<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Nixpkgs Contributors Guide</title><link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="overrides.css" /><link rel="stylesheet" type="text/css" href="highlightjs/mono-blue.css" /><script src="./highlightjs/highlight.pack.js" type="text/javascript"></script><script src="./highlightjs/loader.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /></head><body><div class="book"><div class="titlepage"><div><div><h1 class="title"><a id="idm139978199842960"></a>Nixpkgs Contributors Guide</h1></div><div><h2 class="subtitle">Version "19.09pre-git"

  </h2></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#overview-of-nixpkgs">1.1. Overview of Nixpkgs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-quick-start">2. Quick Start to Adding a Package</a></span></dt><dt><span class="chapter"><a href="#chap-stdenv">3. The Standard Environment</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-using-stdenv">3.1. Using <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="#sec-tools-of-stdenv">3.2. Tools provided by <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="#ssec-stdenv-dependencies">3.3. Specifying dependencies</a></span></dt><dt><span class="section"><a href="#ssec-stdenv-attributes">3.4. Attributes</a></span></dt><dt><span class="section"><a href="#sec-stdenv-phases">3.5. Phases</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-controlling-phases">3.5.1. Controlling phases</a></span></dt><dt><span class="section"><a href="#ssec-unpack-phase">3.5.2. The unpack phase</a></span></dt><dt><span class="section"><a href="#ssec-patch-phase">3.5.3. The patch phase</a></span></dt><dt><span class="section"><a href="#ssec-configure-phase">3.5.4. The configure phase</a></span></dt><dt><span class="section"><a href="#build-phase">3.5.5. The build phase</a></span></dt><dt><span class="section"><a href="#ssec-check-phase">3.5.6. The check phase</a></span></dt><dt><span class="section"><a href="#ssec-install-phase">3.5.7. The install phase</a></span></dt><dt><span class="section"><a href="#ssec-fixup-phase">3.5.8. The fixup phase</a></span></dt><dt><span class="section"><a href="#ssec-installCheck-phase">3.5.9. The installCheck phase</a></span></dt><dt><span class="section"><a href="#ssec-distribution-phase">3.5.10. The distribution phase</a></span></dt></dl></dd><dt><span class="section"><a href="#ssec-stdenv-functions">3.6. Shell functions</a></span></dt><dt><span class="section"><a href="#ssec-setup-hooks">3.7. Package setup hooks</a></span></dt><dt><span class="section"><a href="#sec-purity-in-nixpkgs">3.8. Purity in Nixpkgs</a></span></dt><dt><span class="section"><a href="#sec-hardening-in-nixpkgs">3.9. Hardening in Nixpkgs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-multiple-output">4. Multiple-output packages</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-multiple-outputs-introduction">4.1. Introduction</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-installing">4.2. Installing a split package</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-using-split-packages">4.3. Using a split package</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-">4.4. Writing a split derivation</a></span></dt><dd><dl><dt><span class="section"><a href="#multiple-output-file-binaries-first-convention">4.4.1. <span class="quote">“<span class="quote">Binaries first</span>”</span></a></span></dt><dt><span class="section"><a href="#multiple-output-file-type-groups">4.4.2. File type groups</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-caveats">4.4.3. Common caveats</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-cross">5. Cross-compilation</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-cross-intro">5.1. Introduction</a></span></dt><dt><span class="section"><a href="#sec-cross-packaging">5.2. Packaging in a cross-friendly manner</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-cross-platform-parameters">5.2.1. Platform parameters</a></span></dt><dt><span class="section"><a href="#sec-cross-specifying-dependencies">5.2.2. Specifying Dependencies</a></span></dt><dt><span class="section"><a href="#sec-cross-cookbook">5.2.3. Cross packaging cookbook</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-cross-usage">5.3. Cross-building packages</a></span></dt><dt><span class="section"><a href="#sec-cross-infra">5.4. Cross-compilation infrastructure</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-packageconfig">6. Global configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-allow-broken">6.1. Installing broken packages</a></span></dt><dt><span class="section"><a href="#sec-allow-unsupported-system">6.2. Installing packages on unsupported systems</a></span></dt><dt><span class="section"><a href="#sec-allow-unfree">6.3. Installing unfree packages</a></span></dt><dt><span class="section"><a href="#sec-allow-insecure">6.4. Installing insecure packages</a></span></dt><dt><span class="section"><a href="#sec-modify-via-packageOverrides">6.5. Modify packages via <code class="literal">packageOverrides</code></a></span></dt><dt><span class="section"><a href="#sec-declarative-package-management">6.6. Declarative Package Management</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-building-environment">6.6.1. Build an environment</a></span></dt><dt><span class="section"><a href="#sec-getting-documentation">6.6.2. Getting documentation</a></span></dt><dt><span class="section"><a href="#sec-gnu-info-setup">6.6.3. GNU info setup</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-functions">7. Functions reference</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-functions-library">7.1. Nixpkgs Library Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-functions-library-asserts">7.1.1. Assert functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.asserts.assertMsg">7.1.1.1. <code class="function">lib.asserts.assertMsg</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.asserts.assertOneOf">7.1.1.2. <code class="function">lib.asserts.assertOneOf</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-attrset">7.1.2. Attribute-Set Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.attrsets.attrByPath">7.1.2.1. <code class="function">lib.attrset.attrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.hasAttrByPath">7.1.2.2. <code class="function">lib.attrsets.hasAttrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.setAttrByPath">7.1.2.3. <code class="function">lib.attrsets.setAttrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.getAttrFromPath">7.1.2.4. <code class="function">lib.attrsets.getAttrFromPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.attrVals">7.1.2.5. <code class="function">lib.attrsets.attrVals</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.attrValues">7.1.2.6. <code class="function">lib.attrsets.attrValues</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.catAttrs">7.1.2.7. <code class="function">lib.attrsets.catAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.filterAttrs">7.1.2.8. <code class="function">lib.attrsets.filterAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.filterAttrsRecursive">7.1.2.9. <code class="function">lib.attrsets.filterAttrsRecursive</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.foldAttrs">7.1.2.10. <code class="function">lib.attrsets.foldAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.collect">7.1.2.11. <code class="function">lib.attrsets.collect</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.nameValuePair">7.1.2.12. <code class="function">lib.attrsets.nameValuePair</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrs">7.1.2.13. <code class="function">lib.attrsets.mapAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrs-prime">7.1.2.14. <code class="function">lib.attrsets.mapAttrs'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsToList">7.1.2.15. <code class="function">lib.attrsets.mapAttrsToList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsRecursive">7.1.2.16. <code class="function">lib.attrsets.mapAttrsRecursive</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsRecursiveCond">7.1.2.17. <code class="function">lib.attrsets.mapAttrsRecursiveCond</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.genAttrs">7.1.2.18. <code class="function">lib.attrsets.genAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.isDerivation">7.1.2.19. <code class="function">lib.attrsets.isDerivation</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.toDerivation">7.1.2.20. <code class="function">lib.attrsets.toDerivation</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.optionalAttrs">7.1.2.21. <code class="function">lib.attrsets.optionalAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrsWithNames">7.1.2.22. <code class="function">lib.attrsets.zipAttrsWithNames</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrsWith">7.1.2.23. <code class="function">lib.attrsets.zipAttrsWith</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrs">7.1.2.24. <code class="function">lib.attrsets.zipAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.recursiveUpdateUntil">7.1.2.25. <code class="function">lib.attrsets.recursiveUpdateUntil</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.recursiveUpdate">7.1.2.26. <code class="function">lib.attrsets.recursiveUpdate</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-strings">7.1.3. String manipulation functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.strings.concatStrings">7.1.3.1. <code class="function">lib.strings.concatStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatMapStrings">7.1.3.2. <code class="function">lib.strings.concatMapStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatImapStrings">7.1.3.3. <code class="function">lib.strings.concatImapStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.intersperse">7.1.3.4. <code class="function">lib.strings.intersperse</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatStringsSep">7.1.3.5. <code class="function">lib.strings.concatStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatMapStringsSep">7.1.3.6. <code class="function">lib.strings.concatMapStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatImapStringsSep">7.1.3.7. <code class="function">lib.strings.concatImapStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeSearchPath">7.1.3.8. <code class="function">lib.strings.makeSearchPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeSearchPathOutput">7.1.3.9. <code class="function">lib.strings.makeSearchPathOutput</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeLibraryPath">7.1.3.10. <code class="function">lib.strings.makeLibraryPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeBinPath">7.1.3.11. <code class="function">lib.strings.makeBinPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.optionalString">7.1.3.12. <code class="function">lib.strings.optionalString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasPrefix">7.1.3.13. <code class="function">lib.strings.hasPrefix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasSuffix">7.1.3.14. <code class="function">lib.strings.hasSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasInfix">7.1.3.15. <code class="function">lib.strings.hasInfix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.stringToCharacters">7.1.3.16. <code class="function">lib.strings.stringToCharacters</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.stringAsChars">7.1.3.17. <code class="function">lib.strings.stringAsChars</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escape">7.1.3.18. <code class="function">lib.strings.escape</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeShellArg">7.1.3.19. <code class="function">lib.strings.escapeShellArg</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeShellArgs">7.1.3.20. <code class="function">lib.strings.escapeShellArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeNixString">7.1.3.21. <code class="function">lib.strings.escapeNixString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toLower">7.1.3.22. <code class="function">lib.strings.toLower</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toUpper">7.1.3.23. <code class="function">lib.strings.toUpper</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.addContextFrom">7.1.3.24. <code class="function">lib.strings.addContextFrom</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.splitString">7.1.3.25. <code class="function">lib.strings.splitString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.removePrefix">7.1.3.26. <code class="function">lib.strings.removePrefix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.removeSuffix">7.1.3.27. <code class="function">lib.strings.removeSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.versionOlder">7.1.3.28. <code class="function">lib.strings.versionOlder</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.versionAtLeast">7.1.3.29. <code class="function">lib.strings.versionAtLeast</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.getVersion">7.1.3.30. <code class="function">lib.strings.getVersion</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.nameFromURL">7.1.3.31. <code class="function">lib.strings.nameFromURL</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.enableFeature">7.1.3.32. <code class="function">lib.strings.enableFeature</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.enableFeatureAs">7.1.3.33. <code class="function">lib.strings.enableFeatureAs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.withFeature">7.1.3.34. <code class="function">lib.strings.withFeature</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.withFeatureAs">7.1.3.35. <code class="function">lib.strings.withFeatureAs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fixedWidthString">7.1.3.36. <code class="function">lib.strings.fixedWidthString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fixedWidthNumber">7.1.3.37. <code class="function">lib.strings.fixedWidthNumber</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.isCoercibleToString">7.1.3.38. <code class="function">lib.strings.isCoercibleToString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.isStorePath">7.1.3.39. <code class="function">lib.strings.isStorePath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toInt">7.1.3.40. <code class="function">lib.strings.toInt</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.readPathsFromFile">7.1.3.41. <code class="function">lib.strings.readPathsFromFile</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fileContents">7.1.3.42. <code class="function">lib.strings.fileContents</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-trivial">7.1.4. Miscellaneous functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.trivial.id">7.1.4.1. <code class="function">lib.trivial.id</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.const">7.1.4.2. <code class="function">lib.trivial.const</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.concat">7.1.4.3. <code class="function">lib.trivial.concat</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.or">7.1.4.4. <code class="function">lib.trivial.or</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.and">7.1.4.5. <code class="function">lib.trivial.and</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitAnd">7.1.4.6. <code class="function">lib.trivial.bitAnd</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitOr">7.1.4.7. <code class="function">lib.trivial.bitOr</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitXor">7.1.4.8. <code class="function">lib.trivial.bitXor</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitNot">7.1.4.9. <code class="function">lib.trivial.bitNot</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.boolToString">7.1.4.10. <code class="function">lib.trivial.boolToString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mergeAttrs">7.1.4.11. <code class="function">lib.trivial.mergeAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.flip">7.1.4.12. <code class="function">lib.trivial.flip</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mapNullable">7.1.4.13. <code class="function">lib.trivial.mapNullable</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.version">7.1.4.14. <code class="function">lib.trivial.version</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.release">7.1.4.15. <code class="function">lib.trivial.release</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.codeName">7.1.4.16. <code class="function">lib.trivial.codeName</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.versionSuffix">7.1.4.17. <code class="function">lib.trivial.versionSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.revisionWithDefault">7.1.4.18. <code class="function">lib.trivial.revisionWithDefault</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.inNixShell">7.1.4.19. <code class="function">lib.trivial.inNixShell</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.min">7.1.4.20. <code class="function">lib.trivial.min</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.max">7.1.4.21. <code class="function">lib.trivial.max</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mod">7.1.4.22. <code class="function">lib.trivial.mod</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.compare">7.1.4.23. <code class="function">lib.trivial.compare</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.splitByAndCompare">7.1.4.24. <code class="function">lib.trivial.splitByAndCompare</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.importJSON">7.1.4.25. <code class="function">lib.trivial.importJSON</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.setFunctionArgs">7.1.4.26. <code class="function">lib.trivial.setFunctionArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.functionArgs">7.1.4.27. <code class="function">lib.trivial.functionArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.isFunction">7.1.4.28. <code class="function">lib.trivial.isFunction</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-lists">7.1.5. List manipulation functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.lists.singleton">7.1.5.1. <code class="function">lib.lists.singleton</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldr">7.1.5.2. <code class="function">lib.lists.foldr</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.fold">7.1.5.3. <code class="function">lib.lists.fold</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldl">7.1.5.4. <code class="function">lib.lists.foldl</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldl-prime">7.1.5.5. <code class="function">lib.lists.foldl'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.imap0">7.1.5.6. <code class="function">lib.lists.imap0</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.imap1">7.1.5.7. <code class="function">lib.lists.imap1</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.concatMap">7.1.5.8. <code class="function">lib.lists.concatMap</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.flatten">7.1.5.9. <code class="function">lib.lists.flatten</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.remove">7.1.5.10. <code class="function">lib.lists.remove</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.findSingle">7.1.5.11. <code class="function">lib.lists.findSingle</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.findFirst">7.1.5.12. <code class="function">lib.lists.findFirst</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.any">7.1.5.13. <code class="function">lib.lists.any</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.all">7.1.5.14. <code class="function">lib.lists.all</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.count">7.1.5.15. <code class="function">lib.lists.count</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.optional">7.1.5.16. <code class="function">lib.lists.optional</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.optionals">7.1.5.17. <code class="function">lib.lists.optionals</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.toList">7.1.5.18. <code class="function">lib.lists.toList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.range">7.1.5.19. <code class="function">lib.lists.range</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.partition">7.1.5.20. <code class="function">lib.lists.partition</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.groupBy-prime">7.1.5.21. <code class="function">lib.lists.groupBy'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.zipListsWith">7.1.5.22. <code class="function">lib.lists.zipListsWith</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.zipLists">7.1.5.23. <code class="function">lib.lists.zipLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.reverseList">7.1.5.24. <code class="function">lib.lists.reverseList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.listDfs">7.1.5.25. <code class="function">lib.lists.listDfs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.toposort">7.1.5.26. <code class="function">lib.lists.toposort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.sort">7.1.5.27. <code class="function">lib.lists.sort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.compareLists">7.1.5.28. <code class="function">lib.lists.compareLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.naturalSort">7.1.5.29. <code class="function">lib.lists.naturalSort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.take">7.1.5.30. <code class="function">lib.lists.take</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.drop">7.1.5.31. <code class="function">lib.lists.drop</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.sublist">7.1.5.32. <code class="function">lib.lists.sublist</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.last">7.1.5.33. <code class="function">lib.lists.last</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.init">7.1.5.34. <code class="function">lib.lists.init</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.crossLists">7.1.5.35. <code class="function">lib.lists.crossLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.unique">7.1.5.36. <code class="function">lib.lists.unique</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.intersectLists">7.1.5.37. <code class="function">lib.lists.intersectLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.subtractLists">7.1.5.38. <code class="function">lib.lists.subtractLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.mutuallyExclusive">7.1.5.39. <code class="function">lib.lists.mutuallyExclusive</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-debug">7.1.6. Debugging functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.debug.traceIf">7.1.6.1. <code class="function">lib.debug.traceIf</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValFn">7.1.6.2. <code class="function">lib.debug.traceValFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceVal">7.1.6.3. <code class="function">lib.debug.traceVal</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceSeq">7.1.6.4. <code class="function">lib.debug.traceSeq</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceSeqN">7.1.6.5. <code class="function">lib.debug.traceSeqN</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqFn">7.1.6.6. <code class="function">lib.debug.traceValSeqFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeq">7.1.6.7. <code class="function">lib.debug.traceValSeq</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqNFn">7.1.6.8. <code class="function">lib.debug.traceValSeqNFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqN">7.1.6.9. <code class="function">lib.debug.traceValSeqN</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.runTests">7.1.6.10. <code class="function">lib.debug.runTests</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.testAllTrue">7.1.6.11. <code class="function">lib.debug.testAllTrue</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-options">7.1.7. NixOS / nixpkgs option handling</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.options.isOption">7.1.7.1. <code class="function">lib.options.isOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkOption">7.1.7.2. <code class="function">lib.options.mkOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkEnableOption">7.1.7.3. <code class="function">lib.options.mkEnableOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkSinkUndeclaredOptions">7.1.7.4. <code class="function">lib.options.mkSinkUndeclaredOptions</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mergeEqualOption">7.1.7.5. <code class="function">lib.options.mergeEqualOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.getValues">7.1.7.6. <code class="function">lib.options.getValues</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.getFiles">7.1.7.7. <code class="function">lib.options.getFiles</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.scrubOptionValue">7.1.7.8. <code class="function">lib.options.scrubOptionValue</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.literalExample">7.1.7.9. <code class="function">lib.options.literalExample</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.showOption">7.1.7.10. <code class="function">lib.options.showOption</code></a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#sec-overrides">7.2. Overriding</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkg-override">7.2.1. &lt;pkg&gt;.override</a></span></dt><dt><span class="section"><a href="#sec-pkg-overrideAttrs">7.2.2. &lt;pkg&gt;.overrideAttrs</a></span></dt><dt><span class="section"><a href="#sec-pkg-overrideDerivation">7.2.3. &lt;pkg&gt;.overrideDerivation</a></span></dt><dt><span class="section"><a href="#sec-lib-makeOverridable">7.2.4. lib.makeOverridable</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-generators">7.3. Generators</a></span></dt><dt><span class="section"><a href="#sec-debug">7.4. Debugging Nix Expressions</a></span></dt><dt><span class="section"><a href="#sec-pkgs-fetchers">7.5. Fetcher functions</a></span></dt><dt><span class="section"><a href="#sec-trivial-builders">7.6. Trivial builders</a></span></dt><dt><span class="section"><a href="#sec-fhs-environments">7.7. buildFHSUserEnv</a></span></dt><dt><span class="section"><a href="#sec-pkgs-mkShell">7.8. pkgs.mkShell</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkgs-mkShell-usage">7.8.1. Usage</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-pkgs-dockerTools">7.9. pkgs.dockerTools</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-pkgs-dockerTools-buildImage">7.9.1. buildImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-buildLayeredImage">7.9.2. buildLayeredImage</a></span></dt><dd><dl><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-contents">7.9.2.1. Behavior of <code class="varname">contents</code> in the final image</a></span></dt><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-config">7.9.2.2. Automatic inclusion of <code class="varname">config</code> references</a></span></dt><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-maxLayers">7.9.2.3. Adjusting <code class="varname">maxLayers</code></a></span></dt></dl></dd><dt><span class="section"><a href="#ssec-pkgs-dockerTools-fetchFromRegistry">7.9.3. pullImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-exportImage">7.9.4. exportImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-shadowSetup">7.9.5. shadowSetup</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-pkgs-appimageTools">7.10. pkgs.appimageTools</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-pkgs-appimageTools-formats">7.10.1. AppImage formats</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-appimageTools-wrapping">7.10.2. Wrapping</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-prefer-remote-fetch">7.11. prefer-remote-fetch overlay</a></span></dt><dt><span class="section"><a href="#sec-pkgs-nix-gitignore">7.12. pkgs.nix-gitignore</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkgs-nix-gitignore-usage">7.12.1. Usage</a></span></dt><dt><span class="section"><a href="#sec-pkgs-nix-gitignore-usage-recursive">7.12.2. gitignore files in subdirectories</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-meta">8. Meta-attributes</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-standard-meta-attributes">8.1. Standard meta-attributes</a></span></dt><dt><span class="section"><a href="#sec-meta-license">8.2. Licenses</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-language-support">9. Support for specific programming languages and frameworks</a></span></dt><dd><dl><dt><span class="section"><a href="#android">9.1. Android</a></span></dt><dd><dl><dt><span class="section"><a href="#deploying-an-android-sdk-installation-with-plugins">9.1.1. Deploying an Android SDK installation with plugins</a></span></dt><dt><span class="section"><a href="#using-predefine-android-package-compositions">9.1.2. Using predefine Android package compositions</a></span></dt><dt><span class="section"><a href="#building-an-android-application">9.1.3. Building an Android application</a></span></dt><dt><span class="section"><a href="#spawning-emulator-instances">9.1.4. Spawning emulator instances</a></span></dt><dt><span class="section"><a href="#querying-the-available-versions-of-each-plugin">9.1.5. Querying the available versions of each plugin</a></span></dt><dt><span class="section"><a href="#updating-the-generated-expressions">9.1.6. Updating the generated expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-beam">9.2. BEAM Languages (Erlang, Elixir &amp; LFE)</a></span></dt><dd><dl><dt><span class="section"><a href="#beam-introduction">9.2.1. Introduction</a></span></dt><dt><span class="section"><a href="#beam-structure">9.2.2. Structure</a></span></dt><dt><span class="section"><a href="#build-tools">9.2.3. Build Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#build-tools-rebar3">9.2.3.1. Rebar3</a></span></dt><dt><span class="section"><a href="#build-tools-other">9.2.3.2. Mix &amp; Erlang.mk</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-install-beam-packages">9.2.4. How to Install BEAM Packages</a></span></dt><dt><span class="section"><a href="#packaging-beam-applications">9.2.5. Packaging BEAM Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#packaging-erlang-applications">9.2.5.1. Erlang Applications</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-develop">9.2.6. How to Develop</a></span></dt><dd><dl><dt><span class="section"><a href="#accessing-an-environment">9.2.6.1. Accessing an Environment</a></span></dt><dt><span class="section"><a href="#creating-a-shell">9.2.6.2. Creating a Shell</a></span></dt></dl></dd><dt><span class="section"><a href="#generating-packages-from-hex-with-hex2nix">9.2.7. Generating Packages from Hex with <code class="literal">hex2nix</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-bower">9.3. Bower</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-bower2nix-usage">9.3.1. <span class="command"><strong>bower2nix</strong></span> usage</a></span></dt><dt><span class="section"><a href="#ssec-build-bower-components">9.3.2. <code class="varname">buildBowerComponents</code> function</a></span></dt><dt><span class="section"><a href="#ssec-bower2nix-troubleshooting">9.3.3. Troubleshooting</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-coq">9.4. Coq</a></span></dt><dt><span class="section"><a href="#sec-language-go">9.5. Go</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-go-modules">9.5.1. Go modules</a></span></dt><dt><span class="section"><a href="#ssec-go-legacy">9.5.2. Go legacy</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-the-haskell-infrastructure">9.6. User’s Guide to the Haskell Infrastructure</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-install-haskell-packages">9.6.1. How to install Haskell packages</a></span></dt><dt><span class="section"><a href="#how-to-create-a-development-environment">9.6.2. How to create a development environment</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-install-a-compiler">9.6.2.1. How to install a compiler</a></span></dt><dt><span class="section"><a href="#how-to-install-a-compiler-with-libraries">9.6.2.2. How to install a compiler with libraries</a></span></dt><dt><span class="section"><a href="#how-to-install-a-compiler-with-libraries-hoogle-and-documentation-indexes">9.6.2.3. How to install a compiler with libraries, hoogle and documentation indexes</a></span></dt><dt><span class="section"><a href="#how-to-build-a-haskell-project-using-stack">9.6.2.4. How to build a Haskell project using Stack</a></span></dt><dt><span class="section"><a href="#how-to-create-ad-hoc-environments-for-nix-shell">9.6.2.5. How to create ad hoc environments for <code class="literal">nix-shell</code></a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-create-nix-builds-for-your-own-private-haskell-packages">9.6.3. How to create Nix builds for your own private Haskell packages</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-build-a-stand-alone-project">9.6.3.1. How to build a stand-alone project</a></span></dt><dt><span class="section"><a href="#how-to-build-projects-that-depend-on-each-other">9.6.3.2. How to build projects that depend on each other</a></span></dt></dl></dd><dt><span class="section"><a href="#miscellaneous-topics">9.6.4. Miscellaneous Topics</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-build-with-profiling-enabled">9.6.4.1. How to build with profiling enabled</a></span></dt><dt><span class="section"><a href="#how-to-override-package-versions-in-a-compiler-specific-package-set">9.6.4.2. How to override package versions in a compiler-specific package set</a></span></dt><dt><span class="section"><a href="#how-to-override-packages-in-all-compiler-specific-package-sets">9.6.4.3. How to override packages in all compiler-specific package sets</a></span></dt><dt><span class="section"><a href="#how-to-specify-source-overrides-for-your-haskell-package">9.6.4.4. How to specify source overrides for your Haskell package</a></span></dt><dt><span class="section"><a href="#how-to-recover-from-ghcs-infamous-non-deterministic-library-id-bug">9.6.4.5. How to recover from GHC’s infamous non-deterministic library ID bug</a></span></dt><dt><span class="section"><a href="#builds-on-darwin-fail-with-math.h-not-found">9.6.4.6. Builds on Darwin fail with <code class="literal">math.h</code> not found</a></span></dt><dt><span class="section"><a href="#builds-using-stack-complain-about-missing-system-libraries">9.6.4.7. Builds using Stack complain about missing system libraries</a></span></dt><dt><span class="section"><a href="#creating-statically-linked-binaries">9.6.4.8. Creating statically linked binaries</a></span></dt><dt><span class="section"><a href="#building-ghc-with-integer-simple">9.6.4.9. Building GHC with integer-simple</a></span></dt><dt><span class="section"><a href="#quality-assurance">9.6.4.10. Quality assurance</a></span></dt><dt><span class="section"><a href="#using-hackage2nix-with-nixpkgs">9.6.4.11. Using hackage2nix with nixpkgs</a></span></dt></dl></dd><dt><span class="section"><a href="#other-resources">9.6.5. Other resources</a></span></dt></dl></dd><dt><span class="section"><a href="#idris-packages">9.7. Idris packages</a></span></dt><dd><dl><dt><span class="section"><a href="#installing-idris">9.7.1. Installing Idris</a></span></dt><dt><span class="section"><a href="#starting-idris-with-library-support">9.7.2. Starting Idris with library support</a></span></dt><dt><span class="section"><a href="#building-an-idris-project-with-nix">9.7.3. Building an Idris project with Nix</a></span></dt></dl></dd><dt><span class="section"><a href="#ios">9.8. iOS</a></span></dt><dd><dl><dt><span class="section"><a href="#deploying-a-proxy-component-wrapper-exposing-xcode">9.8.1. Deploying a proxy component wrapper exposing Xcode</a></span></dt><dt><span class="section"><a href="#building-an-ios-application">9.8.2. Building an iOS application</a></span></dt><dt><span class="section"><a href="#spawning-simulator-instances">9.8.3. Spawning simulator instances</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-java">9.9. Java</a></span></dt><dt><span class="section"><a href="#sec-language-lua">9.10. Lua</a></span></dt><dt><span class="section"><a href="#node.js-packages">9.11. Node.js packages</a></span></dt><dt><span class="section"><a href="#sec-language-ocaml">9.12. OCaml</a></span></dt><dt><span class="section"><a href="#sec-language-perl">9.13. Perl</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-generation-from-CPAN">9.13.1. Generation from CPAN</a></span></dt><dt><span class="section"><a href="#ssec-perl-cross-compilation">9.13.2. Cross-compiling modules</a></span></dt></dl></dd><dt><span class="section"><a href="#python">9.14. Python</a></span></dt><dd><dl><dt><span class="section"><a href="#user-guide">9.14.1. User Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#using-python">9.14.1.1. Using Python</a></span></dt><dt><span class="section"><a href="#developing-with-python">9.14.1.2. Developing with Python</a></span></dt><dt><span class="section"><a href="#organising-your-packages">9.14.1.3. Organising your packages</a></span></dt><dt><span class="section"><a href="#including-a-derivation-using-callpackage">9.14.1.4. Including a derivation using <code class="literal">callPackage</code></a></span></dt></dl></dd><dt><span class="section"><a href="#reference">9.14.2. Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#interpreters">9.14.2.1. Interpreters</a></span></dt><dt><span class="section"><a href="#building-packages-and-applications">9.14.2.2. Building packages and applications</a></span></dt><dt><span class="section"><a href="#development-mode">9.14.2.3. Development mode</a></span></dt><dt><span class="section"><a href="#tools">9.14.2.4. Tools</a></span></dt><dt><span class="section"><a href="#deterministic-builds">9.14.2.5. Deterministic builds</a></span></dt><dt><span class="section"><a href="#automatic-tests">9.14.2.6. Automatic tests</a></span></dt></dl></dd><dt><span class="section"><a href="#faq">9.14.3. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-solve-circular-dependencies">9.14.3.1. How to solve circular dependencies?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package">9.14.3.2. How to override a Python package?</a></span></dt><dt><span class="section"><a href="#python-setup.py-bdist_wheel-cannot-create-.whl">9.14.3.3. <code class="literal">python setup.py bdist_wheel</code> cannot create .whl</a></span></dt><dt><span class="section"><a href="#install_data-data_files-problems">9.14.3.4. <code class="literal">install_data</code> / <code class="literal">data_files</code> problems</a></span></dt><dt><span class="section"><a href="#rationale-of-non-existent-global-site-packages">9.14.3.5. Rationale of non-existent global site-packages</a></span></dt><dt><span class="section"><a href="#how-to-consume-python-modules-using-pip-in-a-virtualenv-like-i-am-used-to-on-other-operating-systems">9.14.3.6. How to consume python modules using pip in a virtualenv like I am used to on other Operating Systems ?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package-from-configuration.nix">9.14.3.7. How to override a Python package from <code class="literal">configuration.nix</code>?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package-using-overlays">9.14.3.8. How to override a Python package using overlays?</a></span></dt><dt><span class="section"><a href="#how-to-use-intels-mkl-with-numpy-and-scipy">9.14.3.9. How to use Intel’s MKL with numpy and scipy?</a></span></dt><dt><span class="section"><a href="#what-inputs-do-setup_requires-install_requires-and-tests_require-map-to">9.14.3.10. What inputs do <code class="literal">setup_requires</code>, <code class="literal">install_requires</code> and <code class="literal">tests_require</code> map to?</a></span></dt></dl></dd><dt><span class="section"><a href="#contributing">9.14.4. Contributing</a></span></dt><dd><dl><dt><span class="section"><a href="#contributing-guidelines">9.14.4.1. Contributing guidelines</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#sec-language-qt">9.15. Qt</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-qt-libraries">9.15.1. Packaging Libraries for Nixpkgs</a></span></dt><dt><span class="section"><a href="#ssec-qt-applications">9.15.2. Packaging Applications for Nixpkgs</a></span></dt></dl></dd><dt><span class="section"><a href="#r-packages">9.16. R packages</a></span></dt><dd><dl><dt><span class="section"><a href="#installation">9.16.1. Installation</a></span></dt><dt><span class="section"><a href="#rstudio">9.16.2. RStudio</a></span></dt><dt><span class="section"><a href="#updating-the-package-set">9.16.3. Updating the package set</a></span></dt><dt><span class="section"><a href="#testing-if-the-nix-expression-could-be-evaluated">9.16.4. Testing if the Nix-expression could be evaluated</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-ruby">9.17. Ruby</a></span></dt><dt><span class="section"><a href="#users-guide-to-the-rust-infrastructure">9.18. User’s Guide to the Rust Infrastructure</a></span></dt><dd><dl><dt><span class="section"><a href="#compiling-rust-applications-with-cargo">9.18.1. Compiling Rust applications with Cargo</a></span></dt><dt><span class="section"><a href="#compiling-rust-crates-using-nix-instead-of-cargo">9.18.2. Compiling Rust crates using Nix instead of Cargo</a></span></dt><dd><dl><dt><span class="section"><a href="#simple-operation">9.18.2.1. Simple operation</a></span></dt><dt><span class="section"><a href="#handling-external-dependencies">9.18.2.2. Handling external dependencies</a></span></dt><dt><span class="section"><a href="#options-and-phases-configuration">9.18.2.3. Options and phases configuration</a></span></dt><dt><span class="section"><a href="#features">9.18.2.4. Features</a></span></dt></dl></dd><dt><span class="section"><a href="#setting-up-nix-shell">9.18.3. Setting Up <code class="literal">nix-shell</code></a></span></dt><dd><dl><dt><span class="section"><a href="#controlling-rust-version-inside-nix-shell">9.18.3.1. Controlling Rust Version Inside <code class="literal">nix-shell</code></a></span></dt></dl></dd><dt><span class="section"><a href="#using-the-rust-nightlies-overlay">9.18.4. Using the Rust nightlies overlay</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-texlive">9.19. TeX Live</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-language-texlive-users-guide">9.19.1. User's guide</a></span></dt><dt><span class="section"><a href="#sec-language-texlive-known-problems">9.19.2. Known problems</a></span></dt></dl></dd><dt><span class="section"><a href="#titanium">9.20. Titanium</a></span></dt><dd><dl><dt><span class="section"><a href="#building-a-titanium-app">9.20.1. Building a Titanium app</a></span></dt><dt><span class="section"><a href="#emulating-or-simulating-the-app">9.20.2. Emulating or simulating the app</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-vim-pluginsaddonsbundlesscripts-in-nixpkgs">9.21. User’s Guide to Vim Plugins/Addons/Bundles/Scripts in Nixpkgs</a></span></dt><dd><dl><dt><span class="section"><a href="#custom-configuration">9.21.1. Custom configuration</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vim-packages">9.21.2. Managing plugins with Vim packages</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vim-plug">9.21.3. Managing plugins with vim-plug</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vam">9.21.4. Managing plugins with VAM</a></span></dt><dd><dl><dt><span class="section"><a href="#handling-dependencies-of-vim-plugins">9.21.4.1. Handling dependencies of Vim plugins</a></span></dt><dt><span class="section"><a href="#example">9.21.4.2. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#adding-new-plugins-to-nixpkgs">9.21.5. Adding new plugins to nixpkgs</a></span></dt><dt><span class="section"><a href="#important-repositories">9.21.6. Important repositories</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-emscripten-in-nixpkgs">9.22. User’s Guide to Emscripten in Nixpkgs</a></span></dt><dd><dl><dt><span class="section"><a href="#imperative-usage">9.22.1. Imperative usage</a></span></dt><dt><span class="section"><a href="#declarative-usage">9.22.2. Declarative usage</a></span></dt><dd><dl><dt><span class="section"><a href="#usage-1-pkgs.zlib.override">9.22.2.1. Usage 1: pkgs.zlib.override</a></span></dt><dt><span class="section"><a href="#usage-2-pkgs.buildemscriptenpackage">9.22.2.2. Usage 2: pkgs.buildEmscriptenPackage</a></span></dt><dt><span class="section"><a href="#declarative-debugging">9.22.2.3. Declarative debugging</a></span></dt></dl></dd><dt><span class="section"><a href="#summary">9.22.3. Summary</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-platform-nodes">10. Platform Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-darwin">10.1. Darwin (macOS)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-package-notes">11. Package Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-linux-kernel">11.1. Linux kernel</a></span></dt><dt><span class="section"><a href="#sec-xorg">11.2. X.org</a></span></dt><dt><span class="section"><a href="#sec-eclipse">11.3. Eclipse</a></span></dt><dt><span class="section"><a href="#sec-elm">11.4. Elm</a></span></dt><dt><span class="section"><a href="#sec-shell-helpers">11.5. Interactive shell helpers</a></span></dt><dt><span class="section"><a href="#sec-steam">11.6. Steam</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-steam-nix">11.6.1. Steam in Nix</a></span></dt><dt><span class="section"><a href="#sec-steam-play">11.6.2. How to play</a></span></dt><dt><span class="section"><a href="#sec-steam-troub">11.6.3. Troubleshooting</a></span></dt><dt><span class="section"><a href="#sec-steam-run">11.6.4. steam-run</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-emacs">11.7. Emacs</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-emacs-config">11.7.1. Configuring Emacs</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-weechat">11.8. Weechat</a></span></dt><dt><span class="section"><a href="#sec-citrix">11.9. Citrix Receiver</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-citrix-base">11.9.1. Basic usage</a></span></dt><dt><span class="section"><a href="#sec-citrix-custom-certs">11.9.2. Custom certificates</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-ibus-typing-booster">11.10. ibus-engines.typing-booster</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-ibus-typing-booster-activate">11.10.1. Activating the engine</a></span></dt><dt><span class="section"><a href="#sec-ibus-typing-booster-customize-hunspell">11.10.2. Using custom hunspell dictionaries</a></span></dt><dt><span class="section"><a href="#sec-ibus-typing-booster-emoji-picker">11.10.3. Built-in emoji picker</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chap-overlays">12. Overlays</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-overlays-install">12.1. Installing overlays</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-overlays-argument">12.1.1. Set overlays in NixOS or Nix expressions</a></span></dt><dt><span class="section"><a href="#sec-overlays-lookup">12.1.2. Install overlays via configuration lookup</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-overlays-definition">12.2. Defining overlays</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-conventions">13. Coding conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-syntax">13.1. Syntax</a></span></dt><dt><span class="section"><a href="#sec-package-naming">13.2. Package naming</a></span></dt><dt><span class="section"><a href="#sec-organisation">13.3. File naming and organisation</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-hierarchy">13.3.1. Hierarchy</a></span></dt><dt><span class="section"><a href="#sec-versioning">13.3.2. Versioning</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-sources">13.4. Fetching Sources</a></span></dt><dt><span class="section"><a href="#sec-source-hashes">13.5. Obtaining source hash</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-source-hashes-security">13.5.1. Obtaining hashes securely</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-patches">13.6. Patches</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-submitting-changes">14. Submitting changes</a></span></dt><dd><dl><dt><span class="section"><a href="#submitting-changes-making-patches">14.1. Making patches</a></span></dt><dt><span class="section"><a href="#submitting-changes-submitting-changes">14.2. Submitting changes</a></span></dt><dt><span class="section"><a href="#submitting-changes-pull-request-template">14.3. Pull Request Template</a></span></dt><dd><dl><dt><span class="section"><a href="#submitting-changes-tested-with-sandbox">14.3.1. Tested using sandboxing</a></span></dt><dt><span class="section"><a href="#submitting-changes-platform-diversity">14.3.2. Built on platform(s)</a></span></dt><dt><span class="section"><a href="#submitting-changes-nixos-tests">14.3.3. Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)</a></span></dt><dt><span class="section"><a href="#submitting-changes-tested-compilation">14.3.4. Tested compilation of all pkgs that depend on this change using <span class="command"><strong>nox-review</strong></span></a></span></dt><dt><span class="section"><a href="#submitting-changes-tested-execution">14.3.5. Tested execution of all binary files (usually in <code class="filename">./result/bin/</code>)</a></span></dt><dt><span class="section"><a href="#submitting-changes-contribution-standards">14.3.6. Meets Nixpkgs contribution standards</a></span></dt></dl></dd><dt><span class="section"><a href="#submitting-changes-hotfixing-pull-requests">14.4. Hotfixing pull requests</a></span></dt><dt><span class="section"><a href="#submitting-changes-commit-policy">14.5. Commit policy</a></span></dt><dd><dl><dt><span class="section"><a href="#submitting-changes-master-branch">14.5.1. Master branch</a></span></dt><dt><span class="section"><a href="#submitting-changes-staging-branch">14.5.2. Staging branch</a></span></dt><dt><span class="section"><a href="#submitting-changes-stable-release-branches">14.5.3. Stable release branches</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#sec-reviewing-contributions">15. Reviewing contributions</a></span></dt><dd><dl><dt><span class="section"><a href="#reviewing-contributions-package-updates">15.1. Package updates</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-new-packages">15.2. New packages</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-module-updates">15.3. Module updates</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-new-modules">15.4. New modules</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-other-submissions">15.5. Other submissions</a></span></dt><dt><span class="section"><a href="#reviewing-contributions--merging-pull-requests">15.6. Merging pull requests</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chap-contributing">16. Contributing to this documentation</a></span></dt></dl></div><div class="list-of-examples"><p><strong>List of Examples</strong></p><dl><dt>7.1. <a href="#function-library-lib.asserts.assertMsg-example-false">Printing when the predicate is false</a></dt><dt>7.2. <a href="#function-library-lib.asserts.assertOneOf-example">Ensuring a user provided a possible value</a></dt><dt>7.3. <a href="#function-library-lib.attrset.attrByPath-example-value-exists">Extracting a value from a nested attribute set</a></dt><dt>7.4. <a href="#function-library-lib.attrset.attrByPath-example-default-value">No value at the path, instead using the default</a></dt><dt>7.5. <a href="#function-library-lib.attrsets.hasAttrByPath-example">A nested value does exist inside a set</a></dt><dt>7.6. <a href="#function-library-lib.attrsets.setAttrByPath-example">Creating a new nested attribute set</a></dt><dt>7.7. <a href="#function-library-lib.attrsets.getAttrPath-example-success">Succesfully getting a value from an attribute set</a></dt><dt>7.8. <a href="#function-library-lib.attrsets.getAttrPath-example-throw">Throwing after failing to get a value from an attribute set</a></dt><dt>7.9. <a href="#function-library-lib.attrsets.attrVals-example-success">Getting several values from an attribute set</a></dt><dt>7.10. <a href="#function-library-lib.attrsets.attrVals-failure">Getting missing values from an attribute set</a></dt><dt>7.11. <a href="#function-library-lib.attrsets.attrValues-example"></a></dt><dt>7.12. <a href="#function-library-lib.attrsets.catAttrs-example">Collect an attribute from a list of attribute sets.</a></dt><dt>7.13. <a href="#function-library-lib.attrsets.filterAttrs-example">Filtering an attributeset</a></dt><dt>7.14. <a href="#function-library-lib.attrsets.filterAttrsRecursive-example">Recursively filtering an attribute set</a></dt><dt>7.15. <a href="#function-library-lib.attrsets.foldAttrs-example">Combining an attribute of lists in to one attribute set</a></dt><dt>7.16. <a href="#function-library-lib.attrsets.collect-example-lists">Collecting all lists from an attribute set</a></dt><dt>7.17. <a href="#function-library-lib.attrsets.collect-example-outpath">Collecting all attribute-sets which contain the <code class="literal">outPath</code> attribute name.</a></dt><dt>7.18. <a href="#function-library-lib.attrsets.nameValuePair-example">Creating a name value pair</a></dt><dt>7.19. <a href="#function-library-lib.attrsets.mapAttrs-example">Modifying each value of an attribute set</a></dt><dt>7.20. <a href="#function-library-lib.attrsets.mapAttrs-prime-example">Change the name and value of each attribute of an attribute set</a></dt><dt>7.21. <a href="#function-library-lib.attrsets.mapAttrsToList-example">Combine attribute values and names in to a list</a></dt><dt>7.22. <a href="#function-library-lib.attrsets.mapAttrsRecursive-example">A contrived example of using <code class="function">lib.attrsets.mapAttrsRecursive</code></a></dt><dt>7.23. <a href="#function-library-lib.attrsets.mapAttrsRecursiveCond-example">Only convert attribute values to JSON if the containing attribute set is marked for recursion</a></dt><dt>7.24. <a href="#function-library-lib.attrsets.genAttrs-example">Generate an attrset based on names only</a></dt><dt>7.25. <a href="#function-library-lib.attrsets.isDerivation-example-true">A package is a derivation</a></dt><dt>7.26. <a href="#function-library-lib.attrsets.isDerivation-example-false">Anything else is not a derivation</a></dt><dt>7.27. <a href="#function-library-lib.attrsets.optionalAttrs-example-true">Return the provided attribute set when <code class="varname">cond</code> is true</a></dt><dt>7.28. <a href="#function-library-lib.attrsets.optionalAttrs-example-false">Return an empty attribute set when <code class="varname">cond</code> is false</a></dt><dt>7.29. <a href="#function-library-lib.attrsets.zipAttrsWithNames-example">Summing a list of attribute sets of numbers</a></dt><dt>7.30. <a href="#function-library-lib.attrsets.zipAttrsWith-example">Summing a list of attribute sets of numbers</a></dt><dt>7.31. <a href="#function-library-lib.attrsets.zipAttrs-example">Combining a list of attribute sets</a></dt><dt>7.32. <a href="#function-library-lib.attrsets.recursiveUpdateUntil-example">Recursively merging two attribute sets</a></dt><dt>7.33. <a href="#function-library-lib.attrsets.recursiveUpdate-example">Recursively merging two attribute sets</a></dt><dt>7.34. <a href="#idm139978171580928"><code class="function">lib.strings.concatStrings</code> usage example</a></dt><dt>7.35. <a href="#idm139978171569648"><code class="function">lib.strings.concatMapStrings</code> usage example</a></dt><dt>7.36. <a href="#idm139978171558144"><code class="function">lib.strings.concatImapStrings</code> usage example</a></dt><dt>7.37. <a href="#idm139978171546784"><code class="function">lib.strings.intersperse</code> usage example</a></dt><dt>7.38. <a href="#idm139978171539968"><code class="function">lib.strings.concatStringsSep</code> usage example</a></dt><dt>7.39. <a href="#idm139978171526528"><code class="function">lib.strings.concatMapStringsSep</code> usage example</a></dt><dt>7.40. <a href="#idm139978171512960"><code class="function">lib.strings.concatImapStringsSep</code> usage example</a></dt><dt>7.41. <a href="#idm139978171501440"><code class="function">lib.strings.makeSearchPath</code> usage example</a></dt><dt>7.42. <a href="#idm139978171487840"><code class="function">lib.strings.makeSearchPathOutput</code> usage example</a></dt><dt>7.43. <a href="#idm139978171481680"><code class="function">lib.strings.makeLibraryPath</code> usage example</a></dt><dt>7.44. <a href="#idm139978171475680"><code class="function">lib.strings.makeBinPath</code> usage example</a></dt><dt>7.45. <a href="#idm139978171464176"><code class="function">lib.strings.optionalString</code> usage example</a></dt><dt>7.46. <a href="#idm139978171452912"><code class="function">lib.strings.hasPrefix</code> usage example</a></dt><dt>7.47. <a href="#idm139978171441696"><code class="function">lib.strings.hasSuffix</code> usage example</a></dt><dt>7.48. <a href="#idm139978171430368"><code class="function">lib.strings.hasInfix</code> usage example</a></dt><dt>7.49. <a href="#idm139978171420640"><code class="function">lib.strings.stringToCharacters</code> usage example</a></dt><dt>7.50. <a href="#idm139978171409184"><code class="function">lib.strings.stringAsChars</code> usage example</a></dt><dt>7.51. <a href="#idm139978171399872"><code class="function">lib.strings.escape</code> usage example</a></dt><dt>7.52. <a href="#idm139978171390608"><code class="function">lib.strings.escapeShellArg</code> usage example</a></dt><dt>7.53. <a href="#idm139978171383728"><code class="function">lib.strings.escapeShellArgs</code> usage example</a></dt><dt>7.54. <a href="#idm139978171374384"><code class="function">lib.strings.escapeNixString</code> usage example</a></dt><dt>7.55. <a href="#idm139978171367488"><code class="function">lib.strings.toLower</code> usage example</a></dt><dt>7.56. <a href="#idm139978171360816"><code class="function">lib.strings.toUpper</code> usage example</a></dt><dt>7.57. <a href="#idm139978171349584"><code class="function">lib.strings.addContextFrom</code> usage example</a></dt><dt>7.58. <a href="#idm139978171338368"><code class="function">lib.strings.splitString</code> usage example</a></dt><dt>7.59. <a href="#idm139978171327056"><code class="function">lib.strings.removePrefix</code> usage example</a></dt><dt>7.60. <a href="#idm139978171315664"><code class="function">lib.strings.removeSuffix</code> usage example</a></dt><dt>7.61. <a href="#idm139978171305104"><code class="function">lib.strings.versionOlder</code> usage example</a></dt><dt>7.62. <a href="#idm139978171294544"><code class="function">lib.strings.versionAtLeast</code> usage example</a></dt><dt>7.63. <a href="#idm139978171285968"><code class="function">lib.strings.getVersion</code> usage example</a></dt><dt>7.64. <a href="#idm139978171275472"><code class="function">lib.strings.nameFromURL</code> usage example</a></dt><dt>7.65. <a href="#idm139978171264848"><code class="function">lib.strings.enableFeature</code> usage example</a></dt><dt>7.66. <a href="#idm139978171251920"><code class="function">lib.strings.enableFeatureAs</code> usage example</a></dt><dt>7.67. <a href="#idm139978171241040"><code class="function">lib.strings.withFeature</code> usage example</a></dt><dt>7.68. <a href="#idm139978171228208"><code class="function">lib.strings.withFeatureAs</code> usage example</a></dt><dt>7.69. <a href="#idm139978171214112"><code class="function">lib.strings.fixedWidthString</code> usage example</a></dt><dt>7.70. <a href="#idm139978171203616"><code class="function">lib.strings.fixedWidthNumber</code> usage example</a></dt><dt>7.71. <a href="#idm139978171188368"><code class="function">lib.strings.isStorePath</code> usage example</a></dt><dt>7.72. <a href="#idm139978171178976"><code class="function">lib.strings.toInt</code> usage example</a></dt><dt>7.73. <a href="#idm139978171167664"><code class="function">lib.strings.readPathsFromFile</code> usage example</a></dt><dt>7.74. <a href="#idm139978171158096"><code class="function">lib.strings.fileContents</code> usage example</a></dt><dt>7.75. <a href="#idm139978171136032"><code class="function">lib.trivial.const</code> usage example</a></dt><dt>7.76. <a href="#idm139978171124848"><code class="function">lib.trivial.concat</code> usage example</a></dt><dt>7.77. <a href="#idm139978171070992"><code class="function">lib.trivial.mergeAttrs</code> usage example</a></dt><dt>7.78. <a href="#idm139978171057744"><code class="function">lib.trivial.flip</code> usage example</a></dt><dt>7.79. <a href="#idm139978171047328"><code class="function">lib.trivial.mapNullable</code> usage example</a></dt><dt>7.80. <a href="#idm139978170988448"><code class="function">lib.trivial.mod</code> usage example</a></dt><dt>7.81. <a href="#idm139978170961648"><code class="function">lib.trivial.splitByAndCompare</code> usage example</a></dt><dt>7.82. <a href="#idm139978170918080"><code class="function">lib.lists.singleton</code> usage example</a></dt><dt>7.83. <a href="#idm139978170904416"><code class="function">lib.lists.foldr</code> usage example</a></dt><dt>7.84. <a href="#idm139978170886592"><code class="function">lib.lists.foldl</code> usage example</a></dt><dt>7.85. <a href="#idm139978170869408"><code class="function">lib.lists.imap0</code> usage example</a></dt><dt>7.86. <a href="#idm139978170858160"><code class="function">lib.lists.imap1</code> usage example</a></dt><dt>7.87. <a href="#idm139978170851424"><code class="function">lib.lists.concatMap</code> usage example</a></dt><dt>7.88. <a href="#idm139978170842848"><code class="function">lib.lists.flatten</code> usage example</a></dt><dt>7.89. <a href="#idm139978170833488"><code class="function">lib.lists.remove</code> usage example</a></dt><dt>7.90. <a href="#idm139978170818256"><code class="function">lib.lists.findSingle</code> usage example</a></dt><dt>7.91. <a href="#idm139978170804672"><code class="function">lib.lists.findFirst</code> usage example</a></dt><dt>7.92. <a href="#idm139978170797776"><code class="function">lib.lists.any</code> usage example</a></dt><dt>7.93. <a href="#idm139978170790864"><code class="function">lib.lists.all</code> usage example</a></dt><dt>7.94. <a href="#idm139978170781504"><code class="function">lib.lists.count</code> usage example</a></dt><dt>7.95. <a href="#idm139978170770080"><code class="function">lib.lists.optional</code> usage example</a></dt><dt>7.96. <a href="#idm139978170758784"><code class="function">lib.lists.optionals</code> usage example</a></dt><dt>7.97. <a href="#idm139978170750464"><code class="function">lib.lists.toList</code> usage example</a></dt><dt>7.98. <a href="#idm139978170739120"><code class="function">lib.lists.range</code> usage example</a></dt><dt>7.99. <a href="#idm139978170732208"><code class="function">lib.lists.partition</code> usage example</a></dt><dt>7.100. <a href="#idm139978170717280"><code class="function">lib.lists.groupBy'</code> usage example</a></dt><dt>7.101. <a href="#idm139978170703264"><code class="function">lib.lists.zipListsWith</code> usage example</a></dt><dt>7.102. <a href="#idm139978170696288"><code class="function">lib.lists.zipLists</code> usage example</a></dt><dt>7.103. <a href="#idm139978170687024"><code class="function">lib.lists.reverseList</code> usage example</a></dt><dt>7.104. <a href="#idm139978170673952"><code class="function">lib.lists.listDfs</code> usage example</a></dt><dt>7.105. <a href="#idm139978170662144"><code class="function">lib.lists.toposort</code> usage example</a></dt><dt>7.106. <a href="#idm139978170654736"><code class="function">lib.lists.sort</code> usage example</a></dt><dt>7.107. <a href="#idm139978170642400"><code class="function">lib.lists.compareLists</code> usage example</a></dt><dt>7.108. <a href="#idm139978170633632"><code class="function">lib.lists.naturalSort</code> usage example</a></dt><dt>7.109. <a href="#idm139978170624160"><code class="function">lib.lists.take</code> usage example</a></dt><dt>7.110. <a href="#idm139978170612784"><code class="function">lib.lists.drop</code> usage example</a></dt><dt>7.111. <a href="#idm139978170599456"><code class="function">lib.lists.sublist</code> usage example</a></dt><dt>7.112. <a href="#idm139978170589568"><code class="function">lib.lists.last</code> usage example</a></dt><dt>7.113. <a href="#idm139978170579792"><code class="function">lib.lists.init</code> usage example</a></dt><dt>7.114. <a href="#idm139978170571328"><code class="function">lib.lists.crossLists</code> usage example</a></dt><dt>7.115. <a href="#idm139978170562016"><code class="function">lib.lists.unique</code> usage example</a></dt><dt>7.116. <a href="#idm139978170553472"><code class="function">lib.lists.intersectLists</code> usage example</a></dt><dt>7.117. <a href="#idm139978170544928"><code class="function">lib.lists.subtractLists</code> usage example</a></dt><dt>7.118. <a href="#idm139978170520128"><code class="function">lib.debug.traceIf</code> usage example</a></dt><dt>7.119. <a href="#idm139978170508896"><code class="function">lib.debug.traceValFn</code> usage example</a></dt><dt>7.120. <a href="#idm139978170502144"><code class="function">lib.debug.traceVal</code> usage example</a></dt><dt>7.121. <a href="#idm139978170490928"><code class="function">lib.debug.traceSeq</code> usage example</a></dt><dt>7.122. <a href="#idm139978170478112"><code class="function">lib.debug.traceSeqN</code> usage example</a></dt><dt>7.123. <a href="#idm139978170432736"><code class="function">lib.debug.testAllTrue</code> usage example</a></dt><dt>7.124. <a href="#idm139978170423328"><code class="function">lib.options.isOption</code> usage example</a></dt><dt>7.125. <a href="#idm139978170391296"><code class="function">lib.options.mkOption</code> usage example</a></dt><dt>7.126. <a href="#idm139978170382400"><code class="function">lib.options.mkEnableOption</code> usage example</a></dt><dt>7.127. <a href="#idm139978170359184"><code class="function">lib.options.getValues</code> usage example</a></dt><dt>7.128. <a href="#idm139978170352032"><code class="function">lib.options.getFiles</code> usage example</a></dt><dt>7.129. <a href="#idm139978170328688"><code class="function">lib.options.showOption</code> usage example</a></dt><dt>7.130. <a href="#ex-dockerTools-buildImage">Docker build</a></dt><dt>7.131. <a href="#example-pkgs-dockerTools-buildImage-creation-date">Impurely Defining a Docker Layer's Creation Date</a></dt><dt>7.132. <a href="#ex-dockerTools-pullImage">Docker pull</a></dt><dt>7.133. <a href="#ex-dockerTools-exportImage">Docker export</a></dt><dt>7.134. <a href="#ex-dockerTools-shadowSetup">Shadow base files</a></dt><dt>9.1. <a href="#ex-bowerJson"><code class="filename">bower.json</code></a></dt><dt>9.2. <a href="#ex-buildBowerComponents">buildBowerComponents</a></dt><dt>9.3. <a href="#ex-bowerGulpFile">Example build script (<code class="filename">gulpfile.js</code>)</a></dt><dt>9.4. <a href="#ex-buildBowerComponentsDefaultNix">Full example — <code class="filename">default.nix</code></a></dt><dt>9.5. <a href="#ex-buildGoModule">buildGoModule</a></dt><dt>9.6. <a href="#ex-buildGoPackage">buildGoPackage</a></dt><dt>9.7. <a href="#ex-goDeps">deps.nix</a></dt><dt>15.1. <a href="#reviewing-contributions-sample-package-update">Sample template for a package update review</a></dt><dt>15.2. <a href="#reviewing-contributions-sample-new-package">Sample template for a new package review</a></dt><dt>15.3. <a href="#reviewing-contributions-sample-module-update">Sample template for a module update review</a></dt><dt>15.4. <a href="#reviewing-contributions-sample-new-module">Sample template for a new module review</a></dt></dl></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="introduction"></a>Chapter 1. Introduction</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#overview-of-nixpkgs">1.1. Overview of Nixpkgs</a></span></dt></dl></div><p>
   The Nix Packages collection (Nixpkgs) is a set of thousands of packages for
   the <a class="link" href="http://nixos.org/nix/" target="_top">Nix package manager</a>,
   released under a
   <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/COPYING" target="_top">permissive
   MIT/X11 license</a>. Packages are available for several platforms, and
   can be used with the Nix package manager on most GNU/Linux distributions as
   well as NixOS.
  </p><p>
   This manual primarily describes how to write packages for the Nix Packages
   collection (Nixpkgs). Thus it’s mainly for packagers and developers
   who want to add packages to Nixpkgs. If you like to learn more about the Nix
   package manager and the Nix expression language, then you are kindly
   referred to the <a class="link" href="http://nixos.org/nix/manual/" target="_top">Nix
   manual</a>.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="overview-of-nixpkgs"></a>1.1. Overview of Nixpkgs</h2></div></div></div><p>
    Nix expressions describe how to build packages from source and are
    collected in the
    <a class="link" href="https://github.com/NixOS/nixpkgs" target="_top">nixpkgs
    repository</a>. Also included in the collection are Nix expressions for
    <a class="link" href="http://nixos.org/nixos/manual/index.html#sec-writing-modules" target="_top">NixOS
    modules</a>. With these expressions the Nix package manager can build
    binary packages.
   </p><p>
    Packages, including the Nix packages collection, are distributed through
    <a class="link" href="http://nixos.org/nix/manual/#sec-channels" target="_top">channels</a>.
    The collection is distributed for users of Nix on non-NixOS distributions
    through the channel <code class="literal">nixpkgs</code>. Users of NixOS generally
    use one of the <code class="literal">nixos-*</code> channels, e.g.
    <code class="literal">nixos-16.03</code>, which includes all packages and modules for
    the stable NixOS 16.03. Stable NixOS releases are generally only given
    security updates. More up to date packages and modules are available via
    the <code class="literal">nixos-unstable</code> channel.
   </p><p>
    Both <code class="literal">nixos-unstable</code> and <code class="literal">nixpkgs</code>
    follow the <code class="literal">master</code> branch of the Nixpkgs repository,
    although both do lag the <code class="literal">master</code> branch by generally
    <a class="link" href="http://howoldis.herokuapp.com/" target="_top">a couple of days</a>.
    Updates to a channel are distributed as soon as all tests for that channel
    pass, e.g.
    <a class="link" href="http://hydra.nixos.org/job/nixpkgs/trunk/unstable#tabs-constituents" target="_top">this
    table</a> shows the status of tests for the <code class="literal">nixpkgs</code>
    channel.
   </p><p>
    The tests are conducted by a cluster called
    <a class="link" href="http://nixos.org/hydra/" target="_top">Hydra</a>, which also builds
    binary packages from the Nix expressions in Nixpkgs for
    <code class="literal">x86_64-linux</code>, <code class="literal">i686-linux</code> and
    <code class="literal">x86_64-darwin</code>. The binaries are made available via a
    <a class="link" href="https://cache.nixos.org" target="_top">binary cache</a>.
   </p><p>
    The current Nix expressions of the channels are available in the
    <a class="link" href="https://github.com/NixOS/nixpkgs-channels" target="_top"><code class="literal">nixpkgs-channels</code></a>
    repository, which has branches corresponding to the available channels.
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-quick-start"></a>Chapter 2. Quick Start to Adding a Package</h1></div></div></div><p>
   To add a package to Nixpkgs:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      Checkout the Nixpkgs source tree:
</p><pre class="screen">
$ git clone https://github.com/NixOS/nixpkgs
$ cd nixpkgs</pre><p>
     </p></li><li class="listitem"><p>
      Find a good place in the Nixpkgs tree to add the Nix expression for your
      package. For instance, a library package typically goes into
      <code class="filename">pkgs/development/libraries/<em class="replaceable"><code>pkgname</code></em></code>,
      while a web browser goes into
      <code class="filename">pkgs/applications/networking/browsers/<em class="replaceable"><code>pkgname</code></em></code>.
      See <a class="xref" href="#sec-organisation" title="13.3. File naming and organisation">Section 13.3, “File naming and organisation”</a> for some hints on the tree
      organisation. Create a directory for your package, e.g.
</p><pre class="screen">
$ mkdir pkgs/development/libraries/libfoo</pre><p>
     </p></li><li class="listitem"><p>
      In the package directory, create a Nix expression — a piece of
      code that describes how to build the package. In this case, it should be
      a <span class="emphasis"><em>function</em></span> that is called with the package
      dependencies as arguments, and returns a build of the package in the Nix
      store. The expression should usually be called
      <code class="filename">default.nix</code>.
</p><pre class="screen">
$ emacs pkgs/development/libraries/libfoo/default.nix
$ git add pkgs/development/libraries/libfoo/default.nix</pre><p>
     </p><p>
      You can have a look at the existing Nix expressions under
      <code class="filename">pkgs/</code> to see how it’s done. Here are some
      good ones:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         GNU Hello:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/hello/default.nix" target="_top"><code class="filename">pkgs/applications/misc/hello/default.nix</code></a>.
         Trivial package, which specifies some <code class="varname">meta</code>
         attributes which is good practice.
        </p></li><li class="listitem"><p>
         GNU cpio:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/tools/archivers/cpio/default.nix" target="_top"><code class="filename">pkgs/tools/archivers/cpio/default.nix</code></a>.
         Also a simple package. The generic builder in
         <code class="varname">stdenv</code> does everything for you. It has no
         dependencies beyond <code class="varname">stdenv</code>.
        </p></li><li class="listitem"><p>
         GNU Multiple Precision arithmetic library (GMP):
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/libraries/gmp/5.1.x.nix" target="_top"><code class="filename">pkgs/development/libraries/gmp/5.1.x.nix</code></a>.
         Also done by the generic builder, but has a dependency on
         <code class="varname">m4</code>.
        </p></li><li class="listitem"><p>
         Pan, a GTK-based newsreader:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/newsreaders/pan/default.nix" target="_top"><code class="filename">pkgs/applications/networking/newsreaders/pan/default.nix</code></a>.
         Has an optional dependency on <code class="varname">gtkspell</code>, which is
         only built if <code class="varname">spellCheck</code> is
         <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
         Apache HTTPD:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/servers/http/apache-httpd/2.4.nix" target="_top"><code class="filename">pkgs/servers/http/apache-httpd/2.4.nix</code></a>.
         A bunch of optional features, variable substitutions in the configure
         flags, a post-install hook, and miscellaneous hackery.
        </p></li><li class="listitem"><p>
         Thunderbird:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/mailreaders/thunderbird/default.nix" target="_top"><code class="filename">pkgs/applications/networking/mailreaders/thunderbird/default.nix</code></a>.
         Lots of dependencies.
        </p></li><li class="listitem"><p>
         JDiskReport, a Java utility:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/tools/misc/jdiskreport/default.nix" target="_top"><code class="filename">pkgs/tools/misc/jdiskreport/default.nix</code></a>
         (and the
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/tools/misc/jdiskreport/builder.sh" target="_top">builder</a>).
         Nixpkgs doesn’t have a decent <code class="varname">stdenv</code> for
         Java yet so this is pretty ad-hoc.
        </p></li><li class="listitem"><p>
         XML::Simple, a Perl module:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/perl-packages.nix" target="_top"><code class="filename">pkgs/top-level/perl-packages.nix</code></a>
         (search for the <code class="varname">XMLSimple</code> attribute). Most Perl
         modules are so simple to build that they are defined directly in
         <code class="filename">perl-packages.nix</code>; no need to make a separate
         file for them.
        </p></li><li class="listitem"><p>
         Adobe Reader:
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/adobe-reader/default.nix" target="_top"><code class="filename">pkgs/applications/misc/adobe-reader/default.nix</code></a>.
         Shows how binary-only packages can be supported. In particular the
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/misc/adobe-reader/builder.sh" target="_top">builder</a>
         uses <span class="command"><strong>patchelf</strong></span> to set the RUNPATH and ELF
         interpreter of the executables so that the right libraries are found
         at runtime.
        </p></li></ul></div><p>
     </p><p>
      Some notes:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         All <code class="varname"><a class="varname" href="#chap-meta" title="Chapter 8. Meta-attributes">meta</a></code> attributes are
         optional, but it’s still a good idea to provide at least the
         <code class="varname">description</code>, <code class="varname">homepage</code> and
         <code class="varname"><a class="varname" href="#sec-meta-license" title="8.2. Licenses">license</a></code>.
        </p></li><li class="listitem"><p>
         You can use <span class="command"><strong>nix-prefetch-url</strong></span>
         <em class="replaceable"><code>url</code></em> to get the SHA-256 hash of source
         distributions. There are similar commands as
         <span class="command"><strong>nix-prefetch-git</strong></span> and
         <span class="command"><strong>nix-prefetch-hg</strong></span> available in
         <code class="literal">nix-prefetch-scripts</code> package.
        </p></li><li class="listitem"><p>
         A list of schemes for <code class="literal">mirror://</code> URLs can be found
         in
         <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/build-support/fetchurl/mirrors.nix" target="_top"><code class="filename">pkgs/build-support/fetchurl/mirrors.nix</code></a>.
        </p></li></ul></div><p>
     </p><p>
      The exact syntax and semantics of the Nix expression language, including
      the built-in function, are described in the Nix manual in the
      <a class="link" href="http://hydra.nixos.org/job/nix/trunk/tarball/latest/download-by-type/doc/manual/#chap-writing-nix-expressions" target="_top">chapter
      on writing Nix expressions</a>.
     </p></li><li class="listitem"><p>
      Add a call to the function defined in the previous step to
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/all-packages.nix" target="_top"><code class="filename">pkgs/top-level/all-packages.nix</code></a>
      with some descriptive name for the variable, e.g.
      <code class="varname">libfoo</code>.
</p><pre class="screen">
$ emacs pkgs/top-level/all-packages.nix</pre><p>
     </p><p>
      The attributes in that file are sorted by category (like
      “Development / Libraries”) that more-or-less correspond to
      the directory structure of Nixpkgs, and then by attribute name.
     </p></li><li class="listitem"><p>
      To test whether the package builds, run the following command from the
      root of the nixpkgs source tree:
</p><pre class="screen">
$ nix-build -A libfoo</pre><p>
      where <code class="varname">libfoo</code> should be the variable name defined in
      the previous step. You may want to add the flag <code class="option">-K</code> to
      keep the temporary build directory in case something fails. If the build
      succeeds, a symlink <code class="filename">./result</code> to the package in the
      Nix store is created.
     </p></li><li class="listitem"><p>
      If you want to install the package into your profile (optional), do
</p><pre class="screen">
$ nix-env -f . -iA libfoo</pre><p>
     </p></li><li class="listitem"><p>
      Optionally commit the new package and open a pull request, or send a
      patch to
      <code class="literal">https://groups.google.com/forum/#!forum/nix-devel</code>.
     </p></li></ol></div><p>
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-stdenv"></a>Chapter 3. The Standard Environment</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-using-stdenv">3.1. Using <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="#sec-tools-of-stdenv">3.2. Tools provided by <code class="literal">stdenv</code></a></span></dt><dt><span class="section"><a href="#ssec-stdenv-dependencies">3.3. Specifying dependencies</a></span></dt><dt><span class="section"><a href="#ssec-stdenv-attributes">3.4. Attributes</a></span></dt><dt><span class="section"><a href="#sec-stdenv-phases">3.5. Phases</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-controlling-phases">3.5.1. Controlling phases</a></span></dt><dt><span class="section"><a href="#ssec-unpack-phase">3.5.2. The unpack phase</a></span></dt><dt><span class="section"><a href="#ssec-patch-phase">3.5.3. The patch phase</a></span></dt><dt><span class="section"><a href="#ssec-configure-phase">3.5.4. The configure phase</a></span></dt><dt><span class="section"><a href="#build-phase">3.5.5. The build phase</a></span></dt><dt><span class="section"><a href="#ssec-check-phase">3.5.6. The check phase</a></span></dt><dt><span class="section"><a href="#ssec-install-phase">3.5.7. The install phase</a></span></dt><dt><span class="section"><a href="#ssec-fixup-phase">3.5.8. The fixup phase</a></span></dt><dt><span class="section"><a href="#ssec-installCheck-phase">3.5.9. The installCheck phase</a></span></dt><dt><span class="section"><a href="#ssec-distribution-phase">3.5.10. The distribution phase</a></span></dt></dl></dd><dt><span class="section"><a href="#ssec-stdenv-functions">3.6. Shell functions</a></span></dt><dt><span class="section"><a href="#ssec-setup-hooks">3.7. Package setup hooks</a></span></dt><dt><span class="section"><a href="#sec-purity-in-nixpkgs">3.8. Purity in Nixpkgs</a></span></dt><dt><span class="section"><a href="#sec-hardening-in-nixpkgs">3.9. Hardening in Nixpkgs</a></span></dt></dl></div><p>
   The standard build environment in the Nix Packages collection provides an
   environment for building Unix packages that does a lot of common build tasks
   automatically. In fact, for Unix packages that use the standard
   <code class="literal">./configure; make; make install</code> build interface, you
   don’t need to write a build script at all; the standard environment
   does everything automatically. If <code class="literal">stdenv</code> doesn’t
   do what you need automatically, you can easily customise or override the
   various build phases.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-using-stdenv"></a>3.1. Using <code class="literal">stdenv</code></h2></div></div></div><p>
    To build a package with the standard environment, you use the function
    <code class="varname">stdenv.mkDerivation</code>, instead of the primitive built-in
    function <code class="varname">derivation</code>, e.g.
</p><pre class="programlisting">
stdenv.mkDerivation {
  name = "libfoo-1.2.3";
  src = fetchurl {
    url = http://example.org/libfoo-1.2.3.tar.bz2;
    sha256 = "0x2g1jqygyr5wiwg4ma1nd7w4ydpy82z9gkcv8vh2v8dn3y58v5m";
  };
}</pre><p>
    (<code class="varname">stdenv</code> needs to be in scope, so if you write this in a
    separate Nix expression from <code class="filename">pkgs/all-packages.nix</code>,
    you need to pass it as a function argument.) Specifying a
    <code class="varname">name</code> and a <code class="varname">src</code> is the absolute
    minimum you need to do. Many packages have dependencies that are not
    provided in the standard environment. It’s usually sufficient to
    specify those dependencies in the <code class="varname">buildInputs</code> attribute:
</p><pre class="programlisting">
stdenv.mkDerivation {
  name = "libfoo-1.2.3";
  ...
  buildInputs = [libbar perl ncurses];
}</pre><p>
    This attribute ensures that the <code class="filename">bin</code> subdirectories of
    these packages appear in the <code class="envar">PATH</code> environment variable
    during the build, that their <code class="filename">include</code> subdirectories
    are searched by the C compiler, and so on. (See
    <a class="xref" href="#ssec-setup-hooks" title="3.7. Package setup hooks">Section 3.7, “Package setup hooks”</a> for details.)
   </p><p>
    Often it is necessary to override or modify some aspect of the build. To
    make this easier, the standard environment breaks the package build into a
    number of <span class="emphasis"><em>phases</em></span>, all of which can be overridden or
    modified individually: unpacking the sources, applying patches,
    configuring, building, and installing. (There are some others; see
    <a class="xref" href="#sec-stdenv-phases" title="3.5. Phases">Section 3.5, “Phases”</a>.) For instance, a package that
    doesn’t supply a makefile but instead has to be compiled
    “manually” could be handled like this:
</p><pre class="programlisting">
stdenv.mkDerivation {
  name = "fnord-4.5";
  ...
  buildPhase = ''
    gcc foo.c -o foo
  '';
  installPhase = ''
    mkdir -p $out/bin
    cp foo $out/bin
  '';
}</pre><p>
    (Note the use of <code class="literal">''</code>-style string literals, which are
    very convenient for large multi-line script fragments because they
    don’t need escaping of <code class="literal">"</code> and
    <code class="literal">\</code>, and because indentation is intelligently removed.)
   </p><p>
    There are many other attributes to customise the build. These are listed in
    <a class="xref" href="#ssec-stdenv-attributes" title="3.4. Attributes">Section 3.4, “Attributes”</a>.
   </p><p>
    While the standard environment provides a generic builder, you can still
    supply your own build script:
</p><pre class="programlisting">
stdenv.mkDerivation {
  name = "libfoo-1.2.3";
  ...
  builder = ./builder.sh;
}</pre><p>
    where the builder can do anything it wants, but typically starts with
</p><pre class="programlisting">
source $stdenv/setup
</pre><p>
    to let <code class="literal">stdenv</code> set up the environment (e.g., process the
    <code class="varname">buildInputs</code>). If you want, you can still use
    <code class="literal">stdenv</code>’s generic builder:
</p><pre class="programlisting">
source $stdenv/setup

buildPhase() {
  echo "... this is my custom build phase ..."
  gcc foo.c -o foo
}

installPhase() {
  mkdir -p $out/bin
  cp foo $out/bin
}

genericBuild
</pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-tools-of-stdenv"></a>3.2. Tools provided by <code class="literal">stdenv</code></h2></div></div></div><p>
    The standard environment provides the following packages:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       The GNU C Compiler, configured with C and C++ support.
      </p></li><li class="listitem"><p>
       GNU coreutils (contains a few dozen standard Unix commands).
      </p></li><li class="listitem"><p>
       GNU findutils (contains <span class="command"><strong>find</strong></span>).
      </p></li><li class="listitem"><p>
       GNU diffutils (contains <span class="command"><strong>diff</strong></span>,
       <span class="command"><strong>cmp</strong></span>).
      </p></li><li class="listitem"><p>
       GNU <span class="command"><strong>sed</strong></span>.
      </p></li><li class="listitem"><p>
       GNU <span class="command"><strong>grep</strong></span>.
      </p></li><li class="listitem"><p>
       GNU <span class="command"><strong>awk</strong></span>.
      </p></li><li class="listitem"><p>
       GNU <span class="command"><strong>tar</strong></span>.
      </p></li><li class="listitem"><p>
       <span class="command"><strong>gzip</strong></span>, <span class="command"><strong>bzip2</strong></span> and
       <span class="command"><strong>xz</strong></span>.
      </p></li><li class="listitem"><p>
       GNU Make. It has been patched to provide <span class="quote">“<span class="quote">nested</span>”</span> output
       that can be fed into the <span class="command"><strong>nix-log2xml</strong></span> command and
       <span class="command"><strong>log2html</strong></span> stylesheet to create a structured, readable
       output of the build steps performed by Make.
      </p></li><li class="listitem"><p>
       Bash. This is the shell used for all builders in the Nix Packages
       collection. Not using <span class="command"><strong>/bin/sh</strong></span> removes a large source
       of portability problems.
      </p></li><li class="listitem"><p>
       The <span class="command"><strong>patch</strong></span> command.
      </p></li></ul></div><p>
   </p><p>
    On Linux, <code class="literal">stdenv</code> also includes the
    <span class="command"><strong>patchelf</strong></span> utility.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ssec-stdenv-dependencies"></a>3.3. Specifying dependencies</h2></div></div></div><p>
    As described in the Nix manual, almost any <code class="filename">*.drv</code> store
    path in a derivation's attribute set will induce a dependency on that
    derivation. <code class="varname">mkDerivation</code>, however, takes a few
    attributes intended to, between them, include all the dependencies of a
    package. This is done both for structure and consistency, but also so that
    certain other setup can take place. For example, certain dependencies need
    their bin directories added to the <code class="envar">PATH</code>. That is built-in,
    but other setup is done via a pluggable mechanism that works in conjunction
    with these dependency attributes. See <a class="xref" href="#ssec-setup-hooks" title="3.7. Package setup hooks">Section 3.7, “Package setup hooks”</a>
    for details.
   </p><p>
    Dependencies can be broken down along three axes: their host and target
    platforms relative to the new derivation's, and whether they are
    propagated. The platform distinctions are motivated by cross compilation;
    see <a class="xref" href="#chap-cross" title="Chapter 5. Cross-compilation">Chapter 5, <em>Cross-compilation</em></a> for exactly what each platform means.
    <a href="#ftn.footnote-stdenv-ignored-build-platform" class="footnote" id="footnote-stdenv-ignored-build-platform"><sup class="footnote">[1]</sup></a>
    But even if one is not cross compiling, the platforms imply whether or not
    the dependency is needed at run-time or build-time, a concept that makes
    perfect sense outside of cross compilation. For now, the
    run-time/build-time distinction is just a hint for mental clarity, but in
    the future it perhaps could be enforced.
   </p><p>
    The extension of <code class="envar">PATH</code> with dependencies, alluded to above,
    proceeds according to the relative platforms alone. The process is carried
    out only for dependencies whose host platform matches the new derivation's
    build platform i.e. dependencies which run on the platform where the new
    derivation will be built.
    <a href="#ftn.footnote-stdenv-native-dependencies-in-path" class="footnote" id="footnote-stdenv-native-dependencies-in-path"><sup class="footnote">[2]</sup></a>
    For each dependency <em class="replaceable"><code>dep</code></em> of those dependencies,
    <code class="filename"><em class="replaceable"><code>dep</code></em>/bin</code>, if present, is
    added to the <code class="envar">PATH</code> environment variable.
   </p><p>
    The dependency is propagated when it forces some of its other-transitive
    (non-immediate) downstream dependencies to also take it on as an immediate
    dependency. Nix itself already takes a package's transitive dependencies
    into account, but this propagation ensures nixpkgs-specific infrastructure
    like setup hooks (mentioned above) also are run as if the propagated
    dependency.
   </p><p>
    It is important to note that dependencies are not necessarily propagated as
    the same sort of dependency that they were before, but rather as the
    corresponding sort so that the platform rules still line up. The exact
    rules for dependency propagation can be given by assigning to each
    dependency two integers based one how its host and target platforms are
    offset from the depending derivation's platforms. Those offsets are given
    below in the descriptions of each dependency list attribute.
    Algorithmically, we traverse propagated inputs, accumulating every
    propagated dependency's propagated dependencies and adjusting them to
    account for the "shift in perspective" described by the current
    dependency's platform offsets. This results in sort a transitive closure of
    the dependency relation, with the offsets being approximately summed when
    two dependency links are combined. We also prune transitive dependencies
    whose combined offsets go out-of-bounds, which can be viewed as a filter
    over that transitive closure removing dependencies that are blatantly
    absurd.
   </p><p>
    We can define the process precisely with
    <a class="link" href="https://en.wikipedia.org/wiki/Natural_deduction" target="_top">Natural
    Deduction</a> using the inference rules. This probably seems a bit
    obtuse, but so is the bash code that actually implements it!
    <a href="#ftn.footnote-stdenv-find-inputs-location" class="footnote" id="footnote-stdenv-find-inputs-location"><sup class="footnote">[3]</sup></a>
    They're confusing in very different ways so... hopefully if something
    doesn't make sense in one presentation, it will in the other!
</p><pre class="programlisting">
let mapOffset(h, t, i) = i + (if i &lt;= 0 then h else t - 1)

propagated-dep(h0, t0, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 in {-1, 0, 1}
h0 + t1 in {-1, 0, 1}
-------------------------------------- Transitive property
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)</pre><p>
</p><pre class="programlisting">
let mapOffset(h, t, i) = i + (if i &lt;= 0 then h else t - 1)

dep(h0, _, A, B)
propagated-dep(h1, t1, B, C)
h0 + h1 in {-1, 0, 1}
h0 + t1 in {-1, 0, -1}
----------------------------- Take immediate dependencies' propagated dependencies
propagated-dep(mapOffset(h0, t0, h1),
               mapOffset(h0, t0, t1),
               A, C)</pre><p>
</p><pre class="programlisting">
propagated-dep(h, t, A, B)
----------------------------- Propagated dependencies count as dependencies
dep(h, t, A, B)</pre><p>
    Some explanation of this monstrosity is in order. In the common case, the
    target offset of a dependency is the successor to the target offset:
    <code class="literal">t = h + 1</code>. That means that:
</p><pre class="programlisting">
let f(h, t, i) = i + (if i &lt;= 0 then h else t - 1)
let f(h, h + 1, i) = i + (if i &lt;= 0 then h else (h + 1) - 1)
let f(h, h + 1, i) = i + (if i &lt;= 0 then h else h)
let f(h, h + 1, i) = i + h
  </pre><p>
    This is where "sum-like" comes in from above: We can just sum all of the
    host offsets to get the host offset of the transitive dependency. The
    target offset is the transitive dependency is simply the host offset + 1,
    just as it was with the dependencies composed to make this transitive one;
    it can be ignored as it doesn't add any new information.
   </p><p>
    Because of the bounds checks, the uncommon cases are <code class="literal">h =
    t</code> and <code class="literal">h + 2 = t</code>. In the former case, the
    motivation for <code class="function">mapOffset</code> is that since its host and
    target platforms are the same, no transitive dependency of it should be
    able to "discover" an offset greater than its reduced target offsets.
    <code class="function">mapOffset</code> effectively "squashes" all its transitive
    dependencies' offsets so that none will ever be greater than the target
    offset of the original <code class="literal">h = t</code> package. In the other case,
    <code class="literal">h + 1</code> is skipped over between the host and target
    offsets. Instead of squashing the offsets, we need to "rip" them apart so
    no transitive dependencies' offset is that one.
   </p><p>
    Overall, the unifying theme here is that propagation shouldn't be
    introducing transitive dependencies involving platforms the depending
    package is unaware of. The offset bounds checking and definition of
    <code class="function">mapOffset</code> together ensure that this is the case.
    Discovering a new offset is discovering a new platform, and since those
    platforms weren't in the derivation "spec" of the needing package, they
    cannot be relevant. From a capability perspective, we can imagine that the
    host and target platforms of a package are the capabilities a package
    requires, and the depending package must provide the capability to the
    dependency.
   </p><div class="variablelist"><p class="title"><strong>Variables specifying dependencies</strong></p><dl class="variablelist"><dt><span class="term">
      <code class="varname">depsBuildBuild</code>
     </span></dt><dd><p>
       A list of dependencies whose host and target platforms are the new
       derivation's build platform. This means a <code class="literal">-1</code> host and
       <code class="literal">-1</code> target offset from the new derivation's platforms.
       These are programs and libraries used at build time that produce
       programs and libraries also used at build time. If the dependency
       doesn't care about the target platform (i.e. isn't a compiler or similar
       tool), put it in <code class="varname">nativeBuildInputs</code> instead. The most
       common use of this <code class="literal">buildPackages.stdenv.cc</code>, the
       default C compiler for this role. That example crops up more than one
       might think in old commonly used C libraries.
      </p><p>
       Since these packages are able to be run at build-time, they are always
       added to the <code class="envar">PATH</code>, as described above. But since these
       packages are only guaranteed to be able to run then, they shouldn't
       persist as run-time dependencies. This isn't currently enforced, but
       could be in the future.
      </p></dd><dt><span class="term">
      <code class="varname">nativeBuildInputs</code>
     </span></dt><dd><p>
       A list of dependencies whose host platform is the new derivation's build
       platform, and target platform is the new derivation's host platform.
       This means a <code class="literal">-1</code> host offset and <code class="literal">0</code>
       target offset from the new derivation's platforms. These are programs
       and libraries used at build-time that, if they are a compiler or similar
       tool, produce code to run at run-time—i.e. tools used to build
       the new derivation. If the dependency doesn't care about the target
       platform (i.e. isn't a compiler or similar tool), put it here, rather
       than in <code class="varname">depsBuildBuild</code> or
       <code class="varname">depsBuildTarget</code>. This could be called
       <code class="varname">depsBuildHost</code> but
       <code class="varname">nativeBuildInputs</code> is used for historical continuity.
      </p><p>
       Since these packages are able to be run at build-time, they are added to
       the <code class="envar">PATH</code>, as described above. But since these packages
       are only guaranteed to be able to run then, they shouldn't persist as
       run-time dependencies. This isn't currently enforced, but could be in
       the future.
      </p></dd><dt><span class="term">
      <code class="varname">depsBuildTarget</code>
     </span></dt><dd><p>
       A list of dependencies whose host platform is the new derivation's build
       platform, and target platform is the new derivation's target platform.
       This means a <code class="literal">-1</code> host offset and <code class="literal">1</code>
       target offset from the new derivation's platforms. These are programs
       used at build time that produce code to run with code produced by the
       depending package. Most commonly, these are tools used to build the
       runtime or standard library that the currently-being-built compiler will
       inject into any code it compiles. In many cases, the
       currently-being-built-compiler is itself employed for that task, but
       when that compiler won't run (i.e. its build and host platform differ)
       this is not possible. Other times, the compiler relies on some other
       tool, like binutils, that is always built separately so that the
       dependency is unconditional.
      </p><p>
       This is a somewhat confusing concept to wrap one’s head around,
       and for good reason. As the only dependency type where the platform
       offsets are not adjacent integers, it requires thinking of a
       bootstrapping stage <span class="emphasis"><em>two</em></span> away from the current one.
       It and its use-case go hand in hand and are both considered poor form:
       try to not need this sort of dependency, and try to avoid building
       standard libraries and runtimes in the same derivation as the compiler
       produces code using them. Instead strive to build those like a normal
       library, using the newly-built compiler just as a normal library would.
       In short, do not use this attribute unless you are packaging a compiler
       and are sure it is needed.
      </p><p>
       Since these packages are able to run at build time, they are added to
       the <code class="envar">PATH</code>, as described above. But since these packages
       are only guaranteed to be able to run then, they shouldn't persist as
       run-time dependencies. This isn't currently enforced, but could be in
       the future.
      </p></dd><dt><span class="term">
      <code class="varname">depsHostHost</code>
     </span></dt><dd><p>
       A list of dependencies whose host and target platforms match the new
       derivation's host platform. This means a <code class="literal">0</code> host
       offset and <code class="literal">0</code> target offset from the new derivation's
       host platform. These are packages used at run-time to generate code also
       used at run-time. In practice, this would usually be tools used by
       compilers for macros or a metaprogramming system, or libraries used by
       the macros or metaprogramming code itself. It's always preferable to use
       a <code class="varname">depsBuildBuild</code> dependency in the derivation being
       built over a <code class="varname">depsHostHost</code> on the tool doing the
       building for this purpose.
      </p></dd><dt><span class="term">
      <code class="varname">buildInputs</code>
     </span></dt><dd><p>
       A list of dependencies whose host platform and target platform match the
       new derivation's. This means a <code class="literal">0</code> host offset and a
       <code class="literal">1</code> target offset from the new derivation's host
       platform. This would be called <code class="varname">depsHostTarget</code> but for
       historical continuity. If the dependency doesn't care about the target
       platform (i.e. isn't a compiler or similar tool), put it here, rather
       than in <code class="varname">depsBuildBuild</code>.
      </p><p>
       These are often programs and libraries used by the new derivation at
       <span class="emphasis"><em>run</em></span>-time, but that isn't always the case. For
       example, the machine code in a statically-linked library is only used at
       run-time, but the derivation containing the library is only needed at
       build-time. Even in the dynamic case, the library may also be needed at
       build-time to appease the linker.
      </p></dd><dt><span class="term">
      <code class="varname">depsTargetTarget</code>
     </span></dt><dd><p>
       A list of dependencies whose host platform matches the new derivation's
       target platform. This means a <code class="literal">1</code> offset from the new
       derivation's platforms. These are packages that run on the target
       platform, e.g. the standard library or run-time deps of standard library
       that a compiler insists on knowing about. It's poor form in almost all
       cases for a package to depend on another from a future stage [future
       stage corresponding to positive offset]. Do not use this attribute
       unless you are packaging a compiler and are sure it is needed.
      </p></dd><dt><span class="term">
      <code class="varname">depsBuildBuildPropagated</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">depsBuildBuild</code>. This
       perhaps never ought to be used, but it is included for consistency [see
       below for the others].
      </p></dd><dt><span class="term">
      <code class="varname">propagatedNativeBuildInputs</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">nativeBuildInputs</code>. This
       would be called <code class="varname">depsBuildHostPropagated</code> but for
       historical continuity. For example, if package <code class="varname">Y</code> has
       <code class="literal">propagatedNativeBuildInputs = [X]</code>, and package
       <code class="varname">Z</code> has <code class="literal">buildInputs = [Y]</code>, then
       package <code class="varname">Z</code> will be built as if it included package
       <code class="varname">X</code> in its <code class="varname">nativeBuildInputs</code>. If
       instead, package <code class="varname">Z</code> has <code class="literal">nativeBuildInputs =
       [Y]</code>, then <code class="varname">Z</code> will be built as if it included
       <code class="varname">X</code> in the <code class="varname">depsBuildBuild</code> of package
       <code class="varname">Z</code>, because of the sum of the two
       <code class="literal">-1</code> host offsets.
      </p></dd><dt><span class="term">
      <code class="varname">depsBuildTargetPropagated</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">depsBuildTarget</code>. This is
       prefixed for the same reason of alerting potential users.
      </p></dd><dt><span class="term">
      <code class="varname">depsHostHostPropagated</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">depsHostHost</code>.
      </p></dd><dt><span class="term">
      <code class="varname">propagatedBuildInputs</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">buildInputs</code>. This would
       be called <code class="varname">depsHostTargetPropagated</code> but for historical
       continuity.
      </p></dd><dt><span class="term">
      <code class="varname">depsTargetTargetPropagated</code>
     </span></dt><dd><p>
       The propagated equivalent of <code class="varname">depsTargetTarget</code>. This
       is prefixed for the same reason of alerting potential users.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ssec-stdenv-attributes"></a>3.4. Attributes</h2></div></div></div><div class="variablelist"><p class="title"><strong>Variables affecting <code class="literal">stdenv</code> initialisation</strong></p><dl class="variablelist"><dt><span class="term">
      <code class="varname">NIX_DEBUG</code>
     </span></dt><dd><p>
       A natural number indicating how much information to log. If set to 1 or
       higher, <code class="literal">stdenv</code> will print moderate debugging
       information during the build. In particular, the <span class="command"><strong>gcc</strong></span>
       and <span class="command"><strong>ld</strong></span> wrapper scripts will print out the complete
       command line passed to the wrapped tools. If set to 6 or higher, the
       <code class="literal">stdenv</code> setup script will be run with <code class="literal">set
       -x</code> tracing. If set to 7 or higher, the <span class="command"><strong>gcc</strong></span>
       and <span class="command"><strong>ld</strong></span> wrapper scripts will also be run with
       <code class="literal">set -x</code> tracing.
      </p></dd></dl></div><div class="variablelist"><p class="title"><strong>Attributes affecting build properties</strong></p><dl class="variablelist"><dt><span class="term">
      <code class="varname">enableParallelBuilding</code>
     </span></dt><dd><p>
       If set to <code class="literal">true</code>, <code class="literal">stdenv</code> will pass
       specific flags to <code class="literal">make</code> and other build tools to
       enable parallel building with up to <code class="literal">build-cores</code>
       workers.
      </p><p>
       Unless set to <code class="literal">false</code>, some build systems with good
       support for parallel building including <code class="literal">cmake</code>,
       <code class="literal">meson</code>, and <code class="literal">qmake</code> will set it to
       <code class="literal">true</code>.
      </p></dd></dl></div><div class="variablelist"><p class="title"><strong>Special variables</strong></p><dl class="variablelist"><dt><span class="term">
      <code class="varname">passthru</code>
     </span></dt><dd><p>
       This is an attribute set which can be filled with arbitrary values. For
       example:
</p><pre class="programlisting">
passthru = {
  foo = "bar";
  baz = {
    value1 = 4;
    value2 = 5;
  };
}
</pre><p>
      </p><p>
       Values inside it are not passed to the builder, so you can change them
       without triggering a rebuild. However, they can be accessed outside of a
       derivation directly, as if they were set inside a derivation itself,
       e.g. <code class="literal">hello.baz.value1</code>. We don't specify any usage or
       schema of <code class="literal">passthru</code> - it is meant for values that
       would be useful outside the derivation in other parts of a Nix
       expression (e.g. in other derivations). An example would be to convey
       some specific dependency of your derivation which contains a program
       with plugins support. Later, others who make derivations with plugins
       can use passed-through dependency to ensure that their plugin would be
       binary-compatible with built program.
      </p></dd><dt><span class="term">
      <code class="varname">passthru.updateScript</code>
     </span></dt><dd><p>
       A script to be run by
       <code class="filename">maintainers/scripts/update.nix</code> when the package is
       matched. It needs to be an executable file, either on the file system:
</p><pre class="programlisting">
passthru.updateScript = ./update.sh;
</pre><p>
       or inside the expression itself:
</p><pre class="programlisting">
passthru.updateScript = writeScript "update-zoom-us" ''
  #!/usr/bin/env nix-shell
  #!nix-shell -i bash -p curl pcre common-updater-scripts

  set -eu -o pipefail

  version="$(curl -sI https://zoom.us/client/latest/zoom_x86_64.tar.xz | grep -Fi 'Location:' | pcregrep -o1 '/(([0-9]\.?)+)/')"
  update-source-version zoom-us "$version"
'';
</pre><p>
       The attribute can also contain a list, a script followed by arguments to
       be passed to it:
</p><pre class="programlisting">
passthru.updateScript = [ ../../update.sh pname "--requested-release=unstable" ];
</pre><p>
       Note that the update scripts will be run in parallel by default; you
       should avoid running <span class="command"><strong>git commit</strong></span> or any other commands
       that cannot handle that.
      </p><p>
       For information about how to run the updates, execute
       </p><div class="cmdsynopsis"><p><code class="command">nix-shell</code>  [
         maintainers/scripts/update.nix
        ]</p></div><p>
       .
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-stdenv-phases"></a>3.5. Phases</h2></div></div></div><p>
    The generic builder has a number of <span class="emphasis"><em>phases</em></span>. Package
    builds are split into phases to make it easier to override specific parts
    of the build (e.g., unpacking the sources or installing the binaries).
    Furthermore, it allows a nicer presentation of build logs in the Nix build
    farm.
   </p><p>
    Each phase can be overridden in its entirety either by setting the
    environment variable
    <code class="varname"><em class="replaceable"><code>name</code></em>Phase</code> to a string
    containing some shell commands to be executed, or by redefining the shell
    function <code class="varname"><em class="replaceable"><code>name</code></em>Phase</code>. The
    former is convenient to override a phase from the derivation, while the
    latter is convenient from a build script. However, typically one only wants
    to <span class="emphasis"><em>add</em></span> some commands to a phase, e.g. by defining
    <code class="literal">postInstall</code> or <code class="literal">preFixup</code>, as skipping
    some of the default actions may have unexpected consequences.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-controlling-phases"></a>3.5.1. Controlling phases</h3></div></div></div><p>
     There are a number of variables that control what phases are executed and
     in what order:
     </p><div class="variablelist"><p class="title"><strong>Variables affecting phase control</strong></p><dl class="variablelist"><dt><span class="term">
        <code class="varname">phases</code>
       </span></dt><dd><p>
         Specifies the phases. You can change the order in which phases are
         executed, or add new phases, by setting this variable. If it’s
         not set, the default value is used, which is <code class="literal">$prePhases
         unpackPhase patchPhase $preConfigurePhases configurePhase
         $preBuildPhases buildPhase checkPhase $preInstallPhases installPhase
         fixupPhase $preDistPhases distPhase $postPhases</code>.
        </p><p>
         Usually, if you just want to add a few phases, it’s more
         convenient to set one of the variables below (such as
         <code class="varname">preInstallPhases</code>), as you then don’t specify
         all the normal phases.
        </p></dd><dt><span class="term">
        <code class="varname">prePhases</code>
       </span></dt><dd><p>
         Additional phases executed before any of the default phases.
        </p></dd><dt><span class="term">
        <code class="varname">preConfigurePhases</code>
       </span></dt><dd><p>
         Additional phases executed just before the configure phase.
        </p></dd><dt><span class="term">
        <code class="varname">preBuildPhases</code>
       </span></dt><dd><p>
         Additional phases executed just before the build phase.
        </p></dd><dt><span class="term">
        <code class="varname">preInstallPhases</code>
       </span></dt><dd><p>
         Additional phases executed just before the install phase.
        </p></dd><dt><span class="term">
        <code class="varname">preFixupPhases</code>
       </span></dt><dd><p>
         Additional phases executed just before the fixup phase.
        </p></dd><dt><span class="term">
        <code class="varname">preDistPhases</code>
       </span></dt><dd><p>
         Additional phases executed just before the distribution phase.
        </p></dd><dt><span class="term">
        <code class="varname">postPhases</code>
       </span></dt><dd><p>
         Additional phases executed after any of the default phases.
        </p></dd></dl></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-unpack-phase"></a>3.5.2. The unpack phase</h3></div></div></div><p>
     The unpack phase is responsible for unpacking the source code of the
     package. The default implementation of <code class="function">unpackPhase</code>
     unpacks the source files listed in the <code class="envar">src</code> environment
     variable to the current directory. It supports the following files by
     default:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        Tar files
       </span></dt><dd><p>
         These can optionally be compressed using <span class="command"><strong>gzip</strong></span>
         (<code class="filename">.tar.gz</code>, <code class="filename">.tgz</code> or
         <code class="filename">.tar.Z</code>), <span class="command"><strong>bzip2</strong></span>
         (<code class="filename">.tar.bz2</code>, <code class="filename">.tbz2</code> or
         <code class="filename">.tbz</code>) or <span class="command"><strong>xz</strong></span>
         (<code class="filename">.tar.xz</code>, <code class="filename">.tar.lzma</code> or
         <code class="filename">.txz</code>).
        </p></dd><dt><span class="term">
        Zip files
       </span></dt><dd><p>
         Zip files are unpacked using <span class="command"><strong>unzip</strong></span>. However,
         <span class="command"><strong>unzip</strong></span> is not in the standard environment, so you
         should add it to <code class="varname">nativeBuildInputs</code> yourself.
        </p></dd><dt><span class="term">
        Directories in the Nix store
       </span></dt><dd><p>
         These are simply copied to the current directory. The hash part of the
         file name is stripped, e.g.
         <code class="filename">/nix/store/1wydxgby13cz...-my-sources</code> would be
         copied to <code class="filename">my-sources</code>.
        </p></dd></dl></div><p>
     Additional file types can be supported by setting the
     <code class="varname">unpackCmd</code> variable (see below).
    </p><p></p><div class="variablelist"><p class="title"><strong>Variables controlling the unpack phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">srcs</code> / <code class="varname">src</code>
      </span></dt><dd><p>
        The list of source files or directories to be unpacked or copied. One
        of these must be set.
       </p></dd><dt><span class="term">
       <code class="varname">sourceRoot</code>
      </span></dt><dd><p>
        After running <code class="function">unpackPhase</code>, the generic builder
        changes the current directory to the directory created by unpacking the
        sources. If there are multiple source directories, you should set
        <code class="varname">sourceRoot</code> to the name of the intended directory.
       </p></dd><dt><span class="term">
       <code class="varname">setSourceRoot</code>
      </span></dt><dd><p>
        Alternatively to setting <code class="varname">sourceRoot</code>, you can set
        <code class="varname">setSourceRoot</code> to a shell command to be evaluated by
        the unpack phase after the sources have been unpacked. This command
        must set <code class="varname">sourceRoot</code>.
       </p></dd><dt><span class="term">
       <code class="varname">preUnpack</code>
      </span></dt><dd><p>
        Hook executed at the start of the unpack phase.
       </p></dd><dt><span class="term">
       <code class="varname">postUnpack</code>
      </span></dt><dd><p>
        Hook executed at the end of the unpack phase.
       </p></dd><dt><span class="term">
       <code class="varname">dontMakeSourcesWritable</code>
      </span></dt><dd><p>
        If set to <code class="literal">1</code>, the unpacked sources are
        <span class="emphasis"><em>not</em></span> made writable. By default, they are made
        writable to prevent problems with read-only sources. For example,
        copied store directories would be read-only without this.
       </p></dd><dt><span class="term">
       <code class="varname">unpackCmd</code>
      </span></dt><dd><p>
        The unpack phase evaluates the string <code class="literal">$unpackCmd</code> for
        any unrecognised file. The path to the current source file is contained
        in the <code class="varname">curSrc</code> variable.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-patch-phase"></a>3.5.3. The patch phase</h3></div></div></div><p>
     The patch phase applies the list of patches defined in the
     <code class="varname">patches</code> variable.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the patch phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">patches</code>
      </span></dt><dd><p>
        The list of patches. They must be in the format accepted by the
        <span class="command"><strong>patch</strong></span> command, and may optionally be compressed
        using <span class="command"><strong>gzip</strong></span> (<code class="filename">.gz</code>),
        <span class="command"><strong>bzip2</strong></span> (<code class="filename">.bz2</code>) or
        <span class="command"><strong>xz</strong></span> (<code class="filename">.xz</code>).
       </p></dd><dt><span class="term">
       <code class="varname">patchFlags</code>
      </span></dt><dd><p>
        Flags to be passed to <span class="command"><strong>patch</strong></span>. If not set, the
        argument <code class="option">-p1</code> is used, which causes the leading
        directory component to be stripped from the file names in each patch.
       </p></dd><dt><span class="term">
       <code class="varname">prePatch</code>
      </span></dt><dd><p>
        Hook executed at the start of the patch phase.
       </p></dd><dt><span class="term">
       <code class="varname">postPatch</code>
      </span></dt><dd><p>
        Hook executed at the end of the patch phase.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-configure-phase"></a>3.5.4. The configure phase</h3></div></div></div><p>
     The configure phase prepares the source tree for building. The default
     <code class="function">configurePhase</code> runs <code class="filename">./configure</code>
     (typically an Autoconf-generated script) if it exists.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the configure phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">configureScript</code>
      </span></dt><dd><p>
        The name of the configure script. It defaults to
        <code class="filename">./configure</code> if it exists; otherwise, the configure
        phase is skipped. This can actually be a command (like <code class="literal">perl
        ./Configure.pl</code>).
       </p></dd><dt><span class="term">
       <code class="varname">configureFlags</code>
      </span></dt><dd><p>
        A list of strings passed as additional arguments to the configure
        script.
       </p></dd><dt><span class="term">
       <code class="varname">configureFlagsArray</code>
      </span></dt><dd><p>
        A shell array containing additional arguments passed to the configure
        script. You must use this instead of <code class="varname">configureFlags</code>
        if the arguments contain spaces.
       </p></dd><dt><span class="term">
       <code class="varname">dontAddPrefix</code>
      </span></dt><dd><p>
        By default, the flag <code class="literal">--prefix=$prefix</code> is added to
        the configure flags. If this is undesirable, set this variable to true.
       </p></dd><dt><span class="term">
       <code class="varname">prefix</code>
      </span></dt><dd><p>
        The prefix under which the package must be installed, passed via the
        <code class="option">--prefix</code> option to the configure script. It defaults
        to <code class="option">$out</code>.
       </p></dd><dt><span class="term">
       <code class="varname">prefixKey</code>
      </span></dt><dd><p>
        The key to use when specifying the prefix. By default, this is set to
        <code class="option">--prefix=</code> as that is used by the majority of packages.
       </p></dd><dt><span class="term">
       <code class="varname">dontAddDisableDepTrack</code>
      </span></dt><dd><p>
        By default, the flag <code class="literal">--disable-dependency-tracking</code>
        is added to the configure flags to speed up Automake-based builds. If
        this is undesirable, set this variable to true.
       </p></dd><dt><span class="term">
       <code class="varname">dontFixLibtool</code>
      </span></dt><dd><p>
        By default, the configure phase applies some special hackery to all
        files called <code class="filename">ltmain.sh</code> before running the
        configure script in order to improve the purity of Libtool-based
        packages
        <a href="#ftn.footnote-stdenv-sys-lib-search-path" class="footnote" id="footnote-stdenv-sys-lib-search-path"><sup class="footnote">[4]</sup></a>
        . If this is undesirable, set this variable to true.
       </p></dd><dt><span class="term">
       <code class="varname">dontDisableStatic</code>
      </span></dt><dd><p>
        By default, when the configure script has
        <code class="option">--enable-static</code>, the option
        <code class="option">--disable-static</code> is added to the configure flags.
       </p><p>
        If this is undesirable, set this variable to true.
       </p></dd><dt><span class="term">
       <code class="varname">configurePlatforms</code>
      </span></dt><dd><p>
        By default, when cross compiling, the configure script has
        <code class="option">--build=...</code> and <code class="option">--host=...</code> passed.
        Packages can instead pass <code class="literal">[ "build" "host" "target"
        ]</code> or a subset to control exactly which platform flags are
        passed. Compilers and other tools can use this to also pass the target
        platform.
        <a href="#ftn.footnote-stdenv-build-time-guessing-impurity" class="footnote" id="footnote-stdenv-build-time-guessing-impurity"><sup class="footnote">[5]</sup></a>
       </p></dd><dt><span class="term">
       <code class="varname">preConfigure</code>
      </span></dt><dd><p>
        Hook executed at the start of the configure phase.
       </p></dd><dt><span class="term">
       <code class="varname">postConfigure</code>
      </span></dt><dd><p>
        Hook executed at the end of the configure phase.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="build-phase"></a>3.5.5. The build phase</h3></div></div></div><p>
     The build phase is responsible for actually building the package (e.g.
     compiling it). The default <code class="function">buildPhase</code> simply calls
     <span class="command"><strong>make</strong></span> if a file named <code class="filename">Makefile</code>,
     <code class="filename">makefile</code> or <code class="filename">GNUmakefile</code> exists
     in the current directory (or the <code class="varname">makefile</code> is explicitly
     set); otherwise it does nothing.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the build phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">dontBuild</code>
      </span></dt><dd><p>
        Set to true to skip the build phase.
       </p></dd><dt><span class="term">
       <code class="varname">makefile</code>
      </span></dt><dd><p>
        The file name of the Makefile.
       </p></dd><dt><span class="term">
       <code class="varname">makeFlags</code>
      </span></dt><dd><p>
        A list of strings passed as additional flags to
        <span class="command"><strong>make</strong></span>. These flags are also used by the default
        install and check phase. For setting make flags specific to the build
        phase, use <code class="varname">buildFlags</code> (see below).
</p><pre class="programlisting">
makeFlags = [ "PREFIX=$(out)" ];
</pre><p>
        </p><div class="note"><h3 class="title">Note</h3><p>
          The flags are quoted in bash, but environment variables can be
          specified by using the make syntax.
         </p></div><p>
       </p></dd><dt><span class="term">
       <code class="varname">makeFlagsArray</code>
      </span></dt><dd><p>
        A shell array containing additional arguments passed to
        <span class="command"><strong>make</strong></span>. You must use this instead of
        <code class="varname">makeFlags</code> if the arguments contain spaces, e.g.
</p><pre class="programlisting">
preBuild = ''
  makeFlagsArray+=(CFLAGS="-O0 -g" LDFLAGS="-lfoo -lbar")
'';
</pre><p>
        Note that shell arrays cannot be passed through environment variables,
        so you cannot set <code class="varname">makeFlagsArray</code> in a derivation
        attribute (because those are passed through environment variables): you
        have to define them in shell code.
       </p></dd><dt><span class="term">
       <code class="varname">buildFlags</code> / <code class="varname">buildFlagsArray</code>
      </span></dt><dd><p>
        A list of strings passed as additional flags to
        <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and
        <code class="varname">makeFlagsArray</code>, but only used by the build phase.
       </p></dd><dt><span class="term">
       <code class="varname">preBuild</code>
      </span></dt><dd><p>
        Hook executed at the start of the build phase.
       </p></dd><dt><span class="term">
       <code class="varname">postBuild</code>
      </span></dt><dd><p>
        Hook executed at the end of the build phase.
       </p></dd></dl></div><p>
     You can set flags for <span class="command"><strong>make</strong></span> through the
     <code class="varname">makeFlags</code> variable.
    </p><p>
     Before and after running <span class="command"><strong>make</strong></span>, the hooks
     <code class="varname">preBuild</code> and <code class="varname">postBuild</code> are called,
     respectively.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-check-phase"></a>3.5.6. The check phase</h3></div></div></div><p>
     The check phase checks whether the package was built correctly by running
     its test suite. The default <code class="function">checkPhase</code> calls
     <span class="command"><strong>make check</strong></span>, but only if the <code class="varname">doCheck</code>
     variable is enabled.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the check phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">doCheck</code>
      </span></dt><dd><p>
        Controls whether the check phase is executed. By default it is skipped,
        but if <code class="varname">doCheck</code> is set to true, the check phase is
        usually executed. Thus you should set
</p><pre class="programlisting">doCheck = true;</pre><p>
        in the derivation to enable checks. The exception is cross compilation.
        Cross compiled builds never run tests, no matter how
        <code class="varname">doCheck</code> is set, as the newly-built program won't run
        on the platform used to build it.
       </p></dd><dt><span class="term">
       <code class="varname">makeFlags</code> / <code class="varname">makeFlagsArray</code> / <code class="varname">makefile</code>
      </span></dt><dd><p>
        See the build phase for details.
       </p></dd><dt><span class="term">
       <code class="varname">checkTarget</code>
      </span></dt><dd><p>
        The make target that runs the tests. Defaults to
        <code class="literal">check</code>.
       </p></dd><dt><span class="term">
       <code class="varname">checkFlags</code> / <code class="varname">checkFlagsArray</code>
      </span></dt><dd><p>
        A list of strings passed as additional flags to
        <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and
        <code class="varname">makeFlagsArray</code>, but only used by the check phase.
       </p></dd><dt><span class="term">
       <code class="varname">checkInputs</code>
      </span></dt><dd><p>
        A list of dependencies used by the phase. This gets included in
        <code class="varname">nativeBuildInputs</code> when <code class="varname">doCheck</code> is
        set.
       </p></dd><dt><span class="term">
       <code class="varname">preCheck</code>
      </span></dt><dd><p>
        Hook executed at the start of the check phase.
       </p></dd><dt><span class="term">
       <code class="varname">postCheck</code>
      </span></dt><dd><p>
        Hook executed at the end of the check phase.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-install-phase"></a>3.5.7. The install phase</h3></div></div></div><p>
     The install phase is responsible for installing the package in the Nix
     store under <code class="envar">out</code>. The default
     <code class="function">installPhase</code> creates the directory
     <code class="literal">$out</code> and calls <span class="command"><strong>make install</strong></span>.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the install phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">makeFlags</code> / <code class="varname">makeFlagsArray</code> / <code class="varname">makefile</code>
      </span></dt><dd><p>
        See the build phase for details.
       </p></dd><dt><span class="term">
       <code class="varname">installTargets</code>
      </span></dt><dd><p>
        The make targets that perform the installation. Defaults to
        <code class="literal">install</code>. Example:
</p><pre class="programlisting">
installTargets = "install-bin install-doc";</pre><p>
       </p></dd><dt><span class="term">
       <code class="varname">installFlags</code> / <code class="varname">installFlagsArray</code>
      </span></dt><dd><p>
        A list of strings passed as additional flags to
        <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and
        <code class="varname">makeFlagsArray</code>, but only used by the install phase.
       </p></dd><dt><span class="term">
       <code class="varname">preInstall</code>
      </span></dt><dd><p>
        Hook executed at the start of the install phase.
       </p></dd><dt><span class="term">
       <code class="varname">postInstall</code>
      </span></dt><dd><p>
        Hook executed at the end of the install phase.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-fixup-phase"></a>3.5.8. The fixup phase</h3></div></div></div><p>
     The fixup phase performs some (Nix-specific) post-processing actions on
     the files installed under <code class="filename">$out</code> by the install phase.
     The default <code class="function">fixupPhase</code> does the following:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        It moves the <code class="filename">man/</code>, <code class="filename">doc/</code> and
        <code class="filename">info/</code> subdirectories of <code class="envar">$out</code> to
        <code class="filename">share/</code>.
       </p></li><li class="listitem"><p>
        It strips libraries and executables of debug information.
       </p></li><li class="listitem"><p>
        On Linux, it applies the <span class="command"><strong>patchelf</strong></span> command to ELF
        executables and libraries to remove unused directories from the
        <code class="literal">RPATH</code> in order to prevent unnecessary runtime
        dependencies.
       </p></li><li class="listitem"><p>
        It rewrites the interpreter paths of shell scripts to paths found in
        <code class="envar">PATH</code>. E.g., <code class="filename">/usr/bin/perl</code> will be
        rewritten to
        <code class="filename">/nix/store/<em class="replaceable"><code>some-perl</code></em>/bin/perl</code>
        found in <code class="envar">PATH</code>.
       </p></li></ul></div><p>
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the fixup phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">dontStrip</code>
      </span></dt><dd><p>
        If set, libraries and executables are not stripped. By default, they
        are.
       </p></dd><dt><span class="term">
       <code class="varname">dontStripHost</code>
      </span></dt><dd><p>
        Like <code class="varname">dontStripHost</code>, but only affects the
        <span class="command"><strong>strip</strong></span> command targetting the package's host
        platform. Useful when supporting cross compilation, but otherwise feel
        free to ignore.
       </p></dd><dt><span class="term">
       <code class="varname">dontStripTarget</code>
      </span></dt><dd><p>
        Like <code class="varname">dontStripHost</code>, but only affects the
        <span class="command"><strong>strip</strong></span> command targetting the packages' target
        platform. Useful when supporting cross compilation, but otherwise feel
        free to ignore.
       </p></dd><dt><span class="term">
       <code class="varname">dontMoveSbin</code>
      </span></dt><dd><p>
        If set, files in <code class="filename">$out/sbin</code> are not moved to
        <code class="filename">$out/bin</code>. By default, they are.
       </p></dd><dt><span class="term">
       <code class="varname">stripAllList</code>
      </span></dt><dd><p>
        List of directories to search for libraries and executables from which
        <span class="emphasis"><em>all</em></span> symbols should be stripped. By default,
        it’s empty. Stripping all symbols is risky, since it may remove
        not just debug symbols but also ELF information necessary for normal
        execution.
       </p></dd><dt><span class="term">
       <code class="varname">stripAllFlags</code>
      </span></dt><dd><p>
        Flags passed to the <span class="command"><strong>strip</strong></span> command applied to the
        files in the directories listed in <code class="varname">stripAllList</code>.
        Defaults to <code class="option">-s</code> (i.e. <code class="option">--strip-all</code>).
       </p></dd><dt><span class="term">
       <code class="varname">stripDebugList</code>
      </span></dt><dd><p>
        List of directories to search for libraries and executables from which
        only debugging-related symbols should be stripped. It defaults to
        <code class="literal">lib bin sbin</code>.
       </p></dd><dt><span class="term">
       <code class="varname">stripDebugFlags</code>
      </span></dt><dd><p>
        Flags passed to the <span class="command"><strong>strip</strong></span> command applied to the
        files in the directories listed in <code class="varname">stripDebugList</code>.
        Defaults to <code class="option">-S</code> (i.e. <code class="option">--strip-debug</code>).
       </p></dd><dt><span class="term">
       <code class="varname">dontPatchELF</code>
      </span></dt><dd><p>
        If set, the <span class="command"><strong>patchelf</strong></span> command is not used to remove
        unnecessary <code class="literal">RPATH</code> entries. Only applies to Linux.
       </p></dd><dt><span class="term">
       <code class="varname">dontPatchShebangs</code>
      </span></dt><dd><p>
        If set, scripts starting with <code class="literal">#!</code> do not have their
        interpreter paths rewritten to paths in the Nix store.
       </p></dd><dt><span class="term">
       <code class="varname">dontPruneLibtoolFiles</code>
      </span></dt><dd><p>
        If set, libtool <code class="literal">.la</code> files associated with shared
        libraries won't have their <code class="literal">dependency_libs</code> field
        cleared.
       </p></dd><dt><span class="term">
       <code class="varname">forceShare</code>
      </span></dt><dd><p>
        The list of directories that must be moved from
        <code class="filename">$out</code> to <code class="filename">$out/share</code>. Defaults
        to <code class="literal">man doc info</code>.
       </p></dd><dt><span class="term">
       <code class="varname">setupHook</code>
      </span></dt><dd><p>
        A package can export a <a class="link" href="#ssec-setup-hooks" title="3.7. Package setup hooks">setup
        hook</a> by setting this variable. The setup hook, if defined, is
        copied to <code class="filename">$out/nix-support/setup-hook</code>. Environment
        variables are then substituted in it using
        <code class="function"><a class="function" href="#fun-substituteAll">substituteAll</a></code>.
       </p></dd><dt><span class="term">
       <code class="varname">preFixup</code>
      </span></dt><dd><p>
        Hook executed at the start of the fixup phase.
       </p></dd><dt><span class="term">
       <code class="varname">postFixup</code>
      </span></dt><dd><p>
        Hook executed at the end of the fixup phase.
       </p></dd><dt><a id="stdenv-separateDebugInfo"></a><span class="term">
       <code class="varname">separateDebugInfo</code>
      </span></dt><dd><p>
        If set to <code class="literal">true</code>, the standard environment will enable
        debug information in C/C++ builds. After installation, the debug
        information will be separated from the executables and stored in the
        output named <code class="literal">debug</code>. (This output is enabled
        automatically; you don’t need to set the
        <code class="varname">outputs</code> attribute explicitly.) To be precise, the
        debug information is stored in
        <code class="filename"><em class="replaceable"><code>debug</code></em>/lib/debug/.build-id/<em class="replaceable"><code>XX</code></em>/<em class="replaceable"><code>YYYY…</code></em></code>,
        where <em class="replaceable"><code>XXYYYY…</code></em> is the
        <em class="replaceable"><code>build ID</code></em> of the binary — a SHA-1 hash
        of the contents of the binary. Debuggers like GDB use the build ID to
        look up the separated debug information.
       </p><p>
        For example, with GDB, you can add
</p><pre class="programlisting">
set debug-file-directory ~/.nix-profile/lib/debug
</pre><p>
        to <code class="filename">~/.gdbinit</code>. GDB will then be able to find debug
        information installed via <code class="literal">nix-env -i</code>.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-installCheck-phase"></a>3.5.9. The installCheck phase</h3></div></div></div><p>
     The installCheck phase checks whether the package was installed correctly
     by running its test suite against the installed directories. The default
     <code class="function">installCheck</code> calls <span class="command"><strong>make
     installcheck</strong></span>.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the installCheck phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">doInstallCheck</code>
      </span></dt><dd><p>
        Controls whether the installCheck phase is executed. By default it is
        skipped, but if <code class="varname">doInstallCheck</code> is set to true, the
        installCheck phase is usually executed. Thus you should set
</p><pre class="programlisting">doInstallCheck = true;</pre><p>
        in the derivation to enable install checks. The exception is cross
        compilation. Cross compiled builds never run tests, no matter how
        <code class="varname">doInstallCheck</code> is set, as the newly-built program
        won't run on the platform used to build it.
       </p></dd><dt><span class="term">
       <code class="varname">installCheckTarget</code>
      </span></dt><dd><p>
        The make target that runs the install tests. Defaults to
        <code class="literal">installcheck</code>.
       </p></dd><dt><span class="term">
       <code class="varname">installCheckFlags</code> / <code class="varname">installCheckFlagsArray</code>
      </span></dt><dd><p>
        A list of strings passed as additional flags to
        <span class="command"><strong>make</strong></span>. Like <code class="varname">makeFlags</code> and
        <code class="varname">makeFlagsArray</code>, but only used by the installCheck
        phase.
       </p></dd><dt><span class="term">
       <code class="varname">installCheckInputs</code>
      </span></dt><dd><p>
        A list of dependencies used by the phase. This gets included in
        <code class="varname">nativeBuildInputs</code> when
        <code class="varname">doInstallCheck</code> is set.
       </p></dd><dt><span class="term">
       <code class="varname">preInstallCheck</code>
      </span></dt><dd><p>
        Hook executed at the start of the installCheck phase.
       </p></dd><dt><span class="term">
       <code class="varname">postInstallCheck</code>
      </span></dt><dd><p>
        Hook executed at the end of the installCheck phase.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-distribution-phase"></a>3.5.10. The distribution phase</h3></div></div></div><p>
     The distribution phase is intended to produce a source distribution of the
     package. The default <code class="function">distPhase</code> first calls
     <span class="command"><strong>make dist</strong></span>, then it copies the resulting source tarballs
     to <code class="filename">$out/tarballs/</code>. This phase is only executed if the
     attribute <code class="varname">doDist</code> is set.
    </p><div class="variablelist"><p class="title"><strong>Variables controlling the distribution phase</strong></p><dl class="variablelist"><dt><span class="term">
       <code class="varname">distTarget</code>
      </span></dt><dd><p>
        The make target that produces the distribution. Defaults to
        <code class="literal">dist</code>.
       </p></dd><dt><span class="term">
       <code class="varname">distFlags</code> / <code class="varname">distFlagsArray</code>
      </span></dt><dd><p>
        Additional flags passed to <span class="command"><strong>make</strong></span>.
       </p></dd><dt><span class="term">
       <code class="varname">tarballs</code>
      </span></dt><dd><p>
        The names of the source distribution files to be copied to
        <code class="filename">$out/tarballs/</code>. It can contain shell wildcards.
        The default is <code class="filename">*.tar.gz</code>.
       </p></dd><dt><span class="term">
       <code class="varname">dontCopyDist</code>
      </span></dt><dd><p>
        If set, no files are copied to <code class="filename">$out/tarballs/</code>.
       </p></dd><dt><span class="term">
       <code class="varname">preDist</code>
      </span></dt><dd><p>
        Hook executed at the start of the distribution phase.
       </p></dd><dt><span class="term">
       <code class="varname">postDist</code>
      </span></dt><dd><p>
        Hook executed at the end of the distribution phase.
       </p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ssec-stdenv-functions"></a>3.6. Shell functions</h2></div></div></div><p>
    The standard environment provides a number of useful functions.
   </p><div class="variablelist"><dl class="variablelist"><dt><a id="fun-makeWrapper"></a><span class="term">
      <code class="function">makeWrapper</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>wrapperfile</code></em> <em class="replaceable"><code>args</code></em>
     </span></dt><dd><p>
       Constructs a wrapper for a program with various possible arguments. For
       example:
</p><pre class="programlisting">
# adds `FOOBAR=baz` to `$out/bin/foo`’s environment
makeWrapper $out/bin/foo $wrapperfile --set FOOBAR baz

# prefixes the binary paths of `hello` and `git`
# Be advised that paths often should be patched in directly
# (via string replacements or in `configurePhase`).
makeWrapper $out/bin/foo $wrapperfile --prefix PATH : ${lib.makeBinPath [ hello git ]}
</pre><p>
       There’s many more kinds of arguments, they are documented in
       <code class="literal">nixpkgs/pkgs/build-support/setup-hooks/make-wrapper.sh</code>.
      </p><p>
       <code class="literal">wrapProgram</code> is a convenience function you probably
       want to use most of the time.
      </p></dd><dt><a id="fun-substitute"></a><span class="term">
      <code class="function">substitute</code> <em class="replaceable"><code>infile</code></em> <em class="replaceable"><code>outfile</code></em> <em class="replaceable"><code>subs</code></em>
     </span></dt><dd><p>
       Performs string substitution on the contents of
       <em class="replaceable"><code>infile</code></em>, writing the result to
       <em class="replaceable"><code>outfile</code></em>. The substitutions in
       <em class="replaceable"><code>subs</code></em> are of the following form:
       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          <code class="option">--replace</code> <em class="replaceable"><code>s1</code></em> <em class="replaceable"><code>s2</code></em>
         </span></dt><dd><p>
           Replace every occurrence of the string <em class="replaceable"><code>s1</code></em>
           by <em class="replaceable"><code>s2</code></em>.
          </p></dd><dt><span class="term">
          <code class="option">--subst-var</code> <em class="replaceable"><code>varName</code></em>
         </span></dt><dd><p>
           Replace every occurrence of
           <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code> by the
           contents of the environment variable
           <em class="replaceable"><code>varName</code></em>. This is useful for generating
           files from templates, using
           <code class="literal">@<em class="replaceable"><code>...</code></em>@</code> in the template
           as placeholders.
          </p></dd><dt><span class="term">
          <code class="option">--subst-var-by</code> <em class="replaceable"><code>varName</code></em> <em class="replaceable"><code>s</code></em>
         </span></dt><dd><p>
           Replace every occurrence of
           <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code> by the
           string <em class="replaceable"><code>s</code></em>.
          </p></dd></dl></div><p>
      </p><p>
       Example:
</p><pre class="programlisting">
substitute ./foo.in ./foo.out \
    --replace /usr/bin/bar $bar/bin/bar \
    --replace "a string containing spaces" "some other text" \
    --subst-var someVar
</pre><p>
      </p><p>
       <code class="function">substitute</code> is implemented using the
       <span class="command"><strong><a class="command" href="http://replace.richardlloyd.org.uk/" target="_top">replace</a></strong></span>
       command. Unlike with the <span class="command"><strong>sed</strong></span> command, you
       don’t have to worry about escaping special characters. It
       supports performing substitutions on binary files (such as executables),
       though there you’ll probably want to make sure that the
       replacement string is as long as the replaced string.
      </p></dd><dt><a id="fun-substituteInPlace"></a><span class="term">
      <code class="function">substituteInPlace</code> <em class="replaceable"><code>file</code></em> <em class="replaceable"><code>subs</code></em>
     </span></dt><dd><p>
       Like <code class="function">substitute</code>, but performs the substitutions in
       place on the file <em class="replaceable"><code>file</code></em>.
      </p></dd><dt><a id="fun-substituteAll"></a><span class="term">
      <code class="function">substituteAll</code> <em class="replaceable"><code>infile</code></em> <em class="replaceable"><code>outfile</code></em>
     </span></dt><dd><p>
       Replaces every occurrence of
       <code class="literal">@<em class="replaceable"><code>varName</code></em>@</code>, where
       <em class="replaceable"><code>varName</code></em> is any environment variable, in
       <em class="replaceable"><code>infile</code></em>, writing the result to
       <em class="replaceable"><code>outfile</code></em>. For instance, if
       <em class="replaceable"><code>infile</code></em> has the contents
</p><pre class="programlisting">
#! @bash@/bin/sh
PATH=@coreutils@/bin
echo @foo@
</pre><p>
       and the environment contains
       <code class="literal">bash=/nix/store/bmwp0q28cf21...-bash-3.2-p39</code> and
       <code class="literal">coreutils=/nix/store/68afga4khv0w...-coreutils-6.12</code>,
       but does not contain the variable <code class="varname">foo</code>, then the
       output will be
</p><pre class="programlisting">
#! /nix/store/bmwp0q28cf21...-bash-3.2-p39/bin/sh
PATH=/nix/store/68afga4khv0w...-coreutils-6.12/bin
echo @foo@
</pre><p>
       That is, no substitution is performed for undefined variables.
      </p><p>
       Environment variables that start with an uppercase letter or an
       underscore are filtered out, to prevent global variables (like
       <code class="literal">HOME</code>) or private variables (like
       <code class="literal">__ETC_PROFILE_DONE</code>) from accidentally getting
       substituted. The variables also have to be valid bash
       “names”, as defined in the bash manpage (alphanumeric or
       <code class="literal">_</code>, must not start with a number).
      </p></dd><dt><a id="fun-substituteAllInPlace"></a><span class="term">
      <code class="function">substituteAllInPlace</code> <em class="replaceable"><code>file</code></em>
     </span></dt><dd><p>
       Like <code class="function">substituteAll</code>, but performs the substitutions
       in place on the file <em class="replaceable"><code>file</code></em>.
      </p></dd><dt><a id="fun-stripHash"></a><span class="term">
      <code class="function">stripHash</code> <em class="replaceable"><code>path</code></em>
     </span></dt><dd><p>
       Strips the directory and hash part of a store path, outputting the name
       part to <code class="literal">stdout</code>. For example:
</p><pre class="programlisting">
# prints coreutils-8.24
stripHash "/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"
</pre><p>
       If you wish to store the result in another variable, then the following
       idiom may be useful:
</p><pre class="programlisting">
name="/nix/store/9s9r019176g7cvn2nvcw41gsp862y6b4-coreutils-8.24"
someVar=$(stripHash $name)
</pre><p>
      </p></dd><dt><a id="fun-wrapProgram"></a><span class="term">
      <code class="function">wrapProgram</code> <em class="replaceable"><code>executable</code></em> <em class="replaceable"><code>makeWrapperArgs</code></em>
     </span></dt><dd><p>
       Convenience function for <code class="literal">makeWrapper</code> that
       automatically creates a sane wrapper file It takes all the same
       arguments as <code class="literal">makeWrapper</code>, except for
       <code class="literal">--argv0</code>.
      </p><p>
       It cannot be applied multiple times, since it will overwrite the wrapper
       file.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ssec-setup-hooks"></a>3.7. Package setup hooks</h2></div></div></div><p>
    Nix itself considers a build-time dependency as merely something that
    should previously be built and accessible at build time—packages
    themselves are on their own to perform any additional setup. In most cases,
    that is fine, and the downstream derivation can deal with its own
    dependencies. But for a few common tasks, that would result in almost every
    package doing the same sort of setup work—depending not on the
    package itself, but entirely on which dependencies were used.
   </p><p>
    In order to alleviate this burden, the <em class="firstterm">setup hook</em>
    mechanism was written, where any package can include a shell script that
    [by convention rather than enforcement by Nix], any downstream
    reverse-dependency will source as part of its build process. That allows
    the downstream dependency to merely specify its dependencies, and lets
    those dependencies effectively initialize themselves. No boilerplate
    mirroring the list of dependencies is needed.
   </p><p>
    The setup hook mechanism is a bit of a sledgehammer though: a powerful
    feature with a broad and indiscriminate area of effect. The combination of
    its power and implicit use may be expedient, but isn't without costs. Nix
    itself is unchanged, but the spirit of added dependencies being effect-free
    is violated even if the letter isn't. For example, if a derivation path is
    mentioned more than once, Nix itself doesn't care and simply makes sure the
    dependency derivation is already built just the same—depending is
    just needing something to exist, and needing is idempotent. However, a
    dependency specified twice will have its setup hook run twice, and that
    could easily change the build environment (though a well-written setup hook
    will therefore strive to be idempotent so this is in fact not observable).
    More broadly, setup hooks are anti-modular in that multiple dependencies,
    whether the same or different, should not interfere and yet their setup
    hooks may well do so.
   </p><p>
    The most typical use of the setup hook is actually to add other hooks which
    are then run (i.e. after all the setup hooks) on each dependency. For
    example, the C compiler wrapper's setup hook feeds itself flags for each
    dependency that contains relevant libraries and headers. This is done by
    defining a bash function, and appending its name to one of
    <code class="envar">envBuildBuildHooks</code>`, <code class="envar">envBuildHostHooks</code>`,
    <code class="envar">envBuildTargetHooks</code>`, <code class="envar">envHostHostHooks</code>`,
    <code class="envar">envHostTargetHooks</code>`, or
    <code class="envar">envTargetTargetHooks</code>`. These 6 bash variables correspond to
    the 6 sorts of dependencies by platform (there's 12 total but we ignore the
    propagated/non-propagated axis).
   </p><p>
    Packages adding a hook should not hard code a specific hook, but rather
    choose a variable <span class="emphasis"><em>relative</em></span> to how they are included.
    Returning to the C compiler wrapper example, if the wrapper itself is an
    <code class="literal">n</code> dependency, then it only wants to accumulate flags
    from <code class="literal">n + 1</code> dependencies, as only those ones match the
    compiler's target platform. The <code class="envar">hostOffset</code> variable is
    defined with the current dependency's host offset
    <code class="envar">targetOffset</code> with its target offset, before its setup hook
    is sourced. Additionally, since most environment hooks don't care about the
    target platform, that means the setup hook can append to the right bash
    array by doing something like
</p><pre class="programlisting">
addEnvHooks "$hostOffset" myBashFunction
  </pre><p>
   </p><p>
    The <span class="emphasis"><em>existence</em></span> of setups hooks has long been documented
    and packages inside Nixpkgs are free to use this mechanism. Other packages,
    however, should not rely on these mechanisms not changing between Nixpkgs
    versions. Because of the existing issues with this system, there's little
    benefit from mandating it be stable for any period of time.
   </p><p>
    First, let’s cover some setup hooks that are part of Nixpkgs default
    stdenv. This means that they are run for every package built using
    <code class="function">stdenv.mkDerivation</code>. Some of these are platform
    specific, so they may run on Linux but not Darwin or vice-versa.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="literal">move-docs.sh</code>
      </span></dt><dd><p>
        This setup hook moves any installed documentation to the
        <code class="literal">/share</code> subdirectory directory. This includes the
        man, doc and info directories. This is needed for legacy programs that
        do not know how to use the <code class="literal">share</code> subdirectory.
       </p></dd><dt><span class="term">
       <code class="literal">compress-man-pages.sh</code>
      </span></dt><dd><p>
        This setup hook compresses any man pages that have been installed. The
        compression is done using the gzip program. This helps to reduce the
        installed size of packages.
       </p></dd><dt><span class="term">
       <code class="literal">strip.sh</code>
      </span></dt><dd><p>
        This runs the strip command on installed binaries and libraries. This
        removes unnecessary information like debug symbols when they are not
        needed. This also helps to reduce the installed size of packages.
       </p></dd><dt><span class="term">
       <code class="literal">patch-shebangs.sh</code>
      </span></dt><dd><p>
        This setup hook patches installed scripts to use the full path to the
        shebang interpreter. A shebang interpreter is the first commented line
        of a script telling the operating system which program will run the
        script (e.g <code class="literal">#!/bin/bash</code>). In Nix, we want an exact
        path to that interpreter to be used. This often replaces
        <code class="literal">/bin/sh</code> with a path in the Nix store.
       </p></dd><dt><span class="term">
       <code class="literal">audit-tmpdir.sh</code>
      </span></dt><dd><p>
        This verifies that no references are left from the install binaries to
        the directory used to build those binaries. This ensures that the
        binaries do not need things outside the Nix store. This is currently
        supported in Linux only.
       </p></dd><dt><span class="term">
       <code class="literal">multiple-outputs.sh</code>
      </span></dt><dd><p>
        This setup hook adds configure flags that tell packages to install
        files into any one of the proper outputs listed in
        <code class="literal">outputs</code>. This behavior can be turned off by setting
        <code class="literal">setOutputFlags</code> to false in the derivation
        environment. See <a class="xref" href="#chap-multiple-output" title="Chapter 4. Multiple-output packages">Chapter 4, <em>Multiple-output packages</em></a> for more
        information.
       </p></dd><dt><span class="term">
       <code class="literal">move-sbin.sh</code>
      </span></dt><dd><p>
        This setup hook moves any binaries installed in the sbin subdirectory
        into bin. In addition, a link is provided from sbin to bin for
        compatibility.
       </p></dd><dt><span class="term">
       <code class="literal">move-lib64.sh</code>
      </span></dt><dd><p>
        This setup hook moves any libraries installed in the lib64 subdirectory
        into lib. In addition, a link is provided from lib64 to lib for
        compatibility.
       </p></dd><dt><span class="term">
       <code class="literal">set-source-date-epoch-to-latest.sh</code>
      </span></dt><dd><p>
        This sets <code class="literal">SOURCE_DATE_EPOCH</code> to the modification time
        of the most recent file.
       </p></dd><dt><span class="term">
       Bintools Wrapper
      </span></dt><dd><p>
        The Bintools Wrapper wraps the binary utilities for a bunch of
        miscellaneous purposes. These are GNU Binutils when targetting Linux,
        and a mix of cctools and GNU binutils for Darwin. [The "Bintools" name
        is supposed to be a compromise between "Binutils" and "cctools" not
        denoting any specific implementation.] Specifically, the underlying
        bintools package, and a C standard library (glibc or Darwin's
        libSystem, just for the dynamic loader) are all fed in, and dependency
        finding, hardening (see below), and purity checks for each are handled
        by the Bintools Wrapper. Packages typically depend on CC Wrapper, which
        in turn (at run time) depends on the Bintools Wrapper.
       </p><p>
        The Bintools Wrapper was only just recently split off from CC Wrapper,
        so the division of labor is still being worked out. For example, it
        shouldn't care about about the C standard library, but just take a
        derivation with the dynamic loader (which happens to be the glibc on
        linux). Dependency finding however is a task both wrappers will
        continue to need to share, and probably the most important to
        understand. It is currently accomplished by collecting directories of
        host-platform dependencies (i.e. <code class="varname">buildInputs</code> and
        <code class="varname">nativeBuildInputs</code>) in environment variables. The
        Bintools Wrapper's setup hook causes any <code class="filename">lib</code> and
        <code class="filename">lib64</code> subdirectories to be added to
        <code class="envar">NIX_LDFLAGS</code>. Since the CC Wrapper and the Bintools
        Wrapper use the same strategy, most of the Bintools Wrapper code is
        sparsely commented and refers to the CC Wrapper. But the CC Wrapper's
        code, by contrast, has quite lengthy comments. The Bintools Wrapper
        merely cites those, rather than repeating them, to avoid falling out of
        sync.
       </p><p>
        A final task of the setup hook is defining a number of standard
        environment variables to tell build systems which executables fulfill
        which purpose. They are defined to just be the base name of the tools,
        under the assumption that the Bintools Wrapper's binaries will be on
        the path. Firstly, this helps poorly-written packages, e.g. ones that
        look for just <span class="command"><strong>gcc</strong></span> when <code class="envar">CC</code> isn't
        defined yet <span class="command"><strong>clang</strong></span> is to be used. Secondly, this
        helps packages not get confused when cross-compiling, in which case
        multiple Bintools Wrappers may simultaneously be in use.
        <a href="#ftn.footnote-stdenv-per-platform-wrapper" class="footnote" id="footnote-stdenv-per-platform-wrapper"><sup class="footnote">[6]</sup></a>
        <code class="envar">BUILD_</code>- and <code class="envar">TARGET_</code>-prefixed versions of
        the normal environment variable are defined for additional Bintools
        Wrappers, properly disambiguating them.
       </p><p>
        A problem with this final task is that the Bintools Wrapper is honest
        and defines <code class="envar">LD</code> as <span class="command"><strong>ld</strong></span>. Most packages,
        however, firstly use the C compiler for linking, secondly use
        <code class="envar">LD</code> anyways, defining it as the C compiler, and thirdly,
        only so define <code class="envar">LD</code> when it is undefined as a fallback.
        This triple-threat means Bintools Wrapper will break those packages, as
        LD is already defined as the actual linker which the package won't
        override yet doesn't want to use. The workaround is to define, just for
        the problematic package, <code class="envar">LD</code> as the C compiler. A good
        way to do this would be <span class="command"><strong>preConfigure = "LD=$CC"</strong></span>.
       </p></dd><dt><span class="term">
       CC Wrapper
      </span></dt><dd><p>
        The CC Wrapper wraps a C toolchain for a bunch of miscellaneous
        purposes. Specifically, a C compiler (GCC or Clang), wrapped binary
        tools, and a C standard library (glibc or Darwin's libSystem, just for
        the dynamic loader) are all fed in, and dependency finding, hardening
        (see below), and purity checks for each are handled by the CC Wrapper.
        Packages typically depend on the CC Wrapper, which in turn (at
        run-time) depends on the Bintools Wrapper.
       </p><p>
        Dependency finding is undoubtedly the main task of the CC Wrapper. This
        works just like the Bintools Wrapper, except that any
        <code class="filename">include</code> subdirectory of any relevant dependency is
        added to <code class="envar">NIX_CFLAGS_COMPILE</code>. The setup hook itself
        contains some lengthy comments describing the exact convoluted
        mechanism by which this is accomplished.
       </p><p>
        Similarly, the CC Wrapper follows the Bintools Wrapper in defining
        standard environment variables with the names of the tools it wraps,
        for the same reasons described above. Importantly, while it includes a
        <span class="command"><strong>cc</strong></span> symlink to the c compiler for portability, the
        <code class="envar">CC</code> will be defined using the compiler's "real name"
        (i.e. <span class="command"><strong>gcc</strong></span> or <span class="command"><strong>clang</strong></span>). This helps
        lousy build systems that inspect on the name of the compiler rather
        than run it.
       </p></dd></dl></div><p>
   </p><p>
    Here are some more packages that provide a setup hook. Since the list of
    hooks is extensible, this is not an exhaustive list the mechanism is only
    to be used as a last resort, it might cover most uses.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       Perl
      </span></dt><dd><p>
        Adds the <code class="filename">lib/site_perl</code> subdirectory of each build
        input to the <code class="envar">PERL5LIB</code> environment variable. For
        instance, if <code class="varname">buildInputs</code> contains Perl, then the
        <code class="filename">lib/site_perl</code> subdirectory of each input is added
        to the <code class="envar">PERL5LIB</code> environment variable.
       </p></dd><dt><span class="term">
       Python
      </span></dt><dd><p>
        Adds the <code class="filename">lib/${python.libPrefix}/site-packages</code>
        subdirectory of each build input to the <code class="envar">PYTHONPATH</code>
        environment variable.
       </p></dd><dt><span class="term">
       pkg-config
      </span></dt><dd><p>
        Adds the <code class="filename">lib/pkgconfig</code> and
        <code class="filename">share/pkgconfig</code> subdirectories of each build input
        to the <code class="envar">PKG_CONFIG_PATH</code> environment variable.
       </p></dd><dt><span class="term">
       Automake
      </span></dt><dd><p>
        Adds the <code class="filename">share/aclocal</code> subdirectory of each build
        input to the <code class="envar">ACLOCAL_PATH</code> environment variable.
       </p></dd><dt><span class="term">
       Autoconf
      </span></dt><dd><p>
        The <code class="varname">autoreconfHook</code> derivation adds
        <code class="varname">autoreconfPhase</code>, which runs autoreconf, libtoolize
        and automake, essentially preparing the configure script in
        autotools-based builds. Most autotools-based packages come with the
        configure script pre-generated, but this hook is necessary for a few
        packages and when you need to patch the package’s configure
        scripts.
       </p></dd><dt><span class="term">
       libxml2
      </span></dt><dd><p>
        Adds every file named <code class="filename">catalog.xml</code> found under the
        <code class="filename">xml/dtd</code> and <code class="filename">xml/xsl</code>
        subdirectories of each build input to the
        <code class="envar">XML_CATALOG_FILES</code> environment variable.
       </p></dd><dt><span class="term">
       teTeX / TeX Live
      </span></dt><dd><p>
        Adds the <code class="filename">share/texmf-nix</code> subdirectory of each
        build input to the <code class="envar">TEXINPUTS</code> environment variable.
       </p></dd><dt><span class="term">
       Qt 4
      </span></dt><dd><p>
        Sets the <code class="envar">QTDIR</code> environment variable to Qt’s path.
       </p></dd><dt><span class="term">
       gdk-pixbuf
      </span></dt><dd><p>
        Exports <code class="envar">GDK_PIXBUF_MODULE_FILE</code> environment variable to
        the builder. Add librsvg package to <code class="varname">buildInputs</code> to
        get svg support.
       </p></dd><dt><span class="term">
       GHC
      </span></dt><dd><p>
        Creates a temporary package database and registers every Haskell build
        input in it (TODO: how?).
       </p></dd><dt><span class="term">
       GStreamer
      </span></dt><dd><p>
        Adds the GStreamer plugins subdirectory of each build input to the
        <code class="envar">GST_PLUGIN_SYSTEM_PATH_1_0</code> or
        <code class="envar">GST_PLUGIN_SYSTEM_PATH</code> environment variable.
       </p></dd><dt><span class="term">
       autoPatchelfHook
      </span></dt><dd><p>
        This is a special setup hook which helps in packaging proprietary
        software in that it automatically tries to find missing shared library
        dependencies of ELF files based on the given
        <code class="varname">buildInputs</code> and
        <code class="varname">nativeBuildInputs</code>.
       </p><p>
        You can also specify a <code class="envar">runtimeDependencies</code> environment
        variable which lists dependencies that are unconditionally added to all
        executables.
       </p><p>
        This is useful for programs that use <span class="citerefentry"><span class="refentrytitle">dlopen</span>(3)</span> to load libraries at runtime.
       </p><p>
        In certain situations you may want to run the main command
        (<span class="command"><strong>autoPatchelf</strong></span>) of the setup hook on a file or a set
        of directories instead of unconditionally patching all outputs. This
        can be done by setting the <code class="envar">dontAutoPatchelf</code> environment
        variable to a non-empty value.
       </p><p>
        The <span class="command"><strong>autoPatchelf</strong></span> command also recognizes a
        <em class="parameter"><code>--no-recurse</code></em> command line flag,
        which prevents it from recursing into subdirectories.
       </p></dd><dt><span class="term">
       breakpointHook
      </span></dt><dd><p>
        This hook will make a build pause instead of stopping when a failure
        happens. It prevents nix from cleaning up the build environment
        immediately and allows the user to attach to a build environment using
        the <span class="command"><strong>cntr</strong></span> command. Upon build error it will print
        instructions on how to use <span class="command"><strong>cntr</strong></span>. Installing cntr and
        running the command will provide shell access to the build sandbox of
        failed build. At <code class="filename">/var/lib/cntr</code> the sandboxed
        filesystem is mounted. All commands and files of the system are still
        accessible within the shell. To execute commands from the sandbox use
        the cntr exec subcommand. Note that <span class="command"><strong>cntr</strong></span> also needs
        to be executed on the machine that is doing the build, which might not
        be the case when remote builders are enabled. <span class="command"><strong>cntr</strong></span>
        is only supported on Linux-based platforms. To use it first add
        <code class="literal">cntr</code> to your
        <code class="literal">environment.systemPackages</code> on NixOS or alternatively
        to the root user on non-NixOS systems. Then in the package that is
        supposed to be inspected, add <code class="literal">breakpointHook</code> to
        <code class="literal">nativeBuildInputs</code>.
</p><pre class="programlisting">
         nativeBuildInputs = [ breakpointHook ];
       </pre><p>
        When a build failure happens there will be an instruction printed that
        shows how to attach with <code class="literal">cntr</code> to the build sandbox.
       </p></dd><dt><span class="term">
       libiconv, libintl
      </span></dt><dd><p>
        A few libraries automatically add to <code class="literal">NIX_LDFLAGS</code>
        their library, making their symbols automatically available to the
        linker. This includes libiconv and libintl (gettext). This is done to
        provide compatibility between GNU Linux, where libiconv and libintl are
        bundled in, and other systems where that might not be the case.
        Sometimes, this behavior is not desired. To disable this behavior, set
        <code class="literal">dontAddExtraLibs</code>.
       </p></dd><dt><span class="term">
       cmake
      </span></dt><dd><p>
        Overrides the default configure phase to run the CMake command. By
        default, we use the Make generator of CMake. In addition, dependencies
        are added automatically to CMAKE_PREFIX_PATH so that packages are
        correctly detected by CMake. Some additional flags are passed in to
        give similar behavior to configure-based packages. You can disable this
        hook’s behavior by setting configurePhase to a custom value, or
        by setting dontUseCmakeConfigure. cmakeFlags controls flags passed only
        to CMake. By default, parallel building is enabled as CMake supports
        parallel building almost everywhere. When Ninja is also in use, CMake
        will detect that and use the ninja generator.
       </p></dd><dt><span class="term">
       xcbuildHook
      </span></dt><dd><p>
        Overrides the build and install phases to run the
        “xcbuild” command. This hook is needed when a project
        only comes with build files for the XCode build system. You can disable
        this behavior by setting buildPhase and configurePhase to a custom
        value. xcbuildFlags controls flags passed only to xcbuild.
       </p></dd><dt><span class="term">
       meson
      </span></dt><dd><p>
        Overrides the configure phase to run meson to generate Ninja files. You
        can disable this behavior by setting configurePhase to a custom value,
        or by setting dontUseMesonConfigure. To run these files, you should
        accompany meson with ninja. mesonFlags controls only the flags passed
        to meson. By default, parallel building is enabled as Meson supports
        parallel building almost everywhere.
       </p></dd><dt><span class="term">
       ninja
      </span></dt><dd><p>
        Overrides the build, install, and check phase to run ninja instead of
        make. You can disable this behavior with the dontUseNinjaBuild,
        dontUseNinjaInstall, and dontUseNinjaCheck, respectively. Parallel
        building is enabled by default in Ninja.
       </p></dd><dt><span class="term">
       unzip
      </span></dt><dd><p>
        This setup hook will allow you to unzip .zip files specified in $src.
        There are many similar packages like unrar, undmg, etc.
       </p></dd><dt><span class="term">
       wafHook
      </span></dt><dd><p>
        Overrides the configure, build, and install phases. This will run the
        "waf" script used by many projects. If waf doesn’t exist, it
        will copy the version of waf available in Nixpkgs wafFlags can be used
        to pass flags to the waf script.
       </p></dd><dt><span class="term">
       scons
      </span></dt><dd><p>
        Overrides the build, install, and check phases. This uses the scons
        build system as a replacement for make. scons does not provide a
        configure phase, so everything is managed at build and install time.
       </p></dd></dl></div><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-purity-in-nixpkgs"></a>3.8. Purity in Nixpkgs</h2></div></div></div><p>
    [measures taken to prevent dependencies on packages outside the store, and
    what you can do to prevent them]
   </p><p>
    GCC doesn't search in locations such as <code class="filename">/usr/include</code>.
    In fact, attempts to add such directories through the <code class="option">-I</code>
    flag are filtered out. Likewise, the linker (from GNU binutils) doesn't
    search in standard locations such as <code class="filename">/usr/lib</code>.
    Programs built on Linux are linked against a GNU C Library that likewise
    doesn't search in the default system locations.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-hardening-in-nixpkgs"></a>3.9. Hardening in Nixpkgs</h2></div></div></div><p>
    There are flags available to harden packages at compile or link-time. These
    can be toggled using the <code class="varname">stdenv.mkDerivation</code> parameters
    <code class="varname">hardeningDisable</code> and <code class="varname">hardeningEnable</code>.
   </p><p>
    Both parameters take a list of flags as strings. The special
    <code class="varname">"all"</code> flag can be passed to
    <code class="varname">hardeningDisable</code> to turn off all hardening. These flags
    can also be used as environment variables for testing or development
    purposes.
   </p><p>
    The following flags are enabled by default and might require disabling with
    <code class="varname">hardeningDisable</code> if the program to package is
    incompatible.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="varname">format</code>
     </span></dt><dd><p>
       Adds the <code class="option">-Wformat -Wformat-security
       -Werror=format-security</code> compiler options. At present, this
       warns about calls to <code class="varname">printf</code> and
       <code class="varname">scanf</code> functions where the format string is not a
       string literal and there are no format arguments, as in
       <code class="literal">printf(foo);</code>. This may be a security hole if the
       format string came from untrusted input and contains
       <code class="literal">%n</code>.
      </p><p>
       This needs to be turned off or fixed for errors similar to:
      </p><pre class="programlisting">
/tmp/nix-build-zynaddsubfx-2.5.2.drv-0/zynaddsubfx-2.5.2/src/UI/guimain.cpp:571:28: error: format not a string literal and no format arguments [-Werror=format-security]
         printf(help_message);
                            ^
cc1plus: some warnings being treated as errors
    </pre></dd><dt><span class="term">
      <code class="varname">stackprotector</code>
     </span></dt><dd><p>
       Adds the <code class="option">-fstack-protector-strong --param
       ssp-buffer-size=4</code> compiler options. This adds safety checks
       against stack overwrites rendering many potential code injection attacks
       into aborting situations. In the best case this turns code injection
       vulnerabilities into denial of service or into non-issues (depending on
       the application).
      </p><p>
       This needs to be turned off or fixed for errors similar to:
      </p><pre class="programlisting">
bin/blib.a(bios_console.o): In function `bios_handle_cup':
/tmp/nix-build-ipxe-20141124-5cbdc41.drv-0/ipxe-5cbdc41/src/arch/i386/firmware/pcbios/bios_console.c:86: undefined reference to `__stack_chk_fail'
    </pre></dd><dt><span class="term">
      <code class="varname">fortify</code>
     </span></dt><dd><p>
       Adds the <code class="option">-O2 -D_FORTIFY_SOURCE=2</code> compiler options.
       During code generation the compiler knows a great deal of information
       about buffer sizes (where possible), and attempts to replace insecure
       unlimited length buffer function calls with length-limited ones. This is
       especially useful for old, crufty code. Additionally, format strings in
       writable memory that contain '%n' are blocked. If an application depends
       on such a format string, it will need to be worked around.
      </p><p>
       Additionally, some warnings are enabled which might trigger build
       failures if compiler warnings are treated as errors in the package
       build. In this case, set <code class="option">NIX_CFLAGS_COMPILE</code> to
       <code class="option">-Wno-error=warning-type</code>.
      </p><p>
       This needs to be turned off or fixed for errors similar to:
      </p><pre class="programlisting">
malloc.c:404:15: error: return type is an incomplete type
malloc.c:410:19: error: storage size of 'ms' isn't known
    </pre><pre class="programlisting">
strdup.h:22:1: error: expected identifier or '(' before '__extension__'
    </pre><pre class="programlisting">
strsep.c:65:23: error: register name not specified for 'delim'
    </pre><pre class="programlisting">
installwatch.c:3751:5: error: conflicting types for '__open_2'
    </pre><pre class="programlisting">
fcntl2.h:50:4: error: call to '__open_missing_mode' declared with attribute error: open with O_CREAT or O_TMPFILE in second argument needs 3 arguments
    </pre></dd><dt><span class="term">
      <code class="varname">pic</code>
     </span></dt><dd><p>
       Adds the <code class="option">-fPIC</code> compiler options. This options adds
       support for position independent code in shared libraries and thus
       making ASLR possible.
      </p><p>
       Most notably, the Linux kernel, kernel modules and other code not
       running in an operating system environment like boot loaders won't build
       with PIC enabled. The compiler will is most cases complain that PIC is
       not supported for a specific build.
      </p><p>
       This needs to be turned off or fixed for assembler errors similar to:
      </p><pre class="programlisting">
ccbLfRgg.s: Assembler messages:
ccbLfRgg.s:33: Error: missing or invalid displacement expression `private_key_len@GOTOFF'
    </pre></dd><dt><span class="term">
      <code class="varname">strictoverflow</code>
     </span></dt><dd><p>
       Signed integer overflow is undefined behaviour according to the C
       standard. If it happens, it is an error in the program as it should
       check for overflow before it can happen, not afterwards. GCC provides
       built-in functions to perform arithmetic with overflow checking, which
       are correct and faster than any custom implementation. As a workaround,
       the option <code class="option">-fno-strict-overflow</code> makes gcc behave as if
       signed integer overflows were defined.
      </p><p>
       This flag should not trigger any build or runtime errors.
      </p></dd><dt><span class="term">
      <code class="varname">relro</code>
     </span></dt><dd><p>
       Adds the <code class="option">-z relro</code> linker option. During program load,
       several ELF memory sections need to be written to by the linker, but can
       be turned read-only before turning over control to the program. This
       prevents some GOT (and .dtors) overwrite attacks, but at least the part
       of the GOT used by the dynamic linker (.got.plt) is still vulnerable.
      </p><p>
       This flag can break dynamic shared object loading. For instance, the
       module systems of Xorg and OpenCV are incompatible with this flag. In
       almost all cases the <code class="varname">bindnow</code> flag must also be
       disabled and incompatible programs typically fail with similar errors at
       runtime.
      </p></dd><dt><span class="term">
      <code class="varname">bindnow</code>
     </span></dt><dd><p>
       Adds the <code class="option">-z bindnow</code> linker option. During program load,
       all dynamic symbols are resolved, allowing for the complete GOT to be
       marked read-only (due to <code class="varname">relro</code>). This prevents GOT
       overwrite attacks. For very large applications, this can incur some
       performance loss during initial load while symbols are resolved, but
       this shouldn't be an issue for daemons.
      </p><p>
       This flag can break dynamic shared object loading. For instance, the
       module systems of Xorg and PHP are incompatible with this flag. Programs
       incompatible with this flag often fail at runtime due to missing
       symbols, like:
      </p><pre class="programlisting">
intel_drv.so: undefined symbol: vgaHWFreeHWRec
    </pre></dd></dl></div><p>
    The following flags are disabled by default and should be enabled with
    <code class="varname">hardeningEnable</code> for packages that take untrusted input
    like network services.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="varname">pie</code>
     </span></dt><dd><p>
       Adds the <code class="option">-fPIE</code> compiler and <code class="option">-pie</code>
       linker options. Position Independent Executables are needed to take
       advantage of Address Space Layout Randomization, supported by modern
       kernel versions. While ASLR can already be enforced for data areas in
       the stack and heap (brk and mmap), the code areas must be compiled as
       position-independent. Shared libraries already do this with the
       <code class="varname">pic</code> flag, so they gain ASLR automatically, but binary
       .text regions need to be build with <code class="varname">pie</code> to gain ASLR.
       When this happens, ROP attacks are much harder since there are no static
       locations to bounce off of during a memory corruption attack.
      </p></dd></dl></div><p>
    For more in-depth information on these hardening flags and hardening in
    general, refer to the
    <a class="link" href="https://wiki.debian.org/Hardening" target="_top">Debian Wiki</a>,
    <a class="link" href="https://wiki.ubuntu.com/Security/Features" target="_top">Ubuntu
    Wiki</a>,
    <a class="link" href="https://wiki.gentoo.org/wiki/Project:Hardened" target="_top">Gentoo
    Wiki</a>, and the
    <a class="link" href="https://wiki.archlinux.org/index.php/DeveloperWiki:Security" target="_top">
    Arch Wiki</a>.
   </p></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.footnote-stdenv-ignored-build-platform" class="footnote"><p><a href="#footnote-stdenv-ignored-build-platform" class="para"><sup class="para">[1] </sup></a>
      The build platform is ignored because it is a mere implementation detail
      of the package satisfying the dependency: As a general programming
      principle, dependencies are always <span class="emphasis"><em>specified</em></span> as
      interfaces, not concrete implementation.
     </p></div><div id="ftn.footnote-stdenv-native-dependencies-in-path" class="footnote"><p><a href="#footnote-stdenv-native-dependencies-in-path" class="para"><sup class="para">[2] </sup></a>
      Currently, this means for native builds all dependencies are put on the
      <code class="envar">PATH</code>. But in the future that may not be the case for sake
      of matching cross: the platforms would be assumed to be unique for native
      and cross builds alike, so only the <code class="varname">depsBuild*</code> and
      <code class="varname">nativeBuildInputs</code> would be added to the
      <code class="envar">PATH</code>.
     </p></div><div id="ftn.footnote-stdenv-find-inputs-location" class="footnote"><p><a href="#footnote-stdenv-find-inputs-location" class="para"><sup class="para">[3] </sup></a>
      The <code class="function">findInputs</code> function, currently residing in
      <code class="filename">pkgs/stdenv/generic/setup.sh</code>, implements the
      propagation logic.
     </p></div><div id="ftn.footnote-stdenv-sys-lib-search-path" class="footnote"><p><a href="#footnote-stdenv-sys-lib-search-path" class="para"><sup class="para">[4] </sup></a>
          It clears the
          <code class="varname">sys_lib_<em class="replaceable"><code>*</code></em>search_path</code>
          variables in the Libtool script to prevent Libtool from using
          libraries in <code class="filename">/usr/lib</code> and such.
         </p></div><div id="ftn.footnote-stdenv-build-time-guessing-impurity" class="footnote"><p><a href="#footnote-stdenv-build-time-guessing-impurity" class="para"><sup class="para">[5] </sup></a>
          Eventually these will be passed building natively as well, to improve
          determinism: build-time guessing, as is done today, is a risk of
          impurity.
         </p></div><div id="ftn.footnote-stdenv-per-platform-wrapper" class="footnote"><p><a href="#footnote-stdenv-per-platform-wrapper" class="para"><sup class="para">[6] </sup></a>
          Each wrapper targets a single platform, so if binaries for multiple
          platforms are needed, the underlying binaries must be wrapped
          multiple times. As this is a property of the wrapper itself, the
          multiple wrappings are needed whether or not the same underlying
          binaries can target multiple platforms.
         </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-multiple-output"></a>Chapter 4. Multiple-output packages</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-multiple-outputs-introduction">4.1. Introduction</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-installing">4.2. Installing a split package</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-using-split-packages">4.3. Using a split package</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-">4.4. Writing a split derivation</a></span></dt><dd><dl><dt><span class="section"><a href="#multiple-output-file-binaries-first-convention">4.4.1. <span class="quote">“<span class="quote">Binaries first</span>”</span></a></span></dt><dt><span class="section"><a href="#multiple-output-file-type-groups">4.4.2. File type groups</a></span></dt><dt><span class="section"><a href="#sec-multiple-outputs-caveats">4.4.3. Common caveats</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-multiple-outputs-introduction"></a>4.1. Introduction</h2></div></div></div><p>
    The Nix language allows a derivation to produce multiple outputs, which is
    similar to what is utilized by other Linux distribution packaging systems.
    The outputs reside in separate Nix store paths, so they can be mostly
    handled independently of each other, including passing to build inputs,
    garbage collection or binary substitution. The exception is that building
    from source always produces all the outputs.
   </p><p>
    The main motivation is to save disk space by reducing runtime closure
    sizes; consequently also sizes of substituted binaries get reduced.
    Splitting can be used to have more granular runtime dependencies, for
    example the typical reduction is to split away development-only files, as
    those are typically not needed during runtime. As a result, closure sizes
    of many packages can get reduced to a half or even much less.
   </p><div class="note"><h3 class="title">Note</h3><p>
     The reduction effects could be instead achieved by building the parts in
     completely separate derivations. That would often additionally reduce
     build-time closures, but it tends to be much harder to write such
     derivations, as build systems typically assume all parts are being built
     at once. This compromise approach of single source package producing
     multiple binary packages is also utilized often by rpm and deb.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-multiple-outputs-installing"></a>4.2. Installing a split package</h2></div></div></div><p>
    When installing a package via <code class="varname">systemPackages</code> or
    <span class="command"><strong>nix-env</strong></span> you have several options:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      You can install particular outputs explicitly, as each is available in
      the Nix language as an attribute of the package. The
      <code class="varname">outputs</code> attribute contains a list of output names.
     </p></li><li class="listitem"><p>
      You can let it use the default outputs. These are handled by
      <code class="varname">meta.outputsToInstall</code> attribute that contains a list
      of output names.
     </p><p>
      TODO: more about tweaking the attribute, etc.
     </p></li><li class="listitem"><p>
      NixOS provides configuration option
      <code class="varname">environment.extraOutputsToInstall</code> that allows adding
      extra outputs of <code class="varname">environment.systemPackages</code> atop the
      default ones. It's mainly meant for documentation and debug symbols, and
      it's also modified by specific options.
     </p><div class="note"><h3 class="title">Note</h3><p>
       At this moment there is no similar configurability for packages
       installed by <span class="command"><strong>nix-env</strong></span>. You can still use approach from
       <a class="xref" href="#sec-modify-via-packageOverrides" title="6.5. Modify packages via packageOverrides">Section 6.5, “Modify packages via <code class="literal">packageOverrides</code>”</a> to override
       <code class="varname">meta.outputsToInstall</code> attributes, but that's a rather
       inconvenient way.
      </p></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-multiple-outputs-using-split-packages"></a>4.3. Using a split package</h2></div></div></div><p>
    In the Nix language the individual outputs can be reached explicitly as
    attributes, e.g. <code class="varname">coreutils.info</code>, but the typical case is
    just using packages as build inputs.
   </p><p>
    When a multiple-output derivation gets into a build input of another
    derivation, the <code class="varname">dev</code> output is added if it exists,
    otherwise the first output is added. In addition to that,
    <code class="varname">propagatedBuildOutputs</code> of that package which by default
    contain <code class="varname">$outputBin</code> and <code class="varname">$outputLib</code> are
    also added. (See <a class="xref" href="#multiple-output-file-type-groups" title="4.4.2. File type groups">Section 4.4.2, “File type groups”</a>.)
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-multiple-outputs-"></a>4.4. Writing a split derivation</h2></div></div></div><p>
    Here you find how to write a derivation that produces multiple outputs.
   </p><p>
    In nixpkgs there is a framework supporting multiple-output derivations. It
    tries to cover most cases by default behavior. You can find the source
    separated in
    &lt;<code class="filename">nixpkgs/pkgs/build-support/setup-hooks/multiple-outputs.sh</code>&gt;;
    it's relatively well-readable. The whole machinery is triggered by defining
    the <code class="varname">outputs</code> attribute to contain the list of desired
    output names (strings).
   </p><pre class="programlisting">outputs = [ "bin" "dev" "out" "doc" ];</pre><p>
    Often such a single line is enough. For each output an equally named
    environment variable is passed to the builder and contains the path in nix
    store for that output. Typically you also want to have the main
    <code class="varname">out</code> output, as it catches any files that didn't get
    elsewhere.
   </p><div class="note"><h3 class="title">Note</h3><p>
     There is a special handling of the <code class="varname">debug</code> output,
     described at <a class="xref" href="#stdenv-separateDebugInfo">
       <code class="varname">separateDebugInfo</code>
      </a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="multiple-output-file-binaries-first-convention"></a>4.4.1. <span class="quote">“<span class="quote">Binaries first</span>”</span></h3></div></div></div><p>
     A commonly adopted convention in <code class="literal">nixpkgs</code> is that
     executables provided by the package are contained within its first output.
     This convention allows the dependent packages to reference the executables
     provided by packages in a uniform manner. For instance, provided with the
     knowledge that the <code class="literal">perl</code> package contains a
     <code class="literal">perl</code> executable it can be referenced as
     <code class="literal">${pkgs.perl}/bin/perl</code> within a Nix derivation that
     needs to execute a Perl script.
    </p><p>
     The <code class="literal">glibc</code> package is a deliberate single exception to
     the <span class="quote">“<span class="quote">binaries first</span>”</span> convention. The <code class="literal">glibc</code>
     has <code class="literal">libs</code> as its first output allowing the libraries
     provided by <code class="literal">glibc</code> to be referenced directly (e.g.
     <code class="literal">${stdenv.glibc}/lib/ld-linux-x86-64.so.2</code>). The
     executables provided by <code class="literal">glibc</code> can be accessed via its
     <code class="literal">bin</code> attribute (e.g.
     <code class="literal">${stdenv.glibc.bin}/bin/ldd</code>).
    </p><p>
     The reason for why <code class="literal">glibc</code> deviates from the convention
     is because referencing a library provided by <code class="literal">glibc</code> is a
     very common operation among Nix packages. For instance, third-party
     executables packaged by Nix are typically patched and relinked with the
     relevant version of <code class="literal">glibc</code> libraries from Nix packages
     (please see the documentation on
     <a class="link" href="https://nixos.org/patchelf.html" target="_top">patchelf</a> for
     more details).
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="multiple-output-file-type-groups"></a>4.4.2. File type groups</h3></div></div></div><p>
     The support code currently recognizes some particular kinds of outputs and
     either instructs the build system of the package to put files into their
     desired outputs or it moves the files during the fixup phase. Each group
     of file types has an <code class="varname">outputFoo</code> variable specifying the
     output name where they should go. If that variable isn't defined by the
     derivation writer, it is guessed – a default output name is defined,
     falling back to other possibilities if the output isn't defined.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname"> $outputDev</code>
      </span></dt><dd><p>
        is for development-only files. These include C(++) headers, pkg-config,
        cmake and aclocal files. They go to <code class="varname">dev</code> or
        <code class="varname">out</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputBin</code>
      </span></dt><dd><p>
        is meant for user-facing binaries, typically residing in bin/. They go
        to <code class="varname">bin</code> or <code class="varname">out</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputLib</code>
      </span></dt><dd><p>
        is meant for libraries, typically residing in <code class="filename">lib/</code>
        and <code class="filename">libexec/</code>. They go to <code class="varname">lib</code> or
        <code class="varname">out</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputDoc</code>
      </span></dt><dd><p>
        is for user documentation, typically residing in
        <code class="filename">share/doc/</code>. It goes to <code class="varname">doc</code> or
        <code class="varname">out</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputDevdoc</code>
      </span></dt><dd><p>
        is for <span class="emphasis"><em>developer</em></span> documentation. Currently we count
        gtk-doc and devhelp books in there. It goes to
        <code class="varname">devdoc</code> or is removed (!) by default. This is because
        e.g. gtk-doc tends to be rather large and completely unused by nixpkgs
        users.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputMan</code>
      </span></dt><dd><p>
        is for man pages (except for section 3). They go to
        <code class="varname">man</code> or <code class="varname">$outputBin</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputDevman</code>
      </span></dt><dd><p>
        is for section 3 man pages. They go to <code class="varname">devman</code> or
        <code class="varname">$outputMan</code> by default.
       </p></dd><dt><span class="term">
       <code class="varname"> $outputInfo</code>
      </span></dt><dd><p>
        is for info pages. They go to <code class="varname">info</code> or
        <code class="varname">$outputBin</code> by default.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-multiple-outputs-caveats"></a>4.4.3. Common caveats</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Some configure scripts don't like some of the parameters passed by
       default by the framework, e.g. <code class="literal">--docdir=/foo/bar</code>. You
       can disable this by setting <code class="literal">setOutputFlags = false;</code>.
      </p></li><li class="listitem"><p>
       The outputs of a single derivation can retain references to each other,
       but note that circular references are not allowed. (And each
       strongly-connected component would act as a single output anyway.)
      </p></li><li class="listitem"><p>
       Most of split packages contain their core functionality in libraries.
       These libraries tend to refer to various kind of data that typically
       gets into <code class="varname">out</code>, e.g. locale strings, so there is often
       no advantage in separating the libraries into <code class="varname">lib</code>, as
       keeping them in <code class="varname">out</code> is easier.
      </p></li><li class="listitem"><p>
       Some packages have hidden assumptions on install paths, which
       complicates splitting.
      </p></li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-cross"></a>Chapter 5. Cross-compilation</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-cross-intro">5.1. Introduction</a></span></dt><dt><span class="section"><a href="#sec-cross-packaging">5.2. Packaging in a cross-friendly manner</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-cross-platform-parameters">5.2.1. Platform parameters</a></span></dt><dt><span class="section"><a href="#sec-cross-specifying-dependencies">5.2.2. Specifying Dependencies</a></span></dt><dt><span class="section"><a href="#sec-cross-cookbook">5.2.3. Cross packaging cookbook</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-cross-usage">5.3. Cross-building packages</a></span></dt><dt><span class="section"><a href="#sec-cross-infra">5.4. Cross-compilation infrastructure</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-cross-intro"></a>5.1. Introduction</h2></div></div></div><p>
    "Cross-compilation" means compiling a program on one machine for another
    type of machine. For example, a typical use of cross-compilation is to
    compile programs for embedded devices. These devices often don't have the
    computing power and memory to compile their own programs. One might think
    that cross-compilation is a fairly niche concern. However, there are
    significant advantages to rigorously distinguishing between build-time and
    run-time environments! This applies even when one is developing and
    deploying on the same machine. Nixpkgs is increasingly adopting the opinion
    that packages should be written with cross-compilation in mind, and nixpkgs
    should evaluate in a similar way (by minimizing cross-compilation-specific
    special cases) whether or not one is cross-compiling.
   </p><p>
    This chapter will be organized in three parts. First, it will describe the
    basics of how to package software in a way that supports cross-compilation.
    Second, it will describe how to use Nixpkgs when cross-compiling. Third, it
    will describe the internal infrastructure supporting cross-compilation.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-cross-packaging"></a>5.2. Packaging in a cross-friendly manner</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-cross-platform-parameters"></a>5.2.1. Platform parameters</h3></div></div></div><p>
     Nixpkgs follows the
     <a class="link" href="https://gcc.gnu.org/onlinedocs/gccint/Configure-Terms.html" target="_top">conventions
     of GNU autoconf</a>. We distinguish between 3 types of platforms when
     building a derivation: <em class="wordasword">build</em>,
     <em class="wordasword">host</em>, and <em class="wordasword">target</em>. In
     summary, <em class="wordasword">build</em> is the platform on which a package
     is being built, <em class="wordasword">host</em> is the platform on which it
     will run. The third attribute, <em class="wordasword">target</em>, is
     relevant only for certain specific compilers and build tools.
    </p><p>
     In Nixpkgs, these three platforms are defined as attribute sets under the
     names <code class="literal">buildPlatform</code>, <code class="literal">hostPlatform</code>,
     and <code class="literal">targetPlatform</code>. They are always defined as
     attributes in the standard environment. That means one can access them
     like:
</p><pre class="programlisting">{ stdenv, fooDep, barDep, .. }: ...stdenv.buildPlatform...</pre><p>
     .
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">buildPlatform</code>
      </span></dt><dd><p>
        The "build platform" is the platform on which a package is built. Once
        someone has a built package, or pre-built binary package, the build
        platform should not matter and can be ignored.
       </p></dd><dt><span class="term">
       <code class="varname">hostPlatform</code>
      </span></dt><dd><p>
        The "host platform" is the platform on which a package will be run.
        This is the simplest platform to understand, but also the one with the
        worst name.
       </p></dd><dt><span class="term">
       <code class="varname">targetPlatform</code>
      </span></dt><dd><p>
        The "target platform" attribute is, unlike the other two attributes,
        not actually fundamental to the process of building software. Instead,
        it is only relevant for compatibility with building certain specific
        compilers and build tools. It can be safely ignored for all other
        packages.
       </p><p>
        The build process of certain compilers is written in such a way that
        the compiler resulting from a single build can itself only produce
        binaries for a single platform. The task of specifying this single
        "target platform" is thus pushed to build time of the compiler. The
        root cause of this is that the compiler (which will be run on the host)
        and the standard library/runtime (which will be run on the target) are
        built by a single build process.
       </p><p>
        There is no fundamental need to think about a single target ahead of
        time like this. If the tool supports modular or pluggable backends,
        both the need to specify the target at build time and the constraint of
        having only a single target disappear. An example of such a tool is
        LLVM.
       </p><p>
        Although the existence of a "target platfom" is arguably a historical
        mistake, it is a common one: examples of tools that suffer from it are
        GCC, Binutils, GHC and Autoconf. Nixpkgs tries to avoid sharing in the
        mistake where possible. Still, because the concept of a target platform
        is so ingrained, it is best to support it as is.
       </p></dd></dl></div><p>
     The exact schema these fields follow is a bit ill-defined due to a long
     and convoluted evolution, but this is slowly being cleaned up. You can see
     examples of ones used in practice in
     <code class="literal">lib.systems.examples</code>; note how they are not all very
     consistent. For now, here are few fields can count on them containing:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">system</code>
      </span></dt><dd><p>
        This is a two-component shorthand for the platform. Examples of this
        would be "x86_64-darwin" and "i686-linux"; see
        <code class="literal">lib.systems.doubles</code> for more. The first component
        corresponds to the CPU architecture of the platform and the second to
        the operating system of the platform (<code class="literal">[cpu]-[os]</code>).
        This format has built-in support in Nix, such as the
        <code class="varname">builtins.currentSystem</code> impure string.
       </p></dd><dt><span class="term">
       <code class="varname">config</code>
      </span></dt><dd><p>
        This is a 3- or 4- component shorthand for the platform. Examples of
        this would be <code class="literal">x86_64-unknown-linux-gnu</code> and
        <code class="literal">aarch64-apple-darwin14</code>. This is a standard format
        called the "LLVM target triple", as they are pioneered by LLVM. In the
        4-part form, this corresponds to
        <code class="literal">[cpu]-[vendor]-[os]-[abi]</code>. This format is strictly
        more informative than the "Nix host double", as the previous format
        could analogously be termed. This needs a better name than
        <code class="varname">config</code>!
       </p></dd><dt><span class="term">
       <code class="varname">parsed</code>
      </span></dt><dd><p>
        This is a Nix representation of a parsed LLVM target triple with
        white-listed components. This can be specified directly, or actually
        parsed from the <code class="varname">config</code>. See
        <code class="literal">lib.systems.parse</code> for the exact representation.
       </p></dd><dt><span class="term">
       <code class="varname">libc</code>
      </span></dt><dd><p>
        This is a string identifying the standard C library used. Valid
        identifiers include "glibc" for GNU libc, "libSystem" for Darwin's
        Libsystem, and "uclibc" for µClibc. It should probably be
        refactored to use the module system, like <code class="varname">parse</code>.
       </p></dd><dt><span class="term">
       <code class="varname">is*</code>
      </span></dt><dd><p>
        These predicates are defined in <code class="literal">lib.systems.inspect</code>,
        and slapped onto every platform. They are superior to the ones in
        <code class="varname">stdenv</code> as they force the user to be explicit about
        which platform they are inspecting. Please use these instead of those.
       </p></dd><dt><span class="term">
       <code class="varname">platform</code>
      </span></dt><dd><p>
        This is, quite frankly, a dumping ground of ad-hoc settings (it's an
        attribute set). See <code class="literal">lib.systems.platforms</code> for
        examples—there's hopefully one in there that will work verbatim
        for each platform that is working. Please help us triage these flags
        and give them better homes!
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-cross-specifying-dependencies"></a>5.2.2. Specifying Dependencies</h3></div></div></div><p>
     In this section we explore the relationship between both runtime and
     build-time dependencies and the 3 Autoconf platforms.
    </p><p>
     A runtime dependency between 2 packages implies that between them both the
     host and target platforms match. This is directly implied by the meaning
     of "host platform" and "runtime dependency": The package dependency exists
     while both packages are running on a single host platform.
    </p><p>
     A build time dependency, however, implies a shift in platforms between the
     depending package and the depended-on package. The meaning of a build time
     dependency is that to build the depending package we need to be able to
     run the depended-on's package. The depending package's build platform is
     therefore equal to the depended-on package's host platform. Analogously,
     the depending package's host platform is equal to the depended-on
     package's target platform.
    </p><p>
     In this manner, given the 3 platforms for one package, we can determine
     the three platforms for all its transitive dependencies. This is the most
     important guiding principle behind cross-compilation with Nixpkgs, and
     will be called the <em class="wordasword">sliding window principle</em>.
    </p><p>
     Some examples will make this clearer. If a package is being built with a
     <code class="literal">(build, host, target)</code> platform triple of <code class="literal">(foo,
     bar, bar)</code>, then its build-time dependencies would have a triple
     of <code class="literal">(foo, foo, bar)</code>, and <span class="emphasis"><em>those
     packages'</em></span> build-time dependencies would have a triple of
     <code class="literal">(foo, foo, foo)</code>. In other words, it should take two
     "rounds" of following build-time dependency edges before one reaches a
     fixed point where, by the sliding window principle, the platform triple no
     longer changes. Indeed, this happens with cross-compilation, where only
     rounds of native dependencies starting with the second necessarily
     coincide with native packages.
    </p><div class="note"><h3 class="title">Note</h3><p>
      The depending package's target platform is unconstrained by the sliding
      window principle, which makes sense in that one can in principle build
      cross compilers targeting arbitrary platforms.
     </p></div><p>
     How does this work in practice? Nixpkgs is now structured so that
     build-time dependencies are taken from <code class="varname">buildPackages</code>,
     whereas run-time dependencies are taken from the top level attribute set.
     For example, <code class="varname">buildPackages.gcc</code> should be used at
     build-time, while <code class="varname">gcc</code> should be used at run-time. Now,
     for most of Nixpkgs's history, there was no
     <code class="varname">buildPackages</code>, and most packages have not been
     refactored to use it explicitly. Instead, one can use the six
     (<span class="emphasis"><em>gasp</em></span>) attributes used for specifying dependencies as
     documented in <a class="xref" href="#ssec-stdenv-dependencies" title="3.3. Specifying dependencies">Section 3.3, “Specifying dependencies”</a>. We "splice"
     together the run-time and build-time package sets with
     <code class="varname">callPackage</code>, and then <code class="varname">mkDerivation</code>
     for each of four attributes pulls the right derivation out. This splicing
     can be skipped when not cross-compiling as the package sets are the same,
     but is a bit slow for cross-compiling. Because of this, a
     best-of-both-worlds solution is in the works with no splicing or explicit
     access of <code class="varname">buildPackages</code> needed. For now, feel free to
     use either method.
    </p><div class="note"><h3 class="title">Note</h3><p>
      There is also a "backlink" <code class="varname">targetPackages</code>, yielding a
      package set whose <code class="varname">buildPackages</code> is the current package
      set. This is a hack, though, to accommodate compilers with lousy build
      systems. Please do not use this unless you are absolutely sure you are
      packaging such a compiler and there is no other way.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-cross-cookbook"></a>5.2.3. Cross packaging cookbook</h3></div></div></div><p>
     Some frequently encountered problems when packaging for cross-compilation
     should be answered here. Ideally, the information above is exhaustive, so
     this section cannot provide any new information, but it is ludicrous and
     cruel to expect everyone to spend effort working through the interaction
     of many features just to figure out the same answer to the same common
     problem. Feel free to add to this list!
    </p><div class="qandaset"><a id="idm139978172173136"></a><dl><dt>5.2.3.1. <a href="#cross-qa-build-c-program-in-build-environment">
        What if my package's build system needs to build a C program to be run
        under the build environment?
       </a></dt><dt>5.2.3.2. <a href="#cross-qa-fails-to-find-ar">
        My package fails to find ar.
       </a></dt><dt>5.2.3.3. <a href="#cross-testsuite-runs-host-code">
        My package's testsuite needs to run host platform code.
       </a></dt></dl><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%" /><col /></colgroup><tbody><tr class="question"><td align="left" valign="top"><a id="cross-qa-build-c-program-in-build-environment"></a><a id="idm139978172172032"></a><p><strong>5.2.3.1.</strong></p></td><td align="left" valign="top"><p>
        What if my package's build system needs to build a C program to be run
        under the build environment?
       </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
</p><pre class="programlisting">depsBuildBuild = [ buildPackages.stdenv.cc ];</pre><p>
        Add it to your <code class="function">mkDerivation</code> invocation.
       </p></td></tr><tr class="question"><td align="left" valign="top"><a id="cross-qa-fails-to-find-ar"></a><a id="idm139978172168608"></a><p><strong>5.2.3.2.</strong></p></td><td align="left" valign="top"><p>
        My package fails to find <span class="command"><strong>ar</strong></span>.
       </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
        Many packages assume that an unprefixed <span class="command"><strong>ar</strong></span> is
        available, but Nix doesn't provide one. It only provides a prefixed
        one, just as it only does for all the other binutils programs. It may
        be necessary to patch the package to fix the build system to use a
        prefixed `ar`.
       </p></td></tr><tr class="question"><td align="left" valign="top"><a id="cross-testsuite-runs-host-code"></a><a id="idm139978172165040"></a><p><strong>5.2.3.3.</strong></p></td><td align="left" valign="top"><p>
        My package's testsuite needs to run host platform code.
       </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>
</p><pre class="programlisting">doCheck = stdenv.hostPlatform != stdenv.buildPlatfrom;</pre><p>
        Add it to your <code class="function">mkDerivation</code> invocation.
       </p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-cross-usage"></a>5.3. Cross-building packages</h2></div></div></div><p>
    Nixpkgs can be instantiated with <code class="varname">localSystem</code> alone, in
    which case there is no cross-compiling and everything is built by and for
    that system, or also with <code class="varname">crossSystem</code>, in which case
    packages run on the latter, but all building happens on the former. Both
    parameters take the same schema as the 3 (build, host, and target)
    platforms defined in the previous section. As mentioned above,
    <code class="literal">lib.systems.examples</code> has some platforms which are used
    as arguments for these parameters in practice. You can use them
    programmatically, or on the command line:
</p><pre class="programlisting">
nix-build &lt;nixpkgs&gt; --arg crossSystem '(import &lt;nixpkgs/lib&gt;).systems.examples.fooBarBaz' -A whatever</pre><p>
   </p><div class="note"><h3 class="title">Note</h3><p>
     Eventually we would like to make these platform examples an unnecessary
     convenience so that
</p><pre class="programlisting">
nix-build &lt;nixpkgs&gt; --arg crossSystem '{ config = "&lt;arch&gt;-&lt;os&gt;-&lt;vendor&gt;-&lt;abi&gt;"; }' -A whatever</pre><p>
     works in the vast majority of cases. The problem today is dependencies on
     other sorts of configuration which aren't given proper defaults. We rely
     on the examples to crudely to set those configuration parameters in some
     vaguely sane manner on the users behalf. Issue
     <a class="link" href="https://github.com/NixOS/nixpkgs/issues/34274" target="_top">#34274</a>
     tracks this inconvenience along with its root cause in crufty
     configuration options.
    </p></div><p>
    While one is free to pass both parameters in full, there's a lot of logic
    to fill in missing fields. As discussed in the previous section, only one
    of <code class="varname">system</code>, <code class="varname">config</code>, and
    <code class="varname">parsed</code> is needed to infer the other two. Additionally,
    <code class="varname">libc</code> will be inferred from <code class="varname">parse</code>.
    Finally, <code class="literal">localSystem.system</code> is also
    <span class="emphasis"><em>impurely</em></span> inferred based on the platform evaluation
    occurs. This means it is often not necessary to pass
    <code class="varname">localSystem</code> at all, as in the command-line example in
    the previous paragraph.
   </p><div class="note"><h3 class="title">Note</h3><p>
     Many sources (manual, wiki, etc) probably mention passing
     <code class="varname">system</code>, <code class="varname">platform</code>, along with the
     optional <code class="varname">crossSystem</code> to nixpkgs: <code class="literal">import
     &lt;nixpkgs&gt; { system = ..; platform = ..; crossSystem = ..;
     }</code>. Passing those two instead of <code class="varname">localSystem</code>
     is still supported for compatibility, but is discouraged. Indeed, much of
     the inference we do for these parameters is motivated by compatibility as
     much as convenience.
    </p></div><p>
    One would think that <code class="varname">localSystem</code> and
    <code class="varname">crossSystem</code> overlap horribly with the three
    <code class="varname">*Platforms</code> (<code class="varname">buildPlatform</code>,
    <code class="varname">hostPlatform,</code> and <code class="varname">targetPlatform</code>; see
    <code class="varname">stage.nix</code> or the manual). Actually, those identifiers
    are purposefully not used here to draw a subtle but important distinction:
    While the granularity of having 3 platforms is necessary to properly
    *build* packages, it is overkill for specifying the user's *intent* when
    making a build plan or package set. A simple "build vs deploy" dichotomy is
    adequate: the sliding window principle described in the previous section
    shows how to interpolate between the these two "end points" to get the 3
    platform triple for each bootstrapping stage. That means for any package a
    given package set, even those not bound on the top level but only reachable
    via dependencies or <code class="varname">buildPackages</code>, the three platforms
    will be defined as one of <code class="varname">localSystem</code> or
    <code class="varname">crossSystem</code>, with the former replacing the latter as one
    traverses build-time dependencies. A last simple difference is that
    <code class="varname">crossSystem</code> should be null when one doesn't want to
    cross-compile, while the <code class="varname">*Platform</code>s are always non-null.
    <code class="varname">localSystem</code> is always non-null.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-cross-infra"></a>5.4. Cross-compilation infrastructure</h2></div></div></div><p>
    To be written.
   </p><div class="note"><h3 class="title">Note</h3><p>
     If one explores Nixpkgs, they will see derivations with names like
     <code class="literal">gccCross</code>. Such <code class="literal">*Cross</code> derivations is
     a holdover from before we properly distinguished between the host and
     target platforms—the derivation with "Cross" in the name covered
     the <code class="literal">build = host != target</code> case, while the other
     covered the <code class="literal">host = target</code>, with build platform the same
     or not based on whether one was using its <code class="literal">.nativeDrv</code> or
     <code class="literal">.crossDrv</code>. This ugliness will disappear soon.
    </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-packageconfig"></a>Chapter 6. Global configuration</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-allow-broken">6.1. Installing broken packages</a></span></dt><dt><span class="section"><a href="#sec-allow-unsupported-system">6.2. Installing packages on unsupported systems</a></span></dt><dt><span class="section"><a href="#sec-allow-unfree">6.3. Installing unfree packages</a></span></dt><dt><span class="section"><a href="#sec-allow-insecure">6.4. Installing insecure packages</a></span></dt><dt><span class="section"><a href="#sec-modify-via-packageOverrides">6.5. Modify packages via <code class="literal">packageOverrides</code></a></span></dt><dt><span class="section"><a href="#sec-declarative-package-management">6.6. Declarative Package Management</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-building-environment">6.6.1. Build an environment</a></span></dt><dt><span class="section"><a href="#sec-getting-documentation">6.6.2. Getting documentation</a></span></dt><dt><span class="section"><a href="#sec-gnu-info-setup">6.6.3. GNU info setup</a></span></dt></dl></dd></dl></div><p>
   Nix comes with certain defaults about what packages can and cannot be
   installed, based on a package's metadata. By default, Nix will prevent
   installation if any of the following criteria are true:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The package is thought to be broken, and has had its
     <code class="literal">meta.broken</code> set to <code class="literal">true</code>.
    </p></li><li class="listitem"><p>
     The package isn't intended to run on the given system, as none of its
     <code class="literal">meta.platforms</code> match the given system.
    </p></li><li class="listitem"><p>
     The package's <code class="literal">meta.license</code> is set to a license which is
     considered to be unfree.
    </p></li><li class="listitem"><p>
     The package has known security vulnerabilities but has not or can not be
     updated for some reason, and a list of issues has been entered in to the
     package's <code class="literal">meta.knownVulnerabilities</code>.
    </p></li></ul></div><p>
   Note that all this is checked during evaluation already, and the check
   includes any package that is evaluated. In particular, all build-time
   dependencies are checked. <code class="literal">nix-env -qa</code> will (attempt to)
   hide any packages that would be refused.
  </p><p>
   Each of these criteria can be altered in the nixpkgs configuration.
  </p><p>
   The nixpkgs configuration for a NixOS system is set in the
   <code class="literal">configuration.nix</code>, as in the following example:
</p><pre class="programlisting">
{
  nixpkgs.config = {
    allowUnfree = true;
  };
}
</pre><p>
   However, this does not allow unfree software for individual users. Their
   configurations are managed separately.
  </p><p>
   A user's of nixpkgs configuration is stored in a user-specific configuration
   file located at <code class="filename">~/.config/nixpkgs/config.nix</code>. For
   example:
</p><pre class="programlisting">
{
  allowUnfree = true;
}
</pre><p>
  </p><p>
   Note that we are not able to test or build unfree software on Hydra due to
   policy. Most unfree licenses prohibit us from either executing or
   distributing the software.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-allow-broken"></a>6.1. Installing broken packages</h2></div></div></div><p>
    There are two ways to try compiling a package which has been marked as
    broken.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      For allowing the build of a broken package once, you can use an
      environment variable for a single invocation of the nix tools:
</p><pre class="programlisting">$ export NIXPKGS_ALLOW_BROKEN=1</pre><p>
     </p></li><li class="listitem"><p>
      For permanently allowing broken packages to be built, you may add
      <code class="literal">allowBroken = true;</code> to your user's configuration file,
      like this:
</p><pre class="programlisting">
{
  allowBroken = true;
}
</pre><p>
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-allow-unsupported-system"></a>6.2. Installing packages on unsupported systems</h2></div></div></div><p>
    There are also two ways to try compiling a package which has been marked as
    unsuported for the given system.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      For allowing the build of a broken package once, you can use an
      environment variable for a single invocation of the nix tools:
</p><pre class="programlisting">$ export NIXPKGS_ALLOW_UNSUPPORTED_SYSTEM=1</pre><p>
     </p></li><li class="listitem"><p>
      For permanently allowing broken packages to be built, you may add
      <code class="literal">allowUnsupportedSystem = true;</code> to your user's
      configuration file, like this:
</p><pre class="programlisting">
{
  allowUnsupportedSystem = true;
}
</pre><p>
     </p></li></ul></div><p>
    The difference between a package being unsupported on some system and being
    broken is admittedly a bit fuzzy. If a program <span class="emphasis"><em>ought</em></span>
    to work on a certain platform, but doesn't, the platform should be included
    in <code class="literal">meta.platforms</code>, but marked as broken with e.g.
    <code class="literal">meta.broken = !hostPlatform.isWindows</code>. Of course, this
    begs the question of what "ought" means exactly. That is left to the
    package maintainer.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-allow-unfree"></a>6.3. Installing unfree packages</h2></div></div></div><p>
    There are several ways to tweak how Nix handles a package which has been
    marked as unfree.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      To temporarily allow all unfree packages, you can use an environment
      variable for a single invocation of the nix tools:
</p><pre class="programlisting">$ export NIXPKGS_ALLOW_UNFREE=1</pre><p>
     </p></li><li class="listitem"><p>
      It is possible to permanently allow individual unfree packages, while
      still blocking unfree packages by default using the
      <code class="literal">allowUnfreePredicate</code> configuration option in the user
      configuration file.
     </p><p>
      This option is a function which accepts a package as a parameter, and
      returns a boolean. The following example configuration accepts a package
      and always returns false:
</p><pre class="programlisting">
{
  allowUnfreePredicate = (pkg: false);
}
</pre><p>
     </p><p>
      For a more useful example, try the following. This configuration only
      allows unfree packages named flash player and visual studio code:
</p><pre class="programlisting">
{
  allowUnfreePredicate = (pkg: builtins.elem
    (builtins.parseDrvName pkg.name).name [
      "flashplayer"
      "vscode"
    ]);
}
</pre><p>
     </p></li><li class="listitem"><p>
      It is also possible to whitelist and blacklist licenses that are
      specifically acceptable or not acceptable, using
      <code class="literal">whitelistedLicenses</code> and
      <code class="literal">blacklistedLicenses</code>, respectively.
     </p><p>
      The following example configuration whitelists the licenses
      <code class="literal">amd</code> and <code class="literal">wtfpl</code>:
</p><pre class="programlisting">
{
  whitelistedLicenses = with stdenv.lib.licenses; [ amd wtfpl ];
}
</pre><p>
     </p><p>
      The following example configuration blacklists the
      <code class="literal">gpl3</code> and <code class="literal">agpl3</code> licenses:
</p><pre class="programlisting">
{
  blacklistedLicenses = with stdenv.lib.licenses; [ agpl3 gpl3 ];
}
</pre><p>
     </p></li></ul></div><p>
    A complete list of licenses can be found in the file
    <code class="filename">lib/licenses.nix</code> of the nixpkgs tree.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-allow-insecure"></a>6.4. Installing insecure packages</h2></div></div></div><p>
    There are several ways to tweak how Nix handles a package which has been
    marked as insecure.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      To temporarily allow all insecure packages, you can use an environment
      variable for a single invocation of the nix tools:
</p><pre class="programlisting">$ export NIXPKGS_ALLOW_INSECURE=1</pre><p>
     </p></li><li class="listitem"><p>
      It is possible to permanently allow individual insecure packages, while
      still blocking other insecure packages by default using the
      <code class="literal">permittedInsecurePackages</code> configuration option in the
      user configuration file.
     </p><p>
      The following example configuration permits the installation of the
      hypothetically insecure package <code class="literal">hello</code>, version
      <code class="literal">1.2.3</code>:
</p><pre class="programlisting">
{
  permittedInsecurePackages = [
    "hello-1.2.3"
  ];
}
</pre><p>
     </p></li><li class="listitem"><p>
      It is also possible to create a custom policy around which insecure
      packages to allow and deny, by overriding the
      <code class="literal">allowInsecurePredicate</code> configuration option.
     </p><p>
      The <code class="literal">allowInsecurePredicate</code> option is a function which
      accepts a package and returns a boolean, much like
      <code class="literal">allowUnfreePredicate</code>.
     </p><p>
      The following configuration example only allows insecure packages with
      very short names:
</p><pre class="programlisting">
{
  allowInsecurePredicate = (pkg: (builtins.stringLength (builtins.parseDrvName pkg.name).name) &lt;= 5);
}
</pre><p>
     </p><p>
      Note that <code class="literal">permittedInsecurePackages</code> is only checked if
      <code class="literal">allowInsecurePredicate</code> is not specified.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-modify-via-packageOverrides"></a>6.5. Modify packages via <code class="literal">packageOverrides</code></h2></div></div></div><p>
    You can define a function called <code class="varname">packageOverrides</code> in
    your local <code class="filename">~/.config/nixpkgs/config.nix</code> to override
    Nix packages. It must be a function that takes pkgs as an argument and
    returns a modified set of packages.
</p><pre class="programlisting">
{
  packageOverrides = pkgs: rec {
    foo = pkgs.foo.override { ... };
  };
}
</pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-declarative-package-management"></a>6.6. Declarative Package Management</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-building-environment"></a>6.6.1. Build an environment</h3></div></div></div><p>
     Using <code class="literal">packageOverrides</code>, it is possible to manage
     packages declaratively. This means that we can list all of our desired
     packages within a declarative Nix expression. For example, to have
     <code class="literal">aspell</code>, <code class="literal">bc</code>,
     <code class="literal">ffmpeg</code>, <code class="literal">coreutils</code>,
     <code class="literal">gdb</code>, <code class="literal">nixUnstable</code>,
     <code class="literal">emscripten</code>, <code class="literal">jq</code>,
     <code class="literal">nox</code>, and <code class="literal">silver-searcher</code>, we could
     use the following in <code class="filename">~/.config/nixpkgs/config.nix</code>:
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; {
    myPackages = pkgs.buildEnv {
      name = "my-packages";
      paths = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
    };
  };
}
</pre><p>
     To install it into our environment, you can just run <code class="literal">nix-env -iA
     nixpkgs.myPackages</code>. If you want to load the packages to be built
     from a working copy of <code class="literal">nixpkgs</code> you just run
     <code class="literal">nix-env -f. -iA myPackages</code>. To explore what's been
     installed, just look through <code class="filename">~/.nix-profile/</code>. You can
     see that a lot of stuff has been installed. Some of this stuff is useful
     some of it isn't. Let's tell Nixpkgs to only link the stuff that we want:
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; {
    myPackages = pkgs.buildEnv {
      name = "my-packages";
      paths = [
        aspell
        bc
        coreutils
        gdb
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      pathsToLink = [ "/share" "/bin" ];
    };
  };
}
</pre><p>
     <code class="literal">pathsToLink</code> tells Nixpkgs to only link the paths listed
     which gets rid of the extra stuff in the profile.
     <code class="filename">/bin</code> and <code class="filename">/share</code> are good
     defaults for a user environment, getting rid of the clutter. If you are
     running on Nix on MacOS, you may want to add another path as well,
     <code class="filename">/Applications</code>, that makes GUI apps available.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-getting-documentation"></a>6.6.2. Getting documentation</h3></div></div></div><p>
     After building that new environment, look through
     <code class="filename">~/.nix-profile</code> to make sure everything is there that
     we wanted. Discerning readers will note that some files are missing. Look
     inside <code class="filename">~/.nix-profile/share/man/man1/</code> to verify this.
     There are no man pages for any of the Nix tools! This is because some
     packages like Nix have multiple outputs for things like documentation (see
     section 4). Let's make Nix install those as well.
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; {
    myPackages = pkgs.buildEnv {
      name = "my-packages";
      paths = [
        aspell
        bc
        coreutils
        ffmpeg
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      pathsToLink = [ "/share/man" "/share/doc" "/bin" ];
      extraOutputsToInstall = [ "man" "doc" ];
    };
  };
}
</pre><p>
     This provides us with some useful documentation for using our packages.
     However, if we actually want those manpages to be detected by man, we need
     to set up our environment. This can also be managed within Nix
     expressions.
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; rec {
    myProfile = writeText "my-profile" ''
      export PATH=$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      export MANPATH=$HOME/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
    '';
    myPackages = pkgs.buildEnv {
      name = "my-packages";
      paths = [
        (runCommand "profile" {} ''
          mkdir -p $out/etc/profile.d
          cp ${myProfile} $out/etc/profile.d/my-profile.sh
        '')
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
      ];
      pathsToLink = [ "/share/man" "/share/doc" "/bin" "/etc" ];
      extraOutputsToInstall = [ "man" "doc" ];
    };
  };
}
</pre><p>
     For this to work fully, you must also have this script sourced when you
     are logged in. Try adding something like this to your
     <code class="filename">~/.profile</code> file:
    </p><pre class="screen">
#!/bin/sh
if [ -d $HOME/.nix-profile/etc/profile.d ]; then
  for i in $HOME/.nix-profile/etc/profile.d/*.sh; do
    if [ -r $i ]; then
      . $i
    fi
  done
fi
</pre><p>
     Now just run <code class="literal">source $HOME/.profile</code> and you can starting
     loading man pages from your environent.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-gnu-info-setup"></a>6.6.3. GNU info setup</h3></div></div></div><p>
     Configuring GNU info is a little bit trickier than man pages. To work
     correctly, info needs a database to be generated. This can be done with
     some small modifications to our environment scripts.
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; rec {
    myProfile = writeText "my-profile" ''
      export PATH=$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/sbin:/bin:/usr/sbin:/usr/bin
      export MANPATH=$HOME/.nix-profile/share/man:/nix/var/nix/profiles/default/share/man:/usr/share/man
      export INFOPATH=$HOME/.nix-profile/share/info:/nix/var/nix/profiles/default/share/info:/usr/share/info
    '';
    myPackages = pkgs.buildEnv {
      name = "my-packages";
      paths = [
        (runCommand "profile" {} ''
          mkdir -p $out/etc/profile.d
          cp ${myProfile} $out/etc/profile.d/my-profile.sh
        '')
        aspell
        bc
        coreutils
        ffmpeg
        man
        nixUnstable
        emscripten
        jq
        nox
        silver-searcher
        texinfoInteractive
      ];
      pathsToLink = [ "/share/man" "/share/doc" "/share/info" "/bin" "/etc" ];
      extraOutputsToInstall = [ "man" "doc" "info" ];
      postBuild = ''
        if [ -x $out/bin/install-info -a -w $out/share/info ]; then
          shopt -s nullglob
          for i in $out/share/info/*.info $out/share/info/*.info.gz; do
              $out/bin/install-info $i $out/share/info/dir
          done
        fi
      '';
    };
  };
}
</pre><p>
     <code class="literal">postBuild</code> tells Nixpkgs to run a command after building
     the environment. In this case, <code class="literal">install-info</code> adds the
     installed info pages to <code class="literal">dir</code> which is GNU info's default
     root node. Note that <code class="literal">texinfoInteractive</code> is added to the
     environment to give the <code class="literal">install-info</code> command.
    </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-functions"></a>Chapter 7. Functions reference</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-functions-library">7.1. Nixpkgs Library Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-functions-library-asserts">7.1.1. Assert functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.asserts.assertMsg">7.1.1.1. <code class="function">lib.asserts.assertMsg</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.asserts.assertOneOf">7.1.1.2. <code class="function">lib.asserts.assertOneOf</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-attrset">7.1.2. Attribute-Set Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.attrsets.attrByPath">7.1.2.1. <code class="function">lib.attrset.attrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.hasAttrByPath">7.1.2.2. <code class="function">lib.attrsets.hasAttrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.setAttrByPath">7.1.2.3. <code class="function">lib.attrsets.setAttrByPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.getAttrFromPath">7.1.2.4. <code class="function">lib.attrsets.getAttrFromPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.attrVals">7.1.2.5. <code class="function">lib.attrsets.attrVals</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.attrValues">7.1.2.6. <code class="function">lib.attrsets.attrValues</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.catAttrs">7.1.2.7. <code class="function">lib.attrsets.catAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.filterAttrs">7.1.2.8. <code class="function">lib.attrsets.filterAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.filterAttrsRecursive">7.1.2.9. <code class="function">lib.attrsets.filterAttrsRecursive</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.foldAttrs">7.1.2.10. <code class="function">lib.attrsets.foldAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.collect">7.1.2.11. <code class="function">lib.attrsets.collect</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.nameValuePair">7.1.2.12. <code class="function">lib.attrsets.nameValuePair</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrs">7.1.2.13. <code class="function">lib.attrsets.mapAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrs-prime">7.1.2.14. <code class="function">lib.attrsets.mapAttrs'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsToList">7.1.2.15. <code class="function">lib.attrsets.mapAttrsToList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsRecursive">7.1.2.16. <code class="function">lib.attrsets.mapAttrsRecursive</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.mapAttrsRecursiveCond">7.1.2.17. <code class="function">lib.attrsets.mapAttrsRecursiveCond</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.genAttrs">7.1.2.18. <code class="function">lib.attrsets.genAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.isDerivation">7.1.2.19. <code class="function">lib.attrsets.isDerivation</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.toDerivation">7.1.2.20. <code class="function">lib.attrsets.toDerivation</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.optionalAttrs">7.1.2.21. <code class="function">lib.attrsets.optionalAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrsWithNames">7.1.2.22. <code class="function">lib.attrsets.zipAttrsWithNames</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrsWith">7.1.2.23. <code class="function">lib.attrsets.zipAttrsWith</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.zipAttrs">7.1.2.24. <code class="function">lib.attrsets.zipAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.recursiveUpdateUntil">7.1.2.25. <code class="function">lib.attrsets.recursiveUpdateUntil</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.attrsets.recursiveUpdate">7.1.2.26. <code class="function">lib.attrsets.recursiveUpdate</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-strings">7.1.3. String manipulation functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.strings.concatStrings">7.1.3.1. <code class="function">lib.strings.concatStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatMapStrings">7.1.3.2. <code class="function">lib.strings.concatMapStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatImapStrings">7.1.3.3. <code class="function">lib.strings.concatImapStrings</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.intersperse">7.1.3.4. <code class="function">lib.strings.intersperse</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatStringsSep">7.1.3.5. <code class="function">lib.strings.concatStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatMapStringsSep">7.1.3.6. <code class="function">lib.strings.concatMapStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.concatImapStringsSep">7.1.3.7. <code class="function">lib.strings.concatImapStringsSep</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeSearchPath">7.1.3.8. <code class="function">lib.strings.makeSearchPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeSearchPathOutput">7.1.3.9. <code class="function">lib.strings.makeSearchPathOutput</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeLibraryPath">7.1.3.10. <code class="function">lib.strings.makeLibraryPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.makeBinPath">7.1.3.11. <code class="function">lib.strings.makeBinPath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.optionalString">7.1.3.12. <code class="function">lib.strings.optionalString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasPrefix">7.1.3.13. <code class="function">lib.strings.hasPrefix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasSuffix">7.1.3.14. <code class="function">lib.strings.hasSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.hasInfix">7.1.3.15. <code class="function">lib.strings.hasInfix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.stringToCharacters">7.1.3.16. <code class="function">lib.strings.stringToCharacters</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.stringAsChars">7.1.3.17. <code class="function">lib.strings.stringAsChars</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escape">7.1.3.18. <code class="function">lib.strings.escape</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeShellArg">7.1.3.19. <code class="function">lib.strings.escapeShellArg</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeShellArgs">7.1.3.20. <code class="function">lib.strings.escapeShellArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.escapeNixString">7.1.3.21. <code class="function">lib.strings.escapeNixString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toLower">7.1.3.22. <code class="function">lib.strings.toLower</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toUpper">7.1.3.23. <code class="function">lib.strings.toUpper</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.addContextFrom">7.1.3.24. <code class="function">lib.strings.addContextFrom</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.splitString">7.1.3.25. <code class="function">lib.strings.splitString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.removePrefix">7.1.3.26. <code class="function">lib.strings.removePrefix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.removeSuffix">7.1.3.27. <code class="function">lib.strings.removeSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.versionOlder">7.1.3.28. <code class="function">lib.strings.versionOlder</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.versionAtLeast">7.1.3.29. <code class="function">lib.strings.versionAtLeast</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.getVersion">7.1.3.30. <code class="function">lib.strings.getVersion</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.nameFromURL">7.1.3.31. <code class="function">lib.strings.nameFromURL</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.enableFeature">7.1.3.32. <code class="function">lib.strings.enableFeature</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.enableFeatureAs">7.1.3.33. <code class="function">lib.strings.enableFeatureAs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.withFeature">7.1.3.34. <code class="function">lib.strings.withFeature</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.withFeatureAs">7.1.3.35. <code class="function">lib.strings.withFeatureAs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fixedWidthString">7.1.3.36. <code class="function">lib.strings.fixedWidthString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fixedWidthNumber">7.1.3.37. <code class="function">lib.strings.fixedWidthNumber</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.isCoercibleToString">7.1.3.38. <code class="function">lib.strings.isCoercibleToString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.isStorePath">7.1.3.39. <code class="function">lib.strings.isStorePath</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.toInt">7.1.3.40. <code class="function">lib.strings.toInt</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.readPathsFromFile">7.1.3.41. <code class="function">lib.strings.readPathsFromFile</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.strings.fileContents">7.1.3.42. <code class="function">lib.strings.fileContents</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-trivial">7.1.4. Miscellaneous functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.trivial.id">7.1.4.1. <code class="function">lib.trivial.id</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.const">7.1.4.2. <code class="function">lib.trivial.const</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.concat">7.1.4.3. <code class="function">lib.trivial.concat</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.or">7.1.4.4. <code class="function">lib.trivial.or</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.and">7.1.4.5. <code class="function">lib.trivial.and</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitAnd">7.1.4.6. <code class="function">lib.trivial.bitAnd</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitOr">7.1.4.7. <code class="function">lib.trivial.bitOr</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitXor">7.1.4.8. <code class="function">lib.trivial.bitXor</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.bitNot">7.1.4.9. <code class="function">lib.trivial.bitNot</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.boolToString">7.1.4.10. <code class="function">lib.trivial.boolToString</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mergeAttrs">7.1.4.11. <code class="function">lib.trivial.mergeAttrs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.flip">7.1.4.12. <code class="function">lib.trivial.flip</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mapNullable">7.1.4.13. <code class="function">lib.trivial.mapNullable</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.version">7.1.4.14. <code class="function">lib.trivial.version</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.release">7.1.4.15. <code class="function">lib.trivial.release</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.codeName">7.1.4.16. <code class="function">lib.trivial.codeName</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.versionSuffix">7.1.4.17. <code class="function">lib.trivial.versionSuffix</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.revisionWithDefault">7.1.4.18. <code class="function">lib.trivial.revisionWithDefault</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.inNixShell">7.1.4.19. <code class="function">lib.trivial.inNixShell</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.min">7.1.4.20. <code class="function">lib.trivial.min</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.max">7.1.4.21. <code class="function">lib.trivial.max</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.mod">7.1.4.22. <code class="function">lib.trivial.mod</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.compare">7.1.4.23. <code class="function">lib.trivial.compare</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.splitByAndCompare">7.1.4.24. <code class="function">lib.trivial.splitByAndCompare</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.importJSON">7.1.4.25. <code class="function">lib.trivial.importJSON</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.setFunctionArgs">7.1.4.26. <code class="function">lib.trivial.setFunctionArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.functionArgs">7.1.4.27. <code class="function">lib.trivial.functionArgs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.trivial.isFunction">7.1.4.28. <code class="function">lib.trivial.isFunction</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-lists">7.1.5. List manipulation functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.lists.singleton">7.1.5.1. <code class="function">lib.lists.singleton</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldr">7.1.5.2. <code class="function">lib.lists.foldr</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.fold">7.1.5.3. <code class="function">lib.lists.fold</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldl">7.1.5.4. <code class="function">lib.lists.foldl</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.foldl-prime">7.1.5.5. <code class="function">lib.lists.foldl'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.imap0">7.1.5.6. <code class="function">lib.lists.imap0</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.imap1">7.1.5.7. <code class="function">lib.lists.imap1</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.concatMap">7.1.5.8. <code class="function">lib.lists.concatMap</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.flatten">7.1.5.9. <code class="function">lib.lists.flatten</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.remove">7.1.5.10. <code class="function">lib.lists.remove</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.findSingle">7.1.5.11. <code class="function">lib.lists.findSingle</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.findFirst">7.1.5.12. <code class="function">lib.lists.findFirst</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.any">7.1.5.13. <code class="function">lib.lists.any</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.all">7.1.5.14. <code class="function">lib.lists.all</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.count">7.1.5.15. <code class="function">lib.lists.count</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.optional">7.1.5.16. <code class="function">lib.lists.optional</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.optionals">7.1.5.17. <code class="function">lib.lists.optionals</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.toList">7.1.5.18. <code class="function">lib.lists.toList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.range">7.1.5.19. <code class="function">lib.lists.range</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.partition">7.1.5.20. <code class="function">lib.lists.partition</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.groupBy-prime">7.1.5.21. <code class="function">lib.lists.groupBy'</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.zipListsWith">7.1.5.22. <code class="function">lib.lists.zipListsWith</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.zipLists">7.1.5.23. <code class="function">lib.lists.zipLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.reverseList">7.1.5.24. <code class="function">lib.lists.reverseList</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.listDfs">7.1.5.25. <code class="function">lib.lists.listDfs</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.toposort">7.1.5.26. <code class="function">lib.lists.toposort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.sort">7.1.5.27. <code class="function">lib.lists.sort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.compareLists">7.1.5.28. <code class="function">lib.lists.compareLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.naturalSort">7.1.5.29. <code class="function">lib.lists.naturalSort</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.take">7.1.5.30. <code class="function">lib.lists.take</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.drop">7.1.5.31. <code class="function">lib.lists.drop</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.sublist">7.1.5.32. <code class="function">lib.lists.sublist</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.last">7.1.5.33. <code class="function">lib.lists.last</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.init">7.1.5.34. <code class="function">lib.lists.init</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.crossLists">7.1.5.35. <code class="function">lib.lists.crossLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.unique">7.1.5.36. <code class="function">lib.lists.unique</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.intersectLists">7.1.5.37. <code class="function">lib.lists.intersectLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.subtractLists">7.1.5.38. <code class="function">lib.lists.subtractLists</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.lists.mutuallyExclusive">7.1.5.39. <code class="function">lib.lists.mutuallyExclusive</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-debug">7.1.6. Debugging functions</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.debug.traceIf">7.1.6.1. <code class="function">lib.debug.traceIf</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValFn">7.1.6.2. <code class="function">lib.debug.traceValFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceVal">7.1.6.3. <code class="function">lib.debug.traceVal</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceSeq">7.1.6.4. <code class="function">lib.debug.traceSeq</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceSeqN">7.1.6.5. <code class="function">lib.debug.traceSeqN</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqFn">7.1.6.6. <code class="function">lib.debug.traceValSeqFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeq">7.1.6.7. <code class="function">lib.debug.traceValSeq</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqNFn">7.1.6.8. <code class="function">lib.debug.traceValSeqNFn</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.traceValSeqN">7.1.6.9. <code class="function">lib.debug.traceValSeqN</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.runTests">7.1.6.10. <code class="function">lib.debug.runTests</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.debug.testAllTrue">7.1.6.11. <code class="function">lib.debug.testAllTrue</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-functions-library-options">7.1.7. NixOS / nixpkgs option handling</a></span></dt><dd><dl><dt><span class="section"><a href="#function-library-lib.options.isOption">7.1.7.1. <code class="function">lib.options.isOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkOption">7.1.7.2. <code class="function">lib.options.mkOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkEnableOption">7.1.7.3. <code class="function">lib.options.mkEnableOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mkSinkUndeclaredOptions">7.1.7.4. <code class="function">lib.options.mkSinkUndeclaredOptions</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.mergeEqualOption">7.1.7.5. <code class="function">lib.options.mergeEqualOption</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.getValues">7.1.7.6. <code class="function">lib.options.getValues</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.getFiles">7.1.7.7. <code class="function">lib.options.getFiles</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.scrubOptionValue">7.1.7.8. <code class="function">lib.options.scrubOptionValue</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.literalExample">7.1.7.9. <code class="function">lib.options.literalExample</code></a></span></dt><dt><span class="section"><a href="#function-library-lib.options.showOption">7.1.7.10. <code class="function">lib.options.showOption</code></a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#sec-overrides">7.2. Overriding</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkg-override">7.2.1. &lt;pkg&gt;.override</a></span></dt><dt><span class="section"><a href="#sec-pkg-overrideAttrs">7.2.2. &lt;pkg&gt;.overrideAttrs</a></span></dt><dt><span class="section"><a href="#sec-pkg-overrideDerivation">7.2.3. &lt;pkg&gt;.overrideDerivation</a></span></dt><dt><span class="section"><a href="#sec-lib-makeOverridable">7.2.4. lib.makeOverridable</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-generators">7.3. Generators</a></span></dt><dt><span class="section"><a href="#sec-debug">7.4. Debugging Nix Expressions</a></span></dt><dt><span class="section"><a href="#sec-pkgs-fetchers">7.5. Fetcher functions</a></span></dt><dt><span class="section"><a href="#sec-trivial-builders">7.6. Trivial builders</a></span></dt><dt><span class="section"><a href="#sec-fhs-environments">7.7. buildFHSUserEnv</a></span></dt><dt><span class="section"><a href="#sec-pkgs-mkShell">7.8. pkgs.mkShell</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkgs-mkShell-usage">7.8.1. Usage</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-pkgs-dockerTools">7.9. pkgs.dockerTools</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-pkgs-dockerTools-buildImage">7.9.1. buildImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-buildLayeredImage">7.9.2. buildLayeredImage</a></span></dt><dd><dl><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-contents">7.9.2.1. Behavior of <code class="varname">contents</code> in the final image</a></span></dt><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-config">7.9.2.2. Automatic inclusion of <code class="varname">config</code> references</a></span></dt><dt><span class="section"><a href="#dockerTools-buildLayeredImage-arg-maxLayers">7.9.2.3. Adjusting <code class="varname">maxLayers</code></a></span></dt></dl></dd><dt><span class="section"><a href="#ssec-pkgs-dockerTools-fetchFromRegistry">7.9.3. pullImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-exportImage">7.9.4. exportImage</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-dockerTools-shadowSetup">7.9.5. shadowSetup</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-pkgs-appimageTools">7.10. pkgs.appimageTools</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-pkgs-appimageTools-formats">7.10.1. AppImage formats</a></span></dt><dt><span class="section"><a href="#ssec-pkgs-appimageTools-wrapping">7.10.2. Wrapping</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-prefer-remote-fetch">7.11. prefer-remote-fetch overlay</a></span></dt><dt><span class="section"><a href="#sec-pkgs-nix-gitignore">7.12. pkgs.nix-gitignore</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-pkgs-nix-gitignore-usage">7.12.1. Usage</a></span></dt><dt><span class="section"><a href="#sec-pkgs-nix-gitignore-usage-recursive">7.12.2. gitignore files in subdirectories</a></span></dt></dl></dd></dl></div><p>
   The nixpkgs repository has several utility functions to manipulate Nix
   expressions.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-functions-library"></a>7.1. Nixpkgs Library Functions</h2></div></div></div><p>
    Nixpkgs provides a standard library at <code class="varname">pkgs.lib</code>, or
    through <code class="code">import &lt;nixpkgs/lib&gt;</code>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-asserts"></a>7.1.1. Assert functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.asserts.assertMsg"></a>7.1.1.1. <code class="function">lib.asserts.assertMsg</code></h4></div><div><h5 class="subtitle"><code class="literal">assertMsg :: Bool -&gt; String -&gt; Bool</code>
     </h5></div></div></div><p><a id="lib.asserts.assertMsg"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/asserts.nix#L21" target="_top">lib/asserts.nix:21</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Print a trace message if <code class="literal">pred</code> is false.
     </p><p>
      Intended to be used to augment asserts with helpful error messages.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Condition under which the <code class="varname">msg</code> should
         <span class="emphasis"><em>not</em></span> be printed.
        </p></dd><dt><span class="term">
        <code class="varname">msg</code>
       </span></dt><dd><p>
         Message to print.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.asserts.assertMsg-example-false"></a><p class="title"><strong>Example 7.1. Printing when the predicate is false</strong></p><div class="example-contents"><pre class="programlisting">
assert lib.asserts.assertMsg ("foo" == "bar") "foo is not bar, silly"
stderr&gt; trace: foo is not bar, silly
stderr&gt; assert failed
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.asserts.assertOneOf"></a>7.1.1.2. <code class="function">lib.asserts.assertOneOf</code></h4></div><div><h5 class="subtitle"><code class="literal">assertOneOf :: String -&gt; String -&gt;
      StringList -&gt; Bool</code>
     </h5></div></div></div><p><a id="lib.asserts.assertOneOf"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/asserts.nix#L38" target="_top">lib/asserts.nix:38</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Specialized <code class="function">asserts.assertMsg</code> for checking if
      <code class="varname">val</code> is one of the elements of <code class="varname">xs</code>.
      Useful for checking enums.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">name</code>
       </span></dt><dd><p>
         The name of the variable the user entered <code class="varname">val</code> into,
         for inclusion in the error message.
        </p></dd><dt><span class="term">
        <code class="varname">val</code>
       </span></dt><dd><p>
         The value of what the user provided, to be compared against the values
         in <code class="varname">xs</code>.
        </p></dd><dt><span class="term">
        <code class="varname">xs</code>
       </span></dt><dd><p>
         The list of valid values.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.asserts.assertOneOf-example"></a><p class="title"><strong>Example 7.2. Ensuring a user provided a possible value</strong></p><div class="example-contents"><pre class="programlisting">
let sslLibrary = "bearssl";
in lib.asserts.assertOneOf "sslLibrary" sslLibrary [ "openssl" "bearssl" ];
=&gt; false
stderr&gt; trace: sslLibrary must be one of "openssl", "libressl", but is: "bearssl"
        </pre></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-attrset"></a>7.1.2. Attribute-Set Functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrByPath"></a>7.1.2.1. <code class="function">lib.attrset.attrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">attrByPath :: [String] -&gt; Any -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.attrByPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L24" target="_top">lib/attrsets.nix:24</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Return an attribute from within nested attribute sets.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrPath</code>
       </span></dt><dd><p>
         A list of strings representing the path through the nested attribute
         set <code class="varname">set</code>.
        </p></dd><dt><span class="term">
        <code class="varname">default</code>
       </span></dt><dd><p>
         Default value if <code class="varname">attrPath</code> does not resolve to an
         existing value.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The nested attributeset to select values from.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrset.attrByPath-example-value-exists"></a><p class="title"><strong>Example 7.3. Extracting a value from a nested attribute set</strong></p><div class="example-contents"><pre class="programlisting">
let set = { a = { b = 3; }; };
in lib.attrsets.attrByPath [ "a" "b" ] 0 set
=&gt; 3
</pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrset.attrByPath-example-default-value"></a><p class="title"><strong>Example 7.4. No value at the path, instead using the default</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.attrByPath [ "a" "b" ] 0 {}
=&gt; 0
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.hasAttrByPath"></a>7.1.2.2. <code class="function">lib.attrsets.hasAttrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">hasAttrByPath :: [String] -&gt; AttrSet -&gt; Bool</code>
     </h5></div></div></div><p><a id="lib.attrsets.hasAttrByPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L42" target="_top">lib/attrsets.nix:42</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Determine if an attribute exists within a nested attribute set.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrPath</code>
       </span></dt><dd><p>
         A list of strings representing the path through the nested attribute
         set <code class="varname">set</code>.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The nested attributeset to check.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.hasAttrByPath-example"></a><p class="title"><strong>Example 7.5. A nested value does exist inside a set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.hasAttrByPath
  [ "a" "b" "c" "d" ]
  { a = { b = { c = { d = 123; }; }; }; }
=&gt; true
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.setAttrByPath"></a>7.1.2.3. <code class="function">lib.attrsets.setAttrByPath</code></h4></div><div><h5 class="subtitle"><code class="literal">setAttrByPath :: [String] -&gt; Any -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.setAttrByPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L57" target="_top">lib/attrsets.nix:57</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Create a new attribute set with <code class="varname">value</code> set at the
      nested attribute location specified in <code class="varname">attrPath</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrPath</code>
       </span></dt><dd><p>
         A list of strings representing the path through the nested attribute
         set.
        </p></dd><dt><span class="term">
        <code class="varname">value</code>
       </span></dt><dd><p>
         The value to set at the location described by
         <code class="varname">attrPath</code>.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.setAttrByPath-example"></a><p class="title"><strong>Example 7.6. Creating a new nested attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.setAttrByPath [ "a" "b" ] 3
=&gt; { a = { b = 3; }; }
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.getAttrFromPath"></a>7.1.2.4. <code class="function">lib.attrsets.getAttrFromPath</code></h4></div><div><h5 class="subtitle"><code class="literal">getAttrFromPath :: [String] -&gt; AttrSet -&gt; Value</code>
     </h5></div></div></div><p><a id="lib.attrsets.getAttrFromPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L73" target="_top">lib/attrsets.nix:73</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Like <a class="xref" href="#function-library-lib.attrsets.attrByPath" title="7.1.2.1. lib.attrset.attrByPath">Section 7.1.2.1, “<code class="function">lib.attrset.attrByPath</code>”</a> except
      without a default, and it will throw if the value doesn't exist.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrPath</code>
       </span></dt><dd><p>
         A list of strings representing the path through the nested attribute
         set <code class="varname">set</code>.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The nested attribute set to find the value in.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.getAttrPath-example-success"></a><p class="title"><strong>Example 7.7. Succesfully getting a value from an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.getAttrFromPath [ "a" "b" ] { a = { b = 3; }; }
=&gt; 3
</pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrsets.getAttrPath-example-throw"></a><p class="title"><strong>Example 7.8. Throwing after failing to get a value from an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.getAttrFromPath [ "x" "y" ] { }
=&gt; error: cannot find attribute `x.y'
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrVals"></a>7.1.2.5. <code class="function">lib.attrsets.attrVals</code></h4></div><div><h5 class="subtitle"><code class="literal">attrVals :: [String] -&gt; AttrSet -&gt; [Any]</code>
     </h5></div></div></div><p><a id="lib.attrsets.attrVals"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L84" target="_top">lib/attrsets.nix:84</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Return the specified attributes from a set. All values must exist.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">nameList</code>
       </span></dt><dd><p>
         The list of attributes to fetch from <code class="varname">set</code>. Each
         attribute name must exist on the attrbitue set.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The set to get attribute values from.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.attrVals-example-success"></a><p class="title"><strong>Example 7.9. Getting several values from an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.attrVals [ "a" "b" "c" ] { a = 1; b = 2; c = 3; }
=&gt; [ 1 2 3 ]
</pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrsets.attrVals-failure"></a><p class="title"><strong>Example 7.10. Getting missing values from an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.attrVals [ "d" ] { }
error: attribute 'd' missing
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.attrValues"></a>7.1.2.6. <code class="function">lib.attrsets.attrValues</code></h4></div><div><h5 class="subtitle"><code class="literal">attrValues :: AttrSet -&gt; [Any]</code>
     </h5></div></div></div><p><a id="lib.attrsets.attrValues"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L94" target="_top">lib/attrsets.nix:94</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Get all the attribute values from an attribute set.
     </p><p>
      Provides a backwards-compatible interface of
      <code class="function">builtins.attrValues</code> for Nix version older than 1.8.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrs</code>
       </span></dt><dd><p>
         The attribute set.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.attrValues-example"></a><p class="title"><strong>Example 7.11. </strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.attrValues { a = 1; b = 2; c = 3; }
=&gt; [ 1 2 3 ]
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.catAttrs"></a>7.1.2.7. <code class="function">lib.attrsets.catAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">catAttrs :: String -&gt; AttrSet -&gt; [Any]</code>
     </h5></div></div></div><p><a id="lib.attrsets.catAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L113" target="_top">lib/attrsets.nix:113</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Collect each attribute named `attr' from the list of attribute sets,
      <code class="varname">sets</code>. Sets that don't contain the named attribute are
      ignored.
     </p><p>
      Provides a backwards-compatible interface of
      <code class="function">builtins.catAttrs</code> for Nix version older than 1.9.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attr</code>
       </span></dt><dd><p>
         Attribute name to select from each attribute set in
         <code class="varname">sets</code>.
        </p></dd><dt><span class="term">
        <code class="varname">sets</code>
       </span></dt><dd><p>
         The list of attribute sets to select <code class="varname">attr</code> from.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.catAttrs-example"></a><p class="title"><strong>Example 7.12. Collect an attribute from a list of attribute sets.</strong></p><div class="example-contents"><p>
       Attribute sets which don't have the attribute are ignored.
      </p><pre class="programlisting">
catAttrs "a" [{a = 1;} {b = 0;} {a = 2;}]
=&gt; [ 1 2 ]
      </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.filterAttrs"></a>7.1.2.8. <code class="function">lib.attrsets.filterAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">filterAttrs :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.filterAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L124" target="_top">lib/attrsets.nix:124</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Filter an attribute set by removing all attributes for which the given
      predicate return false.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any -&gt; Bool</code>
        </p><p>
         Predicate which returns true to include an attribute, or returns false
         to exclude it.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The attribute's name
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value
           </p></dd></dl></div><p>
         Returns <code class="literal">true</code> to include the attribute,
         <code class="literal">false</code> to exclude the attribute.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to filter
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.filterAttrs-example"></a><p class="title"><strong>Example 7.13. Filtering an attributeset</strong></p><div class="example-contents"><pre class="programlisting">
filterAttrs (n: v: n == "foo") { foo = 1; bar = 2; }
=&gt; { foo = 1; }
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.filterAttrsRecursive"></a>7.1.2.9. <code class="function">lib.attrsets.filterAttrsRecursive</code></h4></div><div><h5 class="subtitle"><code class="literal">filterAttrsRecursive :: (String -&gt; Any -&gt; Bool) -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.filterAttrsRecursive"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L135" target="_top">lib/attrsets.nix:135</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Filter an attribute set recursively by removing all attributes for which
      the given predicate return false.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any -&gt; Bool</code>
        </p><p>
         Predicate which returns true to include an attribute, or returns false
         to exclude it.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The attribute's name
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value
           </p></dd></dl></div><p>
         Returns <code class="literal">true</code> to include the attribute,
         <code class="literal">false</code> to exclude the attribute.
        </p></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to filter
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.filterAttrsRecursive-example"></a><p class="title"><strong>Example 7.14. Recursively filtering an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.filterAttrsRecursive
  (n: v: v != null)
  {
    levelA = {
      example = "hi";
      levelB = {
        hello = "there";
        this-one-is-present = {
          this-is-excluded = null;
        };
      };
      this-one-is-also-excluded = null;
    };
    also-excluded = null;
  }
=&gt; {
     levelA = {
       example = "hi";
       levelB = {
         hello = "there";
         this-one-is-present = { };
       };
     };
   }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.foldAttrs"></a>7.1.2.10. <code class="function">lib.attrsets.foldAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">foldAttrs :: (Any -&gt; Any -&gt; Any) -&gt; Any -&gt; [AttrSets] -&gt; Any</code>
     </h5></div></div></div><p><a id="lib.attrsets.foldAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L154" target="_top">lib/attrsets.nix:154</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Apply fold function to values grouped by key.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">op</code>
       </span></dt><dd><p>
         <code class="literal">Any -&gt; Any -&gt; Any</code>
        </p><p>
         Given a value <code class="varname">val</code> and a collector
         <code class="varname">col</code>, combine the two.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">val</code>
          </span></dt><dd><p>
            An attribute's value
           </p></dd><dt><span class="term">
           <code class="varname">col</code>
          </span></dt><dd><p>
            The result of previous <code class="function">op</code> calls with other
            values and <code class="function">nul</code>.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">nul</code>
       </span></dt><dd><p>
         The null-value, the starting value.
        </p></dd><dt><span class="term">
        <code class="varname">list_of_attrs</code>
       </span></dt><dd><p>
         A list of attribute sets to fold together by key.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.foldAttrs-example"></a><p class="title"><strong>Example 7.15. Combining an attribute of lists in to one attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.foldAttrs
  (n: a: [n] ++ a) []
  [
    { a = 2; b = 7; }
    { a = 3; }
    { b = 6; }
  ]
=&gt; { a = [ 2 3 ]; b = [ 7 6 ]; }
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.collect"></a>7.1.2.11. <code class="function">lib.attrsets.collect</code></h4></div><div><h5 class="subtitle"><code class="literal">collect :: (Any -&gt; Bool) -&gt; AttrSet -&gt; [Any]</code>
     </h5></div></div></div><p><a id="lib.attrsets.collect"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L178" target="_top">lib/attrsets.nix:178</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Recursively collect sets that verify a given predicate named
      <code class="varname">pred</code> from the set <code class="varname">attrs</code>. The
      recursion stops when <code class="varname">pred</code> returns
      <code class="literal">true</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         <code class="literal">Any -&gt; Bool</code>
        </p><p>
         Given an attribute's value, determine if recursion should stop.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute set value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">attrs</code>
       </span></dt><dd><p>
         The attribute set to recursively collect.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.collect-example-lists"></a><p class="title"><strong>Example 7.16. Collecting all lists from an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.collect isList { a = { b = ["b"]; }; c = [1]; }
=&gt; [["b"] [1]]
</pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrsets.collect-example-outpath"></a><p class="title"><strong>Example 7.17. Collecting all attribute-sets which contain the <code class="literal">outPath</code> attribute name.</strong></p><div class="example-contents"><pre class="programlisting">
collect (x: x ? outPath)
  { a = { outPath = "a/"; }; b = { outPath = "b/"; }; }
=&gt; [{ outPath = "a/"; } { outPath = "b/"; }]
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.nameValuePair"></a>7.1.2.12. <code class="function">lib.attrsets.nameValuePair</code></h4></div><div><h5 class="subtitle"><code class="literal">nameValuePair :: String -&gt; Any -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.nameValuePair"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L194" target="_top">lib/attrsets.nix:194</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Utility function that creates a <code class="literal">{name, value}</code> pair as
      expected by <code class="function">builtins.listToAttrs</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">name</code>
       </span></dt><dd><p>
         The attribute name.
        </p></dd><dt><span class="term">
        <code class="varname">value</code>
       </span></dt><dd><p>
         The attribute value.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.nameValuePair-example"></a><p class="title"><strong>Example 7.18. Creating a name value pair</strong></p><div class="example-contents"><pre class="programlisting">
nameValuePair "some" 6
=&gt; { name = "some"; value = 6; }
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrs"></a>7.1.2.13. <code class="function">lib.attrsets.mapAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal"></code>
     </h5></div></div></div><p><a id="lib.attrsets.mapAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L207" target="_top">lib/attrsets.nix:207</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Apply a function to each element in an attribute set, creating a new
      attribute set.
     </p><p>
      Provides a backwards-compatible interface of
      <code class="function">builtins.mapAttrs</code> for Nix version older than 2.1.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">fn</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any -&gt; Any</code>
        </p><p>
         Given an attribute's name and value, return a new value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute.
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value.
           </p></dd></dl></div></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrs-example"></a><p class="title"><strong>Example 7.19. Modifying each value of an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.mapAttrs
  (name: value: name + "-" value)
  { x = "foo"; y = "bar"; }
=&gt; { x = "x-foo"; y = "y-bar"; }
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrs-prime"></a>7.1.2.14. <code class="function">lib.attrsets.mapAttrs'</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrs' :: (String -&gt; Any -&gt; { name = String; value = Any }) -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.mapAttrs-prime"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L221" target="_top">lib/attrsets.nix:221</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Like <code class="function">mapAttrs</code>, but allows the name of each attribute
      to be changed in addition to the value. The applied function should
      return both the new name and value as a
      <code class="function">nameValuePair</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">fn</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any -&gt; { name = String; value = Any
         }</code>
        </p><p>
         Given an attribute's name and value, return a new
         <a class="link" href="#function-library-lib.attrsets.nameValuePair" title="7.1.2.12. lib.attrsets.nameValuePair">name value
         pair</a>.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute.
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to map over.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrs-prime-example"></a><p class="title"><strong>Example 7.20. Change the name and value of each attribute of an attribute set</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.mapAttrs' (name: value: lib.attrsets.nameValuePair ("foo_" + name) ("bar-" + value))
   { x = "a"; y = "b"; }
=&gt; { foo_x = "bar-a"; foo_y = "bar-b"; }

    </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsToList"></a>7.1.2.15. <code class="function">lib.attrsets.mapAttrsToList</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsToList :: (String -&gt; Any -&gt; Any) -&gt;
   AttrSet -&gt; Any</code>
     </h5></div></div></div><p><a id="lib.attrsets.mapAttrsToList"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L233" target="_top">lib/attrsets.nix:233</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Call <code class="varname">fn</code> for each attribute in the given
      <code class="varname">set</code> and return the result in a list.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">fn</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any -&gt; Any</code>
        </p><p>
         Given an attribute's name and value, return a new value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute.
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to map over.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsToList-example"></a><p class="title"><strong>Example 7.21. Combine attribute values and names in to a list</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.mapAttrsToList (name: value: "${name}=${value}")
   { x = "a"; y = "b"; }
=&gt; [ "x=a" "y=b" ]
</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsRecursive"></a>7.1.2.16. <code class="function">lib.attrsets.mapAttrsRecursive</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsRecursive :: ([String] &gt; Any -&gt; Any) -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.mapAttrsRecursive"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L250" target="_top">lib/attrsets.nix:250</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Like <code class="function">mapAttrs</code>, except that it recursively applies
      itself to attribute sets. Also, the first argument of the argument
      function is a <span class="emphasis"><em>list</em></span> of the names of the containing
      attributes.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         <code class="literal">[ String ] -&gt; Any -&gt; Any</code>
        </p><p>
         Given a list of attribute names and value, return a new value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name_path</code>
          </span></dt><dd><p>
            The list of attribute names to this value.
           </p><p>
            For example, the <code class="varname">name_path</code> for the
            <code class="literal">example</code> string in the attribute set <code class="literal">{
            foo = { bar = "example"; }; }</code> is <code class="literal">[ "foo" "bar"
            ]</code>.
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to recursively map over.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsRecursive-example"></a><p class="title"><strong>Example 7.22. A contrived example of using <code class="function">lib.attrsets.mapAttrsRecursive</code></strong></p><div class="example-contents"><pre class="programlisting">
mapAttrsRecursive
  (path: value: concatStringsSep "-" (path ++ [value]))
  {
    n = {
      a = "A";
      m = {
        b = "B";
        c = "C";
      };
    };
    d = "D";
  }
=&gt; {
     n = {
       a = "n-a-A";
       m = {
         b = "n-m-b-B";
         c = "n-m-c-C";
       };
     };
     d = "d-D";
   }
    </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.mapAttrsRecursiveCond"></a>7.1.2.17. <code class="function">lib.attrsets.mapAttrsRecursiveCond</code></h4></div><div><h5 class="subtitle"><code class="literal">mapAttrsRecursiveCond :: (AttrSet -&gt; Bool) -&gt; ([ String ] -&gt; Any -&gt; Any) -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.mapAttrsRecursiveCond"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L271" target="_top">lib/attrsets.nix:271</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Like <code class="function">mapAttrsRecursive</code>, but it takes an additional
      predicate function that tells it whether to recursive into an attribute
      set. If it returns false, <code class="function">mapAttrsRecursiveCond</code> does
      not recurse, but does apply the map function. It is returns true, it does
      recurse, and does not apply the map function.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cond</code>
       </span></dt><dd><p>
         <code class="literal">(AttrSet -&gt; Bool)</code>
        </p><p>
         Determine if <code class="function">mapAttrsRecursive</code> should recurse
         deeper in to the attribute set.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">attributeset</code>
          </span></dt><dd><p>
            An attribute set.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         <code class="literal">[ String ] -&gt; Any -&gt; Any</code>
        </p><p>
         Given a list of attribute names and value, return a new value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name_path</code>
          </span></dt><dd><p>
            The list of attribute names to this value.
           </p><p>
            For example, the <code class="varname">name_path</code> for the
            <code class="literal">example</code> string in the attribute set <code class="literal">{
            foo = { bar = "example"; }; }</code> is <code class="literal">[ "foo" "bar"
            ]</code>.
           </p></dd><dt><span class="term">
           <code class="varname">value</code>
          </span></dt><dd><p>
            The attribute's value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">set</code>
       </span></dt><dd><p>
         The attribute set to recursively map over.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.mapAttrsRecursiveCond-example"></a><p class="title"><strong>Example 7.23. Only convert attribute values to JSON if the containing attribute set is marked for recursion</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.mapAttrsRecursiveCond
  ({ recurse ? false, ... }: recurse)
  (name: value: builtins.toJSON value)
  {
    dorecur = {
      recurse = true;
      hello = "there";
    };
    dontrecur = {
      converted-to- = "json";
    };
  }
=&gt; {
     dorecur = {
       hello = "\"there\"";
       recurse = "true";
     };
     dontrecur = "{\"converted-to\":\"json\"}";
   }
    </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.genAttrs"></a>7.1.2.18. <code class="function">lib.attrsets.genAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">genAttrs :: [ String ] -&gt; (String -&gt; Any) -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.genAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L291" target="_top">lib/attrsets.nix:291</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Generate an attribute set by mapping a function over a list of attribute
      names.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">names</code>
       </span></dt><dd><p>
         Names of values in the resulting attribute set.
        </p></dd><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         <code class="literal">String -&gt; Any</code>
        </p><p>
         Takes the name of the attribute and return the attribute's value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute to generate a value for.
           </p></dd></dl></div></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.genAttrs-example"></a><p class="title"><strong>Example 7.24. Generate an attrset based on names only</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.genAttrs [ "foo" "bar" ] (name: "x_${name}")
=&gt; { foo = "x_foo"; bar = "x_bar"; }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.isDerivation"></a>7.1.2.19. <code class="function">lib.attrsets.isDerivation</code></h4></div><div><h5 class="subtitle"><code class="literal">isDerivation :: Any -&gt; Bool</code>
     </h5></div></div></div><p><a id="lib.attrsets.isDerivation"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L305" target="_top">lib/attrsets.nix:305</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Check whether the argument is a derivation. Any set with <code class="code">{ type =
      "derivation"; }</code> counts as a derivation.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">value</code>
       </span></dt><dd><p>
         The value which is possibly a derivation.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.isDerivation-example-true"></a><p class="title"><strong>Example 7.25. A package is a derivation</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.isDerivation (import &lt;nixpkgs&gt; {}).ruby
=&gt; true
     </pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrsets.isDerivation-example-false"></a><p class="title"><strong>Example 7.26. Anything else is not a derivation</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.isDerivation "foobar"
=&gt; false
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.toDerivation"></a>7.1.2.20. <code class="function">lib.attrsets.toDerivation</code></h4></div><div><h5 class="subtitle"><code class="literal">toDerivation :: Path -&gt; Derivation</code>
     </h5></div></div></div><p><a id="lib.attrsets.toDerivation"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L308" target="_top">lib/attrsets.nix:308</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Converts a store path to a fake derivation.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">path</code>
       </span></dt><dd><p>
         A store path to convert to a derivation.
        </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.optionalAttrs"></a>7.1.2.21. <code class="function">lib.attrsets.optionalAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">optionalAttrs :: Bool -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.optionalAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L331" target="_top">lib/attrsets.nix:331</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Conditionally return an attribute set or an empty attribute set.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cond</code>
       </span></dt><dd><p>
         Condition under which the <code class="varname">as</code> attribute set is
         returned.
        </p></dd><dt><span class="term">
        <code class="varname">as</code>
       </span></dt><dd><p>
         The attribute set to return if <code class="varname">cond</code> is true.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.optionalAttrs-example-true"></a><p class="title"><strong>Example 7.27. Return the provided attribute set when <code class="varname">cond</code> is true</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.optionalAttrs true { my = "set"; }
=&gt; { my = "set"; }
     </pre></div></div><br class="example-break" /><div class="example"><a id="function-library-lib.attrsets.optionalAttrs-example-false"></a><p class="title"><strong>Example 7.28. Return an empty attribute set when <code class="varname">cond</code> is false</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.optionalAttrs false { my = "set"; }
=&gt; { }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrsWithNames"></a>7.1.2.22. <code class="function">lib.attrsets.zipAttrsWithNames</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWithNames :: [ String ] -&gt; (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.zipAttrsWithNames"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L341" target="_top">lib/attrsets.nix:341</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Merge sets of attributes and use the function <code class="varname">f</code> to
      merge attribute values where the attribute name is in
      <code class="varname">names</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">names</code>
       </span></dt><dd><p>
         A list of attribute names to zip.
        </p></dd><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         <code class="literal">(String -&gt; [ Any ] -&gt; Any</code>
        </p><p>
         Accepts an attribute name, all the values, and returns a combined
         value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute each value came from.
           </p></dd><dt><span class="term">
           <code class="varname">vs</code>
          </span></dt><dd><p>
            A list of values collected from the list of attribute sets.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">sets</code>
       </span></dt><dd><p>
         A list of attribute sets to zip together.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrsWithNames-example"></a><p class="title"><strong>Example 7.29. Summing a list of attribute sets of numbers</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.zipAttrsWithNames
  [ "a" "b" ]
  (name: vals: "${name} ${toString (builtins.foldl' (a: b: a + b) 0 vals)}")
  [
    { a = 1; b = 1; c = 1; }
    { a = 10; }
    { b = 100; }
    { c = 1000; }
  ]
=&gt; { a = "a 11"; b = "b 101"; }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrsWith"></a>7.1.2.23. <code class="function">lib.attrsets.zipAttrsWith</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWith :: (String -&gt; [ Any ] -&gt; Any) -&gt; [ AttrSet ] -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.zipAttrsWith"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L356" target="_top">lib/attrsets.nix:356</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Merge sets of attributes and use the function <code class="varname">f</code> to
      merge attribute values. Similar to
      <a class="xref" href="#function-library-lib.attrsets.zipAttrsWithNames" title="7.1.2.22. lib.attrsets.zipAttrsWithNames">Section 7.1.2.22, “<code class="function">lib.attrsets.zipAttrsWithNames</code>”</a> where
      all key names are passed for <code class="varname">names</code>.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         <code class="literal">(String -&gt; [ Any ] -&gt; Any</code>
        </p><p>
         Accepts an attribute name, all the values, and returns a combined
         value.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">name</code>
          </span></dt><dd><p>
            The name of the attribute each value came from.
           </p></dd><dt><span class="term">
           <code class="varname">vs</code>
          </span></dt><dd><p>
            A list of values collected from the list of attribute sets.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">sets</code>
       </span></dt><dd><p>
         A list of attribute sets to zip together.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrsWith-example"></a><p class="title"><strong>Example 7.30. Summing a list of attribute sets of numbers</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.zipAttrsWith
  (name: vals: "${name} ${toString (builtins.foldl' (a: b: a + b) 0 vals)}")
  [
    { a = 1; b = 1; c = 1; }
    { a = 10; }
    { b = 100; }
    { c = 1000; }
  ]
=&gt; { a = "a 11"; b = "b 101"; c = "c 1001"; }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.zipAttrs"></a>7.1.2.24. <code class="function">lib.attrsets.zipAttrs</code></h4></div><div><h5 class="subtitle"><code class="literal">zipAttrsWith :: [ AttrSet ] -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.zipAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L363" target="_top">lib/attrsets.nix:363</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Merge sets of attributes and combine each attribute value in to a list.
      Similar to <a class="xref" href="#function-library-lib.attrsets.zipAttrsWith" title="7.1.2.23. lib.attrsets.zipAttrsWith">Section 7.1.2.23, “<code class="function">lib.attrsets.zipAttrsWith</code>”</a>
      where the merge function returns a list of all values.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">sets</code>
       </span></dt><dd><p>
         A list of attribute sets to zip together.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.zipAttrs-example"></a><p class="title"><strong>Example 7.31. Combining a list of attribute sets</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.zipAttrs
  [
    { a = 1; b = 1; c = 1; }
    { a = 10; }
    { b = 100; }
    { c = 1000; }
  ]
=&gt; { a = [ 1 10 ]; b = [ 1 100 ]; c = [ 1 1000 ]; }
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.recursiveUpdateUntil"></a>7.1.2.25. <code class="function">lib.attrsets.recursiveUpdateUntil</code></h4></div><div><h5 class="subtitle"><code class="literal">recursiveUpdateUntil :: ( [ String ] -&gt; AttrSet -&gt; AttrSet -&gt; Bool ) -&gt; AttrSet -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.recursiveUpdateUntil"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L393" target="_top">lib/attrsets.nix:393</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      Does the same as the update operator <code class="literal">//</code> except that
      attributes are merged until the given predicate is verified. The
      predicate should accept 3 arguments which are the path to reach the
      attribute, a part of the first attribute set and a part of the second
      attribute set. When the predicate is verified, the value of the first
      attribute set is replaced by the value of the second attribute set.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         <code class="literal">[ String ] -&gt; AttrSet -&gt; AttrSet -&gt; Bool</code>
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">path</code>
          </span></dt><dd><p>
            The path to the values in the left and right hand sides.
           </p></dd><dt><span class="term">
           <code class="varname">l</code>
          </span></dt><dd><p>
            The left hand side value.
           </p></dd><dt><span class="term">
           <code class="varname">r</code>
          </span></dt><dd><p>
            The right hand side value.
           </p></dd></dl></div></dd><dt><span class="term">
        <code class="varname">lhs</code>
       </span></dt><dd><p>
         The left hand attribute set of the merge.
        </p></dd><dt><span class="term">
        <code class="varname">rhs</code>
       </span></dt><dd><p>
         The right hand attribute set of the merge.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.recursiveUpdateUntil-example"></a><p class="title"><strong>Example 7.32. Recursively merging two attribute sets</strong></p><div class="example-contents"><pre class="programlisting">
lib.attrsets.recursiveUpdateUntil (path: l: r: path == ["foo"])
  {
    # first attribute set
    foo.bar = 1;
    foo.baz = 2;
    bar = 3;
  }
  {
    #second attribute set
    foo.bar = 1;
    foo.quz = 2;
    baz = 4;
  }
=&gt; {
  foo.bar = 1; # 'foo.*' from the second set
  foo.quz = 2; #
  bar = 3;     # 'bar' from the first set
  baz = 4;     # 'baz' from the second set
}
     </pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.attrsets.recursiveUpdate"></a>7.1.2.26. <code class="function">lib.attrsets.recursiveUpdate</code></h4></div><div><h5 class="subtitle"><code class="literal">recursiveUpdate :: AttrSet -&gt; AttrSet -&gt; AttrSet</code>
     </h5></div></div></div><p><a id="lib.attrsets.recursiveUpdate"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/attrsets.nix#L424" target="_top">lib/attrsets.nix:424</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p><p>
      A recursive variant of the update operator <code class="literal">//</code>. The
      recursion stops when one of the attribute values is not an attribute set,
      in which case the right hand side value takes precedence over the left
      hand side value.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">lhs</code>
       </span></dt><dd><p>
         The left hand attribute set of the merge.
        </p></dd><dt><span class="term">
        <code class="varname">rhs</code>
       </span></dt><dd><p>
         The right hand attribute set of the merge.
        </p></dd></dl></div><div class="example"><a id="function-library-lib.attrsets.recursiveUpdate-example"></a><p class="title"><strong>Example 7.33. Recursively merging two attribute sets</strong></p><div class="example-contents"><pre class="programlisting">
recursiveUpdate
  {
    boot.loader.grub.enable = true;
    boot.loader.grub.device = "/dev/hda";
  }
  {
    boot.loader.grub.device = "";
  }
=&gt; {
  boot.loader.grub.enable = true;
  boot.loader.grub.device = "";
}
</pre></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-strings"></a>7.1.3. String manipulation functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatStrings"></a>7.1.3.1. <code class="function">lib.strings.concatStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatStrings :: [string] -&gt; string</code>
     </h5></div></div></div><p>
      Concatenate a list of strings.
     </p><div class="example"><a id="idm139978171580928"></a><p class="title"><strong>Example 7.34. <code class="function">lib.strings.concatStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatStrings ["foo" "bar"]
=&gt; "foobar"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatStrings"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L21" target="_top">lib/strings.nix:21</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatMapStrings"></a>7.1.3.2. <code class="function">lib.strings.concatMapStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMapStrings :: (a -&gt; string) -&gt; [a] -&gt; string</code>
     </h5></div></div></div><p>
      Map a function over a list and concatenate the resulting strings.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171569648"></a><p class="title"><strong>Example 7.35. <code class="function">lib.strings.concatMapStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatMapStrings (x: "a" + x) ["foo" "bar"]
=&gt; "afooabar"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatMapStrings"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L31" target="_top">lib/strings.nix:31</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatImapStrings"></a>7.1.3.3. <code class="function">lib.strings.concatImapStrings</code></h4></div><div><h5 class="subtitle"><code class="literal">concatImapStrings :: (int -&gt; a -&gt; string) -&gt; [a] -&gt; string</code>
     </h5></div></div></div><p>
      Like `concatMapStrings` except that the f functions also gets the
      position as a parameter.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171558144"></a><p class="title"><strong>Example 7.36. <code class="function">lib.strings.concatImapStrings</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatImapStrings (pos: x: "${toString pos}-${x}") ["foo" "bar"]
=&gt; "1-foo2-bar"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatImapStrings"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L42" target="_top">lib/strings.nix:42</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.intersperse"></a>7.1.3.4. <code class="function">lib.strings.intersperse</code></h4></div><div><h5 class="subtitle"><code class="literal">intersperse :: a -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Place an element between each element of a list
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">separator</code>
       </span></dt><dd><p>
         Separator to add between elements
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Input list
        </p></dd></dl></div><div class="example"><a id="idm139978171546784"></a><p class="title"><strong>Example 7.37. <code class="function">lib.strings.intersperse</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
intersperse "/" ["usr" "local" "bin"]
=&gt; ["usr" "/" "local" "/" "bin"].
</pre></div></div><br class="example-break" /><p><a id="lib.strings.intersperse"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L52" target="_top">lib/strings.nix:52</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatStringsSep"></a>7.1.3.5. <code class="function">lib.strings.concatStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatStringsSep :: string -&gt; [string] -&gt; string</code>
     </h5></div></div></div><p>
      Concatenate a list of strings with a separator between each element
     </p><div class="example"><a id="idm139978171539968"></a><p class="title"><strong>Example 7.38. <code class="function">lib.strings.concatStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatStringsSep "/" ["usr" "local" "bin"]
=&gt; "usr/local/bin"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatStringsSep"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L69" target="_top">lib/strings.nix:69</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatMapStringsSep"></a>7.1.3.6. <code class="function">lib.strings.concatMapStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMapStringsSep :: string -&gt; (string -&gt; string) -&gt; [string] -&gt; string</code>
     </h5></div></div></div><p>
      Maps a function over a list of strings and then concatenates the result
      with the specified separator interspersed between elements.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">sep</code>
       </span></dt><dd><p>
         Separator to add between elements
        </p></dd><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to map over the list
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         List of input strings
        </p></dd></dl></div><div class="example"><a id="idm139978171526528"></a><p class="title"><strong>Example 7.39. <code class="function">lib.strings.concatMapStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatMapStringsSep "-" (x: toUpper x)  ["foo" "bar" "baz"]
=&gt; "FOO-BAR-BAZ"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatMapStringsSep"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L82" target="_top">lib/strings.nix:82</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.concatImapStringsSep"></a>7.1.3.7. <code class="function">lib.strings.concatImapStringsSep</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMapStringsSep :: string -&gt; (int -&gt; string -&gt; string) -&gt; [string] -&gt; string</code>
     </h5></div></div></div><p>
      Same as `concatMapStringsSep`, but the mapping function additionally
      receives the position of its argument.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">sep</code>
       </span></dt><dd><p>
         Separator to add between elements
        </p></dd><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function that receives elements and their positions
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         List of input strings
        </p></dd></dl></div><div class="example"><a id="idm139978171512960"></a><p class="title"><strong>Example 7.40. <code class="function">lib.strings.concatImapStringsSep</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatImapStringsSep "-" (pos: x: toString (x / pos)) [ 6 6 6 ]
=&gt; "6-3-2"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.concatImapStringsSep"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L99" target="_top">lib/strings.nix:99</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeSearchPath"></a>7.1.3.8. <code class="function">lib.strings.makeSearchPath</code></h4></div><div><h5 class="subtitle"><code class="literal">makeSearchPath :: string -&gt; [string] -&gt; string</code>
     </h5></div></div></div><p>
      Construct a Unix-style, colon-separated search path consisting of the
      given `subDir` appended to each of the given paths.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">subDir</code>
       </span></dt><dd><p>
         Directory name to append
        </p></dd><dt><span class="term">
        <code class="varname">paths</code>
       </span></dt><dd><p>
         List of base paths
        </p></dd></dl></div><div class="example"><a id="idm139978171501440"></a><p class="title"><strong>Example 7.41. <code class="function">lib.strings.makeSearchPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
makeSearchPath "bin" ["/root" "/usr" "/usr/local"]
=&gt; "/root/bin:/usr/bin:/usr/local/bin"
makeSearchPath "bin" [""]
=&gt; "/bin"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.makeSearchPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L118" target="_top">lib/strings.nix:118</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeSearchPathOutput"></a>7.1.3.9. <code class="function">lib.strings.makeSearchPathOutput</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; [package] -&gt; string</code>
     </h5></div></div></div><p>
      Construct a Unix-style search path by appending the given `subDir` to the
      specified `output` of each of the packages. If no output by the given
      name is found, fallback to `.out` and then to the default.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">output</code>
       </span></dt><dd><p>
         Package output to use
        </p></dd><dt><span class="term">
        <code class="varname">subDir</code>
       </span></dt><dd><p>
         Directory name to append
        </p></dd><dt><span class="term">
        <code class="varname">pkgs</code>
       </span></dt><dd><p>
         List of packages
        </p></dd></dl></div><div class="example"><a id="idm139978171487840"></a><p class="title"><strong>Example 7.42. <code class="function">lib.strings.makeSearchPathOutput</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
makeSearchPathOutput "dev" "bin" [ pkgs.openssl pkgs.zlib ]
=&gt; "/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r-dev/bin:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/bin"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.makeSearchPathOutput"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L136" target="_top">lib/strings.nix:136</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeLibraryPath"></a>7.1.3.10. <code class="function">lib.strings.makeLibraryPath</code></h4></div></div></div><p>
      Construct a library search path (such as RPATH) containing the libraries
      for a set of packages
     </p><div class="example"><a id="idm139978171481680"></a><p class="title"><strong>Example 7.43. <code class="function">lib.strings.makeLibraryPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
makeLibraryPath [ "/usr" "/usr/local" ]
=&gt; "/usr/lib:/usr/local/lib"
pkgs = import &lt;nixpkgs&gt; { }
makeLibraryPath [ pkgs.openssl pkgs.zlib ]
=&gt; "/nix/store/9rz8gxhzf8sw4kf2j2f1grr49w8zx5vj-openssl-1.0.1r/lib:/nix/store/wwh7mhwh269sfjkm6k5665b5kgp7jrk2-zlib-1.2.8/lib"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.makeLibraryPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L154" target="_top">lib/strings.nix:154</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.makeBinPath"></a>7.1.3.11. <code class="function">lib.strings.makeBinPath</code></h4></div></div></div><p>
      Construct a binary search path (such as $PATH) containing the binaries
      for a set of packages.
     </p><div class="example"><a id="idm139978171475680"></a><p class="title"><strong>Example 7.44. <code class="function">lib.strings.makeBinPath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
makeBinPath ["/root" "/usr" "/usr/local"]
=&gt; "/root/bin:/usr/bin:/usr/local/bin"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.makeBinPath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L163" target="_top">lib/strings.nix:163</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.optionalString"></a>7.1.3.12. <code class="function">lib.strings.optionalString</code></h4></div><div><h5 class="subtitle"><code class="literal">optionalString :: bool -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Depending on the boolean `cond', return either the given string or the
      empty string. Useful to concatenate against a bigger string.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cond</code>
       </span></dt><dd><p>
         Condition
        </p></dd><dt><span class="term">
        <code class="varname">string</code>
       </span></dt><dd><p>
         String to return if condition is true
        </p></dd></dl></div><div class="example"><a id="idm139978171464176"></a><p class="title"><strong>Example 7.45. <code class="function">lib.strings.optionalString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
optionalString true "some-string"
=&gt; "some-string"
optionalString false "some-string"
=&gt; ""
</pre></div></div><br class="example-break" /><p><a id="lib.strings.optionalString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L176" target="_top">lib/strings.nix:176</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasPrefix"></a>7.1.3.13. <code class="function">lib.strings.hasPrefix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasPrefix :: string -&gt; string -&gt; bool</code>
     </h5></div></div></div><p>
      Determine whether a string has given prefix.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pref</code>
       </span></dt><dd><p>
         Prefix to check for
        </p></dd><dt><span class="term">
        <code class="varname">str</code>
       </span></dt><dd><p>
         Input string
        </p></dd></dl></div><div class="example"><a id="idm139978171452912"></a><p class="title"><strong>Example 7.46. <code class="function">lib.strings.hasPrefix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
hasPrefix "foo" "foobar"
=&gt; true
hasPrefix "foo" "barfoo"
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.strings.hasPrefix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L192" target="_top">lib/strings.nix:192</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasSuffix"></a>7.1.3.14. <code class="function">lib.strings.hasSuffix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasSuffix :: string -&gt; string -&gt; bool</code>
     </h5></div></div></div><p>
      Determine whether a string has given suffix.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">suffix</code>
       </span></dt><dd><p>
         Suffix to check for
        </p></dd><dt><span class="term">
        <code class="varname">content</code>
       </span></dt><dd><p>
         Input string
        </p></dd></dl></div><div class="example"><a id="idm139978171441696"></a><p class="title"><strong>Example 7.47. <code class="function">lib.strings.hasSuffix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
hasSuffix "foo" "foobar"
=&gt; false
hasSuffix "foo" "barfoo"
=&gt; true
</pre></div></div><br class="example-break" /><p><a id="lib.strings.hasSuffix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L208" target="_top">lib/strings.nix:208</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.hasInfix"></a>7.1.3.15. <code class="function">lib.strings.hasInfix</code></h4></div><div><h5 class="subtitle"><code class="literal">hasInfix :: string -&gt; string -&gt; bool</code>
     </h5></div></div></div><p>
      Determine whether a string contains the given infix
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">infix</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">content</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171430368"></a><p class="title"><strong>Example 7.48. <code class="function">lib.strings.hasInfix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
hasInfix "bc" "abcd"
=&gt; true
hasInfix "ab" "abcd"
=&gt; true
hasInfix "cd" "abcd"
=&gt; true
hasInfix "foo" "abcd"
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.strings.hasInfix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L233" target="_top">lib/strings.nix:233</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.stringToCharacters"></a>7.1.3.16. <code class="function">lib.strings.stringToCharacters</code></h4></div><div><h5 class="subtitle"><code class="literal">stringtoCharacters :: string -&gt; [string]</code>
     </h5></div></div></div><p>
      Convert a string to a list of characters (i.e. singleton strings). This
      allows you to, e.g., map a function over each character. However, note
      that this will likely be horribly inefficient; Nix is not a general
      purpose programming language. Complex string manipulations should, if
      appropriate, be done in a derivation. Also note that Nix treats strings
      as a list of bytes and thus doesn't handle unicode.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">s</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171420640"></a><p class="title"><strong>Example 7.49. <code class="function">lib.strings.stringToCharacters</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
stringToCharacters ""
=&gt; [ ]
stringToCharacters "abc"
=&gt; [ "a" "b" "c" ]
stringToCharacters "💩"
=&gt; [ "�" "�" "�" "�" ]
</pre></div></div><br class="example-break" /><p><a id="lib.strings.stringToCharacters"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L257" target="_top">lib/strings.nix:257</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.stringAsChars"></a>7.1.3.17. <code class="function">lib.strings.stringAsChars</code></h4></div><div><h5 class="subtitle"><code class="literal">stringAsChars :: (string -&gt; string) -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Manipulate a string character by character and replace them by strings
      before concatenating the results.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to map over each individual character
        </p></dd><dt><span class="term">
        <code class="varname">s</code>
       </span></dt><dd><p>
         Input string
        </p></dd></dl></div><div class="example"><a id="idm139978171409184"></a><p class="title"><strong>Example 7.50. <code class="function">lib.strings.stringAsChars</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
stringAsChars (x: if x == "a" then "i" else x) "nax"
=&gt; "nix"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.stringAsChars"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L269" target="_top">lib/strings.nix:269</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escape"></a>7.1.3.18. <code class="function">lib.strings.escape</code></h4></div><div><h5 class="subtitle"><code class="literal">escape :: [string] -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Escape occurrence of the elements of `list` in `string` by prefixing it
      with a backslash.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171399872"></a><p class="title"><strong>Example 7.51. <code class="function">lib.strings.escape</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
escape ["(" ")"] "(foo)"
=&gt; "\\(foo\\)"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.escape"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L286" target="_top">lib/strings.nix:286</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeShellArg"></a>7.1.3.19. <code class="function">lib.strings.escapeShellArg</code></h4></div><div><h5 class="subtitle"><code class="literal">escapeShellArg :: string -&gt; string</code>
     </h5></div></div></div><p>
      Quote string to be used safely within the Bourne shell.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">arg</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171390608"></a><p class="title"><strong>Example 7.52. <code class="function">lib.strings.escapeShellArg</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
escapeShellArg "esc'ape\nme"
=&gt; "'esc'\\''ape\nme'"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.escapeShellArg"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L296" target="_top">lib/strings.nix:296</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeShellArgs"></a>7.1.3.20. <code class="function">lib.strings.escapeShellArgs</code></h4></div><div><h5 class="subtitle"><code class="literal">escapeShellArgs :: [string] -&gt; string</code>
     </h5></div></div></div><p>
      Quote all arguments to be safely passed to the Bourne shell.
     </p><div class="example"><a id="idm139978171383728"></a><p class="title"><strong>Example 7.53. <code class="function">lib.strings.escapeShellArgs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
escapeShellArgs ["one" "two three" "four'five"]
=&gt; "'one' 'two three' 'four'\\''five'"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.escapeShellArgs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L306" target="_top">lib/strings.nix:306</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.escapeNixString"></a>7.1.3.21. <code class="function">lib.strings.escapeNixString</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string</code>
     </h5></div></div></div><p>
      Turn a string into a Nix expression representing that string
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">s</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171374384"></a><p class="title"><strong>Example 7.54. <code class="function">lib.strings.escapeNixString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
escapeNixString "hello\${}\n"
=&gt; "\"hello\\\${}\\n\""
</pre></div></div><br class="example-break" /><p><a id="lib.strings.escapeNixString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L316" target="_top">lib/strings.nix:316</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toLower"></a>7.1.3.22. <code class="function">lib.strings.toLower</code></h4></div><div><h5 class="subtitle"><code class="literal">toLower :: string -&gt; string</code>
     </h5></div></div></div><p>
      Converts an ASCII string to lower-case.
     </p><div class="example"><a id="idm139978171367488"></a><p class="title"><strong>Example 7.55. <code class="function">lib.strings.toLower</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
toLower "HOME"
=&gt; "home"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.toLower"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L344" target="_top">lib/strings.nix:344</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toUpper"></a>7.1.3.23. <code class="function">lib.strings.toUpper</code></h4></div><div><h5 class="subtitle"><code class="literal">toUpper :: string -&gt; string</code>
     </h5></div></div></div><p>
      Converts an ASCII string to upper-case.
     </p><div class="example"><a id="idm139978171360816"></a><p class="title"><strong>Example 7.56. <code class="function">lib.strings.toUpper</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
toUpper "home"
=&gt; "HOME"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.toUpper"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L354" target="_top">lib/strings.nix:354</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.addContextFrom"></a>7.1.3.24. <code class="function">lib.strings.addContextFrom</code></h4></div></div></div><p>
      Appends string context from another string. This is an implementation
      detail of Nix.
     </p><p>
      Strings in Nix carry an invisible `context` which is a list of strings
      representing store paths. If the string is later used in a derivation
      attribute, the derivation will properly populate the inputDrvs and
      inputSrcs.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171349584"></a><p class="title"><strong>Example 7.57. <code class="function">lib.strings.addContextFrom</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
pkgs = import &lt;nixpkgs&gt; { };
addContextFrom pkgs.coreutils "bar"
=&gt; "bar"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.addContextFrom"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L369" target="_top">lib/strings.nix:369</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.splitString"></a>7.1.3.25. <code class="function">lib.strings.splitString</code></h4></div></div></div><p>
      Cut a string with a separator and produces a list of strings which were
      separated by this separator.
     </p><p>
      NOTE: this function is not performant and should never be used.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">_sep</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">_s</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171338368"></a><p class="title"><strong>Example 7.58. <code class="function">lib.strings.splitString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
splitString "." "foo.bar.baz"
=&gt; [ "foo" "bar" "baz" ]
splitString "/" "/usr/local/bin"
=&gt; [ "" "usr" "local" "bin" ]
</pre></div></div><br class="example-break" /><p><a id="lib.strings.splitString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L382" target="_top">lib/strings.nix:382</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.removePrefix"></a>7.1.3.26. <code class="function">lib.strings.removePrefix</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Return a string without the specified prefix, if the prefix matches.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">prefix</code>
       </span></dt><dd><p>
         Prefix to remove if it matches
        </p></dd><dt><span class="term">
        <code class="varname">str</code>
       </span></dt><dd><p>
         Input string
        </p></dd></dl></div><div class="example"><a id="idm139978171327056"></a><p class="title"><strong>Example 7.59. <code class="function">lib.strings.removePrefix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
removePrefix "foo." "foo.bar.baz"
=&gt; "bar.baz"
removePrefix "xxx" "foo.bar.baz"
=&gt; "foo.bar.baz"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.removePrefix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L415" target="_top">lib/strings.nix:415</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.removeSuffix"></a>7.1.3.27. <code class="function">lib.strings.removeSuffix</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Return a string without the specified suffix, if the suffix matches.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">suffix</code>
       </span></dt><dd><p>
         Suffix to remove if it matches
        </p></dd><dt><span class="term">
        <code class="varname">str</code>
       </span></dt><dd><p>
         Input string
        </p></dd></dl></div><div class="example"><a id="idm139978171315664"></a><p class="title"><strong>Example 7.60. <code class="function">lib.strings.removeSuffix</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
removeSuffix "front" "homefront"
=&gt; "home"
removeSuffix "xxx" "homefront"
=&gt; "homefront"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.removeSuffix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L439" target="_top">lib/strings.nix:439</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.versionOlder"></a>7.1.3.28. <code class="function">lib.strings.versionOlder</code></h4></div></div></div><p>
      Return true if string v1 denotes a version older than v2.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">v1</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">v2</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171305104"></a><p class="title"><strong>Example 7.61. <code class="function">lib.strings.versionOlder</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
versionOlder "1.1" "1.2"
=&gt; true
versionOlder "1.1" "1.1"
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.strings.versionOlder"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L461" target="_top">lib/strings.nix:461</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.versionAtLeast"></a>7.1.3.29. <code class="function">lib.strings.versionAtLeast</code></h4></div></div></div><p>
      Return true if string v1 denotes a version equal to or newer than v2.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">v1</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">v2</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171294544"></a><p class="title"><strong>Example 7.62. <code class="function">lib.strings.versionAtLeast</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
versionAtLeast "1.1" "1.0"
=&gt; true
versionAtLeast "1.1" "1.1"
=&gt; true
versionAtLeast "1.1" "1.2"
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.strings.versionAtLeast"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L473" target="_top">lib/strings.nix:473</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.getVersion"></a>7.1.3.30. <code class="function">lib.strings.getVersion</code></h4></div></div></div><p>
      This function takes an argument that's either a derivation or a
      derivation's "name" attribute and extracts the version part from that
      argument.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171285968"></a><p class="title"><strong>Example 7.63. <code class="function">lib.strings.getVersion</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
getVersion "youtube-dl-2016.01.01"
=&gt; "2016.01.01"
getVersion pkgs.youtube-dl
=&gt; "2016.01.01"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.getVersion"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L485" target="_top">lib/strings.nix:485</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.nameFromURL"></a>7.1.3.31. <code class="function">lib.strings.nameFromURL</code></h4></div></div></div><p>
      Extract name with version from URL. Ask for separator which is supposed
      to start extension.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">url</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">sep</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171275472"></a><p class="title"><strong>Example 7.64. <code class="function">lib.strings.nameFromURL</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
nameFromURL "https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2" "-"
=&gt; "nix"
nameFromURL "https://nixos.org/releases/nix/nix-1.7/nix-1.7-x86_64-linux.tar.bz2" "_"
=&gt; "nix-1.7-x86"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.nameFromURL"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L501" target="_top">lib/strings.nix:501</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.enableFeature"></a>7.1.3.32. <code class="function">lib.strings.enableFeature</code></h4></div></div></div><p>
      Create an --{enable,disable}-&lt;feat&gt; string that can be passed to
      standard GNU Autoconf scripts.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">enable</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">feat</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171264848"></a><p class="title"><strong>Example 7.65. <code class="function">lib.strings.enableFeature</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
enableFeature true "shared"
=&gt; "--enable-shared"
enableFeature false "shared"
=&gt; "--disable-shared"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.enableFeature"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L517" target="_top">lib/strings.nix:517</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.enableFeatureAs"></a>7.1.3.33. <code class="function">lib.strings.enableFeatureAs</code></h4></div></div></div><p>
      Create an --{enable-&lt;feat&gt;=&lt;value&gt;,disable-&lt;feat&gt;}
      string that can be passed to standard GNU Autoconf scripts.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">enable</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">feat</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">value</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171251920"></a><p class="title"><strong>Example 7.66. <code class="function">lib.strings.enableFeatureAs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
enableFeature true "shared" "foo"
=&gt; "--enable-shared=foo"
enableFeature false "shared" (throw "ignored")
=&gt; "--disable-shared"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.enableFeatureAs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L528" target="_top">lib/strings.nix:528</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.withFeature"></a>7.1.3.34. <code class="function">lib.strings.withFeature</code></h4></div></div></div><p>
      Create an --{with,without}-&lt;feat&gt; string that can be passed to
      standard GNU Autoconf scripts.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">with_</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">feat</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171241040"></a><p class="title"><strong>Example 7.67. <code class="function">lib.strings.withFeature</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
withFeature true "shared"
=&gt; "--with-shared"
withFeature false "shared"
=&gt; "--without-shared"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.withFeature"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L539" target="_top">lib/strings.nix:539</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.withFeatureAs"></a>7.1.3.35. <code class="function">lib.strings.withFeatureAs</code></h4></div></div></div><p>
      Create an --{with-&lt;feat&gt;=&lt;value&gt;,without-&lt;feat&gt;} string
      that can be passed to standard GNU Autoconf scripts.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">with_</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">feat</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">value</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171228208"></a><p class="title"><strong>Example 7.68. <code class="function">lib.strings.withFeatureAs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
with_Feature true "shared" "foo"
=&gt; "--with-shared=foo"
with_Feature false "shared" (throw "ignored")
=&gt; "--without-shared"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.withFeatureAs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L550" target="_top">lib/strings.nix:550</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fixedWidthString"></a>7.1.3.36. <code class="function">lib.strings.fixedWidthString</code></h4></div><div><h5 class="subtitle"><code class="literal">fixedWidthString :: int -&gt; string -&gt; string</code>
     </h5></div></div></div><p>
      Create a fixed width string with additional prefix to match required
      width.
     </p><p>
      This function will fail if the input string is longer than the requested
      length.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">width</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">filler</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">str</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171214112"></a><p class="title"><strong>Example 7.69. <code class="function">lib.strings.fixedWidthString</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
fixedWidthString 5 "0" (toString 15)
=&gt; "00015"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.fixedWidthString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L564" target="_top">lib/strings.nix:564</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fixedWidthNumber"></a>7.1.3.37. <code class="function">lib.strings.fixedWidthNumber</code></h4></div></div></div><p>
      Format a number adding leading zeroes up to fixed width.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">width</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">n</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171203616"></a><p class="title"><strong>Example 7.70. <code class="function">lib.strings.fixedWidthNumber</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
fixedWidthNumber 5 15
=&gt; "00015"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.fixedWidthNumber"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L581" target="_top">lib/strings.nix:581</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.isCoercibleToString"></a>7.1.3.38. <code class="function">lib.strings.isCoercibleToString</code></h4></div></div></div><p>
      Check whether a value can be coerced to a string
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.strings.isCoercibleToString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L584" target="_top">lib/strings.nix:584</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.isStorePath"></a>7.1.3.39. <code class="function">lib.strings.isStorePath</code></h4></div></div></div><p>
      Check whether a value is a store path.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171188368"></a><p class="title"><strong>Example 7.71. <code class="function">lib.strings.isStorePath</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
isStorePath "/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11/bin/python"
=&gt; false
isStorePath "/nix/store/d945ibfx9x185xf04b890y4f9g3cbb63-python-2.7.11/"
=&gt; true
isStorePath pkgs.python
=&gt; true
isStorePath [] || isStorePath 42 || isStorePath {} || …
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.strings.isStorePath"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L602" target="_top">lib/strings.nix:602</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.toInt"></a>7.1.3.40. <code class="function">lib.strings.toInt</code></h4></div><div><h5 class="subtitle"><code class="literal">string -&gt; int</code>
     </h5></div></div></div><p>
      Parse a string string as an int.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">str</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171178976"></a><p class="title"><strong>Example 7.72. <code class="function">lib.strings.toInt</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
toInt "1337"
=&gt; 1337
toInt "-4"
=&gt; -4
toInt "3.14"
=&gt; error: floating point JSON numbers are not supported
</pre></div></div><br class="example-break" /><p><a id="lib.strings.toInt"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L623" target="_top">lib/strings.nix:623</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.readPathsFromFile"></a>7.1.3.41. <code class="function">lib.strings.readPathsFromFile</code></h4></div></div></div><p>
      Read a list of paths from `file`, relative to the `rootPath`. Lines
      beginning with `#` are treated as comments and ignored. Whitespace is
      significant.
     </p><p>
      NOTE: This function is not performant and should be avoided.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">rootPath</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">file</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171167664"></a><p class="title"><strong>Example 7.73. <code class="function">lib.strings.readPathsFromFile</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
readPathsFromFile /prefix
./pkgs/development/libraries/qt-5/5.4/qtbase/series
=&gt; [ "/prefix/dlopen-resolv.patch" "/prefix/tzdir.patch"
"/prefix/dlopen-libXcursor.patch" "/prefix/dlopen-openssl.patch"
"/prefix/dlopen-dbus.patch" "/prefix/xdg-config-dirs.patch"
"/prefix/nix-profiles-library-paths.patch"
"/prefix/compose-search-path.patch" ]
</pre></div></div><br class="example-break" /><p><a id="lib.strings.readPathsFromFile"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L644" target="_top">lib/strings.nix:644</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.strings.fileContents"></a>7.1.3.42. <code class="function">lib.strings.fileContents</code></h4></div><div><h5 class="subtitle"><code class="literal">fileContents :: path -&gt; string</code>
     </h5></div></div></div><p>
      Read the contents of a file removing the trailing \n
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">file</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171158096"></a><p class="title"><strong>Example 7.74. <code class="function">lib.strings.fileContents</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
$ echo "1.0" &gt; ./version

fileContents ./version
=&gt; "1.0"
</pre></div></div><br class="example-break" /><p><a id="lib.strings.fileContents"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/strings.nix#L663" target="_top">lib/strings.nix:663</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-trivial"></a>7.1.4. Miscellaneous functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.id"></a>7.1.4.1. <code class="function">lib.trivial.id</code></h4></div><div><h5 class="subtitle"><code class="literal">id :: a -&gt; a</code>
     </h5></div></div></div><p>
      The identity function For when you need a function that does
      “nothing”.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         The value to return
        </p></dd></dl></div><p><a id="lib.trivial.id"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L12" target="_top">lib/trivial.nix:12</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.const"></a>7.1.4.2. <code class="function">lib.trivial.const</code></h4></div><div><h5 class="subtitle"><code class="literal">const :: a -&gt; b -&gt; a</code>
     </h5></div></div></div><p>
      The constant function
     </p><p>
      Ignores the second argument. If called with only one argument, constructs
      a function that always returns a static value.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Value to return
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Value to ignore
        </p></dd></dl></div><div class="example"><a id="idm139978171136032"></a><p class="title"><strong>Example 7.75. <code class="function">lib.trivial.const</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
let f = const 5; in f 10
=&gt; 5
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.const"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L26" target="_top">lib/trivial.nix:26</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.concat"></a>7.1.4.3. <code class="function">lib.trivial.concat</code></h4></div><div><h5 class="subtitle"><code class="literal">concat :: [a] -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Concatenate two lists
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171124848"></a><p class="title"><strong>Example 7.76. <code class="function">lib.trivial.concat</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concat [ 1 2 ] [ 3 4 ]
=&gt; [ 1 2 3 4 ]
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.concat"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L43" target="_top">lib/trivial.nix:43</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.or"></a>7.1.4.4. <code class="function">lib.trivial.or</code></h4></div></div></div><p>
      boolean “or”
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.or"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L46" target="_top">lib/trivial.nix:46</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.and"></a>7.1.4.5. <code class="function">lib.trivial.and</code></h4></div></div></div><p>
      boolean “and”
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.and"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L49" target="_top">lib/trivial.nix:49</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitAnd"></a>7.1.4.6. <code class="function">lib.trivial.bitAnd</code></h4></div></div></div><p>
      bitwise “and”
     </p><p><a id="lib.trivial.bitAnd"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L52" target="_top">lib/trivial.nix:52</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitOr"></a>7.1.4.7. <code class="function">lib.trivial.bitOr</code></h4></div></div></div><p>
      bitwise “or”
     </p><p><a id="lib.trivial.bitOr"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L57" target="_top">lib/trivial.nix:57</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitXor"></a>7.1.4.8. <code class="function">lib.trivial.bitXor</code></h4></div></div></div><p>
      bitwise “xor”
     </p><p><a id="lib.trivial.bitXor"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L62" target="_top">lib/trivial.nix:62</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.bitNot"></a>7.1.4.9. <code class="function">lib.trivial.bitNot</code></h4></div></div></div><p>
      bitwise “not”
     </p><p><a id="lib.trivial.bitNot"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L67" target="_top">lib/trivial.nix:67</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.boolToString"></a>7.1.4.10. <code class="function">lib.trivial.boolToString</code></h4></div><div><h5 class="subtitle"><code class="literal">boolToString :: bool -&gt; string</code>
     </h5></div></div></div><p>
      Convert a boolean to a string.
     </p><p>
      This function uses the strings "true" and "false" to represent boolean
      values. Calling `toString` on a bool instead returns "1" and "" (sic!).
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.boolToString"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L77" target="_top">lib/trivial.nix:77</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mergeAttrs"></a>7.1.4.11. <code class="function">lib.trivial.mergeAttrs</code></h4></div></div></div><p>
      Merge two attribute sets shallowly, right side trumps left
     </p><p>
      mergeAttrs :: attrs -&gt; attrs -&gt; attrs
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Left attribute set
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Right attribute set (higher precedence for equal keys)
        </p></dd></dl></div><div class="example"><a id="idm139978171070992"></a><p class="title"><strong>Example 7.77. <code class="function">lib.trivial.mergeAttrs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
mergeAttrs { a = 1; b = 2; } { b = 3; c = 4; }
=&gt; { a = 1; b = 3; c = 4; }
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.mergeAttrs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L87" target="_top">lib/trivial.nix:87</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.flip"></a>7.1.4.12. <code class="function">lib.trivial.flip</code></h4></div><div><h5 class="subtitle"><code class="literal">flip :: (a -&gt; b -&gt; c) -&gt; (b -&gt; a -&gt; c)</code>
     </h5></div></div></div><p>
      Flip the order of the arguments of a binary function.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978171057744"></a><p class="title"><strong>Example 7.78. <code class="function">lib.trivial.flip</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
flip concat [1] [2]
=&gt; [ 2 1 ]
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.flip"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L101" target="_top">lib/trivial.nix:101</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mapNullable"></a>7.1.4.13. <code class="function">lib.trivial.mapNullable</code></h4></div></div></div><p>
      Apply function if the supplied argument is non-null.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to call
        </p></dd><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Argument to check for null before passing it to `f`
        </p></dd></dl></div><div class="example"><a id="idm139978171047328"></a><p class="title"><strong>Example 7.79. <code class="function">lib.trivial.mapNullable</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
mapNullable (x: x+1) null
=&gt; null
mapNullable (x: x+1) 22
=&gt; 23
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.mapNullable"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L111" target="_top">lib/trivial.nix:111</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.version"></a>7.1.4.14. <code class="function">lib.trivial.version</code></h4></div></div></div><p>
      Returns the current full nixpkgs version number.
     </p><p><a id="lib.trivial.version"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L127" target="_top">lib/trivial.nix:127</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.release"></a>7.1.4.15. <code class="function">lib.trivial.release</code></h4></div></div></div><p>
      Returns the current nixpkgs release number as string.
     </p><p><a id="lib.trivial.release"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L130" target="_top">lib/trivial.nix:130</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.codeName"></a>7.1.4.16. <code class="function">lib.trivial.codeName</code></h4></div></div></div><p>
      Returns the current nixpkgs release code name.
     </p><p>
      On each release the first letter is bumped and a new animal is chosen
      starting with that new letter.
     </p><p><a id="lib.trivial.codeName"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L137" target="_top">lib/trivial.nix:137</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.versionSuffix"></a>7.1.4.17. <code class="function">lib.trivial.versionSuffix</code></h4></div></div></div><p>
      Returns the current nixpkgs version suffix as string.
     </p><p><a id="lib.trivial.versionSuffix"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L140" target="_top">lib/trivial.nix:140</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.revisionWithDefault"></a>7.1.4.18. <code class="function">lib.trivial.revisionWithDefault</code></h4></div><div><h5 class="subtitle"><code class="literal">revisionWithDefault :: string -&gt; string</code>
     </h5></div></div></div><p>
      Attempts to return the the current revision of nixpkgs and returns the
      supplied default value otherwise.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">default</code>
       </span></dt><dd><p>
         Default value to return if revision can not be determined
        </p></dd></dl></div><p><a id="lib.trivial.revisionWithDefault"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L151" target="_top">lib/trivial.nix:151</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.inNixShell"></a>7.1.4.19. <code class="function">lib.trivial.inNixShell</code></h4></div><div><h5 class="subtitle"><code class="literal">inNixShell :: bool</code>
     </h5></div></div></div><p>
      Determine whether the function is being called from inside a Nix shell.
     </p><p><a id="lib.trivial.inNixShell"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L169" target="_top">lib/trivial.nix:169</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.min"></a>7.1.4.20. <code class="function">lib.trivial.min</code></h4></div></div></div><p>
      Return minimum of two numbers.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.min"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L175" target="_top">lib/trivial.nix:175</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.max"></a>7.1.4.21. <code class="function">lib.trivial.max</code></h4></div></div></div><p>
      Return maximum of two numbers.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.max"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L178" target="_top">lib/trivial.nix:178</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.mod"></a>7.1.4.22. <code class="function">lib.trivial.mod</code></h4></div></div></div><p>
      Integer modulus
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">base</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">int</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170988448"></a><p class="title"><strong>Example 7.80. <code class="function">lib.trivial.mod</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
mod 11 10
=&gt; 1
mod 1 10
=&gt; 1
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.mod"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L188" target="_top">lib/trivial.nix:188</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.compare"></a>7.1.4.23. <code class="function">lib.trivial.compare</code></h4></div></div></div><p>
      C-style comparisons
     </p><p>
      a &lt; b, compare a b =&gt; -1 a == b, compare a b =&gt; 0 a &gt; b,
      compare a b =&gt; 1
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.compare"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L199" target="_top">lib/trivial.nix:199</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.splitByAndCompare"></a>7.1.4.24. <code class="function">lib.trivial.splitByAndCompare</code></h4></div><div><h5 class="subtitle"><code class="literal">(a -&gt; bool) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int) -&gt; (a -&gt; a -&gt; int)</code>
     </h5></div></div></div><p>
      Split type into two subtypes by predicate `p`, take all elements of the
      first subtype to be less than all the elements of the second subtype,
      compare elements of a single subtype with `yes` and `no` respectively.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">p</code>
       </span></dt><dd><p>
         Predicate
        </p></dd><dt><span class="term">
        <code class="varname">yes</code>
       </span></dt><dd><p>
         Comparison function if predicate holds for both values
        </p></dd><dt><span class="term">
        <code class="varname">no</code>
       </span></dt><dd><p>
         Comparison function if predicate holds for neither value
        </p></dd><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         First value to compare
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Second value to compare
        </p></dd></dl></div><div class="example"><a id="idm139978170961648"></a><p class="title"><strong>Example 7.81. <code class="function">lib.trivial.splitByAndCompare</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
let cmp = splitByAndCompare (hasPrefix "foo") compare compare; in

cmp "a" "z" =&gt; -1
cmp "fooa" "fooz" =&gt; -1

cmp "f" "a" =&gt; 1
cmp "fooa" "a" =&gt; -1
# while
compare "fooa" "a" =&gt; 1
</pre></div></div><br class="example-break" /><p><a id="lib.trivial.splitByAndCompare"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L224" target="_top">lib/trivial.nix:224</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.importJSON"></a>7.1.4.25. <code class="function">lib.trivial.importJSON</code></h4></div></div></div><p>
      Reads a JSON file.
     </p><p>
      Type :: path -&gt; any
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">path</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.importJSON"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L244" target="_top">lib/trivial.nix:244</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.setFunctionArgs"></a>7.1.4.26. <code class="function">lib.trivial.setFunctionArgs</code></h4></div></div></div><p>
      Add metadata about expected function arguments to a function. The
      metadata should match the format given by builtins.functionArgs, i.e. a
      set from expected argument to a bool representing whether that argument
      has a default or not. setFunctionArgs : (a → b) → Map
      String Bool → (a → b)
     </p><p>
      This function is necessary because you can't dynamically create a
      function of the { a, b ? foo, ... }: format, but some facilities like
      callPackage expect to be able to query expected arguments.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">args</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.setFunctionArgs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L279" target="_top">lib/trivial.nix:279</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.functionArgs"></a>7.1.4.27. <code class="function">lib.trivial.functionArgs</code></h4></div></div></div><p>
      Extract the expected function arguments from a function. This works both
      with nix-native { a, b ? foo, ... }: style functions and functions with
      args set with 'setFunctionArgs'. It has the same return type and
      semantics as builtins.functionArgs. setFunctionArgs : (a → b)
      → Map String Bool.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.functionArgs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L291" target="_top">lib/trivial.nix:291</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.trivial.isFunction"></a>7.1.4.28. <code class="function">lib.trivial.isFunction</code></h4></div></div></div><p>
      Check whether something is a function or something annotated with
      function args.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.trivial.isFunction"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/trivial.nix#L296" target="_top">lib/trivial.nix:296</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-lists"></a>7.1.5. List manipulation functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.singleton"></a>7.1.5.1. <code class="function">lib.lists.singleton</code></h4></div><div><h5 class="subtitle"><code class="literal">singleton :: a -&gt; [a]</code>
     </h5></div></div></div><p>
      Create a list consisting of a single element. `singleton x` is sometimes
      more convenient with respect to indentation than `[x]` when x spans
      multiple lines.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170918080"></a><p class="title"><strong>Example 7.82. <code class="function">lib.lists.singleton</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
singleton "foo"
=&gt; [ "foo" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.singleton"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L22" target="_top">lib/lists.nix:22</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldr"></a>7.1.5.2. <code class="function">lib.lists.foldr</code></h4></div><div><h5 class="subtitle"><code class="literal">foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
     </h5></div></div></div><p>
      “right fold” a binary function `op` between successive
      elements of `list` with `nul' as the starting value, i.e., `foldr op nul
      [x_1 x_2 ... x_n] == op x_1 (op x_2 ... (op x_n nul))`.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">op</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">nul</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170904416"></a><p class="title"><strong>Example 7.83. <code class="function">lib.lists.foldr</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concat = foldr (a: b: a + b) "z"
concat [ "a" "b" "c" ]
=&gt; "abcz"
# different types
strange = foldr (int: str: toString (int + 1) + str) "a"
strange [ 1 2 3 4 ]
=&gt; "2345a"
</pre></div></div><br class="example-break" /><p><a id="lib.lists.foldr"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L39" target="_top">lib/lists.nix:39</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.fold"></a>7.1.5.3. <code class="function">lib.lists.fold</code></h4></div></div></div><p>
      `fold` is an alias of `foldr` for historic reasons
     </p><p><a id="lib.lists.fold"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L50" target="_top">lib/lists.nix:50</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldl"></a>7.1.5.4. <code class="function">lib.lists.foldl</code></h4></div><div><h5 class="subtitle"><code class="literal">foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
     </h5></div></div></div><p>
      “left fold”, like `foldr`, but from the left: `foldl op nul
      [x_1 x_2 ... x_n] == op (... (op (op nul x_1) x_2) ... x_n)`.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">op</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">nul</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170886592"></a><p class="title"><strong>Example 7.84. <code class="function">lib.lists.foldl</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
lconcat = foldl (a: b: a + b) "z"
lconcat [ "a" "b" "c" ]
=&gt; "zabc"
# different types
lstrange = foldl (str: int: str + toString (int + 1)) ""
strange [ 1 2 3 4 ]
=&gt; "a2345"
</pre></div></div><br class="example-break" /><p><a id="lib.lists.foldl"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L67" target="_top">lib/lists.nix:67</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.foldl-prime"></a>7.1.5.5. <code class="function">lib.lists.foldl'</code></h4></div><div><h5 class="subtitle"><code class="literal">foldl' :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>
     </h5></div></div></div><p>
      Strict version of `foldl`.
     </p><p>
      The difference is that evaluation is forced upon access. Usually used
      with small whole results (in contract with lazily-generated list or large
      lists where only a part is consumed.)
     </p><p><a id="lib.lists.foldl-prime"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L83" target="_top">lib/lists.nix:83</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.imap0"></a>7.1.5.6. <code class="function">lib.lists.imap0</code></h4></div><div><h5 class="subtitle"><code class="literal">imap0 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code>
     </h5></div></div></div><p>
      Map with index starting from 0
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170869408"></a><p class="title"><strong>Example 7.85. <code class="function">lib.lists.imap0</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
imap0 (i: v: "${v}-${toString i}") ["a" "b"]
=&gt; [ "a-0" "b-1" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.imap0"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L93" target="_top">lib/lists.nix:93</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.imap1"></a>7.1.5.7. <code class="function">lib.lists.imap1</code></h4></div><div><h5 class="subtitle"><code class="literal">imap1 :: (int -&gt; a -&gt; b) -&gt; [a] -&gt; [b]</code>
     </h5></div></div></div><p>
      Map with index starting from 1
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170858160"></a><p class="title"><strong>Example 7.86. <code class="function">lib.lists.imap1</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
imap1 (i: v: "${v}-${toString i}") ["a" "b"]
=&gt; [ "a-1" "b-2" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.imap1"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L103" target="_top">lib/lists.nix:103</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.concatMap"></a>7.1.5.8. <code class="function">lib.lists.concatMap</code></h4></div><div><h5 class="subtitle"><code class="literal">concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]</code>
     </h5></div></div></div><p>
      Map and concatenate the result.
     </p><div class="example"><a id="idm139978170851424"></a><p class="title"><strong>Example 7.87. <code class="function">lib.lists.concatMap</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
concatMap (x: [x] ++ ["z"]) ["a" "b"]
=&gt; [ "a" "z" "b" "z" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.concatMap"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L113" target="_top">lib/lists.nix:113</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.flatten"></a>7.1.5.9. <code class="function">lib.lists.flatten</code></h4></div></div></div><p>
      Flatten the argument into a single list; that is, nested lists are
      spliced into the top-level lists.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170842848"></a><p class="title"><strong>Example 7.88. <code class="function">lib.lists.flatten</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
flatten [1 [2 [3] 4] 5]
=&gt; [1 2 3 4 5]
flatten 1
=&gt; [1]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.flatten"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L124" target="_top">lib/lists.nix:124</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.remove"></a>7.1.5.10. <code class="function">lib.lists.remove</code></h4></div><div><h5 class="subtitle"><code class="literal">remove :: a -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Remove elements equal to 'e' from a list. Useful for buildInputs.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">e</code>
       </span></dt><dd><p>
         Element to remove from the list
        </p></dd></dl></div><div class="example"><a id="idm139978170833488"></a><p class="title"><strong>Example 7.89. <code class="function">lib.lists.remove</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
remove 3 [ 1 3 4 3 ]
=&gt; [ 1 4 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.remove"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L137" target="_top">lib/lists.nix:137</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.findSingle"></a>7.1.5.11. <code class="function">lib.lists.findSingle</code></h4></div><div><h5 class="subtitle"><code class="literal">findSingle :: (a -&gt; bool) -&gt; a -&gt; a -&gt; [a] -&gt; a</code>
     </h5></div></div></div><p>
      Find the sole element in the list matching the specified predicate,
      returns `default` if no such element exists, or `multiple` if there are
      multiple matching elements.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Predicate
        </p></dd><dt><span class="term">
        <code class="varname">default</code>
       </span></dt><dd><p>
         Default value to return if element was not found.
        </p></dd><dt><span class="term">
        <code class="varname">multiple</code>
       </span></dt><dd><p>
         Default value to return if more than one element was found
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Input list
        </p></dd></dl></div><div class="example"><a id="idm139978170818256"></a><p class="title"><strong>Example 7.90. <code class="function">lib.lists.findSingle</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
findSingle (x: x == 3) "none" "multiple" [ 1 3 3 ]
=&gt; "multiple"
findSingle (x: x == 3) "none" "multiple" [ 1 3 ]
=&gt; 3
findSingle (x: x == 3) "none" "multiple" [ 1 9 ]
=&gt; "none"
</pre></div></div><br class="example-break" /><p><a id="lib.lists.findSingle"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L155" target="_top">lib/lists.nix:155</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.findFirst"></a>7.1.5.12. <code class="function">lib.lists.findFirst</code></h4></div><div><h5 class="subtitle"><code class="literal">findFirst :: (a -&gt; bool) -&gt; a -&gt; [a] -&gt; a</code>
     </h5></div></div></div><p>
      Find the first element in the list matching the specified predicate or
      return `default` if no such element exists.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Predicate
        </p></dd><dt><span class="term">
        <code class="varname">default</code>
       </span></dt><dd><p>
         Default value to return
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Input list
        </p></dd></dl></div><div class="example"><a id="idm139978170804672"></a><p class="title"><strong>Example 7.91. <code class="function">lib.lists.findFirst</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
findFirst (x: x &gt; 3) 7 [ 1 6 4 ]
=&gt; 6
findFirst (x: x &gt; 9) 7 [ 1 6 4 ]
=&gt; 7
</pre></div></div><br class="example-break" /><p><a id="lib.lists.findFirst"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L180" target="_top">lib/lists.nix:180</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.any"></a>7.1.5.13. <code class="function">lib.lists.any</code></h4></div><div><h5 class="subtitle"><code class="literal">any :: (a -&gt; bool) -&gt; [a] -&gt; bool</code>
     </h5></div></div></div><p>
      Return true if function `pred` returns true for at least one element of
      `list`.
     </p><div class="example"><a id="idm139978170797776"></a><p class="title"><strong>Example 7.92. <code class="function">lib.lists.any</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
any isString [ 1 "a" { } ]
=&gt; true
any isString [ 1 { } ]
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.lists.any"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L201" target="_top">lib/lists.nix:201</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.all"></a>7.1.5.14. <code class="function">lib.lists.all</code></h4></div><div><h5 class="subtitle"><code class="literal">all :: (a -&gt; bool) -&gt; [a] -&gt; bool</code>
     </h5></div></div></div><p>
      Return true if function `pred` returns true for all elements of `list`.
     </p><div class="example"><a id="idm139978170790864"></a><p class="title"><strong>Example 7.93. <code class="function">lib.lists.all</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
all (x: x &lt; 3) [ 1 2 ]
=&gt; true
all (x: x &lt; 3) [ 1 2 3 ]
=&gt; false
</pre></div></div><br class="example-break" /><p><a id="lib.lists.all"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L214" target="_top">lib/lists.nix:214</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.count"></a>7.1.5.15. <code class="function">lib.lists.count</code></h4></div><div><h5 class="subtitle"><code class="literal">count :: (a -&gt; bool) -&gt; [a] -&gt; int</code>
     </h5></div></div></div><p>
      Count how many elements of `list` match the supplied predicate function.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Predicate
        </p></dd></dl></div><div class="example"><a id="idm139978170781504"></a><p class="title"><strong>Example 7.94. <code class="function">lib.lists.count</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
count (x: x == 3) [ 3 2 3 4 6 ]
=&gt; 2
</pre></div></div><br class="example-break" /><p><a id="lib.lists.count"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L225" target="_top">lib/lists.nix:225</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.optional"></a>7.1.5.16. <code class="function">lib.lists.optional</code></h4></div><div><h5 class="subtitle"><code class="literal">optional :: bool -&gt; a -&gt; [a]</code>
     </h5></div></div></div><p>
      Return a singleton list or an empty list, depending on a boolean value.
      Useful when building lists with optional elements (e.g. `++ optional
      (system == "i686-linux") flashplayer').
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cond</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">elem</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170770080"></a><p class="title"><strong>Example 7.95. <code class="function">lib.lists.optional</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
optional true "foo"
=&gt; [ "foo" ]
optional false "foo"
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.optional"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L241" target="_top">lib/lists.nix:241</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.optionals"></a>7.1.5.17. <code class="function">lib.lists.optionals</code></h4></div><div><h5 class="subtitle"><code class="literal">optionals :: bool -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Return a list or an empty list, depending on a boolean value.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cond</code>
       </span></dt><dd><p>
         Condition
        </p></dd><dt><span class="term">
        <code class="varname">elems</code>
       </span></dt><dd><p>
         List to return if condition is true
        </p></dd></dl></div><div class="example"><a id="idm139978170758784"></a><p class="title"><strong>Example 7.96. <code class="function">lib.lists.optionals</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
optionals true [ 2 3 ]
=&gt; [ 2 3 ]
optionals false [ 2 3 ]
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.optionals"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L253" target="_top">lib/lists.nix:253</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.toList"></a>7.1.5.18. <code class="function">lib.lists.toList</code></h4></div></div></div><p>
      If argument is a list, return it; else, wrap it in a singleton list. If
      you're using this, you should almost certainly reconsider if there isn't
      a more "well-typed" approach.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170750464"></a><p class="title"><strong>Example 7.97. <code class="function">lib.lists.toList</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
toList [ 1 2 ]
=&gt; [ 1 2 ]
toList "hi"
=&gt; [ "hi "]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.toList"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L270" target="_top">lib/lists.nix:270</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.range"></a>7.1.5.19. <code class="function">lib.lists.range</code></h4></div><div><h5 class="subtitle"><code class="literal">range :: int -&gt; int -&gt; [int]</code>
     </h5></div></div></div><p>
      Return a list of integers from `first' up to and including `last'.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">first</code>
       </span></dt><dd><p>
         First integer in the range
        </p></dd><dt><span class="term">
        <code class="varname">last</code>
       </span></dt><dd><p>
         Last integer in the range
        </p></dd></dl></div><div class="example"><a id="idm139978170739120"></a><p class="title"><strong>Example 7.98. <code class="function">lib.lists.range</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
range 2 4
=&gt; [ 2 3 4 ]
range 3 2
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.range"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L282" target="_top">lib/lists.nix:282</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.partition"></a>7.1.5.20. <code class="function">lib.lists.partition</code></h4></div><div><h5 class="subtitle"><code class="literal">(a -&gt; bool) -&gt; [a] -&gt; { right :: [a], wrong :: [a] }</code>
     </h5></div></div></div><p>
      Splits the elements of a list in two lists, `right` and `wrong`,
      depending on the evaluation of a predicate.
     </p><div class="example"><a id="idm139978170732208"></a><p class="title"><strong>Example 7.99. <code class="function">lib.lists.partition</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
partition (x: x &gt; 2) [ 5 1 2 3 4 ]
=&gt; { right = [ 5 3 4 ]; wrong = [ 1 2 ]; }
</pre></div></div><br class="example-break" /><p><a id="lib.lists.partition"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L301" target="_top">lib/lists.nix:301</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.groupBy-prime"></a>7.1.5.21. <code class="function">lib.lists.groupBy'</code></h4></div></div></div><p>
      Splits the elements of a list into many lists, using the return value of
      a predicate. Predicate should return a string which becomes keys of
      attrset `groupBy' returns.
     </p><p>
      `groupBy'` allows to customise the combining function and initial value
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">op</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">nul</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">lst</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170717280"></a><p class="title"><strong>Example 7.100. <code class="function">lib.lists.groupBy'</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
groupBy (x: boolToString (x &gt; 2)) [ 5 1 2 3 4 ]
=&gt; { true = [ 5 3 4 ]; false = [ 1 2 ]; }
groupBy (x: x.name) [ {name = "icewm"; script = "icewm &amp;";}
{name = "xfce";  script = "xfce4-session &amp;";}
{name = "icewm"; script = "icewmbg &amp;";}
{name = "mate";  script = "gnome-session &amp;";}
]
=&gt; { icewm = [ { name = "icewm"; script = "icewm &amp;"; }
{ name = "icewm"; script = "icewmbg &amp;"; } ];
mate  = [ { name = "mate";  script = "gnome-session &amp;"; } ];
xfce  = [ { name = "xfce";  script = "xfce4-session &amp;"; } ];
}

groupBy' builtins.add 0 (x: boolToString (x &gt; 2)) [ 5 1 2 3 4 ]
=&gt; { true = 12; false = 3; }
</pre></div></div><br class="example-break" /><p><a id="lib.lists.groupBy-prime"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L330" target="_top">lib/lists.nix:330</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.zipListsWith"></a>7.1.5.22. <code class="function">lib.lists.zipListsWith</code></h4></div><div><h5 class="subtitle"><code class="literal">zipListsWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code>
     </h5></div></div></div><p>
      Merges two lists of the same size together. If the sizes aren't the same
      the merging stops at the shortest. How both lists are merged is defined
      by the first argument.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to zip elements of both lists
        </p></dd><dt><span class="term">
        <code class="varname">fst</code>
       </span></dt><dd><p>
         First list
        </p></dd><dt><span class="term">
        <code class="varname">snd</code>
       </span></dt><dd><p>
         Second list
        </p></dd></dl></div><div class="example"><a id="idm139978170703264"></a><p class="title"><strong>Example 7.101. <code class="function">lib.lists.zipListsWith</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
zipListsWith (a: b: a + b) ["h" "l"] ["e" "o"]
=&gt; ["he" "lo"]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.zipListsWith"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L350" target="_top">lib/lists.nix:350</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.zipLists"></a>7.1.5.23. <code class="function">lib.lists.zipLists</code></h4></div><div><h5 class="subtitle"><code class="literal">zipLists :: [a] -&gt; [b] -&gt; [{ fst :: a, snd :: b}]</code>
     </h5></div></div></div><p>
      Merges two lists of the same size together. If the sizes aren't the same
      the merging stops at the shortest.
     </p><div class="example"><a id="idm139978170696288"></a><p class="title"><strong>Example 7.102. <code class="function">lib.lists.zipLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
zipLists [ 1 2 ] [ "a" "b" ]
=&gt; [ { fst = 1; snd = "a"; } { fst = 2; snd = "b"; } ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.zipLists"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L369" target="_top">lib/lists.nix:369</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.reverseList"></a>7.1.5.24. <code class="function">lib.lists.reverseList</code></h4></div><div><h5 class="subtitle"><code class="literal">reverseList :: [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Reverse the order of the elements of a list.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">xs</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170687024"></a><p class="title"><strong>Example 7.103. <code class="function">lib.lists.reverseList</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">

reverseList [ "b" "o" "j" ]
=&gt; [ "j" "o" "b" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.reverseList"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L380" target="_top">lib/lists.nix:380</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.listDfs"></a>7.1.5.25. <code class="function">lib.lists.listDfs</code></h4></div></div></div><p>
      Depth-First Search (DFS) for lists `list != []`.
     </p><p>
      `before a b == true` means that `b` depends on `a` (there's an edge from
      `b` to `a`).
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">stopOnCycles</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">before</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170673952"></a><p class="title"><strong>Example 7.104. <code class="function">lib.lists.listDfs</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
listDfs true hasPrefix [ "/home/user" "other" "/" "/home" ]
== { minimal = "/";                  # minimal element
visited = [ "/home/user" ];     # seen elements (in reverse order)
rest    = [ "/home" "other" ];  # everything else
}

listDfs true hasPrefix [ "/home/user" "other" "/" "/home" "/" ]
== { cycle   = "/";                  # cycle encountered at this element
loops   = [ "/" ];              # and continues to these elements
visited = [ "/" "/home/user" ]; # elements leading to the cycle (in reverse order)
rest    = [ "/home" "other" ];  # everything else
</pre></div></div><br class="example-break" /><p><a id="lib.lists.listDfs"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L402" target="_top">lib/lists.nix:402</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.toposort"></a>7.1.5.26. <code class="function">lib.lists.toposort</code></h4></div></div></div><p>
      Sort a list based on a partial ordering using DFS. This implementation is
      O(N^2), if your ordering is linear, use `sort` instead.
     </p><p>
      `before a b == true` means that `b` should be after `a` in the result.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">before</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170662144"></a><p class="title"><strong>Example 7.105. <code class="function">lib.lists.toposort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">

toposort hasPrefix [ "/home/user" "other" "/" "/home" ]
== { result = [ "/" "/home" "/home/user" "other" ]; }

toposort hasPrefix [ "/home/user" "other" "/" "/home" "/" ]
== { cycle = [ "/home/user" "/" "/" ]; # path leading to a cycle
loops = [ "/" ]; }                # loops back to these elements

toposort hasPrefix [ "other" "/home/user" "/home" "/" ]
== { result = [ "other" "/" "/home" "/home/user" ]; }

toposort (a: b: a &lt; b) [ 3 2 1 ] == { result = [ 1 2 3 ]; }
</pre></div></div><br class="example-break" /><p><a id="lib.lists.toposort"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L441" target="_top">lib/lists.nix:441</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.sort"></a>7.1.5.27. <code class="function">lib.lists.sort</code></h4></div></div></div><p>
      Sort a list based on a comparator function which compares two elements
      and returns true if the first argument is strictly below the second
      argument. The returned list is sorted in an increasing order. The
      implementation does a quick-sort.
     </p><div class="example"><a id="idm139978170654736"></a><p class="title"><strong>Example 7.106. <code class="function">lib.lists.sort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
sort (a: b: a &lt; b) [ 5 3 7 ]
=&gt; [ 3 5 7 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.sort"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L469" target="_top">lib/lists.nix:469</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.compareLists"></a>7.1.5.28. <code class="function">lib.lists.compareLists</code></h4></div></div></div><p>
      Compare two lists element-by-element.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">cmp</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170642400"></a><p class="title"><strong>Example 7.107. <code class="function">lib.lists.compareLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
compareLists compare [] []
=&gt; 0
compareLists compare [] [ "a" ]
=&gt; -1
compareLists compare [ "a" ] []
=&gt; 1
compareLists compare [ "a" "b" ] [ "a" "c" ]
=&gt; 1
</pre></div></div><br class="example-break" /><p><a id="lib.lists.compareLists"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L498" target="_top">lib/lists.nix:498</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.naturalSort"></a>7.1.5.29. <code class="function">lib.lists.naturalSort</code></h4></div></div></div><p>
      Sort list using "Natural sorting". Numeric portions of strings are sorted
      in numeric order.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">lst</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170633632"></a><p class="title"><strong>Example 7.108. <code class="function">lib.lists.naturalSort</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
naturalSort ["disk11" "disk8" "disk100" "disk9"]
=&gt; ["disk8" "disk9" "disk11" "disk100"]
naturalSort ["10.46.133.149" "10.5.16.62" "10.54.16.25"]
=&gt; ["10.5.16.62" "10.46.133.149" "10.54.16.25"]
naturalSort ["v0.2" "v0.15" "v0.0.9"]
=&gt; [ "v0.0.9" "v0.2" "v0.15" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.naturalSort"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L521" target="_top">lib/lists.nix:521</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.take"></a>7.1.5.30. <code class="function">lib.lists.take</code></h4></div><div><h5 class="subtitle"><code class="literal">take :: int -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Return the first (at most) N elements of a list.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">count</code>
       </span></dt><dd><p>
         Number of elements to take
        </p></dd></dl></div><div class="example"><a id="idm139978170624160"></a><p class="title"><strong>Example 7.109. <code class="function">lib.lists.take</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
take 2 [ "a" "b" "c" "d" ]
=&gt; [ "a" "b" ]
take 2 [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.take"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L539" target="_top">lib/lists.nix:539</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.drop"></a>7.1.5.31. <code class="function">lib.lists.drop</code></h4></div><div><h5 class="subtitle"><code class="literal">drop :: int -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Remove the first (at most) N elements of a list.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">count</code>
       </span></dt><dd><p>
         Number of elements to drop
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Input list
        </p></dd></dl></div><div class="example"><a id="idm139978170612784"></a><p class="title"><strong>Example 7.110. <code class="function">lib.lists.drop</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
drop 2 [ "a" "b" "c" "d" ]
=&gt; [ "c" "d" ]
drop 2 [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.drop"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L553" target="_top">lib/lists.nix:553</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.sublist"></a>7.1.5.32. <code class="function">lib.lists.sublist</code></h4></div><div><h5 class="subtitle"><code class="literal">sublist :: int -&gt; int -&gt; [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Return a list consisting of at most `count` elements of `list`, starting
      at index `start`.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">start</code>
       </span></dt><dd><p>
         Index at which to start the sublist
        </p></dd><dt><span class="term">
        <code class="varname">count</code>
       </span></dt><dd><p>
         Number of elements to take
        </p></dd><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Input list
        </p></dd></dl></div><div class="example"><a id="idm139978170599456"></a><p class="title"><strong>Example 7.111. <code class="function">lib.lists.sublist</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
sublist 1 3 [ "a" "b" "c" "d" "e" ]
=&gt; [ "b" "c" "d" ]
sublist 1 3 [ ]
=&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.sublist"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L570" target="_top">lib/lists.nix:570</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.last"></a>7.1.5.33. <code class="function">lib.lists.last</code></h4></div><div><h5 class="subtitle"><code class="literal">last :: [a] -&gt; a</code>
     </h5></div></div></div><p>
      Return the last element of a list.
     </p><p>
      This function throws an error if the list is empty.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170589568"></a><p class="title"><strong>Example 7.112. <code class="function">lib.lists.last</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
last [ 1 2 3 ]
=&gt; 3
</pre></div></div><br class="example-break" /><p><a id="lib.lists.last"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L594" target="_top">lib/lists.nix:594</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.init"></a>7.1.5.34. <code class="function">lib.lists.init</code></h4></div><div><h5 class="subtitle"><code class="literal">init :: [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Return all elements but the last.
     </p><p>
      This function throws an error if the list is empty.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170579792"></a><p class="title"><strong>Example 7.113. <code class="function">lib.lists.init</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
init [ 1 2 3 ]
=&gt; [ 1 2 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.init"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L608" target="_top">lib/lists.nix:608</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.crossLists"></a>7.1.5.35. <code class="function">lib.lists.crossLists</code></h4></div></div></div><p>
      Return the image of the cross product of some lists by a function.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170571328"></a><p class="title"><strong>Example 7.114. <code class="function">lib.lists.crossLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
crossLists (x:y: "${toString x}${toString y}") [[1 2] [3 4]]
=&gt; [ "13" "14" "23" "24" ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.crossLists"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L619" target="_top">lib/lists.nix:619</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.unique"></a>7.1.5.36. <code class="function">lib.lists.unique</code></h4></div><div><h5 class="subtitle"><code class="literal">unique :: [a] -&gt; [a]</code>
     </h5></div></div></div><p>
      Remove duplicate elements from the list. O(n^2) complexity.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">list</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170562016"></a><p class="title"><strong>Example 7.115. <code class="function">lib.lists.unique</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
unique [ 3 2 3 4 ]
=&gt; [ 3 2 4 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.unique"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L630" target="_top">lib/lists.nix:630</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.intersectLists"></a>7.1.5.37. <code class="function">lib.lists.intersectLists</code></h4></div></div></div><p>
      Intersects list 'e' and another list. O(nm) complexity.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">e</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170553472"></a><p class="title"><strong>Example 7.116. <code class="function">lib.lists.intersectLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
intersectLists [ 1 2 3 ] [ 6 3 2 ]
=&gt; [ 3 2 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.intersectLists"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L645" target="_top">lib/lists.nix:645</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.subtractLists"></a>7.1.5.38. <code class="function">lib.lists.subtractLists</code></h4></div></div></div><p>
      Subtracts list 'e' from another list. O(nm) complexity.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">e</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170544928"></a><p class="title"><strong>Example 7.117. <code class="function">lib.lists.subtractLists</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
subtractLists [ 3 2 ] [ 1 2 3 4 5 3 ]
=&gt; [ 1 4 5 ]
</pre></div></div><br class="example-break" /><p><a id="lib.lists.subtractLists"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L653" target="_top">lib/lists.nix:653</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.lists.mutuallyExclusive"></a>7.1.5.39. <code class="function">lib.lists.mutuallyExclusive</code></h4></div></div></div><p>
      Test if two lists have no common element. It should be slightly more
      efficient than (intersectLists a b == [])
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">a</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">b</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.lists.mutuallyExclusive"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/lists.nix#L658" target="_top">lib/lists.nix:658</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-debug"></a>7.1.6. Debugging functions</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceIf"></a>7.1.6.1. <code class="function">lib.debug.traceIf</code></h4></div><div><h5 class="subtitle"><code class="literal">traceIf :: bool -&gt; string -&gt; a -&gt; a</code>
     </h5></div></div></div><p>
      Conditionally trace the supplied message, based on a predicate.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pred</code>
       </span></dt><dd><p>
         Predicate to check
        </p></dd><dt><span class="term">
        <code class="varname">msg</code>
       </span></dt><dd><p>
         Message that should be traced
        </p></dd><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Value to return
        </p></dd></dl></div><div class="example"><a id="idm139978170520128"></a><p class="title"><strong>Example 7.118. <code class="function">lib.debug.traceIf</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
traceIf true "hello" 3
trace: hello
=&gt; 3
</pre></div></div><br class="example-break" /><p><a id="lib.debug.traceIf"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L35" target="_top">lib/debug.nix:35</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValFn"></a>7.1.6.2. <code class="function">lib.debug.traceValFn</code></h4></div><div><h5 class="subtitle"><code class="literal">traceValFn :: (a -&gt; b) -&gt; a -&gt; a</code>
     </h5></div></div></div><p>
      Trace the supplied value after applying a function to it, and return the
      original value.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to apply
        </p></dd><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Value to trace and return
        </p></dd></dl></div><div class="example"><a id="idm139978170508896"></a><p class="title"><strong>Example 7.119. <code class="function">lib.debug.traceValFn</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
traceValFn (v: "mystring ${v}") "foo"
trace: mystring foo
=&gt; "foo"
</pre></div></div><br class="example-break" /><p><a id="lib.debug.traceValFn"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L53" target="_top">lib/debug.nix:53</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceVal"></a>7.1.6.3. <code class="function">lib.debug.traceVal</code></h4></div><div><h5 class="subtitle"><code class="literal">traceVal :: a -&gt; a</code>
     </h5></div></div></div><p>
      Trace the supplied value and return it.
     </p><div class="example"><a id="idm139978170502144"></a><p class="title"><strong>Example 7.120. <code class="function">lib.debug.traceVal</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
traceVal 42
# trace: 42
=&gt; 42
</pre></div></div><br class="example-break" /><p><a id="lib.debug.traceVal"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L68" target="_top">lib/debug.nix:68</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceSeq"></a>7.1.6.4. <code class="function">lib.debug.traceSeq</code></h4></div><div><h5 class="subtitle"><code class="literal">traceSeq :: a -&gt; b -&gt; b</code>
     </h5></div></div></div><p>
      `builtins.trace`, but the value is `builtins.deepSeq`ed first.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         The value to trace
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         The value to return
        </p></dd></dl></div><div class="example"><a id="idm139978170490928"></a><p class="title"><strong>Example 7.121. <code class="function">lib.debug.traceSeq</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
trace { a.b.c = 3; } null
trace: { a = &lt;CODE&gt;; }
=&gt; null
traceSeq { a.b.c = 3; } null
trace: { a = { b = { c = 3; }; }; }
=&gt; null
</pre></div></div><br class="example-break" /><p><a id="lib.debug.traceSeq"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L82" target="_top">lib/debug.nix:82</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceSeqN"></a>7.1.6.5. <code class="function">lib.debug.traceSeqN</code></h4></div></div></div><p>
      Like `traceSeq`, but only evaluate down to depth n. This is very useful
      because lots of `traceSeq` usages lead to an infinite recursion.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">depth</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">y</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170478112"></a><p class="title"><strong>Example 7.122. <code class="function">lib.debug.traceSeqN</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
traceSeqN 2 { a.b.c = 3; } null
trace: { a = { b = {…}; }; }
=&gt; null
</pre></div></div><br class="example-break" /><p><a id="lib.debug.traceSeqN"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L97" target="_top">lib/debug.nix:97</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqFn"></a>7.1.6.6. <code class="function">lib.debug.traceValSeqFn</code></h4></div></div></div><p>
      A combination of `traceVal` and `traceSeq` that applies a provided
      function to the value to be traced after `deepSeq`ing it.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to apply
        </p></dd><dt><span class="term">
        <code class="varname">v</code>
       </span></dt><dd><p>
         Value to trace
        </p></dd></dl></div><p><a id="lib.debug.traceValSeqFn"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L114" target="_top">lib/debug.nix:114</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeq"></a>7.1.6.7. <code class="function">lib.debug.traceValSeq</code></h4></div></div></div><p>
      A combination of `traceVal` and `traceSeq`.
     </p><p><a id="lib.debug.traceValSeq"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L121" target="_top">lib/debug.nix:121</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqNFn"></a>7.1.6.8. <code class="function">lib.debug.traceValSeqNFn</code></h4></div></div></div><p>
      A combination of `traceVal` and `traceSeqN` that applies a provided
      function to the value to be traced.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">f</code>
       </span></dt><dd><p>
         Function to apply
        </p></dd><dt><span class="term">
        <code class="varname">depth</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">v</code>
       </span></dt><dd><p>
         Value to trace
        </p></dd></dl></div><p><a id="lib.debug.traceValSeqNFn"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L125" target="_top">lib/debug.nix:125</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.traceValSeqN"></a>7.1.6.9. <code class="function">lib.debug.traceValSeqN</code></h4></div></div></div><p>
      A combination of `traceVal` and `traceSeqN`.
     </p><p><a id="lib.debug.traceValSeqN"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L133" target="_top">lib/debug.nix:133</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.runTests"></a>7.1.6.10. <code class="function">lib.debug.runTests</code></h4></div></div></div><p>
      Evaluate a set of tests. A test is an attribute set `{expr, expected}`,
      denoting an expression and its expected result. The result is a list of
      failed tests, each represented as `{name, expected, actual}`, denoting
      the attribute name of the failing test and its expected and actual
      results.
     </p><p>
      Used for regression testing of the functions in lib; see tests.nix for an
      example. Only tests having names starting with "test" are run.
     </p><p>
      Add attr { tests = ["testName"]; } to run these tests only.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">tests</code>
       </span></dt><dd><p>
         Tests to run
        </p></dd></dl></div><p><a id="lib.debug.runTests"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L150" target="_top">lib/debug.nix:150</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.debug.testAllTrue"></a>7.1.6.11. <code class="function">lib.debug.testAllTrue</code></h4></div></div></div><p>
      Create a test assuming that list elements are `true`.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">expr</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170432736"></a><p class="title"><strong>Example 7.123. <code class="function">lib.debug.testAllTrue</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
{ testX = allTrue [ true ]; }
</pre></div></div><br class="example-break" /><p><a id="lib.debug.testAllTrue"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/debug.nix#L166" target="_top">lib/debug.nix:166</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-functions-library-options"></a>7.1.7. NixOS / nixpkgs option handling</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.isOption"></a>7.1.7.1. <code class="function">lib.options.isOption</code></h4></div><div><h5 class="subtitle"><code class="literal">isOption :: a -&gt; bool</code>
     </h5></div></div></div><p>
      Returns true when the given argument is an option
     </p><div class="example"><a id="idm139978170423328"></a><p class="title"><strong>Example 7.124. <code class="function">lib.options.isOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
isOption 1             // =&gt; false
isOption (mkOption {}) // =&gt; true
</pre></div></div><br class="example-break" /><p><a id="lib.options.isOption"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L19" target="_top">lib/options.nix:19</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkOption"></a>7.1.7.2. <code class="function">lib.options.mkOption</code></h4></div></div></div><p>
      Creates an Option attribute set. mkOption accepts an attribute set with
      the following keys:
     </p><p>
      All keys default to `null` when not given.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">pattern</code>
       </span></dt><dd><p>
         Structured function argument
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
           <code class="varname">default</code>
          </span></dt><dd><p>
            Default value used when no definition is given in the
            configuration.
           </p></dd><dt><span class="term">
           <code class="varname">defaultText</code>
          </span></dt><dd><p>
            Textual representation of the default, for the manual.
           </p></dd><dt><span class="term">
           <code class="varname">example</code>
          </span></dt><dd><p>
            Example value used in the manual.
           </p></dd><dt><span class="term">
           <code class="varname">description</code>
          </span></dt><dd><p>
            String describing the option.
           </p></dd><dt><span class="term">
           <code class="varname">relatedPackages</code>
          </span></dt><dd><p>
            Related packages used in the manual (see `genRelatedPackages` in
            ../nixos/doc/manual/default.nix).
           </p></dd><dt><span class="term">
           <code class="varname">type</code>
          </span></dt><dd><p>
            Option type, providing type-checking and value merging.
           </p></dd><dt><span class="term">
           <code class="varname">apply</code>
          </span></dt><dd><p>
            Function that converts the option value to something else.
           </p></dd><dt><span class="term">
           <code class="varname">internal</code>
          </span></dt><dd><p>
            Whether the option is for NixOS developers only.
           </p></dd><dt><span class="term">
           <code class="varname">visible</code>
          </span></dt><dd><p>
            Whether the option shows up in the manual.
           </p></dd><dt><span class="term">
           <code class="varname">readOnly</code>
          </span></dt><dd><p>
            Whether the option can be set only once
           </p></dd><dt><span class="term">
           <code class="varname">options</code>
          </span></dt><dd><p>
            Deprecated, used by types.optionSet.
           </p></dd></dl></div></dd></dl></div><div class="example"><a id="idm139978170391296"></a><p class="title"><strong>Example 7.125. <code class="function">lib.options.mkOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
mkOption { }  // =&gt; { _type = "option"; }
mkOption { defaultText = "foo"; } // =&gt; { _type = "option"; defaultText = "foo"; }
</pre></div></div><br class="example-break" /><p><a id="lib.options.mkOption"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L29" target="_top">lib/options.nix:29</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkEnableOption"></a>7.1.7.3. <code class="function">lib.options.mkEnableOption</code></h4></div></div></div><p>
      Creates an Option attribute set for a boolean value option i.e an option
      to be toggled on or off:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">name</code>
       </span></dt><dd><p>
         Name for the created option
        </p></dd></dl></div><div class="example"><a id="idm139978170382400"></a><p class="title"><strong>Example 7.126. <code class="function">lib.options.mkEnableOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
mkEnableOption "foo"
=&gt; { _type = "option"; default = false; description = "Whether to enable foo."; example = true; type = { ... }; }
</pre></div></div><br class="example-break" /><p><a id="lib.options.mkEnableOption"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L63" target="_top">lib/options.nix:63</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mkSinkUndeclaredOptions"></a>7.1.7.4. <code class="function">lib.options.mkSinkUndeclaredOptions</code></h4></div></div></div><p>
      This option accepts anything, but it does not produce any result.
     </p><p>
      This is useful for sharing a module across different module sets without
      having to implement similar features as long as the values of the options
      are not accessed.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">attrs</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.options.mkSinkUndeclaredOptions"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L77" target="_top">lib/options.nix:77</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.mergeEqualOption"></a>7.1.7.5. <code class="function">lib.options.mergeEqualOption</code></h4></div></div></div><p>
      "Merge" option definitions by checking that they all have the same value.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">loc</code>
       </span></dt><dd><p>
         Function argument
        </p></dd><dt><span class="term">
        <code class="varname">defs</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.options.mergeEqualOption"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L108" target="_top">lib/options.nix:108</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.getValues"></a>7.1.7.6. <code class="function">lib.options.getValues</code></h4></div><div><h5 class="subtitle"><code class="literal">getValues :: [ { value :: a } ] -&gt; [a]</code>
     </h5></div></div></div><p>
      Extracts values of all "value" keys of the given list.
     </p><div class="example"><a id="idm139978170359184"></a><p class="title"><strong>Example 7.127. <code class="function">lib.options.getValues</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
getValues [ { value = 1; } { value = 2; } ] // =&gt; [ 1 2 ]
getValues [ ]                               // =&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.options.getValues"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L124" target="_top">lib/options.nix:124</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.getFiles"></a>7.1.7.7. <code class="function">lib.options.getFiles</code></h4></div><div><h5 class="subtitle"><code class="literal">getFiles :: [ { file :: a } ] -&gt; [a]</code>
     </h5></div></div></div><p>
      Extracts values of all "file" keys of the given list
     </p><div class="example"><a id="idm139978170352032"></a><p class="title"><strong>Example 7.128. <code class="function">lib.options.getFiles</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
getFiles [ { file = "file1"; } { file = "file2"; } ] // =&gt; [ "file1" "file2" ]
getFiles [ ]                                         // =&gt; [ ]
</pre></div></div><br class="example-break" /><p><a id="lib.options.getFiles"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L134" target="_top">lib/options.nix:134</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.scrubOptionValue"></a>7.1.7.8. <code class="function">lib.options.scrubOptionValue</code></h4></div></div></div><p>
      This function recursively removes all derivation attributes from `x`
      except for the `name` attribute.
     </p><p>
      This is to make the generation of `options.xml` much more efficient: the
      XML representation of derivations is very large (on the order of
      megabytes) and is not actually used by the manual generator.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">x</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.options.scrubOptionValue"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L173" target="_top">lib/options.nix:173</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.literalExample"></a>7.1.7.9. <code class="function">lib.options.literalExample</code></h4></div></div></div><p>
      For use in the `example` option attribute. It causes the given text to be
      included verbatim in documentation. This is necessary for example values
      that are not simple values, e.g., functions.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">text</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><p><a id="lib.options.literalExample"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L185" target="_top">lib/options.nix:185</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-library-lib.options.showOption"></a>7.1.7.10. <code class="function">lib.options.showOption</code></h4></div></div></div><p>
      Convert an option, described as a list of the option parts in to a safe,
      human readable version.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        <code class="varname">parts</code>
       </span></dt><dd><p>
         Function argument
        </p></dd></dl></div><div class="example"><a id="idm139978170328688"></a><p class="title"><strong>Example 7.129. <code class="function">lib.options.showOption</code> usage example</strong></p><div class="example-contents"><pre class="programlisting">
(showOption ["foo" "bar" "baz"]) == "foo.bar.baz"
(showOption ["foo" "bar.baz" "tux"]) == "foo.\"bar.baz\".tux"
</pre></div></div><br class="example-break" /><p><a id="lib.options.showOption"></a>
      Located at
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/options.nix#L196" target="_top">lib/options.nix:196</a>
      in <code class="literal">&lt;nixpkgs&gt;</code>.
     </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-overrides"></a>7.2. Overriding</h2></div></div></div><p>
    Sometimes one wants to override parts of <code class="literal">nixpkgs</code>, e.g.
    derivation attributes, the results of derivations.
   </p><p>
    These functions are used to make changes to packages, returning only single
    packages. <a class="link" href="#chap-overlays" title="Chapter 12. Overlays">Overlays</a>, on the other
    hand, can be used to combine the overridden packages across the entire
    package set of Nixpkgs.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkg-override"></a>7.2.1. &lt;pkg&gt;.override</h3></div></div></div><p>
     The function <code class="varname">override</code> is usually available for all the
     derivations in the nixpkgs expression (<code class="varname">pkgs</code>).
    </p><p>
     It is used to override the arguments passed to a function.
    </p><p>
     Example usages:
</p><pre class="programlisting">pkgs.foo.override { arg1 = val1; arg2 = val2; ... }</pre><p>

</p><pre class="programlisting">
import pkgs.path { overlays = [ (self: super: {
  foo = super.foo.override { barSupport = true ; };
  })]};
</pre><p>
</p><pre class="programlisting">
mypkg = pkgs.callPackage ./mypkg.nix {
  mydep = pkgs.mydep.override { ... };
  }
</pre><p>
    </p><p>
     In the first example, <code class="varname">pkgs.foo</code> is the result of a
     function call with some default arguments, usually a derivation. Using
     <code class="varname">pkgs.foo.override</code> will call the same function with the
     given new arguments.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkg-overrideAttrs"></a>7.2.2. &lt;pkg&gt;.overrideAttrs</h3></div></div></div><p>
     The function <code class="varname">overrideAttrs</code> allows overriding the
     attribute set passed to a <code class="varname">stdenv.mkDerivation</code> call,
     producing a new derivation based on the original one. This function is
     available on all derivations produced by the
     <code class="varname">stdenv.mkDerivation</code> function, which is most packages in
     the nixpkgs expression <code class="varname">pkgs</code>.
    </p><p>
     Example usage:
</p><pre class="programlisting">
helloWithDebug = pkgs.hello.overrideAttrs (oldAttrs: rec {
  separateDebugInfo = true;
});
</pre><p>
    </p><p>
     In the above example, the <code class="varname">separateDebugInfo</code> attribute
     is overridden to be true, thus building debug info for
     <code class="varname">helloWithDebug</code>, while all other attributes will be
     retained from the original <code class="varname">hello</code> package.
    </p><p>
     The argument <code class="varname">oldAttrs</code> is conventionally used to refer
     to the attr set originally passed to
     <code class="varname">stdenv.mkDerivation</code>.
    </p><div class="note"><h3 class="title">Note</h3><p>
      Note that <code class="varname">separateDebugInfo</code> is processed only by the
      <code class="varname">stdenv.mkDerivation</code> function, not the generated, raw
      Nix derivation. Thus, using <code class="varname">overrideDerivation</code> will
      not work in this case, as it overrides only the attributes of the final
      derivation. It is for this reason that <code class="varname">overrideAttrs</code>
      should be preferred in (almost) all cases to
      <code class="varname">overrideDerivation</code>, i.e. to allow using
      <code class="varname">stdenv.mkDerivation</code> to process input arguments, as
      well as the fact that it is easier to use (you can use the same attribute
      names you see in your Nix code, instead of the ones generated (e.g.
      <code class="varname">buildInputs</code> vs <code class="varname">nativeBuildInputs</code>),
      and it involves less typing).
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkg-overrideDerivation"></a>7.2.3. &lt;pkg&gt;.overrideDerivation</h3></div></div></div><div class="warning"><h3 class="title">Warning</h3><p>
      You should prefer <code class="varname">overrideAttrs</code> in almost all cases,
      see its documentation for the reasons why.
      <code class="varname">overrideDerivation</code> is not deprecated and will continue
      to work, but is less nice to use and does not have as many abilities as
      <code class="varname">overrideAttrs</code>.
     </p></div><div class="warning"><h3 class="title">Warning</h3><p>
      Do not use this function in Nixpkgs as it evaluates a Derivation before
      modifying it, which breaks package abstraction and removes error-checking
      of function arguments. In addition, this evaluation-per-function
      application incurs a performance penalty, which can become a problem if
      many overrides are used. It is only intended for ad-hoc customisation,
      such as in <code class="filename">~/.config/nixpkgs/config.nix</code>.
     </p></div><p>
     The function <code class="varname">overrideDerivation</code> creates a new
     derivation based on an existing one by overriding the original's
     attributes with the attribute set produced by the specified function. This
     function is available on all derivations defined using the
     <code class="varname">makeOverridable</code> function. Most standard
     derivation-producing functions, such as
     <code class="varname">stdenv.mkDerivation</code>, are defined using this function,
     which means most packages in the nixpkgs expression,
     <code class="varname">pkgs</code>, have this function.
    </p><p>
     Example usage:
</p><pre class="programlisting">
mySed = pkgs.gnused.overrideDerivation (oldAttrs: {
  name = "sed-4.2.2-pre";
  src = fetchurl {
    url = ftp://alpha.gnu.org/gnu/sed/sed-4.2.2-pre.tar.bz2;
    sha256 = "11nq06d131y4wmf3drm0yk502d2xc6n5qy82cg88rb9nqd2lj41k";
  };
  patches = [];
});
</pre><p>
    </p><p>
     In the above example, the <code class="varname">name</code>, <code class="varname">src</code>,
     and <code class="varname">patches</code> of the derivation will be overridden, while
     all other attributes will be retained from the original derivation.
    </p><p>
     The argument <code class="varname">oldAttrs</code> is used to refer to the attribute
     set of the original derivation.
    </p><div class="note"><h3 class="title">Note</h3><p>
      A package's attributes are evaluated *before* being modified by the
      <code class="varname">overrideDerivation</code> function. For example, the
      <code class="varname">name</code> attribute reference in <code class="varname">url =
      "mirror://gnu/hello/${name}.tar.gz";</code> is filled-in *before* the
      <code class="varname">overrideDerivation</code> function modifies the attribute
      set. This means that overriding the <code class="varname">name</code> attribute, in
      this example, *will not* change the value of the <code class="varname">url</code>
      attribute. Instead, we need to override both the <code class="varname">name</code>
      *and* <code class="varname">url</code> attributes.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-lib-makeOverridable"></a>7.2.4. lib.makeOverridable</h3></div></div></div><p>
     The function <code class="varname">lib.makeOverridable</code> is used to make the
     result of a function easily customizable. This utility only makes sense
     for functions that accept an argument set and return an attribute set.
    </p><p>
     Example usage:
</p><pre class="programlisting">
f = { a, b }: { result = a+b; };
c = lib.makeOverridable f { a = 1; b = 2; };
</pre><p>
    </p><p>
     The variable <code class="varname">c</code> is the value of the <code class="varname">f</code>
     function applied with some default arguments. Hence the value of
     <code class="varname">c.result</code> is <code class="literal">3</code>, in this example.
    </p><p>
     The variable <code class="varname">c</code> however also has some additional
     functions, like <a class="link" href="#sec-pkg-override" title="7.2.1. &lt;pkg&gt;.override">c.override</a> which
     can be used to override the default arguments. In this example the value
     of <code class="varname">(c.override { a = 4; }).result</code> is 6.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-generators"></a>7.3. Generators</h2></div></div></div><p>
    Generators are functions that create file formats from nix data structures,
    e. g. for configuration files. There are generators available for:
    <code class="literal">INI</code>, <code class="literal">JSON</code> and <code class="literal">YAML</code>
   </p><p>
    All generators follow a similar call interface: <code class="code">generatorName
    configFunctions data</code>, where <code class="literal">configFunctions</code> is an
    attrset of user-defined functions that format nested parts of the content.
    They each have common defaults, so often they do not need to be set
    manually. An example is <code class="code">mkSectionName ? (name: libStr.escape [ "["
    "]" ] name)</code> from the <code class="literal">INI</code> generator. It receives
    the name of a section and sanitizes it. The default
    <code class="literal">mkSectionName</code> escapes <code class="literal">[</code> and
    <code class="literal">]</code> with a backslash.
   </p><p>
    Generators can be fine-tuned to produce exactly the file format required by
    your application/service. One example is an INI-file format which uses
    <code class="literal">: </code> as separator, the strings
    <code class="literal">"yes"</code>/<code class="literal">"no"</code> as boolean values and
    requires all string values to be quoted:
   </p><pre class="programlisting">
with lib;
let
  customToINI = generators.toINI {
    # specifies how to format a key/value pair
    mkKeyValue = generators.mkKeyValueDefault {
      # specifies the generated string for a subset of nix values
      mkValueString = v:
             if v == true then ''"yes"''
        else if v == false then ''"no"''
        else if isString v then ''"${v}"''
        # and delegats all other values to the default generator
        else generators.mkValueStringDefault {} v;
    } ":";
  };

# the INI file can now be given as plain old nix values
in customToINI {
  main = {
    pushinfo = true;
    autopush = false;
    host = "localhost";
    port = 42;
  };
  mergetool = {
    merge = "diff3";
  };
}
</pre><p>
    This will produce the following INI file as nix string:
   </p><pre class="programlisting">
[main]
autopush:"no"
host:"localhost"
port:42
pushinfo:"yes"
str\:ange:"very::strange"

[mergetool]
merge:"diff3"
</pre><div class="note"><h3 class="title">Note</h3><p>
     Nix store paths can be converted to strings by enclosing a derivation
     attribute like so: <code class="code">"${drv}"</code>.
    </p></div><p>
    Detailed documentation for each generator can be found in
    <code class="literal">lib/generators.nix</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-debug"></a>7.4. Debugging Nix Expressions</h2></div></div></div><p>
    Nix is a unityped, dynamic language, this means every value can potentially
    appear anywhere. Since it is also non-strict, evaluation order and what
    ultimately is evaluated might surprise you. Therefore it is important to be
    able to debug nix expressions.
   </p><p>
    In the <code class="literal">lib/debug.nix</code> file you will find a number of
    functions that help (pretty-)printing values while evaluation is runnnig.
    You can even specify how deep these values should be printed recursively,
    and transform them on the fly. Please consult the docstrings in
    <code class="literal">lib/debug.nix</code> for usage information.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-pkgs-fetchers"></a>7.5. Fetcher functions</h2></div></div></div><p>
    When using Nix, you will frequently need to download source code and other
    files from the internet. Nixpkgs comes with a few helper functions that
    allow you to fetch fixed-output derivations in a structured way.
   </p><p>
    The two fetcher primitives are <code class="function">fetchurl</code> and
    <code class="function">fetchzip</code>. Both of these have two required arguments, a
    URL and a hash. The hash is typically <code class="literal">sha256</code>, although
    many more hash algorithms are supported. Nixpkgs contributors are currently
    recommended to use <code class="literal">sha256</code>. This hash will be used by Nix
    to identify your source. A typical usage of fetchurl is provided below.
   </p><pre class="programlisting">
{ stdenv, fetchurl }:

stdenv.mkDerivation {
  name = "hello";
  src = fetchurl {
    url = "http://www.example.org/hello.tar.gz";
    sha256 = "1111111111111111111111111111111111111111111111111111";
  };
}
</pre><p>
    The main difference between <code class="function">fetchurl</code> and
    <code class="function">fetchzip</code> is in how they store the contents.
    <code class="function">fetchurl</code> will store the unaltered contents of the URL
    within the Nix store. <code class="function">fetchzip</code> on the other hand will
    decompress the archive for you, making files and directories directly
    accessible in the future. <code class="function">fetchzip</code> can only be used
    with archives. Despite the name, <code class="function">fetchzip</code> is not
    limited to .zip files and can also be used with any tarball.
   </p><p>
    <code class="function">fetchpatch</code> works very similarly to
    <code class="function">fetchurl</code> with the same arguments expected. It expects
    patch files as a source and and performs normalization on them before
    computing the checksum. For example it will remove comments or other
    unstable parts that are sometimes added by version control systems and can
    change over time.
   </p><p>
    Other fetcher functions allow you to add source code directly from a VCS
    such as subversion or git. These are mostly straightforward names based on
    the name of the command used with the VCS system. Because they give you a
    working repository, they act most like <code class="function">fetchzip</code>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">fetchsvn</code>
     </span></dt><dd><p>
       Used with Subversion. Expects <code class="literal">url</code> to a Subversion
       directory, <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchgit</code>
     </span></dt><dd><p>
       Used with Git. Expects <code class="literal">url</code> to a Git repo,
       <code class="literal">rev</code>, and <code class="literal">sha256</code>.
       <code class="literal">rev</code> in this case can be full the git commit id (SHA1
       hash) or a tag name like <code class="literal">refs/tags/v1.0</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchfossil</code>
     </span></dt><dd><p>
       Used with Fossil. Expects <code class="literal">url</code> to a Fossil archive,
       <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchcvs</code>
     </span></dt><dd><p>
       Used with CVS. Expects <code class="literal">cvsRoot</code>,
       <code class="literal">tag</code>, and <code class="literal">sha256</code>.
      </p></dd><dt><span class="term">
      <code class="literal">fetchhg</code>
     </span></dt><dd><p>
       Used with Mercurial. Expects <code class="literal">url</code>,
       <code class="literal">rev</code>, and <code class="literal">sha256</code>.
      </p></dd></dl></div><p>
    A number of fetcher functions wrap part of <code class="function">fetchurl</code>
    and <code class="function">fetchzip</code>. They are mainly convenience functions
    intended for commonly used destinations of source code in Nixpkgs. These
    wrapper fetchers are listed below.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">fetchFromGitHub</code>
     </span></dt><dd><p>
       <code class="function">fetchFromGitHub</code> expects four arguments.
       <code class="literal">owner</code> is a string corresponding to the GitHub user or
       organization that controls this repository. <code class="literal">repo</code>
       corresponds to the name of the software repository. These are located at
       the top of every GitHub HTML page as
       <code class="literal">owner</code>/<code class="literal">repo</code>. <code class="literal">rev</code>
       corresponds to the Git commit hash or tag (e.g <code class="literal">v1.0</code>)
       that will be downloaded from Git. Finally, <code class="literal">sha256</code>
       corresponds to the hash of the extracted directory. Again, other hash
       algorithms are also available but <code class="literal">sha256</code> is currently
       preferred.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromGitLab</code>
     </span></dt><dd><p>
       This is used with GitLab repositories. The arguments expected are very
       similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromBitbucket</code>
     </span></dt><dd><p>
       This is used with BitBucket repositories. The arguments expected are
       very similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromSavannah</code>
     </span></dt><dd><p>
       This is used with Savannah repositories. The arguments expected are very
       similar to fetchFromGitHub above.
      </p></dd><dt><span class="term">
      <code class="literal">fetchFromRepoOrCz</code>
     </span></dt><dd><p>
       This is used with repo.or.cz repositories. The arguments expected are
       very similar to fetchFromGitHub above.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-trivial-builders"></a>7.6. Trivial builders</h2></div></div></div><p>
    Nixpkgs provides a couple of functions that help with building derivations.
    The most important one, <code class="function">stdenv.mkDerivation</code>, has
    already been documented above. The following functions wrap
    <code class="function">stdenv.mkDerivation</code>, making it easier to use in
    certain cases.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">runCommand</code>
     </span></dt><dd><p>
       This takes three arguments, <code class="literal">name</code>,
       <code class="literal">env</code>, and <code class="literal">buildCommand</code>.
       <code class="literal">name</code> is just the name that Nix will append to the
       store path in the same way that <code class="literal">stdenv.mkDerivation</code>
       uses its <code class="literal">name</code> attribute. <code class="literal">env</code> is an
       attribute set specifying environment variables that will be set for this
       derivation. These attributes are then passed to the wrapped
       <code class="literal">stdenv.mkDerivation</code>. <code class="literal">buildCommand</code>
       specifies the commands that will be run to create this derivation. Note
       that you will need to create <code class="literal">$out</code> for Nix to register
       the command as successful.
      </p><p>
       An example of using <code class="literal">runCommand</code> is provided below.
      </p><pre class="programlisting">
       (import &lt;nixpkgs&gt; {}).runCommand "my-example" {} ''
         echo My example command is running

         mkdir $out

         echo I can write data to the Nix store &gt; $out/message

         echo I can also run basic commands like:

         echo ls
         ls

         echo whoami
         whoami

         echo date
         date
       ''
     </pre></dd><dt><span class="term">
      <code class="literal">runCommandCC</code>
     </span></dt><dd><p>
       This works just like <code class="literal">runCommand</code>. The only difference
       is that it also provides a C compiler in
       <code class="literal">buildCommand</code>’s environment. To minimize your
       dependencies, you should only use this if you are sure you will need a C
       compiler as part of running your command.
      </p></dd><dt><span class="term">
      <code class="literal">writeTextFile</code>, <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>, <code class="literal">writeScript</code>, <code class="literal">writeScriptBin</code>
     </span></dt><dd><p>
       These functions write <code class="literal">text</code> to the Nix store. This is
       useful for creating scripts from Nix expressions.
       <code class="literal">writeTextFile</code> takes an attribute set and expects two
       arguments, <code class="literal">name</code> and <code class="literal">text</code>.
       <code class="literal">name</code> corresponds to the name used in the Nix store
       path. <code class="literal">text</code> will be the contents of the file. You can
       also set <code class="literal">executable</code> to true to make this file have
       the executable bit set.
      </p><p>
       Many more commands wrap <code class="literal">writeTextFile</code> including
       <code class="literal">writeText</code>, <code class="literal">writeTextDir</code>,
       <code class="literal">writeScript</code>, and <code class="literal">writeScriptBin</code>.
       These are convenience functions over <code class="literal">writeTextFile</code>.
      </p></dd><dt><span class="term">
      <code class="literal">symlinkJoin</code>
     </span></dt><dd><p>
       This can be used to put many derivations into the same directory
       structure. It works by creating a new derivation and adding symlinks to
       each of the paths listed. It expects two arguments,
       <code class="literal">name</code>, and <code class="literal">paths</code>.
       <code class="literal">name</code> is the name used in the Nix store path for the
       created derivation. <code class="literal">paths</code> is a list of paths that
       will be symlinked. These paths can be to Nix store derivations or any
       other subdirectory contained within.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-fhs-environments"></a>7.7. buildFHSUserEnv</h2></div></div></div><p>
    <code class="function">buildFHSUserEnv</code> provides a way to build and run
    FHS-compatible lightweight sandboxes. It creates an isolated root with
    bound <code class="filename">/nix/store</code>, so its footprint in terms of disk
    space needed is quite small. This allows one to run software which is hard
    or unfeasible to patch for NixOS -- 3rd-party source trees with FHS
    assumptions, games distributed as tarballs, software with integrity
    checking and/or external self-updated binaries. It uses Linux namespaces
    feature to create temporary lightweight environments which are destroyed
    after all child processes exit, without root user rights requirement.
    Accepted arguments are:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="literal">name</code>
     </span></dt><dd><p>
       Environment name.
      </p></dd><dt><span class="term">
      <code class="literal">targetPkgs</code>
     </span></dt><dd><p>
       Packages to be installed for the main host's architecture (i.e. x86_64
       on x86_64 installations). Along with libraries binaries are also
       installed.
      </p></dd><dt><span class="term">
      <code class="literal">multiPkgs</code>
     </span></dt><dd><p>
       Packages to be installed for all architectures supported by a host (i.e.
       i686 and x86_64 on x86_64 installations). Only libraries are installed
       by default.
      </p></dd><dt><span class="term">
      <code class="literal">extraBuildCommands</code>
     </span></dt><dd><p>
       Additional commands to be executed for finalizing the directory
       structure.
      </p></dd><dt><span class="term">
      <code class="literal">extraBuildCommandsMulti</code>
     </span></dt><dd><p>
       Like <code class="literal">extraBuildCommands</code>, but executed only on
       multilib architectures.
      </p></dd><dt><span class="term">
      <code class="literal">extraOutputsToInstall</code>
     </span></dt><dd><p>
       Additional derivation outputs to be linked for both target and
       multi-architecture packages.
      </p></dd><dt><span class="term">
      <code class="literal">extraInstallCommands</code>
     </span></dt><dd><p>
       Additional commands to be executed for finalizing the derivation with
       runner script.
      </p></dd><dt><span class="term">
      <code class="literal">runScript</code>
     </span></dt><dd><p>
       A command that would be executed inside the sandbox and passed all the
       command line arguments. It defaults to <code class="literal">bash</code>.
      </p></dd></dl></div><p>
    One can create a simple environment using a <code class="literal">shell.nix</code>
    like that:
   </p><pre class="programlisting">
{ pkgs ? import &lt;nixpkgs&gt; {} }:

(pkgs.buildFHSUserEnv {
  name = "simple-x11-env";
  targetPkgs = pkgs: (with pkgs;
    [ udev
      alsaLib
    ]) ++ (with pkgs.xorg;
    [ libX11
      libXcursor
      libXrandr
    ]);
  multiPkgs = pkgs: (with pkgs;
    [ udev
      alsaLib
    ]);
  runScript = "bash";
}).env
</pre><p>
    Running <code class="literal">nix-shell</code> would then drop you into a shell with
    these libraries and binaries available. You can use this to run
    closed-source applications which expect FHS structure without hassles:
    simply change <code class="literal">runScript</code> to the application path, e.g.
    <code class="filename">./bin/start.sh</code> -- relative paths are supported.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-pkgs-mkShell"></a>7.8. pkgs.mkShell</h2></div></div></div><p>
    <code class="function">pkgs.mkShell</code> is a special kind of derivation that is
    only useful when using it combined with <span class="command"><strong>nix-shell</strong></span>. It
    will in fact fail to instantiate when invoked with
    <span class="command"><strong>nix-build</strong></span>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkgs-mkShell-usage"></a>7.8.1. Usage</h3></div></div></div><pre class="programlisting">
{ pkgs ? import &lt;nixpkgs&gt; {} }:
pkgs.mkShell {
  # this will make all the build inputs from hello and gnutar
  # available to the shell environment
  inputsFrom = with pkgs; [ hello gnutar ];
  buildInputs = [ pkgs.gnumake ];
}
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-pkgs-dockerTools"></a>7.9. pkgs.dockerTools</h2></div></div></div><p>
    <code class="varname">pkgs.dockerTools</code> is a set of functions for creating and
    manipulating Docker images according to the
    <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#docker-image-specification-v120" target="_top">
    Docker Image Specification v1.2.0 </a>. Docker itself is not used to
    perform any of the operations done by these functions.
   </p><div class="warning"><h3 class="title">Warning</h3><p>
     The <code class="varname">dockerTools</code> API is unstable and may be subject to
     backwards-incompatible changes in the future.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-dockerTools-buildImage"></a>7.9.1. buildImage</h3></div></div></div><p>
     This function is analogous to the <span class="command"><strong>docker build</strong></span> command,
     in that it can be used to build a Docker-compatible repository tarball
     containing a single image with one or multiple layers. As such, the result
     is suitable for being loaded in Docker with <span class="command"><strong>docker
     load</strong></span>.
    </p><p>
     The parameters of <code class="varname">buildImage</code> with relative example
     values are described below:
    </p><div class="example"><a id="ex-dockerTools-buildImage"></a><p class="title"><strong>Example 7.130. Docker build</strong></p><div class="example-contents"><pre class="programlisting">
buildImage {
  name = "redis"; <a id="ex-dockerTools-buildImage-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  tag = "latest"; <a id="ex-dockerTools-buildImage-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>

  fromImage = someBaseImage; <a id="ex-dockerTools-buildImage-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
  fromImageName = null; <a id="ex-dockerTools-buildImage-4"></a><span><img src="images/callouts/4.svg" alt="4" border="0" /></span>
  fromImageTag = "latest"; <a id="ex-dockerTools-buildImage-5"></a><span><img src="images/callouts/5.svg" alt="5" border="0" /></span>

  contents = pkgs.redis; <a id="ex-dockerTools-buildImage-6"></a><span><img src="images/callouts/6.svg" alt="6" border="0" /></span>
  runAsRoot = '' <a id="ex-dockerTools-buildImage-runAsRoot"></a><span><img src="images/callouts/7.svg" alt="7" border="0" /></span>
    #!${pkgs.runtimeShell}
    mkdir -p /data
  '';

  config = { <a id="ex-dockerTools-buildImage-8"></a><span><img src="images/callouts/8.svg" alt="8" border="0" /></span>
    Cmd = [ "/bin/redis-server" ];
    WorkingDir = "/data";
    Volumes = {
      "/data" = {};
    };
  };
}
</pre></div></div><br class="example-break" /><p>
     The above example will build a Docker image
     <code class="literal">redis/latest</code> from the given base image. Loading and
     running this image in Docker results in <code class="literal">redis-server</code>
     being started automatically.
    </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">name</code> specifies the name of the resulting image. This
       is the only required argument for <code class="varname">buildImage</code>.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">tag</code> specifies the tag of the resulting image. By
       default it's <code class="literal">null</code>, which indicates that the nix
       output hash will be used as tag.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">fromImage</code> is the repository tarball containing the
       base image. It must be a valid Docker image, such as exported by
       <span class="command"><strong>docker save</strong></span>. By default it's <code class="literal">null</code>,
       which can be seen as equivalent to <code class="literal">FROM scratch</code> of a
       <code class="filename">Dockerfile</code>.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-4"><span><img src="images/callouts/4.svg" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">fromImageName</code> can be used to further specify the base
       image within the repository, in case it contains multiple images. By
       default it's <code class="literal">null</code>, in which case
       <code class="varname">buildImage</code> will peek the first image available in the
       repository.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-5"><span><img src="images/callouts/5.svg" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">fromImageTag</code> can be used to further specify the tag
       of the base image within the repository, in case an image contains
       multiple tags. By default it's <code class="literal">null</code>, in which case
       <code class="varname">buildImage</code> will peek the first tag available for the
       base image.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-6"><span><img src="images/callouts/6.svg" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">contents</code> is a derivation that will be copied in the
       new layer of the resulting image. This can be similarly seen as
       <span class="command"><strong>ADD contents/ /</strong></span> in a <code class="filename">Dockerfile</code>.
       By default it's <code class="literal">null</code>.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-runAsRoot"><span><img src="images/callouts/7.svg" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">runAsRoot</code> is a bash script that will run as root in
       an environment that overlays the existing layers of the base image with
       the new resulting layer, including the previously copied
       <code class="varname">contents</code> derivation. This can be similarly seen as
       <span class="command"><strong>RUN ...</strong></span> in a <code class="filename">Dockerfile</code>.
       </p><div class="note"><h3 class="title">Note</h3><p>
         Using this parameter requires the <code class="literal">kvm</code> device to be
         available.
        </p></div><p>
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-buildImage-8"><span><img src="images/callouts/8.svg" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">config</code> is used to specify the configuration of the
       containers that will be started off the built image in Docker. The
       available options are listed in the
       <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top">
       Docker Image Specification v1.2.0 </a>.
      </p></td></tr></table></div><p>
     After the new layer has been created, its closure (to which
     <code class="varname">contents</code>, <code class="varname">config</code> and
     <code class="varname">runAsRoot</code> contribute) will be copied in the layer
     itself. Only new dependencies that are not already in the existing layers
     will be copied.
    </p><p>
     At the end of the process, only one new single layer will be produced and
     added to the resulting image.
    </p><p>
     The resulting repository will only list the single image
     <code class="varname">image/tag</code>. In the case of
     <a class="xref" href="#ex-dockerTools-buildImage" title="Example 7.130. Docker build">Example 7.130, “Docker build”</a> it would be
     <code class="varname">redis/latest</code>.
    </p><p>
     It is possible to inspect the arguments with which an image was built
     using its <code class="varname">buildArgs</code> attribute.
    </p><div class="note"><h3 class="title">Note</h3><p>
      If you see errors similar to <code class="literal">getProtocolByName: does not exist
      (no such protocol name: tcp)</code> you may need to add
      <code class="literal">pkgs.iana-etc</code> to <code class="varname">contents</code>.
     </p></div><div class="note"><h3 class="title">Note</h3><p>
      If you see errors similar to <code class="literal">Error_Protocol ("certificate has
      unknown CA",True,UnknownCa)</code> you may need to add
      <code class="literal">pkgs.cacert</code> to <code class="varname">contents</code>.
     </p></div><div class="example"><a id="example-pkgs-dockerTools-buildImage-creation-date"></a><p class="title"><strong>Example 7.131. Impurely Defining a Docker Layer's Creation Date</strong></p><div class="example-contents"><p>
      By default <code class="function">buildImage</code> will use a static date of one
      second past the UNIX Epoch. This allows <code class="function">buildImage</code>
      to produce binary reproducible images. When listing images with
      <span class="command"><strong>docker images</strong></span>, the newly created images will be listed
      like this:
     </p><pre class="screen">
$ docker images
REPOSITORY   TAG      IMAGE ID       CREATED        SIZE
hello        latest   08c791c7846e   48 years ago   25.2MB
</pre><p>
      You can break binary reproducibility but have a sorted, meaningful
      <code class="literal">CREATED</code> column by setting <code class="literal">created</code>
      to <code class="literal">now</code>.
     </p><pre class="programlisting">
pkgs.dockerTools.buildImage {
  name = "hello";
  tag = "latest";
  created = "now";
  contents = pkgs.hello;

  config.Cmd = [ "/bin/hello" ];
}
</pre><p>
      and now the Docker CLI will display a reasonable date and sort the images
      as expected:
</p><pre class="screen">
$ docker images
REPOSITORY   TAG      IMAGE ID       CREATED              SIZE
hello        latest   de2bf4786de6   About a minute ago   25.2MB
</pre><p>
      however, the produced images will not be binary reproducible.
     </p></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-dockerTools-buildLayeredImage"></a>7.9.2. buildLayeredImage</h3></div></div></div><p>
     Create a Docker image with many of the store paths being on their own
     layer to improve sharing between images.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">name</code>
      </span></dt><dd><p>
        The name of the resulting image.
       </p></dd><dt><span class="term">
       <code class="varname">tag</code> <span class="emphasis"><em>optional</em></span>
      </span></dt><dd><p>
        Tag of the generated image.
       </p><p>
        <span class="emphasis"><em>Default:</em></span> the output path's hash
       </p></dd><dt><span class="term">
       <code class="varname">contents</code> <span class="emphasis"><em>optional</em></span>
      </span></dt><dd><p>
        Top level paths in the container. Either a single derivation, or a list
        of derivations.
       </p><p>
        <span class="emphasis"><em>Default:</em></span> <code class="literal">[]</code>
       </p></dd><dt><span class="term">
       <code class="varname">config</code> <span class="emphasis"><em>optional</em></span>
      </span></dt><dd><p>
        Run-time configuration of the container. A full list of the options are
        available at in the
        <a class="link" href="https://github.com/moby/moby/blob/master/image/spec/v1.2.md#image-json-field-descriptions" target="_top">
        Docker Image Specification v1.2.0 </a>.
       </p><p>
        <span class="emphasis"><em>Default:</em></span> <code class="literal">{}</code>
       </p></dd><dt><span class="term">
       <code class="varname">created</code> <span class="emphasis"><em>optional</em></span>
      </span></dt><dd><p>
        Date and time the layers were created. Follows the same
        <code class="literal">now</code> exception supported by
        <code class="literal">buildImage</code>.
       </p><p>
        <span class="emphasis"><em>Default:</em></span> <code class="literal">1970-01-01T00:00:01Z</code>
       </p></dd><dt><span class="term">
       <code class="varname">maxLayers</code> <span class="emphasis"><em>optional</em></span>
      </span></dt><dd><p>
        Maximum number of layers to create.
       </p><p>
        <span class="emphasis"><em>Default:</em></span> <code class="literal">24</code>
       </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-contents"></a>7.9.2.1. Behavior of <code class="varname">contents</code> in the final image</h4></div></div></div><p>
      Each path directly listed in <code class="varname">contents</code> will have a
      symlink in the root of the image.
     </p><p>
      For example:
</p><pre class="programlisting">
pkgs.dockerTools.buildLayeredImage {
  name = "hello";
  contents = [ pkgs.hello ];
}
</pre><p>
      will create symlinks for all the paths in the <code class="literal">hello</code>
      package:
</p><pre class="screen">
/bin/hello -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/bin/hello
/share/info/hello.info -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/info/hello.info
/share/locale/bg/LC_MESSAGES/hello.mo -&gt; /nix/store/h1zb1padqbbb7jicsvkmrym3r6snphxg-hello-2.10/share/locale/bg/LC_MESSAGES/hello.mo
</pre><p>
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-config"></a>7.9.2.2. Automatic inclusion of <code class="varname">config</code> references</h4></div></div></div><p>
      The closure of <code class="varname">config</code> is automatically included in the
      closure of the final image.
     </p><p>
      This allows you to make very simple Docker images with very little code.
      This container will start up and run <span class="command"><strong>hello</strong></span>:
</p><pre class="programlisting">
pkgs.dockerTools.buildLayeredImage {
  name = "hello";
  config.Cmd = [ "${pkgs.hello}/bin/hello" ];
}
</pre><p>
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="dockerTools-buildLayeredImage-arg-maxLayers"></a>7.9.2.3. Adjusting <code class="varname">maxLayers</code></h4></div></div></div><p>
      Increasing the <code class="varname">maxLayers</code> increases the number of
      layers which have a chance to be shared between different images.
     </p><p>
      Modern Docker installations support up to 128 layers, however older
      versions support as few as 42.
     </p><p>
      If the produced image will not be extended by other Docker builds, it is
      safe to set <code class="varname">maxLayers</code> to <code class="literal">128</code>.
      However it will be impossible to extend the image further.
     </p><p>
      The first (<code class="literal">maxLayers-2</code>) most "popular" paths will have
      their own individual layers, then layer #<code class="literal">maxLayers-1</code>
      will contain all the remaining "unpopular" paths, and finally layer
      #<code class="literal">maxLayers</code> will contain the Image configuration.
     </p><p>
      Docker's Layers are not inherently ordered, they are content-addressable
      and are not explicitly layered until they are composed in to an Image.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-dockerTools-fetchFromRegistry"></a>7.9.3. pullImage</h3></div></div></div><p>
     This function is analogous to the <span class="command"><strong>docker pull</strong></span> command,
     in that it can be used to pull a Docker image from a Docker registry. By
     default <a class="link" href="https://hub.docker.com/" target="_top">Docker Hub</a> is
     used to pull images.
    </p><p>
     Its parameters are described in the example below:
    </p><div class="example"><a id="ex-dockerTools-pullImage"></a><p class="title"><strong>Example 7.132. Docker pull</strong></p><div class="example-contents"><pre class="programlisting">
pullImage {
  imageName = "nixos/nix"; <a id="ex-dockerTools-pullImage-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  imageDigest = "sha256:20d9485b25ecfd89204e843a962c1bd70e9cc6858d65d7f5fadc340246e2116b"; <a id="ex-dockerTools-pullImage-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
  finalImageTag = "1.11";  <a id="ex-dockerTools-pullImage-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
  sha256 = "0mqjy3zq2v6rrhizgb9nvhczl87lcfphq9601wcprdika2jz7qh8"; <a id="ex-dockerTools-pullImage-4"></a><span><img src="images/callouts/4.svg" alt="4" border="0" /></span>
  os = "linux"; <a id="ex-dockerTools-pullImage-5"></a><span><img src="images/callouts/5.svg" alt="5" border="0" /></span>
  arch = "x86_64"; <a id="ex-dockerTools-pullImage-6"></a><span><img src="images/callouts/6.svg" alt="6" border="0" /></span>
}
</pre></div></div><br class="example-break" /><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">imageName</code> specifies the name of the image to be
       downloaded, which can also include the registry namespace (e.g.
       <code class="literal">nixos</code>). This argument is required.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">imageDigest</code> specifies the digest of the image to be
       downloaded. Skopeo can be used to get the digest of an image, with its
       <code class="varname">inspect</code> subcommand. Since a given
       <code class="varname">imageName</code> may transparently refer to a manifest list
       of images which support multiple architectures and/or operating systems,
       supply the `--override-os` and `--override-arch` arguments to specify
       exactly which image you want. By default it will match the OS and
       architecture of the host the command is run on.
</p><pre class="programlisting">
$ nix-shell --packages skopeo jq --command "skopeo --override-os linux --override-arch x86_64 inspect docker://docker.io/nixos/nix:1.11 | jq -r '.Digest'"
sha256:20d9485b25ecfd89204e843a962c1bd70e9cc6858d65d7f5fadc340246e2116b
</pre><p>
       This argument is required.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">finalImageTag</code>, if specified, this is the tag of the
       image to be created. Note it is never used to fetch the image since we
       prefer to rely on the immutable digest ID. By default it's
       <code class="literal">latest</code>.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-4"><span><img src="images/callouts/4.svg" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">sha256</code> is the checksum of the whole fetched image.
       This argument is required.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-5"><span><img src="images/callouts/5.svg" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">os</code>, if specified, is the operating system of the
       fetched image. By default it's <code class="literal">linux</code>.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-dockerTools-pullImage-6"><span><img src="images/callouts/6.svg" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">arch</code>, if specified, is the cpu architecture of the
       fetched image. By default it's <code class="literal">x86_64</code>.
      </p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-dockerTools-exportImage"></a>7.9.4. exportImage</h3></div></div></div><p>
     This function is analogous to the <span class="command"><strong>docker export</strong></span>
     command, in that it can be used to flatten a Docker image that contains
     multiple layers. It is in fact the result of the merge of all the layers
     of the image. As such, the result is suitable for being imported in Docker
     with <span class="command"><strong>docker import</strong></span>.
    </p><div class="note"><h3 class="title">Note</h3><p>
      Using this function requires the <code class="literal">kvm</code> device to be
      available.
     </p></div><p>
     The parameters of <code class="varname">exportImage</code> are the following:
    </p><div class="example"><a id="ex-dockerTools-exportImage"></a><p class="title"><strong>Example 7.133. Docker export</strong></p><div class="example-contents"><pre class="programlisting">
exportImage {
  fromImage = someLayeredImage;
  fromImageName = null;
  fromImageTag = null;

  name = someLayeredImage.name;
}
  </pre></div></div><br class="example-break" /><p>
     The parameters relative to the base image have the same synopsis as
     described in <a class="xref" href="#ssec-pkgs-dockerTools-buildImage" title="7.9.1. buildImage">Section 7.9.1, “buildImage”</a>, except
     that <code class="varname">fromImage</code> is the only required argument in this
     case.
    </p><p>
     The <code class="varname">name</code> argument is the name of the derivation output,
     which defaults to <code class="varname">fromImage.name</code>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-dockerTools-shadowSetup"></a>7.9.5. shadowSetup</h3></div></div></div><p>
     This constant string is a helper for setting up the base files for
     managing users and groups, only if such files don't exist already. It is
     suitable for being used in a <code class="varname">runAsRoot</code>
     <a class="xref" href="#ex-dockerTools-buildImage-runAsRoot"><span><img src="images/callouts/7.svg" alt="7" border="0" /></span></a> script for cases
     like in the example below:
    </p><div class="example"><a id="ex-dockerTools-shadowSetup"></a><p class="title"><strong>Example 7.134. Shadow base files</strong></p><div class="example-contents"><pre class="programlisting">
buildImage {
  name = "shadow-basic";

  runAsRoot = ''
    #!${pkgs.runtimeShell}
    ${shadowSetup}
    groupadd -r redis
    useradd -r -g redis redis
    mkdir /data
    chown redis:redis /data
  '';
}
</pre></div></div><br class="example-break" /><p>
     Creating base files like <code class="literal">/etc/passwd</code> or
     <code class="literal">/etc/login.defs</code> is necessary for shadow-utils to
     manipulate users and groups.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-pkgs-appimageTools"></a>7.10. pkgs.appimageTools</h2></div></div></div><p>
    <code class="varname">pkgs.appimageTools</code> is a set of functions for extracting
    and wrapping <a class="link" href="https://appimage.org/" target="_top">AppImage</a>
    files. They are meant to be used if traditional packaging from source is
    infeasible, or it would take too long. To quickly run an AppImage file,
    <code class="literal">pkgs.appimage-run</code> can be used as well.
   </p><div class="warning"><h3 class="title">Warning</h3><p>
     The <code class="varname">appimageTools</code> API is unstable and may be subject to
     backwards-incompatible changes in the future.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-appimageTools-formats"></a>7.10.1. AppImage formats</h3></div></div></div><p>
     There are different formats for AppImages, see
     <a class="link" href="https://github.com/AppImage/AppImageSpec/blob/74ad9ca2f94bf864a4a0dac1f369dd4f00bd1c28/draft.md#image-format" target="_top">the
     specification</a> for details.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Type 1 images are ISO 9660 files that are also ELF executables.
      </p></li><li class="listitem"><p>
       Type 2 images are ELF executables with an appended filesystem.
      </p></li></ul></div><p>
     They can be told apart with <span class="command"><strong>file -k</strong></span>:
    </p><pre class="screen">
<code class="prompt">$ </code>file -k type1.AppImage
type1.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) ISO 9660 CD-ROM filesystem data 'AppImage' (Lepton 3.x), scale 0-0,
spot sensor temperature 0.000000, unit celsius, color scheme 0, calibration: offset 0.000000, slope 0.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.18, BuildID[sha1]=d629f6099d2344ad82818172add1d38c5e11bc6d, stripped\012- data

<code class="prompt">$ </code>file -k type2.AppImage
type2.AppImage: ELF 64-bit LSB executable, x86-64, version 1 (SYSV) (Lepton 3.x), scale 232-60668, spot sensor temperature -4.187500, color scheme 15, show scale bar, calibration: offset -0.000000, slope 0.000000 (Lepton 2.x), scale 4111-45000, spot sensor temperature 412442.250000, color scheme 3, minimum point enabled, calibration: offset -75402534979642766821519867692934234112.000000, slope 5815371847733706829839455140374904832.000000, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.18, BuildID[sha1]=79dcc4e55a61c293c5e19edbd8d65b202842579f, stripped\012- data
  </pre><p>
     Note how the type 1 AppImage is described as an <code class="literal">ISO 9660 CD-ROM
     filesystem</code>, and the type 2 AppImage is not.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-pkgs-appimageTools-wrapping"></a>7.10.2. Wrapping</h3></div></div></div><p>
     Depending on the type of AppImage you're wrapping, you'll have to use
     <code class="varname">wrapType1</code> or <code class="varname">wrapType2</code>.
    </p><pre class="programlisting">
appimageTools.wrapType2 { # or wrapType1
  name = "patchwork"; <a id="ex-appimageTools-wrapping-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  src = fetchurl { <a id="ex-appimageTools-wrapping-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
    url = https://github.com/ssbc/patchwork/releases/download/v3.11.4/Patchwork-3.11.4-linux-x86_64.AppImage;
    sha256 =  "1blsprpkvm0ws9b96gb36f0rbf8f5jgmw4x6dsb1kswr4ysf591s";
  };
  extraPkgs = pkgs: with pkgs; [ ]; <a id="ex-appimageTools-wrapping-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-appimageTools-wrapping-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">name</code> specifies the name of the resulting image.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-appimageTools-wrapping-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">src</code> specifies the AppImage file to extract.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-appimageTools-wrapping-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       <code class="varname">extraPkgs</code> allows you to pass a function to include
       additional packages inside the FHS environment your AppImage is going to
       run in. There are a few ways to learn which dependencies an application
       needs:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Looking through the extracted AppImage files, reading its scripts and
          running <span class="command"><strong>patchelf</strong></span> and <span class="command"><strong>ldd</strong></span> on its
          executables. This can also be done in
          <span class="command"><strong>appimage-run</strong></span>, by setting
          <span class="command"><strong>APPIMAGE_DEBUG_EXEC=bash</strong></span>.
         </p></li><li class="listitem"><p>
          Running <span class="command"><strong>strace -vfefile</strong></span> on the wrapped executable,
          looking for libraries that can't be found.
         </p></li></ul></div><p>
      </p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-prefer-remote-fetch"></a>7.11. prefer-remote-fetch overlay</h2></div></div></div><p>
    <code class="function">prefer-remote-fetch</code> is an overlay that download
    sources on remote builder. This is useful when the evaluating machine has a
    slow upload while the builder can fetch faster directly from the source. To
    use it, put the following snippet as a new overlay:
</p><pre class="programlisting">
    self: super:
      (super.prefer-remote-fetch self super)
  </pre><p>
    A full configuration example for that sets the overlay up for your own
    account, could look like this
</p><pre class="programlisting">
    $ mkdir ~/.config/nixpkgs/overlays/
    $ cat &gt; ~/.config/nixpkgs/overlays/prefer-remote-fetch.nix &lt;&lt;EOF
      self: super: super.prefer-remote-fetch self super
    EOF
  </pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-pkgs-nix-gitignore"></a>7.12. pkgs.nix-gitignore</h2></div></div></div><p>
    <code class="function">pkgs.nix-gitignore</code> is a function that acts similarly
    to <code class="literal">builtins.filterSource</code> but also allows filtering with
    the help of the gitignore format.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkgs-nix-gitignore-usage"></a>7.12.1. Usage</h3></div></div></div><p>
     <code class="literal">pkgs.nix-gitignore</code> exports a number of functions, but
     you'll most likely need either <code class="literal">gitignoreSource</code> or
     <code class="literal">gitignoreSourcePure</code>. As their first argument, they both
     accept either 1. a file with gitignore lines or 2. a string with gitignore
     lines, or 3. a list of either of the two. They will be concatenated into a
     single big string.
    </p><pre class="programlisting">
{ pkgs ? import &lt;nixpkgs&gt; {} }:

 nix-gitignore.gitignoreSource [] ./source
     # Simplest version

 nix-gitignore.gitignoreSource "supplemental-ignores\n" ./source
     # This one reads the ./source/.gitignore and concats the auxiliary ignores

 nix-gitignore.gitignoreSourcePure "ignore-this\nignore-that\n" ./source
     # Use this string as gitignore, don't read ./source/.gitignore.

 nix-gitignore.gitignoreSourcePure ["ignore-this\nignore-that\n", ~/.gitignore] ./source
     # It also accepts a list (of strings and paths) that will be concatenated
     # once the paths are turned to strings via readFile.
  </pre><p>
     These functions are derived from the <code class="literal">Filter</code> functions
     by setting the first filter argument to <code class="literal">(_: _: true)</code>:
    </p><pre class="programlisting">
gitignoreSourcePure = gitignoreFilterSourcePure (_: _: true);
gitignoreSource = gitignoreFilterSource (_: _: true);
  </pre><p>
     Those filter functions accept the same arguments the
     <code class="literal">builtins.filterSource</code> function would pass to its
     filters, thus <code class="literal">fn: gitignoreFilterSourcePure fn ""</code>
     should be extensionally equivalent to <code class="literal">filterSource</code>. The
     file is blacklisted iff it's blacklisted by either your filter or the
     gitignoreFilter.
    </p><p>
     If you want to make your own filter from scratch, you may use
    </p><pre class="programlisting">
gitignoreFilter = ign: root: filterPattern (gitignoreToPatterns ign) root;
  </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-pkgs-nix-gitignore-usage-recursive"></a>7.12.2. gitignore files in subdirectories</h3></div></div></div><p>
     If you wish to use a filter that would search for .gitignore files in
     subdirectories, just like git does by default, use this function:
    </p><pre class="programlisting">
gitignoreFilterRecursiveSource = filter: patterns: root:
# OR
gitignoreRecursiveSource = gitignoreFilterSourcePure (_: _: true);
  </pre></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-meta"></a>Chapter 8. Meta-attributes</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-standard-meta-attributes">8.1. Standard meta-attributes</a></span></dt><dt><span class="section"><a href="#sec-meta-license">8.2. Licenses</a></span></dt></dl></div><p>
   Nix packages can declare <span class="emphasis"><em>meta-attributes</em></span> that contain
   information about a package such as a description, its homepage, its
   license, and so on. For instance, the GNU Hello package has a
   <code class="varname">meta</code> declaration like this:
</p><pre class="programlisting">
meta = with stdenv.lib; {
  description = "A program that produces a familiar, friendly greeting";
  longDescription = ''
    GNU Hello is a program that prints "Hello, world!" when you run it.
    It is fully customizable.
  '';
  homepage = https://www.gnu.org/software/hello/manual/;
  license = licenses.gpl3Plus;
  maintainers = [ maintainers.eelco ];
  platforms = platforms.all;
};
</pre><p>
  </p><p>
   Meta-attributes are not passed to the builder of the package. Thus, a change
   to a meta-attribute doesn’t trigger a recompilation of the package.
   The value of a meta-attribute must be a string.
  </p><p>
   The meta-attributes of a package can be queried from the command-line using
   <span class="command"><strong>nix-env</strong></span>:
</p><pre class="screen">
$ nix-env -qa hello --json
{
    "hello": {
        "meta": {
            "description": "A program that produces a familiar, friendly greeting",
            "homepage": "https://www.gnu.org/software/hello/manual/",
            "license": {
                "fullName": "GNU General Public License version 3 or later",
                "shortName": "GPLv3+",
                "url": "http://www.fsf.org/licensing/licenses/gpl.html"
            },
            "longDescription": "GNU Hello is a program that prints \"Hello, world!\" when you run it.\nIt is fully customizable.\n",
            "maintainers": [
                "Ludovic Court\u00e8s &lt;ludo@gnu.org&gt;"
            ],
            "platforms": [
                "i686-linux",
                "x86_64-linux",
                "armv5tel-linux",
                "armv7l-linux",
                "mips32-linux",
                "x86_64-darwin",
                "i686-cygwin",
                "i686-freebsd",
                "x86_64-freebsd",
                "i686-openbsd",
                "x86_64-openbsd"
            ],
            "position": "/home/user/dev/nixpkgs/pkgs/applications/misc/hello/default.nix:14"
        },
        "name": "hello-2.9",
        "system": "x86_64-linux"
    }
}


</pre><p>
   <span class="command"><strong>nix-env</strong></span> knows about the <code class="varname">description</code>
   field specifically:
</p><pre class="screen">
$ nix-env -qa hello --description
hello-2.3  A program that produces a familiar, friendly greeting
</pre><p>
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-standard-meta-attributes"></a>8.1. Standard meta-attributes</h2></div></div></div><p>
    It is expected that each meta-attribute is one of the following:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
      <code class="varname">description</code>
     </span></dt><dd><p>
       A short (one-line) description of the package. This is shown by
       <span class="command"><strong>nix-env -q --description</strong></span> and also on the Nixpkgs
       release pages.
      </p><p>
       Don’t include a period at the end. Don’t include newline
       characters. Capitalise the first character. For brevity, don’t
       repeat the name of package — just describe what it does.
      </p><p>
       Wrong: <code class="literal">"libpng is a library that allows you to decode PNG
       images."</code>
      </p><p>
       Right: <code class="literal">"A library for decoding PNG images"</code>
      </p></dd><dt><span class="term">
      <code class="varname">longDescription</code>
     </span></dt><dd><p>
       An arbitrarily long description of the package.
      </p></dd><dt><span class="term">
      <code class="varname">branch</code>
     </span></dt><dd><p>
       Release branch. Used to specify that a package is not going to receive
       updates that are not in this branch; for example, Linux kernel 3.0 is
       supposed to be updated to 3.0.X, not 3.1.
      </p></dd><dt><span class="term">
      <code class="varname">homepage</code>
     </span></dt><dd><p>
       The package’s homepage. Example:
       <code class="literal">https://www.gnu.org/software/hello/manual/</code>
      </p></dd><dt><span class="term">
      <code class="varname">downloadPage</code>
     </span></dt><dd><p>
       The page where a link to the current version can be found. Example:
       <code class="literal">https://ftp.gnu.org/gnu/hello/</code>
      </p></dd><dt><span class="term">
      <code class="varname">license</code>
     </span></dt><dd><p>
       The license, or licenses, for the package. One from the attribute set
       defined in
       <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top">
       <code class="filename">nixpkgs/lib/licenses.nix</code></a>. At this moment
       using both a list of licenses and a single license is valid. If the
       license field is in the form of a list representation, then it means
       that parts of the package are licensed differently. Each license should
       preferably be referenced by their attribute. The non-list attribute
       value can also be a space delimited string representation of the
       contained attribute shortNames or spdxIds. The following are all valid
       examples:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Single license referenced by attribute (preferred)
          <code class="literal">stdenv.lib.licenses.gpl3</code>.
         </p></li><li class="listitem"><p>
          Single license referenced by its attribute shortName (frowned upon)
          <code class="literal">"gpl3"</code>.
         </p></li><li class="listitem"><p>
          Single license referenced by its attribute spdxId (frowned upon)
          <code class="literal">"GPL-3.0"</code>.
         </p></li><li class="listitem"><p>
          Multiple licenses referenced by attribute (preferred) <code class="literal">with
          stdenv.lib.licenses; [ asl20 free ofl ]</code>.
         </p></li><li class="listitem"><p>
          Multiple licenses referenced as a space delimited string of attribute
          shortNames (frowned upon) <code class="literal">"asl20 free ofl"</code>.
         </p></li></ul></div><p>
       For details, see <a class="xref" href="#sec-meta-license" title="8.2. Licenses">Section 8.2, “Licenses”</a>.
      </p></dd><dt><span class="term">
      <code class="varname">maintainers</code>
     </span></dt><dd><p>
       A list of names and e-mail addresses of the maintainers of this Nix
       expression. If you would like to be a maintainer of a package, you may
       want to add yourself to
       <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/maintainers/maintainer-list.nix" target="_top"><code class="filename">nixpkgs/maintainers/maintainer-list.nix</code></a>
       and write something like <code class="literal">[ stdenv.lib.maintainers.alice
       stdenv.lib.maintainers.bob ]</code>.
      </p></dd><dt><span class="term">
      <code class="varname">priority</code>
     </span></dt><dd><p>
       The <span class="emphasis"><em>priority</em></span> of the package, used by
       <span class="command"><strong>nix-env</strong></span> to resolve file name conflicts between
       packages. See the Nix manual page for <span class="command"><strong>nix-env</strong></span> for
       details. Example: <code class="literal">"10"</code> (a low-priority package).
      </p></dd><dt><span class="term">
      <code class="varname">platforms</code>
     </span></dt><dd><p>
       The list of Nix platform types on which the package is supported. Hydra
       builds packages according to the platform specified. If no platform is
       specified, the package does not have prebuilt binaries. An example is:
</p><pre class="programlisting">
meta.platforms = stdenv.lib.platforms.linux;
</pre><p>
       Attribute Set <code class="varname">stdenv.lib.platforms</code> defines
       <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/systems/doubles.nix" target="_top">
       various common lists</a> of platforms types.
      </p></dd><dt><span class="term">
      <code class="varname">tests</code>
     </span></dt><dd><div class="warning"><h3 class="title">Warning</h3><p>
        This attribute is special in that it is not actually under the
        <code class="literal">meta</code> attribute set but rather under the
        <code class="literal">passthru</code> attribute set. This is due to a current
        limitation of Nix, and will change as soon as Nixpkgs will be able to
        depend on a new enough version of Nix. See
        <a class="link" href="https://github.com/NixOS/nix/issues/2532" target="_top">the
        relevant issue</a> for more details.
       </p></div><p>
       An attribute set with as values tests. A test is a derivation, which
       builds successfully when the test passes, and fails to build otherwise.
       A derivation that is a test needs to have
       <code class="literal">meta.timeout</code> defined.
      </p><p>
       The NixOS tests are available as <code class="literal">nixosTests</code> in
       parameters of derivations. For instance, the OpenSMTPD derivation
       includes lines similar to:
</p><pre class="programlisting">
{ /* ... */, nixosTests }:
{
  # ...
  passthru.tests = {
    basic-functionality-and-dovecot-integration = nixosTests.opensmtpd;
  };
}
</pre><p>
      </p></dd><dt><span class="term">
      <code class="varname">timeout</code>
     </span></dt><dd><p>
       A timeout (in seconds) for building the derivation. If the derivation
       takes longer than this time to build, it can fail due to breaking the
       timeout. However, all computers do not have the same computing power,
       hence some builders may decide to apply a multiplicative factor to this
       value. When filling this value in, try to keep it approximately
       consistent with other values already present in
       <code class="literal">nixpkgs</code>.
      </p></dd><dt><span class="term">
      <code class="varname">hydraPlatforms</code>
     </span></dt><dd><p>
       The list of Nix platform types for which the Hydra instance at
       <code class="literal">hydra.nixos.org</code> will build the package. (Hydra is the
       Nix-based continuous build system.) It defaults to the value of
       <code class="varname">meta.platforms</code>. Thus, the only reason to set
       <code class="varname">meta.hydraPlatforms</code> is if you want
       <code class="literal">hydra.nixos.org</code> to build the package on a subset of
       <code class="varname">meta.platforms</code>, or not at all, e.g.
</p><pre class="programlisting">
meta.platforms = stdenv.lib.platforms.linux;
meta.hydraPlatforms = [];
</pre><p>
      </p></dd><dt><span class="term">
      <code class="varname">broken</code>
     </span></dt><dd><p>
       If set to <code class="literal">true</code>, the package is marked as
       “broken”, meaning that it won’t show up in
       <code class="literal">nix-env -qa</code>, and cannot be built or installed. Such
       packages should be removed from Nixpkgs eventually unless they are
       fixed.
      </p></dd><dt><span class="term">
      <code class="varname">updateWalker</code>
     </span></dt><dd><p>
       If set to <code class="literal">true</code>, the package is tested to be updated
       correctly by the <code class="literal">update-walker.sh</code> script without
       additional settings. Such packages have <code class="varname">meta.version</code>
       set and their homepage (or the page specified by
       <code class="varname">meta.downloadPage</code>) contains a direct link to the
       package tarball.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-meta-license"></a>8.2. Licenses</h2></div></div></div><p>
    The <code class="varname">meta.license</code> attribute should preferrably contain a
    value from <code class="varname">stdenv.lib.licenses</code> defined in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/lib/licenses.nix" target="_top">
    <code class="filename">nixpkgs/lib/licenses.nix</code></a>, or in-place license
    description of the same format if the license is unlikely to be useful in
    another expression.
   </p><p>
    Although it's typically better to indicate the specific license, a few
    generic options are available:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="varname">stdenv.lib.licenses.free</code>, <code class="varname">"free"</code>
      </span></dt><dd><p>
        Catch-all for free software licenses not listed above.
       </p></dd><dt><span class="term">
       <code class="varname">stdenv.lib.licenses.unfreeRedistributable</code>, <code class="varname">"unfree-redistributable"</code>
      </span></dt><dd><p>
        Unfree package that can be redistributed in binary form. That is,
        it’s legal to redistribute the <span class="emphasis"><em>output</em></span> of
        the derivation. This means that the package can be included in the
        Nixpkgs channel.
       </p><p>
        Sometimes proprietary software can only be redistributed unmodified.
        Make sure the builder doesn’t actually modify the original
        binaries; otherwise we’re breaking the license. For instance,
        the NVIDIA X11 drivers can be redistributed unmodified, but our builder
        applies <span class="command"><strong>patchelf</strong></span> to make them work. Thus, its
        license is <code class="varname">"unfree"</code> and it cannot be included in the
        Nixpkgs channel.
       </p></dd><dt><span class="term">
       <code class="varname">stdenv.lib.licenses.unfree</code>, <code class="varname">"unfree"</code>
      </span></dt><dd><p>
        Unfree package that cannot be redistributed. You can build it yourself,
        but you cannot redistribute the output of the derivation. Thus it
        cannot be included in the Nixpkgs channel.
       </p></dd><dt><span class="term">
       <code class="varname">stdenv.lib.licenses.unfreeRedistributableFirmware</code>, <code class="varname">"unfree-redistributable-firmware"</code>
      </span></dt><dd><p>
        This package supplies unfree, redistributable firmware. This is a
        separate value from <code class="varname">unfree-redistributable</code> because
        not everybody cares whether firmware is free.
       </p></dd></dl></div><p>
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-language-support"></a>Chapter 9. Support for specific programming languages and frameworks</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#android">9.1. Android</a></span></dt><dd><dl><dt><span class="section"><a href="#deploying-an-android-sdk-installation-with-plugins">9.1.1. Deploying an Android SDK installation with plugins</a></span></dt><dt><span class="section"><a href="#using-predefine-android-package-compositions">9.1.2. Using predefine Android package compositions</a></span></dt><dt><span class="section"><a href="#building-an-android-application">9.1.3. Building an Android application</a></span></dt><dt><span class="section"><a href="#spawning-emulator-instances">9.1.4. Spawning emulator instances</a></span></dt><dt><span class="section"><a href="#querying-the-available-versions-of-each-plugin">9.1.5. Querying the available versions of each plugin</a></span></dt><dt><span class="section"><a href="#updating-the-generated-expressions">9.1.6. Updating the generated expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-beam">9.2. BEAM Languages (Erlang, Elixir &amp; LFE)</a></span></dt><dd><dl><dt><span class="section"><a href="#beam-introduction">9.2.1. Introduction</a></span></dt><dt><span class="section"><a href="#beam-structure">9.2.2. Structure</a></span></dt><dt><span class="section"><a href="#build-tools">9.2.3. Build Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#build-tools-rebar3">9.2.3.1. Rebar3</a></span></dt><dt><span class="section"><a href="#build-tools-other">9.2.3.2. Mix &amp; Erlang.mk</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-install-beam-packages">9.2.4. How to Install BEAM Packages</a></span></dt><dt><span class="section"><a href="#packaging-beam-applications">9.2.5. Packaging BEAM Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#packaging-erlang-applications">9.2.5.1. Erlang Applications</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-develop">9.2.6. How to Develop</a></span></dt><dd><dl><dt><span class="section"><a href="#accessing-an-environment">9.2.6.1. Accessing an Environment</a></span></dt><dt><span class="section"><a href="#creating-a-shell">9.2.6.2. Creating a Shell</a></span></dt></dl></dd><dt><span class="section"><a href="#generating-packages-from-hex-with-hex2nix">9.2.7. Generating Packages from Hex with <code class="literal">hex2nix</code></a></span></dt></dl></dd><dt><span class="section"><a href="#sec-bower">9.3. Bower</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-bower2nix-usage">9.3.1. <span class="command"><strong>bower2nix</strong></span> usage</a></span></dt><dt><span class="section"><a href="#ssec-build-bower-components">9.3.2. <code class="varname">buildBowerComponents</code> function</a></span></dt><dt><span class="section"><a href="#ssec-bower2nix-troubleshooting">9.3.3. Troubleshooting</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-coq">9.4. Coq</a></span></dt><dt><span class="section"><a href="#sec-language-go">9.5. Go</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-go-modules">9.5.1. Go modules</a></span></dt><dt><span class="section"><a href="#ssec-go-legacy">9.5.2. Go legacy</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-the-haskell-infrastructure">9.6. User’s Guide to the Haskell Infrastructure</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-install-haskell-packages">9.6.1. How to install Haskell packages</a></span></dt><dt><span class="section"><a href="#how-to-create-a-development-environment">9.6.2. How to create a development environment</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-install-a-compiler">9.6.2.1. How to install a compiler</a></span></dt><dt><span class="section"><a href="#how-to-install-a-compiler-with-libraries">9.6.2.2. How to install a compiler with libraries</a></span></dt><dt><span class="section"><a href="#how-to-install-a-compiler-with-libraries-hoogle-and-documentation-indexes">9.6.2.3. How to install a compiler with libraries, hoogle and documentation indexes</a></span></dt><dt><span class="section"><a href="#how-to-build-a-haskell-project-using-stack">9.6.2.4. How to build a Haskell project using Stack</a></span></dt><dt><span class="section"><a href="#how-to-create-ad-hoc-environments-for-nix-shell">9.6.2.5. How to create ad hoc environments for <code class="literal">nix-shell</code></a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-create-nix-builds-for-your-own-private-haskell-packages">9.6.3. How to create Nix builds for your own private Haskell packages</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-build-a-stand-alone-project">9.6.3.1. How to build a stand-alone project</a></span></dt><dt><span class="section"><a href="#how-to-build-projects-that-depend-on-each-other">9.6.3.2. How to build projects that depend on each other</a></span></dt></dl></dd><dt><span class="section"><a href="#miscellaneous-topics">9.6.4. Miscellaneous Topics</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-build-with-profiling-enabled">9.6.4.1. How to build with profiling enabled</a></span></dt><dt><span class="section"><a href="#how-to-override-package-versions-in-a-compiler-specific-package-set">9.6.4.2. How to override package versions in a compiler-specific package set</a></span></dt><dt><span class="section"><a href="#how-to-override-packages-in-all-compiler-specific-package-sets">9.6.4.3. How to override packages in all compiler-specific package sets</a></span></dt><dt><span class="section"><a href="#how-to-specify-source-overrides-for-your-haskell-package">9.6.4.4. How to specify source overrides for your Haskell package</a></span></dt><dt><span class="section"><a href="#how-to-recover-from-ghcs-infamous-non-deterministic-library-id-bug">9.6.4.5. How to recover from GHC’s infamous non-deterministic library ID bug</a></span></dt><dt><span class="section"><a href="#builds-on-darwin-fail-with-math.h-not-found">9.6.4.6. Builds on Darwin fail with <code class="literal">math.h</code> not found</a></span></dt><dt><span class="section"><a href="#builds-using-stack-complain-about-missing-system-libraries">9.6.4.7. Builds using Stack complain about missing system libraries</a></span></dt><dt><span class="section"><a href="#creating-statically-linked-binaries">9.6.4.8. Creating statically linked binaries</a></span></dt><dt><span class="section"><a href="#building-ghc-with-integer-simple">9.6.4.9. Building GHC with integer-simple</a></span></dt><dt><span class="section"><a href="#quality-assurance">9.6.4.10. Quality assurance</a></span></dt><dt><span class="section"><a href="#using-hackage2nix-with-nixpkgs">9.6.4.11. Using hackage2nix with nixpkgs</a></span></dt></dl></dd><dt><span class="section"><a href="#other-resources">9.6.5. Other resources</a></span></dt></dl></dd><dt><span class="section"><a href="#idris-packages">9.7. Idris packages</a></span></dt><dd><dl><dt><span class="section"><a href="#installing-idris">9.7.1. Installing Idris</a></span></dt><dt><span class="section"><a href="#starting-idris-with-library-support">9.7.2. Starting Idris with library support</a></span></dt><dt><span class="section"><a href="#building-an-idris-project-with-nix">9.7.3. Building an Idris project with Nix</a></span></dt></dl></dd><dt><span class="section"><a href="#ios">9.8. iOS</a></span></dt><dd><dl><dt><span class="section"><a href="#deploying-a-proxy-component-wrapper-exposing-xcode">9.8.1. Deploying a proxy component wrapper exposing Xcode</a></span></dt><dt><span class="section"><a href="#building-an-ios-application">9.8.2. Building an iOS application</a></span></dt><dt><span class="section"><a href="#spawning-simulator-instances">9.8.3. Spawning simulator instances</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-java">9.9. Java</a></span></dt><dt><span class="section"><a href="#sec-language-lua">9.10. Lua</a></span></dt><dt><span class="section"><a href="#node.js-packages">9.11. Node.js packages</a></span></dt><dt><span class="section"><a href="#sec-language-ocaml">9.12. OCaml</a></span></dt><dt><span class="section"><a href="#sec-language-perl">9.13. Perl</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-generation-from-CPAN">9.13.1. Generation from CPAN</a></span></dt><dt><span class="section"><a href="#ssec-perl-cross-compilation">9.13.2. Cross-compiling modules</a></span></dt></dl></dd><dt><span class="section"><a href="#python">9.14. Python</a></span></dt><dd><dl><dt><span class="section"><a href="#user-guide">9.14.1. User Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#using-python">9.14.1.1. Using Python</a></span></dt><dt><span class="section"><a href="#developing-with-python">9.14.1.2. Developing with Python</a></span></dt><dt><span class="section"><a href="#organising-your-packages">9.14.1.3. Organising your packages</a></span></dt><dt><span class="section"><a href="#including-a-derivation-using-callpackage">9.14.1.4. Including a derivation using <code class="literal">callPackage</code></a></span></dt></dl></dd><dt><span class="section"><a href="#reference">9.14.2. Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#interpreters">9.14.2.1. Interpreters</a></span></dt><dt><span class="section"><a href="#building-packages-and-applications">9.14.2.2. Building packages and applications</a></span></dt><dt><span class="section"><a href="#development-mode">9.14.2.3. Development mode</a></span></dt><dt><span class="section"><a href="#tools">9.14.2.4. Tools</a></span></dt><dt><span class="section"><a href="#deterministic-builds">9.14.2.5. Deterministic builds</a></span></dt><dt><span class="section"><a href="#automatic-tests">9.14.2.6. Automatic tests</a></span></dt></dl></dd><dt><span class="section"><a href="#faq">9.14.3. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-solve-circular-dependencies">9.14.3.1. How to solve circular dependencies?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package">9.14.3.2. How to override a Python package?</a></span></dt><dt><span class="section"><a href="#python-setup.py-bdist_wheel-cannot-create-.whl">9.14.3.3. <code class="literal">python setup.py bdist_wheel</code> cannot create .whl</a></span></dt><dt><span class="section"><a href="#install_data-data_files-problems">9.14.3.4. <code class="literal">install_data</code> / <code class="literal">data_files</code> problems</a></span></dt><dt><span class="section"><a href="#rationale-of-non-existent-global-site-packages">9.14.3.5. Rationale of non-existent global site-packages</a></span></dt><dt><span class="section"><a href="#how-to-consume-python-modules-using-pip-in-a-virtualenv-like-i-am-used-to-on-other-operating-systems">9.14.3.6. How to consume python modules using pip in a virtualenv like I am used to on other Operating Systems ?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package-from-configuration.nix">9.14.3.7. How to override a Python package from <code class="literal">configuration.nix</code>?</a></span></dt><dt><span class="section"><a href="#how-to-override-a-python-package-using-overlays">9.14.3.8. How to override a Python package using overlays?</a></span></dt><dt><span class="section"><a href="#how-to-use-intels-mkl-with-numpy-and-scipy">9.14.3.9. How to use Intel’s MKL with numpy and scipy?</a></span></dt><dt><span class="section"><a href="#what-inputs-do-setup_requires-install_requires-and-tests_require-map-to">9.14.3.10. What inputs do <code class="literal">setup_requires</code>, <code class="literal">install_requires</code> and <code class="literal">tests_require</code> map to?</a></span></dt></dl></dd><dt><span class="section"><a href="#contributing">9.14.4. Contributing</a></span></dt><dd><dl><dt><span class="section"><a href="#contributing-guidelines">9.14.4.1. Contributing guidelines</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="#sec-language-qt">9.15. Qt</a></span></dt><dd><dl><dt><span class="section"><a href="#ssec-qt-libraries">9.15.1. Packaging Libraries for Nixpkgs</a></span></dt><dt><span class="section"><a href="#ssec-qt-applications">9.15.2. Packaging Applications for Nixpkgs</a></span></dt></dl></dd><dt><span class="section"><a href="#r-packages">9.16. R packages</a></span></dt><dd><dl><dt><span class="section"><a href="#installation">9.16.1. Installation</a></span></dt><dt><span class="section"><a href="#rstudio">9.16.2. RStudio</a></span></dt><dt><span class="section"><a href="#updating-the-package-set">9.16.3. Updating the package set</a></span></dt><dt><span class="section"><a href="#testing-if-the-nix-expression-could-be-evaluated">9.16.4. Testing if the Nix-expression could be evaluated</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-ruby">9.17. Ruby</a></span></dt><dt><span class="section"><a href="#users-guide-to-the-rust-infrastructure">9.18. User’s Guide to the Rust Infrastructure</a></span></dt><dd><dl><dt><span class="section"><a href="#compiling-rust-applications-with-cargo">9.18.1. Compiling Rust applications with Cargo</a></span></dt><dt><span class="section"><a href="#compiling-rust-crates-using-nix-instead-of-cargo">9.18.2. Compiling Rust crates using Nix instead of Cargo</a></span></dt><dd><dl><dt><span class="section"><a href="#simple-operation">9.18.2.1. Simple operation</a></span></dt><dt><span class="section"><a href="#handling-external-dependencies">9.18.2.2. Handling external dependencies</a></span></dt><dt><span class="section"><a href="#options-and-phases-configuration">9.18.2.3. Options and phases configuration</a></span></dt><dt><span class="section"><a href="#features">9.18.2.4. Features</a></span></dt></dl></dd><dt><span class="section"><a href="#setting-up-nix-shell">9.18.3. Setting Up <code class="literal">nix-shell</code></a></span></dt><dd><dl><dt><span class="section"><a href="#controlling-rust-version-inside-nix-shell">9.18.3.1. Controlling Rust Version Inside <code class="literal">nix-shell</code></a></span></dt></dl></dd><dt><span class="section"><a href="#using-the-rust-nightlies-overlay">9.18.4. Using the Rust nightlies overlay</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-language-texlive">9.19. TeX Live</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-language-texlive-users-guide">9.19.1. User's guide</a></span></dt><dt><span class="section"><a href="#sec-language-texlive-known-problems">9.19.2. Known problems</a></span></dt></dl></dd><dt><span class="section"><a href="#titanium">9.20. Titanium</a></span></dt><dd><dl><dt><span class="section"><a href="#building-a-titanium-app">9.20.1. Building a Titanium app</a></span></dt><dt><span class="section"><a href="#emulating-or-simulating-the-app">9.20.2. Emulating or simulating the app</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-vim-pluginsaddonsbundlesscripts-in-nixpkgs">9.21. User’s Guide to Vim Plugins/Addons/Bundles/Scripts in Nixpkgs</a></span></dt><dd><dl><dt><span class="section"><a href="#custom-configuration">9.21.1. Custom configuration</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vim-packages">9.21.2. Managing plugins with Vim packages</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vim-plug">9.21.3. Managing plugins with vim-plug</a></span></dt><dt><span class="section"><a href="#managing-plugins-with-vam">9.21.4. Managing plugins with VAM</a></span></dt><dd><dl><dt><span class="section"><a href="#handling-dependencies-of-vim-plugins">9.21.4.1. Handling dependencies of Vim plugins</a></span></dt><dt><span class="section"><a href="#example">9.21.4.2. Example</a></span></dt></dl></dd><dt><span class="section"><a href="#adding-new-plugins-to-nixpkgs">9.21.5. Adding new plugins to nixpkgs</a></span></dt><dt><span class="section"><a href="#important-repositories">9.21.6. Important repositories</a></span></dt></dl></dd><dt><span class="section"><a href="#users-guide-to-emscripten-in-nixpkgs">9.22. User’s Guide to Emscripten in Nixpkgs</a></span></dt><dd><dl><dt><span class="section"><a href="#imperative-usage">9.22.1. Imperative usage</a></span></dt><dt><span class="section"><a href="#declarative-usage">9.22.2. Declarative usage</a></span></dt><dd><dl><dt><span class="section"><a href="#usage-1-pkgs.zlib.override">9.22.2.1. Usage 1: pkgs.zlib.override</a></span></dt><dt><span class="section"><a href="#usage-2-pkgs.buildemscriptenpackage">9.22.2.2. Usage 2: pkgs.buildEmscriptenPackage</a></span></dt><dt><span class="section"><a href="#declarative-debugging">9.22.2.3. Declarative debugging</a></span></dt></dl></dd><dt><span class="section"><a href="#summary">9.22.3. Summary</a></span></dt></dl></dd></dl></div><p>
   The <a class="link" href="#chap-stdenv" title="Chapter 3. The Standard Environment">standard build environment</a> makes it
   easy to build typical Autotools-based packages with very little code. Any
   other kind of package can be accomodated by overriding the appropriate
   phases of <code class="literal">stdenv</code>. However, there are specialised
   functions in Nixpkgs to easily build packages for other programming
   languages, such as Perl or Haskell. These are described in this chapter.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="android"></a>9.1. Android</h2></div></div></div><p>
    The Android build environment provides three major features and a number of
    supporting features.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="deploying-an-android-sdk-installation-with-plugins"></a>9.1.1. Deploying an Android SDK installation with plugins</h3></div></div></div><p>
     The first use case is deploying the SDK with a desired set of plugins or
     subsets of an SDK.
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

let
  androidComposition = androidenv.composeAndroidPackages {
    toolsVersion = "25.2.5";
    platformToolsVersion = "27.0.1";
    buildToolsVersions = [ "27.0.3" ];
    includeEmulator = false;
    emulatorVersion = "27.2.0";
    platformVersions = [ "24" ];
    includeSources = false;
    includeDocs = false;
    includeSystemImages = false;
    systemImageTypes = [ "default" ];
    abiVersions = [ "armeabi-v7a" ];
    lldbVersions = [ "2.0.2558144" ];
    cmakeVersions = [ "3.6.4111459" ];
    includeNDK = false;
    ndkVersion = "16.1.4479499";
    useGoogleAPIs = false;
    useGoogleTVAddOns = false;
    includeExtras = [
      "extras;google;gcm"
    ];
  };
in
androidComposition.androidsdk
</pre><p>
     The above function invocation states that we want an Android SDK with the
     above specified plugin versions. By default, most plugins are disabled.
     Notable exceptions are the tools, platform-tools and build-tools sub
     packages.
    </p><p>
     The following parameters are supported:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">toolsVersion</code>, specifies the version of the tools
       package to use
      </p></li><li class="listitem"><p>
       <code class="literal">platformsToolsVersion</code> specifies the version of the
       <code class="literal">platform-tools</code> plugin
      </p></li><li class="listitem"><p>
       <code class="literal">buildToolsVersion</code> specifies the versions of the
       <code class="literal">build-tools</code> plugins to use.
      </p></li><li class="listitem"><p>
       <code class="literal">includeEmulator</code> specifies whether to deploy the
       emulator package (<code class="literal">false</code> by default). When enabled,
       the version of the emulator to deploy can be specified by setting the
       <code class="literal">emulatorVersion</code> parameter.
      </p></li><li class="listitem"><p>
       <code class="literal">includeDocs</code> specifies whether the documentation
       catalog should be included.
      </p></li><li class="listitem"><p>
       <code class="literal">lldbVersions</code> specifies what LLDB versions should be
       deployed.
      </p></li><li class="listitem"><p>
       <code class="literal">cmakeVersions</code> specifies which CMake versions should
       be deployed.
      </p></li><li class="listitem"><p>
       <code class="literal">includeNDK</code> specifies that the Android NDK bundle
       should be included. Defaults to: <code class="literal">false</code>.
      </p></li><li class="listitem"><p>
       <code class="literal">ndkVersion</code> specifies the NDK version that we want to
       use.
      </p></li><li class="listitem"><p>
       <code class="literal">includeExtras</code> is an array of identifier strings
       referring to arbitrary add-on packages that should be installed.
      </p></li><li class="listitem"><p>
       <code class="literal">platformVersions</code> specifies which platform SDK
       versions should be included.
      </p></li></ul></div><p>
     For each platform version that has been specified, we can apply the
     following options:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">includeSystemImages</code> specifies whether a system image
       for each platform SDK should be included.
      </p></li><li class="listitem"><p>
       <code class="literal">includeSources</code> specifies whether the sources for each
       SDK version should be included.
      </p></li><li class="listitem"><p>
       <code class="literal">useGoogleAPIs</code> specifies that for each selected
       platform version the Google API should be included.
      </p></li><li class="listitem"><p>
       <code class="literal">useGoogleTVAddOns</code> specifies that for each selected
       platform version the Google TV add-on should be included.
      </p></li></ul></div><p>
     For each requested system image we can specify the following options:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">systemImageTypes</code> specifies what kind of system images
       should be included. Defaults to: <code class="literal">default</code>.
      </p></li><li class="listitem"><p>
       <code class="literal">abiVersions</code> specifies what kind of ABI version of
       each system image should be included. Defaults to:
       <code class="literal">armeabi-v7a</code>.
      </p></li></ul></div><p>
     Most of the function arguments have reasonable default settings.
    </p><p>
     When building the above expression with:
    </p><pre class="programlisting">
$ nix-build
</pre><p>
     The Android SDK gets deployed with all desired plugin versions.
    </p><p>
     We can also deploy subsets of the Android SDK. For example, to only the
     the <code class="literal">platform-tools</code> package, you can evaluate the
     following expression:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

let
  androidComposition = androidenv.composeAndroidPackages {
    # ...
  };
in
androidComposition.platform-tools
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using-predefine-android-package-compositions"></a>9.1.2. Using predefine Android package compositions</h3></div></div></div><p>
     In addition to composing an Android package set manually, it is also
     possible to use a predefined composition that contains all basic packages
     for a specific Android version, such as version 9.0 (API-level 28).
    </p><p>
     The following Nix expression can be used to deploy the entire SDK with all
     basic plugins:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.androidsdk
</pre><p>
     It is also possible to use one plugin only:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

androidenv.androidPkgs_9_0.platform-tools
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="building-an-android-application"></a>9.1.3. Building an Android application</h3></div></div></div><p>
     In addition to the SDK, it is also possible to build an Ant-based Android
     project and automatically deploy all the Android plugins that a project
     requires.
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

androidenv.buildApp {
  name = "MyAndroidApp";
  src = ./myappsources;
  release = true;

  # If release is set to true, you need to specify the following parameters
  keyStore = ./keystore;
  keyAlias = "myfirstapp";
  keyStorePassword = "mykeystore";
  keyAliasPassword = "myfirstapp";

  # Any Android SDK parameters that install all the relevant plugins that a
  # build requires
  platformVersions = [ "24" ];

  # When we include the NDK, then ndk-build is invoked before Ant gets invoked
  includeNDK = true;
}
</pre><p>
     Aside from the app-specific build parameters (<code class="literal">name</code>,
     <code class="literal">src</code>, <code class="literal">release</code> and keystore
     parameters), the <code class="literal">buildApp {}</code> function supports all the
     function parameters that the SDK composition function (the function shown
     in the previous section) supports.
    </p><p>
     This build function is particularly useful when it is desired to use
     <a class="link" href="http://nixos.org/hydra" target="_top">Hydra</a>: the Nix-based
     continuous integration solution to build Android apps. An Android APK gets
     exposed as a build product and can be installed on any Android device with
     a web browser by navigating to the build result page.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="spawning-emulator-instances"></a>9.1.4. Spawning emulator instances</h3></div></div></div><p>
     For testing purposes, it can also be quite convenient to automatically
     generate scripts that spawn emulator instances with all desired
     configuration settings.
    </p><p>
     An emulator spawn script can be configured by invoking the
     <code class="literal">emulateApp {}</code> function:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  name = "emulate-MyAndroidApp";
  platformVersion = "24";
  abiVersion = "armeabi-v7a"; # mips, x86 or x86_64
  systemImageType = "default";
  useGoogleAPIs = false;
}
</pre><p>
     It is also possible to specify an APK to deploy inside the emulator and
     the package and activity names to launch it:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

androidenv.emulateApp {
  name = "emulate-MyAndroidApp";
  platformVersion = "24";
  abiVersion = "armeabi-v7a"; # mips, x86 or x86_64
  systemImageType = "default";
  useGoogleAPIs = false;
  app = ./MyApp.apk;
  package = "MyApp";
  activity = "MainActivity";
}
</pre><p>
     In addition to prebuilt APKs, you can also bind the APK parameter to a
     <code class="literal">buildApp {}</code> function invocation shown in the previous
     example.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="querying-the-available-versions-of-each-plugin"></a>9.1.5. Querying the available versions of each plugin</h3></div></div></div><p>
     When using any of the previously shown functions, it may be a bit
     inconvenient to find out what options are supported, since the Android SDK
     provides many plugins.
    </p><p>
     A shell script in the
     <code class="literal">pkgs/development/mobile/androidenv/</code> sub directory can
     be used to retrieve all possible options:
    </p><pre class="programlisting">
sh ./querypackages.sh packages build-tools
</pre><p>
     The above command-line instruction queries all build-tools versions in the
     generated <code class="literal">packages.nix</code> expression.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="updating-the-generated-expressions"></a>9.1.6. Updating the generated expressions</h3></div></div></div><p>
     Most of the Nix expressions are generated from XML files that the Android
     package manager uses. To update the expressions run the
     <code class="literal">generate.sh</code> script that is stored in the
     <code class="literal">pkgs/development/mobile/androidenv/</code> sub directory:
    </p><pre class="programlisting">
sh ./generate.sh
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-beam"></a>9.2. BEAM Languages (Erlang, Elixir &amp; LFE)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="beam-introduction"></a>9.2.1. Introduction</h3></div></div></div><p>
     In this document and related Nix expressions, we use the term,
     <span class="emphasis"><em>BEAM</em></span>, to describe the environment. BEAM is the name
     of the Erlang Virtual Machine and, as far as we're concerned, from a
     packaging perspective, all languages that run on the BEAM are
     interchangeable. That which varies, like the build system, is transparent
     to users of any given BEAM package, so we make no distinction.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="beam-structure"></a>9.2.2. Structure</h3></div></div></div><p>
     All BEAM-related expressions are available via the top-level
     <code class="literal">beam</code> attribute, which includes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">interpreters</code>: a set of compilers running on the BEAM,
       including multiple Erlang/OTP versions
       (<code class="literal">beam.interpreters.erlangR19</code>, etc), Elixir
       (<code class="literal">beam.interpreters.elixir</code>) and LFE
       (<code class="literal">beam.interpreters.lfe</code>).
      </p></li><li class="listitem"><p>
       <code class="literal">packages</code>: a set of package sets, each compiled with a
       specific Erlang/OTP version, e.g.
       <code class="literal">beam.packages.erlangR19</code>.
      </p></li></ul></div><p>
     The default Erlang compiler, defined by
     <code class="literal">beam.interpreters.erlang</code>, is aliased as
     <code class="literal">erlang</code>. The default BEAM package set is defined by
     <code class="literal">beam.packages.erlang</code> and aliased at the top level as
     <code class="literal">beamPackages</code>.
    </p><p>
     To create a package set built with a custom Erlang version, use the
     lambda, <code class="literal">beam.packagesWith</code>, which accepts an Erlang/OTP
     derivation and produces a package set similar to
     <code class="literal">beam.packages.erlang</code>.
    </p><p>
     Many Erlang/OTP distributions available in
     <code class="literal">beam.interpreters</code> have versions with ODBC and/or Java
     enabled. For example, there's
     <code class="literal">beam.interpreters.erlangR19_odbc_javac</code>, which
     corresponds to <code class="literal">beam.interpreters.erlangR19</code>.
    </p><p><a id="erlang-call-package"></a>
     We also provide the lambda,
     <code class="literal">beam.packages.erlang.callPackage</code>, which simplifies
     writing BEAM package definitions by injecting all packages from
     <code class="literal">beam.packages.erlang</code> into the top-level context.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="build-tools"></a>9.2.3. Build Tools</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="build-tools-rebar3"></a>9.2.3.1. Rebar3</h4></div></div></div><p>
      By default, Rebar3 wants to manage its own dependencies. This is
      perfectly acceptable in the normal, non-Nix setup, but in the Nix world,
      it is not. To rectify this, we provide two versions of Rebar3:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">rebar3</code>: patched to remove the ability to download
         anything. When not running it via <code class="literal">nix-shell</code> or
         <code class="literal">nix-build</code>, it's probably not going to work as
         desired.
        </p></li><li class="listitem"><p>
         <code class="literal">rebar3-open</code>: the normal, unmodified Rebar3. It
         should work exactly as would any other version of Rebar3. Any Erlang
         package should rely on <code class="literal">rebar3</code> instead. See
         <a class="xref" href="#rebar3-packages" title="9.2.5.1.1. Rebar3 Packages">Section 9.2.5.1.1, “Rebar3 Packages”</a>.
        </p></li></ul></div><p>
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="build-tools-other"></a>9.2.3.2. Mix &amp; Erlang.mk</h4></div></div></div><p>
      Both Mix and Erlang.mk work exactly as expected. There is a bootstrap
      process that needs to be run for both, however, which is supported by the
      <code class="literal">buildMix</code> and <code class="literal">buildErlangMk</code>
      derivations, respectively.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-install-beam-packages"></a>9.2.4. How to Install BEAM Packages</h3></div></div></div><p>
     BEAM packages are not registered at the top level, simply because they are
     not relevant to the vast majority of Nix users. They are installable using
     the <code class="literal">beam.packages.erlang</code> attribute set (aliased as
     <code class="literal">beamPackages</code>), which points to packages built by the
     default Erlang/OTP version in Nixpkgs, as defined by
     <code class="literal">beam.interpreters.erlang</code>. To list the available
     packages in <code class="literal">beamPackages</code>, use the following command:
    </p><pre class="programlisting">
$ nix-env -f "&lt;nixpkgs&gt;" -qaP -A beamPackages
beamPackages.esqlite    esqlite-0.2.1
beamPackages.goldrush   goldrush-0.1.7
beamPackages.ibrowse    ibrowse-4.2.2
beamPackages.jiffy      jiffy-0.14.5
beamPackages.lager      lager-3.0.2
beamPackages.meck       meck-0.8.3
beamPackages.rebar3-pc  pc-1.1.0
  </pre><p>
     To install any of those packages into your profile, refer to them by their
     attribute path (first column):
    </p><pre class="programlisting">
$ nix-env -f "&lt;nixpkgs&gt;" -iA beamPackages.ibrowse
  </pre><p>
     The attribute path of any BEAM package corresponds to the name of that
     particular package in <a class="link" href="https://hex.pm" target="_top">Hex</a> or its
     OTP Application/Release name.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="packaging-beam-applications"></a>9.2.5. Packaging BEAM Applications</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="packaging-erlang-applications"></a>9.2.5.1. Erlang Applications</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="rebar3-packages"></a>9.2.5.1.1. Rebar3 Packages</h5></div></div></div><p>
       The Nix function, <code class="literal">buildRebar3</code>, defined in
       <code class="literal">beam.packages.erlang.buildRebar3</code> and aliased at the
       top level, can be used to build a derivation that understands how to
       build a Rebar3 project. For example, we can build
       <a class="link" href="https://github.com/erlang-nix/hex2nix" target="_top">hex2nix</a>
       as follows:
      </p><pre class="programlisting">
        { stdenv, fetchFromGitHub, buildRebar3, ibrowse, jsx, erlware_commons }:

        buildRebar3 rec {
          name = "hex2nix";
          version = "0.0.1";

          src = fetchFromGitHub {
            owner = "ericbmerritt";
            repo = "hex2nix";
            rev = "${version}";
            sha256 = "1w7xjidz1l5yjmhlplfx7kphmnpvqm67w99hd2m7kdixwdxq0zqg";
          };

          beamDeps = [ ibrowse jsx erlware_commons ];
        }
      </pre><p>
       Such derivations are callable with
       <code class="literal">beam.packages.erlang.callPackage</code> (see
       <a class="xref" href="#erlang-call-package">Section 9.2.2, “Structure”</a>). To call this package using the
       normal <code class="literal">callPackage</code>, refer to dependency packages via
       <code class="literal">beamPackages</code>, e.g.
       <code class="literal">beamPackages.ibrowse</code>.
      </p><p>
       Notably, <code class="literal">buildRebar3</code> includes
       <code class="literal">beamDeps</code>, while
       <code class="literal">stdenv.mkDerivation</code> does not. BEAM dependencies added
       there will be correctly handled by the system.
      </p><p>
       If a package needs to compile native code via Rebar3's port compilation
       mechanism, add <code class="literal">compilePort = true;</code> to the derivation.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="erlang-mk-packages"></a>9.2.5.1.2. Erlang.mk Packages</h5></div></div></div><p>
       Erlang.mk functions similarly to Rebar3, except we use
       <code class="literal">buildErlangMk</code> instead of
       <code class="literal">buildRebar3</code>.
      </p><pre class="programlisting">
        { buildErlangMk, fetchHex, cowlib, ranch }:

        buildErlangMk {
          name = "cowboy";
          version = "1.0.4";

          src = fetchHex {
            pkg = "cowboy";
            version = "1.0.4";
            sha256 = "6a0edee96885fae3a8dd0ac1f333538a42e807db638a9453064ccfdaa6b9fdac";
          };

          beamDeps = [ cowlib ranch ];

          meta = {
            description = ''
              Small, fast, modular HTTP server written in Erlang
            '';
            license = stdenv.lib.licenses.isc;
            homepage = https://github.com/ninenines/cowboy;
          };
        }
      </pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="mix-packages"></a>9.2.5.1.3. Mix Packages</h5></div></div></div><p>
       Mix functions similarly to Rebar3, except we use
       <code class="literal">buildMix</code> instead of <code class="literal">buildRebar3</code>.
      </p><pre class="programlisting">
        { buildMix, fetchHex, plug, absinthe }:

        buildMix {
          name = "absinthe_plug";
          version = "1.0.0";

          src = fetchHex {
            pkg = "absinthe_plug";
            version = "1.0.0";
            sha256 = "08459823fe1fd4f0325a8bf0c937a4520583a5a26d73b193040ab30a1dfc0b33";
          };

          beamDeps = [ plug absinthe ];

          meta = {
            description = ''
              A plug for Absinthe, an experimental GraphQL toolkit
            '';
            license = stdenv.lib.licenses.bsd3;
            homepage = https://github.com/CargoSense/absinthe_plug;
          };
        }
      </pre><p>
       Alternatively, we can use <code class="literal">buildHex</code> as a shortcut:
      </p><pre class="programlisting">
        { buildHex, buildMix, plug, absinthe }:

        buildHex {
          name = "absinthe_plug";
          version = "1.0.0";

          sha256 = "08459823fe1fd4f0325a8bf0c937a4520583a5a26d73b193040ab30a1dfc0b33";

          builder = buildMix;

          beamDeps = [ plug absinthe ];

          meta = {
            description = ''
              A plug for Absinthe, an experimental GraphQL toolkit
            '';
            license = stdenv.lib.licenses.bsd3;
            homepage = https://github.com/CargoSense/absinthe_plug;
         };
       }
      </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-develop"></a>9.2.6. How to Develop</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="accessing-an-environment"></a>9.2.6.1. Accessing an Environment</h4></div></div></div><p>
      Often, we simply want to access a valid environment that contains a
      specific package and its dependencies. We can accomplish that with the
      <code class="literal">env</code> attribute of a derivation. For example, let's say
      we want to access an Erlang REPL with <code class="literal">ibrowse</code> loaded
      up. We could do the following:
     </p><pre class="programlisting">
      $ nix-shell -A beamPackages.ibrowse.env --run "erl"
      Erlang/OTP 18 [erts-7.0] [source] [64-bit] [smp:4:4] [async-threads:10] [hipe] [kernel-poll:false]

      Eshell V7.0  (abort with ^G)
      1&gt; m(ibrowse).
      Module: ibrowse
      MD5: 3b3e0137d0cbb28070146978a3392945
      Compiled: January 10 2016, 23:34
      Object file: /nix/store/g1rlf65rdgjs4abbyj4grp37ry7ywivj-ibrowse-4.2.2/lib/erlang/lib/ibrowse-4.2.2/ebin/ibrowse.beam
      Compiler options:  [{outdir,"/tmp/nix-build-ibrowse-4.2.2.drv-0/hex-source-ibrowse-4.2.2/_build/default/lib/ibrowse/ebin"},
      debug_info,debug_info,nowarn_shadow_vars,
      warn_unused_import,warn_unused_vars,warnings_as_errors,
      {i,"/tmp/nix-build-ibrowse-4.2.2.drv-0/hex-source-ibrowse-4.2.2/_build/default/lib/ibrowse/include"}]
      Exports:
      add_config/1                  send_req_direct/7
      all_trace_off/0               set_dest/3
      code_change/3                 set_max_attempts/3
      get_config_value/1            set_max_pipeline_size/3
      get_config_value/2            set_max_sessions/3
      get_metrics/0                 show_dest_status/0
      get_metrics/2                 show_dest_status/1
      handle_call/3                 show_dest_status/2
      handle_cast/2                 spawn_link_worker_process/1
      handle_info/2                 spawn_link_worker_process/2
      init/1                        spawn_worker_process/1
      module_info/0                 spawn_worker_process/2
      module_info/1                 start/0
      rescan_config/0               start_link/0
      rescan_config/1               stop/0
      send_req/3                    stop_worker_process/1
      send_req/4                    stream_close/1
      send_req/5                    stream_next/1
      send_req/6                    terminate/2
      send_req_direct/4             trace_off/0
      send_req_direct/5             trace_off/2
      send_req_direct/6             trace_on/0
      trace_on/2
      ok
      2&gt;
    </pre><p>
      Notice the <code class="literal">-A beamPackages.ibrowse.env</code>. That is the
      key to this functionality.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="creating-a-shell"></a>9.2.6.2. Creating a Shell</h4></div></div></div><p>
      Getting access to an environment often isn't enough to do real
      development. Usually, we need to create a <code class="literal">shell.nix</code>
      file and do our development inside of the environment specified therein.
      This file looks a lot like the packaging described above, except that
      <code class="literal">src</code> points to the project root and we call the package
      directly.
     </p><pre class="programlisting">
{ pkgs ? import "&lt;nixpkgs"&gt; {} }:

with pkgs;

let

  f = { buildRebar3, ibrowse, jsx, erlware_commons }:
      buildRebar3 {
        name = "hex2nix";
        version = "0.1.0";
        src = ./.;
        beamDeps = [ ibrowse jsx erlware_commons ];
      };
  drv = beamPackages.callPackage f {};

in

  drv
    </pre><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="building-in-a-shell"></a>9.2.6.2.1. Building in a Shell (for Mix Projects)</h5></div></div></div><p>
       We can leverage the support of the derivation, irrespective of the build
       derivation, by calling the commands themselves.
      </p><pre class="programlisting">
# =============================================================================
# Variables
# =============================================================================

NIX_TEMPLATES := "$(CURDIR)/nix-templates"

TARGET := "$(PREFIX)"

PROJECT_NAME := thorndyke

NIXPKGS=../nixpkgs
NIX_PATH=nixpkgs=$(NIXPKGS)
NIX_SHELL=nix-shell -I "$(NIX_PATH)" --pure
# =============================================================================
# Rules
# =============================================================================
.PHONY= all test clean repl shell build test analyze configure install \
        test-nix-install publish plt analyze

all: build

guard-%:
        @ if [ "${${*}}" == "" ]; then \
                echo "Environment variable $* not set"; \
                exit 1; \
        fi

clean:
        rm -rf _build
        rm -rf .cache

repl:
        $(NIX_SHELL) --run "iex -pa './_build/prod/lib/*/ebin'"

shell:
        $(NIX_SHELL)

configure:
        $(NIX_SHELL) --command 'eval "$$configurePhase"'

build: configure
        $(NIX_SHELL) --command 'eval "$$buildPhase"'

install:
        $(NIX_SHELL) --command 'eval "$$installPhase"'

test:
        $(NIX_SHELL) --command 'mix test --no-start --no-deps-check'

plt:
        $(NIX_SHELL) --run "mix dialyzer.plt --no-deps-check"

analyze: build plt
        $(NIX_SHELL) --run "mix dialyzer --no-compile"

    </pre><p>
       Using a <code class="literal">shell.nix</code> as described (see
       <a class="xref" href="#creating-a-shell" title="9.2.6.2. Creating a Shell">Section 9.2.6.2, “Creating a Shell”</a>) should just work. Aside from
       <code class="literal">test</code>, <code class="literal">plt</code>, and
       <code class="literal">analyze</code>, the Make targets work just fine for all of
       the build derivations.
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="generating-packages-from-hex-with-hex2nix"></a>9.2.7. Generating Packages from Hex with <code class="literal">hex2nix</code></h3></div></div></div><p>
     Updating the <a class="link" href="https://hex.pm" target="_top">Hex</a> package set
     requires
     <a class="link" href="https://github.com/erlang-nix/hex2nix" target="_top">hex2nix</a>.
     Given the path to the Erlang modules (usually
     <code class="literal">pkgs/development/erlang-modules</code>), it will dump a file
     called <code class="literal">hex-packages.nix</code>, containing all the packages
     that use a recognized build system in
     <a class="link" href="https://hex.pm" target="_top">Hex</a>. It can't be determined,
     however, whether every package is buildable.
    </p><p>
     To make life easier for our users, try to build every
     <a class="link" href="https://hex.pm" target="_top">Hex</a> package and remove those that
     fail. To do that, simply run the following command in the root of your
     <code class="literal">nixpkgs</code> repository:
    </p><pre class="programlisting">
$ nix-build -A beamPackages
    </pre><p>
     That will attempt to build every package in
     <code class="literal">beamPackages</code>. Then manually remove those that fail.
     Hopefully, someone will improve
     <a class="link" href="https://github.com/erlang-nix/hex2nix" target="_top">hex2nix</a> in
     the future to automate the process.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-bower"></a>9.3. Bower</h2></div></div></div><p>
    <a class="link" href="http://bower.io" target="_top">Bower</a> is a package manager for
    web site front-end components. Bower packages (comprising of build
    artefacts and sometimes sources) are stored in <span class="command"><strong>git</strong></span>
    repositories, typically on Github. The package registry is run by the Bower
    team with package metadata coming from the <code class="filename">bower.json</code>
    file within each package.
   </p><p>
    The end result of running Bower is a <code class="filename">bower_components</code>
    directory which can be included in the web app's build process.
   </p><p>
    Bower can be run interactively, by installing
    <code class="varname">nodePackages.bower</code>. More interestingly, the Bower
    components can be declared in a Nix derivation, with the help of
    <code class="varname">nodePackages.bower2nix</code>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-bower2nix-usage"></a>9.3.1. <span class="command"><strong>bower2nix</strong></span> usage</h3></div></div></div><p>
     Suppose you have a <code class="filename">bower.json</code> with the following
     contents:
     </p><div class="example"><a id="ex-bowerJson"></a><p class="title"><strong>Example 9.1. <code class="filename">bower.json</code></strong></p><div class="example-contents"><pre class="programlisting">
{
  "name": "my-web-app",
  "dependencies": {
    "angular": "~1.5.0",
    "bootstrap": "~3.3.6"
  }
}
</pre></div></div><p><br class="example-break" />
    </p><p>
     Running <span class="command"><strong>bower2nix</strong></span> will produce something like the
     following output:
</p><pre class="programlisting">
{ fetchbower, buildEnv }:
buildEnv { name = "bower-env"; ignoreCollisions = true; paths = [
  (fetchbower "angular" "1.5.3" "~1.5.0" "1749xb0firxdra4rzadm4q9x90v6pzkbd7xmcyjk6qfza09ykk9y")
  (fetchbower "bootstrap" "3.3.6" "~3.3.6" "1vvqlpbfcy0k5pncfjaiskj3y6scwifxygfqnw393sjfxiviwmbv")
  (fetchbower "jquery" "2.2.2" "1.9.1 - 2" "10sp5h98sqwk90y4k6hbdviwqzvzwqf47r3r51pakch5ii2y7js1")
]; }
</pre><p>
    </p><p>
     Using the <span class="command"><strong>bower2nix</strong></span> command line arguments, the output
     can be redirected to a file. A name like
     <code class="filename">bower-packages.nix</code> would be fine.
    </p><p>
     The resulting derivation is a union of all the downloaded Bower packages
     (and their dependencies). To use it, they still need to be linked together
     by Bower, which is where <code class="varname">buildBowerComponents</code> is
     useful.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-build-bower-components"></a>9.3.2. <code class="varname">buildBowerComponents</code> function</h3></div></div></div><p>
     The function is implemented in
     <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/bower-modules/generic/default.nix" target="_top">
     <code class="filename">pkgs/development/bower-modules/generic/default.nix</code></a>.
     Example usage:
     </p><div class="example"><a id="ex-buildBowerComponents"></a><p class="title"><strong>Example 9.2. buildBowerComponents</strong></p><div class="example-contents"><pre class="programlisting">
bowerComponents = buildBowerComponents {
  name = "my-web-app";
  generated = ./bower-packages.nix; <a id="ex-buildBowerComponents-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  src = myWebApp; <a id="ex-buildBowerComponents-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
};
</pre></div></div><p><br class="example-break" />
    </p><p>
     In <a class="xref" href="#ex-buildBowerComponents" title="Example 9.2. buildBowerComponents">Example 9.2, “buildBowerComponents”</a>, the following arguments are
     of special significance to the function:
     </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponents-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">generated</code> specifies the file which was created by
        <span class="command"><strong>bower2nix</strong></span>.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponents-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">src</code> is your project's sources. It needs to contain a
        <code class="filename">bower.json</code> file.
       </p></td></tr></table></div><p>
    </p><p>
     <code class="varname">buildBowerComponents</code> will run Bower to link together
     the output of <span class="command"><strong>bower2nix</strong></span>, resulting in a
     <code class="filename">bower_components</code> directory which can be used.
    </p><p>
     Here is an example of a web frontend build process using
     <span class="command"><strong>gulp</strong></span>. You might use <span class="command"><strong>grunt</strong></span>, or
     anything else.
    </p><div class="example"><a id="ex-bowerGulpFile"></a><p class="title"><strong>Example 9.3. Example build script (<code class="filename">gulpfile.js</code>)</strong></p><div class="example-contents"><pre class="programlisting">
var gulp = require('gulp');

gulp.task('default', [], function () {
  gulp.start('build');
});

gulp.task('build', [], function () {
  console.log("Just a dummy gulp build");
  gulp
    .src(["./bower_components/**/*"])
    .pipe(gulp.dest("./gulpdist/"));
});
</pre></div></div><br class="example-break" /><div class="example"><a id="ex-buildBowerComponentsDefaultNix"></a><p class="title"><strong>Example 9.4. Full example — <code class="filename">default.nix</code></strong></p><div class="example-contents"><pre class="programlisting">
{ myWebApp ? { outPath = ./.; name = "myWebApp"; }
, pkgs ? import &lt;nixpkgs&gt; {}
}:

pkgs.stdenv.mkDerivation {
  name = "my-web-app-frontend";
  src = myWebApp;

  buildInputs = [ pkgs.nodePackages.gulp ];

  bowerComponents = pkgs.buildBowerComponents { <a id="ex-buildBowerComponentsDefault-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
    name = "my-web-app";
    generated = ./bower-packages.nix;
    src = myWebApp;
  };

  buildPhase = ''
    cp --reflink=auto --no-preserve=mode -R $bowerComponents/bower_components . <a id="ex-buildBowerComponentsDefault-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
    export HOME=$PWD <a id="ex-buildBowerComponentsDefault-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
    ${pkgs.nodePackages.gulp}/bin/gulp build <a id="ex-buildBowerComponentsDefault-4"></a><span><img src="images/callouts/4.svg" alt="4" border="0" /></span>
  '';

  installPhase = "mv gulpdist $out";
}
</pre></div></div><br class="example-break" /><p>
     A few notes about <a class="xref" href="#ex-buildBowerComponentsDefaultNix" title="Example 9.4. Full example — default.nix">Example 9.4, “Full example — <code class="filename">default.nix</code>”</a>:
     </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponentsDefault-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        The result of <code class="varname">buildBowerComponents</code> is an input to
        the frontend build.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponentsDefault-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Whether to symlink or copy the <code class="filename">bower_components</code>
        directory depends on the build tool in use. In this case a copy is used
        to avoid <span class="command"><strong>gulp</strong></span> silliness with permissions.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponentsDefault-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <span class="command"><strong>gulp</strong></span> requires <code class="varname">HOME</code> to refer to a
        writeable directory.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildBowerComponentsDefault-4"><span><img src="images/callouts/4.svg" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        The actual build command. Other tools could be used.
       </p></td></tr></table></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-bower2nix-troubleshooting"></a>9.3.3. Troubleshooting</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       <code class="literal">ENOCACHE</code> errors from <code class="varname">buildBowerComponents</code>
      </span></dt><dd><p>
        This means that Bower was looking for a package version which doesn't
        exist in the generated <code class="filename">bower-packages.nix</code>.
       </p><p>
        If <code class="filename">bower.json</code> has been updated, then run
        <span class="command"><strong>bower2nix</strong></span> again.
       </p><p>
        It could also be a bug in <span class="command"><strong>bower2nix</strong></span> or
        <span class="command"><strong>fetchbower</strong></span>. If possible, try reformulating the
        version specification in <code class="filename">bower.json</code>.
       </p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-coq"></a>9.4. Coq</h2></div></div></div><p>
    Coq libraries should be installed in
    <code class="literal">$(out)/lib/coq/${coq.coq-version}/user-contrib/</code>. Such
    directories are automatically added to the <code class="literal">$COQPATH</code>
    environment variable by the hook defined in the Coq derivation.
   </p><p>
    Some extensions (plugins) might require OCaml and sometimes other OCaml
    packages. The <code class="literal">coq.ocamlPackages</code> attribute can be used to
    depend on the same package set Coq was built against.
   </p><p>
    Coq libraries may be compatible with some specific versions of Coq only.
    The <code class="literal">compatibleCoqVersions</code> attribute is used to precisely
    select those versions of Coq that are compatible with this derivation.
   </p><p>
    Here is a simple package example. It is a pure Coq library, thus it depends
    on Coq. It builds on the Mathematical Components library, thus it also
    takes <code class="literal">mathcomp</code> as <code class="literal">buildInputs</code>. Its
    <code class="literal">Makefile</code> has been generated using
    <code class="literal">coq_makefile</code> so we only have to set the
    <code class="literal">$COQLIB</code> variable at install time.
   </p><pre class="programlisting">
{ stdenv, fetchFromGitHub, coq, mathcomp }:

stdenv.mkDerivation rec {
  name = "coq${coq.coq-version}-multinomials-${version}";
  version = "1.0";
  src = fetchFromGitHub {
    owner = "math-comp";
    repo = "multinomials";
    rev = version;
    sha256 = "1qmbxp1h81cy3imh627pznmng0kvv37k4hrwi2faa101s6bcx55m";
  };

  buildInputs = [ coq ];
  propagatedBuildInputs = [ mathcomp ];

  installFlags = "COQLIB=$(out)/lib/coq/${coq.coq-version}/";

  meta = {
    description = "A Coq/SSReflect Library for Monoidal Rings and Multinomials";
    inherit (src.meta) homepage;
    license = stdenv.lib.licenses.cecill-b;
    inherit (coq.meta) platforms;
  };

  passthru = {
    compatibleCoqVersions = v: builtins.elem v [ "8.5" "8.6" "8.7" ];
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-go"></a>9.5. Go</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-go-modules"></a>9.5.1. Go modules</h3></div></div></div><p>
     The function <code class="varname"> buildGoModule </code> builds Go programs managed
     with Go modules. It builds a
     <a class="link" href="https://github.com/golang/go/wiki/Modules" target="_top">Go
     modules</a> through a two phase build:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        An intermediate fetcher derivation. This derivation will be used to
        fetch all of the dependencies of the Go module.
       </p></li><li class="listitem"><p>
        A final derivation will use the output of the intermediate derivation
        to build the binaries and produce the final output.
       </p></li></ul></div><p>
    </p><div class="example"><a id="ex-buildGoModule"></a><p class="title"><strong>Example 9.5. buildGoModule</strong></p><div class="example-contents"><pre class="programlisting">
pet = buildGoModule rec {
  name = "pet-${version}";
  version = "0.3.4";

  src = fetchFromGitHub {
    owner = "knqyf263";
    repo = "pet";
    rev = "v${version}";
    sha256 = "0m2fzpqxk7hrbxsgqplkg7h2p7gv6s1miymv3gvw0cz039skag0s";
  };

  modSha256 = "1879j77k96684wi554rkjxydrj8g3hpp0kvxz03sd8dmwr3lh83j"; <a id="ex-buildGoModule-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>

  subPackages = [ "." ]; <a id="ex-buildGoModule-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>

  meta = with lib; {
    description = "Simple command-line snippet manager, written in Go";
    homepage = https://github.com/knqyf263/pet;
    license = licenses.mit;
    maintainers = with maintainers; [ kalbasit ];
    platforms = platforms.linux ++ platforms.darwin;
  };
}
</pre></div></div><br class="example-break" /><p>
     <a class="xref" href="#ex-buildGoModule" title="Example 9.5. buildGoModule">Example 9.5, “buildGoModule”</a> is an example expression using
     buildGoModule, the following arguments are of special significance to the
     function:
     </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoModule-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">modSha256</code> is the hash of the output of the
        intermediate fetcher derivation.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoModule-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">subPackages</code> limits the builder from building child
        packages that have not been listed. If <code class="varname">subPackages</code>
        is not specified, all child packages will be built.
       </p></td></tr></table></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-go-legacy"></a>9.5.2. Go legacy</h3></div></div></div><p>
     The function <code class="varname"> buildGoPackage </code> builds legacy Go
     programs, not supporting Go modules.
    </p><div class="example"><a id="ex-buildGoPackage"></a><p class="title"><strong>Example 9.6. buildGoPackage</strong></p><div class="example-contents"><pre class="programlisting">
deis = buildGoPackage rec {
  name = "deis-${version}";
  version = "1.13.0";

  goPackagePath = "github.com/deis/deis"; <a id="ex-buildGoPackage-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  subPackages = [ "client" ]; <a id="ex-buildGoPackage-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>

  src = fetchFromGitHub {
    owner = "deis";
    repo = "deis";
    rev = "v${version}";
    sha256 = "1qv9lxqx7m18029lj8cw3k7jngvxs4iciwrypdy0gd2nnghc68sw";
  };

  goDeps = ./deps.nix; <a id="ex-buildGoPackage-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>

  buildFlags = "--tags release"; <a id="ex-buildGoPackage-4"></a><span><img src="images/callouts/4.svg" alt="4" border="0" /></span>
}
</pre></div></div><br class="example-break" /><p>
     <a class="xref" href="#ex-buildGoPackage" title="Example 9.6. buildGoPackage">Example 9.6, “buildGoPackage”</a> is an example expression using
     buildGoPackage, the following arguments are of special significance to the
     function:
     </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoPackage-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">goPackagePath</code> specifies the package's canonical Go
        import path.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoPackage-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">subPackages</code> limits the builder from building child
        packages that have not been listed. If <code class="varname">subPackages</code>
        is not specified, all child packages will be built.
       </p><p>
        In this example only <code class="literal">github.com/deis/deis/client</code>
        will be built.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoPackage-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">goDeps</code> is where the Go dependencies of a Go program
        are listed as a list of package source identified by Go import path. It
        could be imported as a separate <code class="varname">deps.nix</code> file for
        readability. The dependency data structure is described below.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-buildGoPackage-4"><span><img src="images/callouts/4.svg" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">buildFlags</code> is a list of flags passed to the go build
        command.
       </p></td></tr></table></div><p>
    </p><p>
     The <code class="varname">goDeps</code> attribute can be imported from a separate
     <code class="varname">nix</code> file that defines which Go libraries are needed and
     should be included in <code class="varname">GOPATH</code> for
     <code class="varname">buildPhase</code>.
    </p><div class="example"><a id="ex-goDeps"></a><p class="title"><strong>Example 9.7. deps.nix</strong></p><div class="example-contents"><pre class="programlisting">
[ <a id="ex-goDeps-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
  {
    goPackagePath = "gopkg.in/yaml.v2"; <a id="ex-goDeps-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
    fetch = {
      type = "git"; <a id="ex-goDeps-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
      url = "https://gopkg.in/yaml.v2";
      rev = "a83829b6f1293c91addabc89d0571c246397bbf4";
      sha256 = "1m4dsmk90sbi17571h6pld44zxz7jc4lrnl4f27dpd1l8g5xvjhh";
    };
  }
  {
    goPackagePath = "github.com/docopt/docopt-go";
    fetch = {
      type = "git";
      url = "https://github.com/docopt/docopt-go";
      rev = "784ddc588536785e7299f7272f39101f7faccc3f";
      sha256 = "0wwz48jl9fvl1iknvn9dqr4gfy1qs03gxaikrxxp9gry6773v3sj";
    };
  }
]
</pre></div></div><br class="example-break" /><p>
     </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#ex-goDeps-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">goDeps</code> is a list of Go dependencies.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-goDeps-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">goPackagePath</code> specifies Go package import path.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#ex-goDeps-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        <code class="varname">fetch type</code> that needs to be used to get package
        source. If <code class="varname">git</code> is used there should be
        <code class="varname">url</code>, <code class="varname">rev</code> and
        <code class="varname">sha256</code> defined next to it.
       </p></td></tr></table></div><p>
    </p><p>
     To extract dependency information from a Go package in automated way use
     <a class="link" href="https://github.com/kamilchm/go2nix" target="_top">go2nix</a>. It
     can produce complete derivation and <code class="varname">goDeps</code> file for Go
     programs.
    </p><p>
     <code class="varname">buildGoPackage</code> produces
     <a class="xref" href="#chap-multiple-output" title="Chapter 4. Multiple-output packages"><em>Multiple-output packages</em></a> where
     <code class="varname">bin</code> includes program binaries. You can test build a Go
     binary as follows:
</p><pre class="screen">
    $ nix-build -A deis.bin
  </pre><p>
     or build all outputs with:
</p><pre class="screen">
    $ nix-build -A deis.all
  </pre><p>
     <code class="varname">bin</code> output will be installed by default with
     <code class="varname">nix-env -i</code> or <code class="varname">systemPackages</code>.
    </p><p>
     You may use Go packages installed into the active Nix profiles by adding
     the following to your ~/.bashrc:
</p><pre class="screen">
for p in $NIX_PROFILES; do
    GOPATH="$p/share/go:$GOPATH"
done
</pre><p>
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="users-guide-to-the-haskell-infrastructure"></a>9.6. User’s Guide to the Haskell Infrastructure</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-install-haskell-packages"></a>9.6.1. How to install Haskell packages</h3></div></div></div><p>
     Nixpkgs distributes build instructions for all Haskell packages registered
     on <a class="link" href="http://hackage.haskell.org/" target="_top">Hackage</a>, but
     strangely enough normal Nix package lookups don’t seem to discover
     any of them, except for the default version of ghc, cabal-install, and
     stack:
    </p><pre class="programlisting">
$ nix-env -i alex
error: selector ‘alex’ matches no derivations
$ nix-env -qa ghc
ghc-7.10.2
</pre><p>
     The Haskell package set is not registered in the top-level namespace
     because it is <span class="emphasis"><em>huge</em></span>. If all Haskell packages were
     visible to these commands, then name-based search/install operations would
     be much slower than they are now. We avoided that by keeping all
     Haskell-related packages in a separate attribute set called
     <code class="literal">haskellPackages</code>, which the following command will list:
    </p><pre class="programlisting">
$ nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskellPackages
haskellPackages.a50         a50-0.5
haskellPackages.abacate     haskell-abacate-0.0.0.0
haskellPackages.abcBridge   haskell-abcBridge-0.12
haskellPackages.afv         afv-0.1.1
haskellPackages.alex        alex-3.1.4
haskellPackages.Allure      Allure-0.4.101.1
haskellPackages.alms        alms-0.6.7
[... some 8000 entries omitted  ...]
</pre><p>
     To install any of those packages into your profile, refer to them by their
     attribute path (first column):
    </p><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -iA haskellPackages.Allure ...
</pre><p>
     The attribute path of any Haskell packages corresponds to the name of that
     particular package on Hackage: the package
     <code class="literal">cabal-install</code> has the attribute
     <code class="literal">haskellPackages.cabal-install</code>, and so on. (Actually,
     this convention causes trouble with packages like
     <code class="literal">3dmodels</code> and <code class="literal">4Blocks</code>, because these
     names are invalid identifiers in the Nix language. The issue of how to
     deal with these rare corner cases is currently unresolved.)
    </p><p>
     Haskell packages whose Nix name (second column) begins with a
     <code class="literal">haskell-</code> prefix are packages that provide a library
     whereas packages without that prefix provide just executables. Libraries
     may provide executables too, though: the package
     <code class="literal">haskell-pandoc</code>, for example, installs both a library
     and an application. You can install and use Haskell executables just like
     any other program in Nixpkgs, but using Haskell libraries for development
     is a bit trickier and we’ll address that subject in great detail in
     section <a class="link" href="#how-to-create-a-development-environment" title="9.6.2. How to create a development environment">How to
     create a development environment</a>.
    </p><p>
     Attribute paths are deterministic inside of Nixpkgs, but the path
     necessary to reach Nixpkgs varies from system to system. We dodged that
     problem by giving <code class="literal">nix-env</code> an explicit <code class="literal">-f
     "&lt;nixpkgs&gt;"</code> parameter, but if you call
     <code class="literal">nix-env</code> without that flag, then chances are the
     invocation fails:
    </p><pre class="programlisting">
$ nix-env -iA haskellPackages.cabal-install
error: attribute ‘haskellPackages’ in selection path
       ‘haskellPackages.cabal-install’ not found
</pre><p>
     On NixOS, for example, Nixpkgs does <span class="emphasis"><em>not</em></span> exist in the
     top-level namespace by default. To figure out the proper attribute path,
     it’s easiest to query for the path of a well-known Nixpkgs package,
     i.e.:
    </p><pre class="programlisting">
$ nix-env -qaP coreutils
nixos.coreutils  coreutils-8.23
</pre><p>
     If your system responds like that (most NixOS installations will), then
     the attribute path to <code class="literal">haskellPackages</code> is
     <code class="literal">nixos.haskellPackages</code>. Thus, if you want to use
     <code class="literal">nix-env</code> without giving an explicit
     <code class="literal">-f</code> flag, then that’s the way to do it:
    </p><pre class="programlisting">
nix-env -qaP -A nixos.haskellPackages
nix-env -iA nixos.haskellPackages.cabal-install
</pre><p>
     Our current default compiler is GHC 7.10.x and the
     <code class="literal">haskellPackages</code> set contains packages built with that
     particular version. Nixpkgs contains the latest major release of every GHC
     since 6.10.4, however, and there is a whole family of package sets
     available that defines Hackage packages built with each of those
     compilers, too:
    </p><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskell.packages.ghc6123
nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskell.packages.ghc763
</pre><p>
     The name <code class="literal">haskellPackages</code> is really just a synonym for
     <code class="literal">haskell.packages.ghc7102</code>, because we prefer that
     package set internally and recommend it to our users as their default
     choice, but ultimately you are free to compile your Haskell packages with
     any GHC version you please. The following command displays the complete
     list of available compilers:
    </p><pre class="programlisting">
$ nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskell.compiler
haskell.compiler.ghc6104        ghc-6.10.4
haskell.compiler.ghc6123        ghc-6.12.3
haskell.compiler.ghc704         ghc-7.0.4
haskell.compiler.ghc722         ghc-7.2.2
haskell.compiler.ghc742         ghc-7.4.2
haskell.compiler.ghc763         ghc-7.6.3
haskell.compiler.ghc784         ghc-7.8.4
haskell.compiler.ghc7102        ghc-7.10.2
haskell.compiler.ghcHEAD        ghc-7.11.20150402
haskell.compiler.ghcNokinds     ghc-nokinds-7.11.20150704
haskell.compiler.ghcjs          ghcjs-0.1.0
haskell.compiler.jhc            jhc-0.8.2
haskell.compiler.uhc            uhc-1.1.9.0
</pre><p>
     We have no package sets for <code class="literal">jhc</code> or
     <code class="literal">uhc</code> yet, unfortunately, but for every version of GHC
     listed above, there exists a package set based on that compiler. Also, the
     attributes <code class="literal">haskell.compiler.ghcXYC</code> and
     <code class="literal">haskell.packages.ghcXYC.ghc</code> are synonymous for the sake
     of convenience.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-create-a-development-environment"></a>9.6.2. How to create a development environment</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-install-a-compiler"></a>9.6.2.1. How to install a compiler</h4></div></div></div><p>
      A simple development environment consists of a Haskell compiler and one
      or both of the tools <code class="literal">cabal-install</code> and
      <code class="literal">stack</code>. We saw in section
      <a class="link" href="#how-to-install-haskell-packages" title="9.6.1. How to install Haskell packages">How to install Haskell
      packages</a> how you can install those programs into your user
      profile:
     </p><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -iA haskellPackages.ghc haskellPackages.cabal-install
</pre><p>
      Instead of the default package set <code class="literal">haskellPackages</code>,
      you can also use the more precise name
      <code class="literal">haskell.compiler.ghc7102</code>, which has the advantage that
      it refers to the same GHC version regardless of what Nixpkgs considers
      <span class="quote">“<span class="quote">default</span>”</span> at any given time.
     </p><p>
      Once you’ve made those tools available in
      <code class="literal">$PATH</code>, it’s possible to build Hackage packages
      the same way people without access to Nix do it all the time:
     </p><pre class="programlisting">
cabal get lens-4.11 &amp;&amp; cd lens-4.11
cabal install -j --dependencies-only
cabal configure
cabal build
</pre><p>
      If you enjoy working with Cabal sandboxes, then that’s entirely
      possible too: just execute the command
     </p><pre class="programlisting">
cabal sandbox init
</pre><p>
      before installing the required dependencies.
     </p><p>
      The <code class="literal">nix-shell</code> utility makes it easy to switch to a
      different compiler version; just enter the Nix shell environment with the
      command
     </p><pre class="programlisting">
nix-shell -p haskell.compiler.ghc784
</pre><p>
      to bring GHC 7.8.4 into <code class="literal">$PATH</code>. Alternatively, you can
      use Stack instead of <code class="literal">nix-shell</code> directly to select
      compiler versions and other build tools per-project. It uses
      <code class="literal">nix-shell</code> under the hood when Nix support is turned
      on. See <a class="link" href="#how-to-build-a-haskell-project-using-stack" title="9.6.2.4. How to build a Haskell project using Stack">How to
      build a Haskell project using Stack</a>.
     </p><p>
      If you’re using <code class="literal">cabal-install</code>, re-running
      <code class="literal">cabal configure</code> inside the spawned shell switches your
      build to use that compiler instead. If you’re working on a project
      that doesn’t depend on any additional system libraries outside of
      GHC, then it’s even sufficient to just run the <code class="literal">cabal
      configure</code> command inside of the shell:
     </p><pre class="programlisting">
nix-shell -p haskell.compiler.ghc784 --command "cabal configure"
</pre><p>
      Afterwards, all other commands like <code class="literal">cabal build</code> work
      just fine in any shell environment, because the configure phase recorded
      the absolute paths to all required tools like GHC in its build
      configuration inside of the <code class="literal">dist/</code> directory. Please
      note, however, that <code class="literal">nix-collect-garbage</code> can break such
      an environment because the Nix store paths created by
      <code class="literal">nix-shell</code> aren’t <span class="quote">“<span class="quote">alive</span>”</span> anymore
      once <code class="literal">nix-shell</code> has terminated. If you find that your
      Haskell builds no longer work after garbage collection, then
      you’ll have to re-run <code class="literal">cabal configure</code> inside of
      a new <code class="literal">nix-shell</code> environment.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-install-a-compiler-with-libraries"></a>9.6.2.2. How to install a compiler with libraries</h4></div></div></div><p>
      GHC expects to find all installed libraries inside of its own
      <code class="literal">lib</code> directory. This approach works fine on traditional
      Unix systems, but it doesn’t work for Nix, because GHC’s
      store path is immutable once it’s built. We cannot install
      additional libraries into that location. As a consequence, our copies of
      GHC don’t know any packages except their own core libraries, like
      <code class="literal">base</code>, <code class="literal">containers</code>,
      <code class="literal">Cabal</code>, etc.
     </p><p>
      We can register additional libraries to GHC, however, using a special
      build function called <code class="literal">ghcWithPackages</code>. That function
      expects one argument: a function that maps from an attribute set of
      Haskell packages to a list of packages, which determines the libraries
      known to that particular version of GHC. For example, the Nix expression
      <code class="literal">ghcWithPackages (pkgs: [pkgs.mtl])</code> generates a copy of
      GHC that has the <code class="literal">mtl</code> library registered in addition to
      its normal core packages:
     </p><pre class="programlisting">
$ nix-shell -p "haskellPackages.ghcWithPackages (pkgs: [pkgs.mtl])"

[nix-shell:~]$ ghc-pkg list mtl
/nix/store/zy79...-ghc-7.10.2/lib/ghc-7.10.2/package.conf.d:
    mtl-2.2.1
</pre><p>
      This function allows users to define their own development environment by
      means of an override. After adding the following snippet to
      <code class="literal">~/.config/nixpkgs/config.nix</code>,
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    myHaskellEnv = self.haskell.packages.ghc7102.ghcWithPackages
                     (haskellPackages: with haskellPackages; [
                       # libraries
                       arrows async cgi criterion
                       # tools
                       cabal-install haskintex
                     ]);
  };
}
</pre><p>
      it’s possible to install that compiler with <code class="literal">nix-env -f
      "&lt;nixpkgs&gt;" -iA myHaskellEnv</code>. If you’d like to
      switch that development environment to a different version of GHC, just
      replace the <code class="literal">ghc7102</code> bit in the previous definition
      with the appropriate name. Of course, it’s also possible to define
      any number of these development environments! (You can’t install
      two of them into the same profile at the same time, though, because that
      would result in file conflicts.)
     </p><p>
      The generated <code class="literal">ghc</code> program is a wrapper script that
      re-directs the real GHC executable to use a new <code class="literal">lib</code>
      directory — one that we specifically constructed to contain all
      those packages the user requested:
     </p><pre class="programlisting">
$ cat $(type -p ghc)
#! /nix/store/xlxj...-bash-4.3-p33/bin/bash -e
export NIX_GHC=/nix/store/19sm...-ghc-7.10.2/bin/ghc
export NIX_GHCPKG=/nix/store/19sm...-ghc-7.10.2/bin/ghc-pkg
export NIX_GHC_DOCDIR=/nix/store/19sm...-ghc-7.10.2/share/doc/ghc/html
export NIX_GHC_LIBDIR=/nix/store/19sm...-ghc-7.10.2/lib/ghc-7.10.2
exec /nix/store/j50p...-ghc-7.10.2/bin/ghc "-B$NIX_GHC_LIBDIR" "$@"
</pre><p>
      The variables <code class="literal">$NIX_GHC</code>,
      <code class="literal">$NIX_GHCPKG</code>, etc. point to the
      <span class="emphasis"><em>new</em></span> store path <code class="literal">ghcWithPackages</code>
      constructed specifically for this environment. The last line of the
      wrapper script then executes the real <code class="literal">ghc</code>, but passes
      the path to the new <code class="literal">lib</code> directory using GHC’s
      <code class="literal">-B</code> flag.
     </p><p>
      The purpose of those environment variables is to work around an impurity
      in the popular
      <a class="link" href="http://hackage.haskell.org/package/ghc-paths" target="_top">ghc-paths</a>
      library. That library promises to give its users access to GHC’s
      installation paths. Only, the library can’t possible know that
      path when it’s compiled, because the path GHC considers its own is
      determined only much later, when the user configures it through
      <code class="literal">ghcWithPackages</code>. So we
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/patches/ghc-paths-nix.patch" target="_top">patched
      ghc-paths</a> to return the paths found in those environment variables
      at run-time rather than trying to guess them at compile-time.
     </p><p>
      To make sure that mechanism works properly all the time, we recommend
      that you set those variables to meaningful values in your shell
      environment, too, i.e. by adding the following code to your
      <code class="literal">~/.bashrc</code>:
     </p><pre class="programlisting">
if type &gt;/dev/null 2&gt;&amp;1 -p ghc; then
  eval "$(egrep ^export "$(type -p ghc)")"
fi
</pre><p>
      If you are certain that you’ll use only one GHC environment which
      is located in your user profile, then you can use the following code,
      too, which has the advantage that it doesn’t contain any paths
      from the Nix store, i.e. those settings always remain valid even if
      a <code class="literal">nix-env -u</code> operation updates the GHC environment in
      your profile:
     </p><pre class="programlisting">
if [ -e ~/.nix-profile/bin/ghc ]; then
  export NIX_GHC="$HOME/.nix-profile/bin/ghc"
  export NIX_GHCPKG="$HOME/.nix-profile/bin/ghc-pkg"
  export NIX_GHC_DOCDIR="$HOME/.nix-profile/share/doc/ghc/html"
  export NIX_GHC_LIBDIR="$HOME/.nix-profile/lib/ghc-$($NIX_GHC --numeric-version)"
fi
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-install-a-compiler-with-libraries-hoogle-and-documentation-indexes"></a>9.6.2.3. How to install a compiler with libraries, hoogle and documentation indexes</h4></div></div></div><p>
      If you plan to use your environment for interactive programming, not just
      compiling random Haskell code, you might want to replace
      <code class="literal">ghcWithPackages</code> in all the listings above with
      <code class="literal">ghcWithHoogle</code>.
     </p><p>
      This environment generator not only produces an environment with GHC and
      all the specified libraries, but also generates a
      <code class="literal">hoogle</code> and <code class="literal">haddock</code> indexes for all
      the packages, and provides a wrapper script around
      <code class="literal">hoogle</code> binary that uses all those things. A precise
      name for this thing would be
      <span class="quote">“<span class="quote"><code class="literal">ghcWithPackagesAndHoogleAndDocumentationIndexes</code></span>”</span>,
      which is, regrettably, too long and scary.
     </p><p>
      For example, installing the following environment
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    myHaskellEnv = self.haskellPackages.ghcWithHoogle
                     (haskellPackages: with haskellPackages; [
                       # libraries
                       arrows async cgi criterion
                       # tools
                       cabal-install haskintex
                     ]);
  };
}
</pre><p>
      allows one to browse module documentation index
      <a class="link" href="https://downloads.haskell.org/~ghc/latest/docs/html/libraries/index.html" target="_top">not
      too dissimilar to this</a> for all the specified packages and their
      dependencies by directing a browser of choice to
      <code class="literal">~/.nix-profile/share/doc/hoogle/index.html</code> (or
      <code class="literal">/run/current-system/sw/share/doc/hoogle/index.html</code> in
      case you put it in <code class="literal">environment.systemPackages</code> in
      NixOS).
     </p><p>
      After you’ve marveled enough at that try adding the following to
      your <code class="literal">~/.ghc/ghci.conf</code>
     </p><pre class="programlisting">
:def hoogle \s -&gt; return $ ":! hoogle search -cl --count=15 \"" ++ s ++ "\""
:def doc \s -&gt; return $ ":! hoogle search -cl --info \"" ++ s ++ "\""
</pre><p>
      and test it by typing into <code class="literal">ghci</code>:
     </p><pre class="programlisting">
:hoogle a -&gt; a
:doc a -&gt; a
</pre><p>
      Be sure to note the links to <code class="literal">haddock</code> files in the
      output. With any modern and properly configured terminal emulator you can
      just click those links to navigate there.
     </p><p>
      Finally, you can run
     </p><pre class="programlisting">
hoogle server --local -p 8080
</pre><p>
      and navigate to http://localhost:8080/ for your own local
      <a class="link" href="https://www.haskell.org/hoogle/" target="_top">Hoogle</a>. The
      <code class="literal">--local</code> flag makes the hoogle server serve files from
      your nix store over http, without the flag it will use
      <code class="literal">file://</code> URIs. Note, however, that Firefox and possibly
      other browsers disallow navigation from <code class="literal">http://</code> to
      <code class="literal">file://</code> URIs for security reasons, which might be
      quite an inconvenience. Versions before v5 did not have this flag. See
      <a class="link" href="http://kb.mozillazine.org/Links_to_local_pages_do_not_work" target="_top">this
      page</a> for workarounds.
     </p><p>
      For NixOS users there’s a service which runs this exact command
      for you. Specify the <code class="literal">packages</code> you want documentation
      for and the <code class="literal">haskellPackages</code> set you want them to come
      from. Add the following to <code class="literal">configuration.nix</code>.
     </p><pre class="programlisting">
services.hoogle = {
  enable = true;
  packages = (hpkgs: with hpkgs; [text cryptonite]);
  haskellPackages = pkgs.haskellPackages;
};
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-build-a-haskell-project-using-stack"></a>9.6.2.4. How to build a Haskell project using Stack</h4></div></div></div><p>
      <a class="link" href="http://haskellstack.org" target="_top">Stack</a> is a popular
      build tool for Haskell projects. It has first-class support for Nix.
      Stack can optionally use Nix to automatically select the right version of
      GHC and other build tools to build, test and execute apps in an existing
      project downloaded from somewhere on the Internet. Pass the
      <code class="literal">--nix</code> flag to any <code class="literal">stack</code> command to
      do so, e.g.
     </p><pre class="programlisting">
git clone --recursive http://github.com/yesodweb/wai
cd wai
stack --nix build
</pre><p>
      If you want <code class="literal">stack</code> to use Nix by default, you can add a
      <code class="literal">nix</code> section to the <code class="literal">stack.yaml</code> file,
      as explained in the
      <a class="link" href="http://docs.haskellstack.org/en/stable/nix_integration.html" target="_top">Stack
      documentation</a>. For example:
     </p><pre class="programlisting">
nix:
  enable: true
  packages: [pkgconfig zeromq zlib]
</pre><p>
      The example configuration snippet above tells Stack to create an ad hoc
      environment for <code class="literal">nix-shell</code> as in the below section, in
      which the <code class="literal">pkgconfig</code>, <code class="literal">zeromq</code> and
      <code class="literal">zlib</code> packages from Nixpkgs are available. All
      <code class="literal">stack</code> commands will implicitly be executed inside this
      ad hoc environment.
     </p><p>
      Some projects have more sophisticated needs. For examples, some ad hoc
      environments might need to expose Nixpkgs packages compiled in a certain
      way, or with extra environment variables. In these cases, you’ll
      need a <code class="literal">shell</code> field instead of
      <code class="literal">packages</code>:
     </p><pre class="programlisting">
nix:
  enable: true
  shell-file: shell.nix
</pre><p>
      For more on how to write a <code class="literal">shell.nix</code> file see the
      below section. You’ll need to express a derivation. Note that
      Nixpkgs ships with a convenience wrapper function around
      <code class="literal">mkDerivation</code> called
      <code class="literal">haskell.lib.buildStackProject</code> to help you create this
      derivation in exactly the way Stack expects. All of the same inputs as
      <code class="literal">mkDerivation</code> can be provided. For example, to build a
      Stack project that including packages that link against a version of the
      R library compiled with special options turned on:
     </p><pre class="programlisting">
with (import &lt;nixpkgs&gt; { });

let R = pkgs.R.override { enableStrictBarrier = true; };
in
haskell.lib.buildStackProject {
  name = "HaskellR";
  buildInputs = [ R zeromq zlib ];
}
</pre><p>
      You can select a particular GHC version to compile with by setting the
      <code class="literal">ghc</code> attribute as an argument to
      <code class="literal">buildStackProject</code>. Better yet, let Stack choose what
      GHC version it wants based on the snapshot specified in
      <code class="literal">stack.yaml</code> (only works with Stack &gt;= 1.1.3):
     </p><pre class="programlisting">
{nixpkgs ? import &lt;nixpkgs&gt; { }, ghc ? nixpkgs.ghc}:

with nixpkgs;

let R = pkgs.R.override { enableStrictBarrier = true; };
in
haskell.lib.buildStackProject {
  name = "HaskellR";
  buildInputs = [ R zeromq zlib ];
  inherit ghc;
}
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-create-ad-hoc-environments-for-nix-shell"></a>9.6.2.5. How to create ad hoc environments for <code class="literal">nix-shell</code></h4></div></div></div><p>
      The easiest way to create an ad hoc development environment is to run
      <code class="literal">nix-shell</code> with the appropriate GHC environment given
      on the command-line:
     </p><pre class="programlisting">
nix-shell -p "haskellPackages.ghcWithPackages (pkgs: with pkgs; [mtl pandoc])"
</pre><p>
      For more sophisticated use-cases, however, it’s more convenient to
      save the desired configuration in a file called
      <code class="literal">shell.nix</code> that looks like this:
     </p><pre class="programlisting">
{ nixpkgs ? import &lt;nixpkgs&gt; {}, compiler ? "ghc7102" }:
let
  inherit (nixpkgs) pkgs;
  ghc = pkgs.haskell.packages.${compiler}.ghcWithPackages (ps: with ps; [
          monad-par mtl
        ]);
in
pkgs.stdenv.mkDerivation {
  name = "my-haskell-env-0";
  buildInputs = [ ghc ];
  shellHook = "eval $(egrep ^export ${ghc}/bin/ghc)";
}
</pre><p>
      Now run <code class="literal">nix-shell</code> — or even <code class="literal">nix-shell
      --pure</code> — to enter a shell environment that has the
      appropriate compiler in <code class="literal">$PATH</code>. If you use
      <code class="literal">--pure</code>, then add all other packages that your
      development environment needs into the <code class="literal">buildInputs</code>
      attribute. If you’d like to switch to a different compiler
      version, then pass an appropriate <code class="literal">compiler</code> argument to
      the expression, i.e. <code class="literal">nix-shell --argstr compiler
      ghc784</code>.
     </p><p>
      If you need such an environment because you’d like to compile a
      Hackage package outside of Nix — i.e. because you’re
      hacking on the latest version from Git —, then the package set
      provides suitable nix-shell environments for you already! Every Haskell
      package has an <code class="literal">env</code> attribute that provides a shell
      environment suitable for compiling that particular package. If
      you’d like to hack the <code class="literal">lens</code> library, for
      example, then you just have to check out the source code and enter the
      appropriate environment:
     </p><pre class="programlisting">
$ cabal get lens-4.11 &amp;&amp; cd lens-4.11
Downloading lens-4.11...
Unpacking to lens-4.11/

$ nix-shell "&lt;nixpkgs&gt;" -A haskellPackages.lens.env
[nix-shell:/tmp/lens-4.11]$
</pre><p>
      At point, you can run <code class="literal">cabal configure</code>, <code class="literal">cabal
      build</code>, and all the other development commands. Note that you
      need <code class="literal">cabal-install</code> installed in your
      <code class="literal">$PATH</code> already to use it here — the
      <code class="literal">nix-shell</code> environment does not provide it.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="how-to-create-nix-builds-for-your-own-private-haskell-packages"></a>9.6.3. How to create Nix builds for your own private Haskell packages</h3></div></div></div><p>
     If your own Haskell packages have build instructions for Cabal, then you
     can convert those automatically into build instructions for Nix using the
     <code class="literal">cabal2nix</code> utility, which you can install into your
     profile by running <code class="literal">nix-env -i cabal2nix</code>.
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-build-a-stand-alone-project"></a>9.6.3.1. How to build a stand-alone project</h4></div></div></div><p>
      For example, let’s assume that you’re working on a private
      project called <code class="literal">foo</code>. To generate a Nix build expression
      for it, change into the project’s top-level directory and run the
      command:
     </p><pre class="programlisting">
cabal2nix . &gt; foo.nix
</pre><p>
      Then write the following snippet into a file called
      <code class="literal">default.nix</code>:
     </p><pre class="programlisting">
{ nixpkgs ? import &lt;nixpkgs&gt; {}, compiler ? "ghc7102" }:
nixpkgs.pkgs.haskell.packages.${compiler}.callPackage ./foo.nix { }
</pre><p>
      Finally, store the following code in a file called
      <code class="literal">shell.nix</code>:
     </p><pre class="programlisting">
{ nixpkgs ? import &lt;nixpkgs&gt; {}, compiler ? "ghc7102" }:
(import ./default.nix { inherit nixpkgs compiler; }).env
</pre><p>
      At this point, you can run <code class="literal">nix-build</code> to have Nix
      compile your project and install it into a Nix store path. The local
      directory will contain a symlink called <code class="literal">result</code> after
      <code class="literal">nix-build</code> returns that points into that location. Of
      course, passing the flag <code class="literal">--argstr compiler ghc763</code>
      allows switching the build to any version of GHC currently supported.
     </p><p>
      Furthermore, you can call <code class="literal">nix-shell</code> to enter an
      interactive development environment in which you can use <code class="literal">cabal
      configure</code> and <code class="literal">cabal build</code> to develop your
      code. That environment will automatically contain a proper GHC derivation
      with all the required libraries registered as well as all the
      system-level libraries your package might need.
     </p><p>
      If your package does not depend on any system-level libraries, then
      it’s sufficient to run
     </p><pre class="programlisting">
nix-shell --command "cabal configure"
</pre><p>
      once to set up your build. <code class="literal">cabal-install</code> determines
      the absolute paths to all resources required for the build and writes
      them into a config file in the <code class="literal">dist/</code> directory. Once
      that’s done, you can run <code class="literal">cabal build</code> and any
      other command for that project even outside of the
      <code class="literal">nix-shell</code> environment. This feature is particularly
      nice for those of us who like to edit their code with an IDE, like
      Emacs’ <code class="literal">haskell-mode</code>, because it’s not
      necessary to start Emacs inside of nix-shell just to make it find out the
      necessary settings for building the project;
      <code class="literal">cabal-install</code> has already done that for us.
     </p><p>
      If you want to do some quick-and-dirty hacking and don’t want to
      bother setting up a <code class="literal">default.nix</code> and
      <code class="literal">shell.nix</code> file manually, then you can use the
      <code class="literal">--shell</code> flag offered by <code class="literal">cabal2nix</code>
      to have it generate a stand-alone <code class="literal">nix-shell</code>
      environment for you. With that feature, running
     </p><pre class="programlisting">
cabal2nix --shell . &gt; shell.nix
nix-shell --command "cabal configure"
</pre><p>
      is usually enough to set up a build environment for any given Haskell
      package. You can even use that generated file to run
      <code class="literal">nix-build</code>, too:
     </p><pre class="programlisting">
nix-build shell.nix
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-build-projects-that-depend-on-each-other"></a>9.6.3.2. How to build projects that depend on each other</h4></div></div></div><p>
      If you have multiple private Haskell packages that depend on each other,
      then you’ll have to register those packages in the Nixpkgs set to
      make them visible for the dependency resolution performed by
      <code class="literal">callPackage</code>. First of all, change into each of your
      projects top-level directories and generate a
      <code class="literal">default.nix</code> file with <code class="literal">cabal2nix</code>:
     </p><pre class="programlisting">
cd ~/src/foo &amp;&amp; cabal2nix . &gt; default.nix
cd ~/src/bar &amp;&amp; cabal2nix . &gt; default.nix
</pre><p>
      Then edit your <code class="literal">~/.config/nixpkgs/config.nix</code> file to
      register those builds in the default Haskell package set:
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    haskellPackages = super.haskellPackages.override {
      overrides = self: super: {
        foo = self.callPackage ../src/foo {};
        bar = self.callPackage ../src/bar {};
      };
    };
  };
}
</pre><p>
      Once that’s accomplished, <code class="literal">nix-env -f "&lt;nixpkgs&gt;"
      -qA haskellPackages</code> will show your packages like any other
      package from Hackage, and you can build them
     </p><pre class="programlisting">
nix-build "&lt;nixpkgs&gt;" -A haskellPackages.foo
</pre><p>
      or enter an interactive shell environment suitable for building them:
     </p><pre class="programlisting">
nix-shell "&lt;nixpkgs&gt;" -A haskellPackages.bar.env
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="miscellaneous-topics"></a>9.6.4. Miscellaneous Topics</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-build-with-profiling-enabled"></a>9.6.4.1. How to build with profiling enabled</h4></div></div></div><p>
      Every Haskell package set takes a function called
      <code class="literal">overrides</code> that you can use to manipulate the package
      as much as you please. One useful application of this feature is to
      replace the default <code class="literal">mkDerivation</code> function with one
      that enables library profiling for all packages. To accomplish that add
      the following snippet to your
      <code class="literal">~/.config/nixpkgs/config.nix</code> file:
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    profiledHaskellPackages = self.haskellPackages.override {
      overrides = self: super: {
        mkDerivation = args: super.mkDerivation (args // {
          enableLibraryProfiling = true;
        });
      };
    };
  };
}
</pre><p>
      Then, replace instances of <code class="literal">haskellPackages</code> in the
      <code class="literal">cabal2nix</code>-generated <code class="literal">default.nix</code> or
      <code class="literal">shell.nix</code> files with
      <code class="literal">profiledHaskellPackages</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-package-versions-in-a-compiler-specific-package-set"></a>9.6.4.2. How to override package versions in a compiler-specific package set</h4></div></div></div><p>
      Nixpkgs provides the latest version of
      <a class="link" href="http://hackage.haskell.org/package/ghc-events" target="_top"><code class="literal">ghc-events</code></a>,
      which is 0.4.4.0 at the time of this writing. This is fine for users of
      GHC 7.10.x, but GHC 7.8.4 cannot compile that binary. Now, one way to
      solve that problem is to register an older version of
      <code class="literal">ghc-events</code> in the 7.8.x-specific package set. The
      first step is to generate Nix build instructions with
      <code class="literal">cabal2nix</code>:
     </p><pre class="programlisting">
cabal2nix cabal://ghc-events-0.4.3.0 &gt; ~/.nixpkgs/ghc-events-0.4.3.0.nix
</pre><p>
      Then add the override in <code class="literal">~/.config/nixpkgs/config.nix</code>:
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    haskell = super.haskell // {
      packages = super.haskell.packages // {
        ghc784 = super.haskell.packages.ghc784.override {
          overrides = self: super: {
            ghc-events = self.callPackage ./ghc-events-0.4.3.0.nix {};
          };
        };
      };
    };
  };
}
</pre><p>
      This code is a little crazy, no doubt, but it’s necessary because
      the intuitive version
     </p><pre class="programlisting">
{ # ...

  haskell.packages.ghc784 = super.haskell.packages.ghc784.override {
    overrides = self: super: {
      ghc-events = self.callPackage ./ghc-events-0.4.3.0.nix {};
    };
  };
}
</pre><p>
      doesn’t do what we want it to: that code replaces the
      <code class="literal">haskell</code> package set in Nixpkgs with one that contains
      only one entry,<code class="literal">packages</code>, which contains only one entry
      <code class="literal">ghc784</code>. This override loses the
      <code class="literal">haskell.compiler</code> set, and it loses the
      <code class="literal">haskell.packages.ghcXYZ</code> sets for all compilers but GHC
      7.8.4. To avoid that problem, we have to perform the convoluted little
      dance from above, iterating over each step in hierarchy.
     </p><p>
      Once it’s accomplished, however, we can install a variant of
      <code class="literal">ghc-events</code> that’s compiled with GHC 7.8.4:
     </p><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -iA haskell.packages.ghc784.ghc-events
</pre><p>
      Unfortunately, it turns out that this build fails again while executing
      the test suite! Apparently, the release archive on Hackage is missing
      some data files that the test suite requires, so we cannot run it. We
      accomplish that by re-generating the Nix expression with the
      <code class="literal">--no-check</code> flag:
     </p><pre class="programlisting">
cabal2nix --no-check cabal://ghc-events-0.4.3.0 &gt; ~/.nixpkgs/ghc-events-0.4.3.0.nix
</pre><p>
      Now the builds succeeds.
     </p><p>
      Of course, in the concrete example of <code class="literal">ghc-events</code> this
      whole exercise is not an ideal solution, because
      <code class="literal">ghc-events</code> can analyze the output emitted by any
      version of GHC later than 6.12 regardless of the compiler version that
      was used to build the <code class="literal">ghc-events</code> executable, so
      strictly speaking there’s no reason to prefer one built with GHC
      7.8.x in the first place. However, for users who cannot use GHC 7.10.x at
      all for some reason, the approach of downgrading to an older version
      might be useful.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-packages-in-all-compiler-specific-package-sets"></a>9.6.4.3. How to override packages in all compiler-specific package sets</h4></div></div></div><p>
      In the previous section we learned how to override a package in a single
      compiler-specific package set. You may have some overrides defined that
      you want to use across multiple package sets. To accomplish this you
      could use the technique that we learned in the previous section by
      repeating the overrides for all the compiler-specific package sets. For
      example:
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    haskell = super.haskell // {
      packages = super.haskell.packages // {
        ghc784 = super.haskell.packages.ghc784.override {
          overrides = self: super: {
            my-package = ...;
            my-other-package = ...;
          };
        };
        ghc822 = super.haskell.packages.ghc784.override {
          overrides = self: super: {
            my-package = ...;
            my-other-package = ...;
          };
        };
        ...
      };
    };
  };
}
</pre><p>
      However there’s a more convenient way to override all
      compiler-specific package sets at once:
     </p><pre class="programlisting">
{
  packageOverrides = super: let self = super.pkgs; in
  {
    haskell = super.haskell // {
      packageOverrides = self: super: {
        my-package = ...;
        my-other-package = ...;
      };
    };
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-specify-source-overrides-for-your-haskell-package"></a>9.6.4.4. How to specify source overrides for your Haskell package</h4></div></div></div><p>
      When starting a Haskell project you can use
      <code class="literal">developPackage</code> to define a derivation for your package
      at the <code class="literal">root</code> path as well as source override versions
      for Hackage packages, like so:
     </p><pre class="programlisting">
# default.nix
{ compilerVersion ? "ghc842" }:
let
  # pinning nixpkgs using new Nix 2.0 builtin `fetchGit`
  pkgs = import (fetchGit (import ./version.nix)) { };
  compiler = pkgs.haskell.packages."${compilerVersion}";
  pkg = compiler.developPackage {
    root = ./.;
    source-overrides = {
      # Let's say the GHC 8.4.2 haskellPackages uses 1.6.0.0 and your test suite is incompatible with &gt;= 1.6.0.0
      HUnit = "1.5.0.0";
    };
  };
in pkg
</pre><p>
      This could be used in place of a simplified <code class="literal">stack.yaml</code>
      defining a Nix derivation for your Haskell package.
     </p><p>
      As you can see this allows you to specify only the source version found
      on Hackage and nixpkgs will take care of the rest.
     </p><p>
      You can also specify <code class="literal">buildInputs</code> for your Haskell
      derivation for packages that directly depend on external libraries like
      so:
     </p><pre class="programlisting">
# default.nix
{ compilerVersion ? "ghc842" }:
let
  # pinning nixpkgs using new Nix 2.0 builtin `fetchGit`
  pkgs = import (fetchGit (import ./version.nix)) { };
  compiler = pkgs.haskell.packages."${compilerVersion}";
  pkg = compiler.developPackage {
    root = ./.;
    source-overrides = {
      HUnit = "1.5.0.0"; # Let's say the GHC 8.4.2 haskellPackages uses 1.6.0.0 and your test suite is incompatible with &gt;= 1.6.0.0
    };
  };
  # in case your package source depends on any libraries directly, not just transitively.
  buildInputs = [ zlib ];
in pkg.overrideAttrs(attrs: {
  buildInputs = attrs.buildInputs ++ buildInputs;
})
</pre><p>
      Notice that you will need to override (via
      <code class="literal">overrideAttrs</code> or similar) the derivation returned by
      the <code class="literal">developPackage</code> Nix lambda as there is no
      <code class="literal">buildInputs</code> named argument you can pass directly into
      the <code class="literal">developPackage</code> lambda.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-recover-from-ghcs-infamous-non-deterministic-library-id-bug"></a>9.6.4.5. How to recover from GHC’s infamous non-deterministic library ID bug</h4></div></div></div><p>
      GHC and distributed build farms don’t get along well:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        https://ghc.haskell.org/trac/ghc/ticket/4012
       </p></li></ul></div><p>
      When you see an error like this one
     </p><pre class="programlisting">
package foo-0.7.1.0 is broken due to missing package
text-1.2.0.4-98506efb1b9ada233bb5c2b2db516d91
</pre><p>
      then you have to download and re-install <code class="literal">foo</code> and all
      its dependents from scratch:
     </p><pre class="programlisting">
nix-store -q --referrers /nix/store/*-haskell-text-1.2.0.4 \
  | xargs -L 1 nix-store --repair-path
</pre><p>
      If you’re using additional Hydra servers other than
      <code class="literal">hydra.nixos.org</code>, then it might be necessary to purge
      the local caches that store data from those machines to disable these
      binary channels for the duration of the previous command, i.e. by
      running:
     </p><pre class="programlisting">
rm ~/.cache/nix/binary-cache*.sqlite
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="builds-on-darwin-fail-with-math.h-not-found"></a>9.6.4.6. Builds on Darwin fail with <code class="literal">math.h</code> not found</h4></div></div></div><p>
      Users of GHC on Darwin have occasionally reported that builds fail,
      because the compiler complains about a missing include file:
     </p><pre class="programlisting">
fatal error: 'math.h' file not found
</pre><p>
      The issue has been discussed at length in
      <a class="link" href="https://github.com/NixOS/nixpkgs/issues/6390" target="_top">ticket
      6390</a>, and so far no good solution has been proposed. As a
      work-around, users who run into this problem can configure the
      environment variables
     </p><pre class="programlisting">
export NIX_CFLAGS_COMPILE="-idirafter /usr/include"
export NIX_CFLAGS_LINK="-L/usr/lib"
</pre><p>
      in their <code class="literal">~/.bashrc</code> file to avoid the compiler error.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="builds-using-stack-complain-about-missing-system-libraries"></a>9.6.4.7. Builds using Stack complain about missing system libraries</h4></div></div></div><pre class="programlisting">
--  While building package zlib-0.5.4.2 using:
  runhaskell -package=Cabal-1.22.4.0 -clear-package-db [... lots of flags ...]
Process exited with code: ExitFailure 1
Logs have been written to: /home/foo/src/stack-ide/.stack-work/logs/zlib-0.5.4.2.log

Configuring zlib-0.5.4.2...
Setup.hs: Missing dependency on a foreign library:
* Missing (or bad) header file: zlib.h
This problem can usually be solved by installing the system package that
provides this library (you may need the "-dev" version). If the library is
already installed but in a non-standard location then you can use the flags
--extra-include-dirs= and --extra-lib-dirs= to specify where it is.
If the header file does exist, it may contain errors that are caught by the C
compiler at the preprocessing stage. In this case you can re-run configure
with the verbosity flag -v3 to see the error messages.
</pre><p>
      When you run the build inside of the nix-shell environment, the system is
      configured to find <code class="literal">libz.so</code> without any special flags
      – the compiler and linker <span class="quote">“<span class="quote">just know</span>”</span> how to find it.
      Consequently, Cabal won’t record any search paths for
      <code class="literal">libz.so</code> in the package description, which means that
      the package works fine inside of nix-shell, but once you leave the shell
      the shared object can no longer be found. That issue is by no means
      specific to Stack: you’ll have that problem with any other Haskell
      package that’s built inside of nix-shell but run outside of that
      environment.
     </p><p>
      You can remedy this issue in several ways. The easiest is to add a
      <code class="literal">nix</code> section to the <code class="literal">stack.yaml</code> like
      the following:
     </p><pre class="programlisting">
nix:
  enable: true
  packages: [ zlib ]
</pre><p>
      Stack’s Nix support knows to add
      <code class="literal">${zlib.out}/lib</code> and
      <code class="literal">${zlib.dev}/include</code> as an
      <code class="literal">--extra-lib-dirs</code> and
      <code class="literal">extra-include-dirs</code>, respectively. Alternatively, you
      can achieve the same effect by hand. First of all, run
     </p><pre class="programlisting">
$ nix-build --no-out-link "&lt;nixpkgs&gt;" -A zlib
/nix/store/alsvwzkiw4b7ip38l4nlfjijdvg3fvzn-zlib-1.2.8
</pre><p>
      to find out the store path of the system’s zlib library. Now, you
      can
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        add that path (plus a <span class="quote">“<span class="quote">/lib</span>”</span> suffix) to your
        <code class="literal">$LD_LIBRARY_PATH</code> environment variable to make sure
        your system linker finds <code class="literal">libz.so</code> automatically.
        It’s no pretty solution, but it will work.
       </p></li><li class="listitem"><p>
        As a variant of (1), you can also install any number of system
        libraries into your user’s profile (or some other profile) and
        point <code class="literal">$LD_LIBRARY_PATH</code> to that profile instead, so
        that you don’t have to list dozens of those store paths all over
        the place.
       </p></li><li class="listitem"><p>
        The solution I prefer is to call stack with an appropriate
        –extra-lib-dirs flag like so: <code class="literal">shell stack
        --extra-lib-dirs=/nix/store/alsvwzkiw4b7ip38l4nlfjijdvg3fvzn-zlib-1.2.8/lib
        build</code>
       </p></li></ol></div><p>
      Typically, you’ll need <code class="literal">--extra-include-dirs</code> as
      well. It’s possible to add those flag to the project’s
      <code class="literal">stack.yaml</code> or your user’s global
      <code class="literal">~/.stack/global/stack.yaml</code> file so that you
      don’t have to specify them manually every time. But again,
      you’re likely better off using Stack’s Nix support instead.
     </p><p>
      The same thing applies to <code class="literal">cabal configure</code>, of course,
      if you’re building with <code class="literal">cabal-install</code> instead
      of Stack.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="creating-statically-linked-binaries"></a>9.6.4.8. Creating statically linked binaries</h4></div></div></div><p>
      There are two levels of static linking. The first option is to configure
      the build with the Cabal flag
      <code class="literal">--disable-executable-dynamic</code>. In Nix expressions, this
      can be achieved by setting the attribute:
     </p><pre class="programlisting">
enableSharedExecutables = false;
</pre><p>
      That gives you a binary with statically linked Haskell libraries and
      dynamically linked system libraries.
     </p><p>
      To link both Haskell libraries and system libraries statically, the
      additional flags <code class="literal">--ghc-option=-optl=-static
      --ghc-option=-optl=-pthread</code> need to be used. In Nix, this is
      accomplished with:
     </p><pre class="programlisting">
configureFlags = [ "--ghc-option=-optl=-static" "--ghc-option=-optl=-pthread" ];
</pre><p>
      It’s important to realize, however, that most system libraries in
      Nix are built as shared libraries only, i.e. there is just no static
      library available that Cabal could link!
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-ghc-with-integer-simple"></a>9.6.4.9. Building GHC with integer-simple</h4></div></div></div><p>
      By default GHC implements the Integer type using the
      <a class="link" href="https://gmplib.org/" target="_top">GNU Multiple Precision Arithmetic
      (GMP) library</a>. The implementation can be found in the
      <a class="link" href="http://hackage.haskell.org/package/integer-gmp" target="_top">integer-gmp</a>
      package.
     </p><p>
      A potential problem with this is that GMP is licensed under the
      <a class="link" href="https://www.gnu.org/copyleft/lesser.html" target="_top">GNU Lesser
      General Public License (LGPL)</a>, a kind of <span class="quote">“<span class="quote">copyleft</span>”</span>
      license. According to the terms of the LGPL, paragraph 5, you may
      distribute a program that is designed to be compiled and dynamically
      linked with the library under the terms of your choice (i.e.,
      commercially) but if your program incorporates portions of the library,
      if it is linked statically, then your program is a
      <span class="quote">“<span class="quote">derivative</span>”</span>–a <span class="quote">“<span class="quote">work based on the
      library</span>”</span>–and according to paragraph 2, section c, you
      <span class="quote">“<span class="quote">must cause the whole of the work to be licensed</span>”</span> under the
      terms of the LGPL (including for free).
     </p><p>
      The LGPL licensing for GMP is a problem for the overall licensing of
      binary programs compiled with GHC because most distributions (and builds)
      of GHC use static libraries. (Dynamic libraries are currently distributed
      only for macOS.) The LGPL licensing situation may be worse: even though
      <a class="link" href="https://www.haskell.org/ghc/license" target="_top">The Glasgow
      Haskell Compiler License</a> is essentially a <span class="quote">“<span class="quote">free
      software</span>”</span> license (BSD3), according to paragraph 2 of the LGPL,
      GHC must be distributed under the terms of the LGPL!
     </p><p>
      To work around these problems GHC can be build with a slower but
      LGPL-free alternative implemention for Integer called
      <a class="link" href="http://hackage.haskell.org/package/integer-simple" target="_top">integer-simple</a>.
     </p><p>
      To get a GHC compiler build with <code class="literal">integer-simple</code>
      instead of <code class="literal">integer-gmp</code> use the attribute:
      <code class="literal">haskell.compiler.integer-simple."${ghcVersion}"</code>. For
      example:
     </p><pre class="programlisting">
$ nix-build -E '(import &lt;nixpkgs&gt; {}).haskell.compiler.integer-simple.ghc802'
...
$ result/bin/ghc-pkg list | grep integer
    integer-simple-0.1.1.1
</pre><p>
      The following command displays the complete list of GHC compilers build
      with <code class="literal">integer-simple</code>:
     </p><pre class="programlisting">
$ nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskell.compiler.integer-simple
haskell.compiler.integer-simple.ghc7102  ghc-7.10.2
haskell.compiler.integer-simple.ghc7103  ghc-7.10.3
haskell.compiler.integer-simple.ghc722   ghc-7.2.2
haskell.compiler.integer-simple.ghc742   ghc-7.4.2
haskell.compiler.integer-simple.ghc783   ghc-7.8.3
haskell.compiler.integer-simple.ghc784   ghc-7.8.4
haskell.compiler.integer-simple.ghc801   ghc-8.0.1
haskell.compiler.integer-simple.ghc802   ghc-8.0.2
haskell.compiler.integer-simple.ghcHEAD  ghc-8.1.20170106
</pre><p>
      To get a package set supporting <code class="literal">integer-simple</code> use the
      attribute:
      <code class="literal">haskell.packages.integer-simple."${ghcVersion}"</code>. For
      example use the following to get the <code class="literal">scientific</code>
      package build with <code class="literal">integer-simple</code>:
     </p><pre class="programlisting">
nix-build -A haskell.packages.integer-simple.ghc802.scientific
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="quality-assurance"></a>9.6.4.10. Quality assurance</h4></div></div></div><p>
      The <code class="literal">haskell.lib</code> library includes a number of functions
      for checking for various imperfections in Haskell packages. It’s
      useful to apply these functions to your own Haskell packages and
      integrate that in a Continuous Integration server like
      <a class="link" href="https://nixos.org/hydra/" target="_top">hydra</a> to assure your
      packages maintain a minimum level of quality. This section discusses some
      of these functions.
     </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="failonallwarnings"></a>9.6.4.10.1. failOnAllWarnings</h5></div></div></div><p>
       Applying <code class="literal">haskell.lib.failOnAllWarnings</code> to a Haskell
       package enables the <code class="literal">-Wall</code> and
       <code class="literal">-Werror</code> GHC options to turn all warnings into build
       failures.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildstrictly"></a>9.6.4.10.2. buildStrictly</h5></div></div></div><p>
       Applying <code class="literal">haskell.lib.buildStrictly</code> to a Haskell
       package calls <code class="literal">failOnAllWarnings</code> on the given package
       to turn all warnings into build failures. Additionally the source of
       your package is gotten from first invoking <code class="literal">cabal
       sdist</code> to ensure all needed files are listed in the Cabal file.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="checkunusedpackages"></a>9.6.4.10.3. checkUnusedPackages</h5></div></div></div><p>
       Applying <code class="literal">haskell.lib.checkUnusedPackages</code> to a Haskell
       package invokes the
       <a class="link" href="http://hackage.haskell.org/package/packunused" target="_top">packunused</a>
       tool on the package. <code class="literal">packunused</code> complains when it
       finds packages listed as build-depends in the Cabal file which are
       redundant. For example:
      </p><pre class="programlisting">
$ nix-build -E 'let pkgs = import &lt;nixpkgs&gt; {}; in pkgs.haskell.lib.checkUnusedPackages {} pkgs.haskellPackages.scientific'
these derivations will be built:
  /nix/store/3lc51cxj2j57y3zfpq5i69qbzjpvyci1-scientific-0.3.5.1.drv
...
detected package components
~~~~~~~~~~~~~~~~~~~~~~~~~~~

 - library
 - testsuite(s): test-scientific
 - benchmark(s): bench-scientific*

(component names suffixed with '*' are not configured to be built)

library
~~~~~~~

The following package dependencies seem redundant:

 - ghc-prim-0.5.0.0

testsuite(test-scientific)
~~~~~~~~~~~~~~~~~~~~~~~~~~

no redundant packages dependencies found

builder for ‘/nix/store/3lc51cxj2j57y3zfpq5i69qbzjpvyci1-scientific-0.3.5.1.drv’ failed with exit code 1
error: build of ‘/nix/store/3lc51cxj2j57y3zfpq5i69qbzjpvyci1-scientific-0.3.5.1.drv’ failed
</pre><p>
       As you can see, <code class="literal">packunused</code> finds out that although
       the testsuite component has no redundant dependencies the library
       component of <code class="literal">scientific-0.3.5.1</code> depends on
       <code class="literal">ghc-prim</code> which is unused in the library.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="using-hackage2nix-with-nixpkgs"></a>9.6.4.11. Using hackage2nix with nixpkgs</h4></div></div></div><p>
      Hackage package derivations are found in the
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/hackage-packages.nix" target="_top"><code class="literal">hackage-packages.nix</code></a>
      file within <code class="literal">nixpkgs</code> and are used as the initial
      package set for <code class="literal">haskellPackages</code>. The
      <code class="literal">hackage-packages.nix</code> file is not meant to be edited by
      hand, but rather autogenerated by
      <a class="link" href="https://github.com/NixOS/cabal2nix/tree/master/hackage2nix" target="_top"><code class="literal">hackage2nix</code></a>,
      which by default uses the
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/configuration-hackage2nix.yaml" target="_top"><code class="literal">configuration-hackage2nix.yaml</code></a>
      file to generate all the derivations.
     </p><p>
      To modify the contents <code class="literal">configuration-hackage2nix.yaml</code>,
      follow the instructions on
      <a class="link" href="https://github.com/NixOS/cabal2nix/tree/master/hackage2nix" target="_top"><code class="literal">hackage2nix</code></a>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="other-resources"></a>9.6.5. Other resources</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       The Youtube video
       <a class="link" href="https://www.youtube.com/watch?v=BsBhi_r-OeE" target="_top">Nix Loves
       Haskell</a> provides an introduction into Haskell NG aimed at
       beginners. The slides are available at
       http://cryp.to/nixos-meetup-3-slides.pdf and also – in a form
       ready for cut &amp; paste – at
       https://github.com/NixOS/cabal2nix/blob/master/doc/nixos-meetup-3-slides.md.
      </p></li><li class="listitem"><p>
       Another Youtube video is
       <a class="link" href="https://www.youtube.com/watch?v=mQd3s57n_2Y" target="_top">Escaping
       Cabal Hell with Nix</a>, which discusses the subject of Haskell
       development with Nix but also provides a basic introduction to Nix as
       well, i.e. it’s suitable for viewers with almost no prior
       Nix experience.
      </p></li><li class="listitem"><p>
       Oliver Charles wrote a very nice
       <a class="link" href="http://wiki.ocharles.org.uk/Nix" target="_top">Tutorial how to
       develop Haskell packages with Nix</a>.
      </p></li><li class="listitem"><p>
       The <span class="emphasis"><em>Journey into the Haskell NG infrastructure</em></span>
       series of postings describe the new Haskell infrastructure in great
       detail:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <a class="link" href="https://nixos.org/nix-dev/2015-January/015591.html" target="_top">Part
         1</a> explains the differences between the old and the new code and
         gives instructions how to migrate to the new setup.
        </p></li><li class="listitem"><p>
         <a class="link" href="https://nixos.org/nix-dev/2015-January/015608.html" target="_top">Part
         2</a> looks in-depth at how to tweak and configure your setup by
         means of overrides.
        </p></li><li class="listitem"><p>
         <a class="link" href="https://nixos.org/nix-dev/2015-April/016912.html" target="_top">Part
         3</a> describes the infrastructure that keeps the Haskell package
         set in Nixpkgs up-to-date.
        </p></li></ul></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idris-packages"></a>9.7. Idris packages</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="installing-idris"></a>9.7.1. Installing Idris</h3></div></div></div><p>
     The easiest way to get a working idris version is to install the
     <code class="literal">idris</code> attribute:
    </p><pre class="programlisting">
$ # On NixOS
$ nix-env -i nixos.idris
$ # On non-NixOS
$ nix-env -i nixpkgs.idris
</pre><p>
     This however only provides the <code class="literal">prelude</code> and
     <code class="literal">base</code> libraries. To install additional libraries:
    </p><pre class="programlisting">
$ nix-env -iE 'pkgs: pkgs.idrisPackages.with-packages (with pkgs.idrisPackages; [ contrib pruviloj ])'
</pre><p>
     To see all available Idris packages:
    </p><pre class="programlisting">
$ # On NixOS
$ nix-env -qaPA nixos.idrisPackages
$ # On non-NixOS
$ nix-env -qaPA nixpkgs.idrisPackages
</pre><p>
     Similarly, entering a <code class="literal">nix-shell</code>:
    </p><pre class="programlisting">
$ nix-shell -p 'idrisPackages.with-packages (with idrisPackages; [ contrib pruviloj ])'
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="starting-idris-with-library-support"></a>9.7.2. Starting Idris with library support</h3></div></div></div><p>
     To have access to these libraries in idris, call it with an argument
     <code class="literal">-p &lt;library name&gt;</code> for each library:
    </p><pre class="programlisting">
$ nix-shell -p 'idrisPackages.with-packages (with idrisPackages; [ contrib pruviloj ])'
[nix-shell:~]$ idris -p contrib -p pruviloj
</pre><p>
     A listing of all available packages the Idris binary has access to is
     available via <code class="literal">--listlibs</code>:
    </p><pre class="programlisting">
$ idris --listlibs
00prelude-idx.ibc
pruviloj
base
contrib
prelude
00pruviloj-idx.ibc
00base-idx.ibc
00contrib-idx.ibc
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="building-an-idris-project-with-nix"></a>9.7.3. Building an Idris project with Nix</h3></div></div></div><p>
     As an example of how a Nix expression for an Idris package can be created,
     here is the one for <code class="literal">idrisPackages.yaml</code>:
    </p><pre class="programlisting">
{ build-idris-package
, fetchFromGitHub
, contrib
, lightyear
, lib
}:
build-idris-package  {
  name = "yaml";
  version = "2018-01-25";

  # This is the .ipkg file that should be built, defaults to the package name
  # In this case it should build `Yaml.ipkg` instead of `yaml.ipkg`
  # This is only necessary because the yaml packages ipkg file is
  # different from its package name here.
  ipkgName = "Yaml";
  # Idris dependencies to provide for the build
  idrisDeps = [ contrib lightyear ];

  src = fetchFromGitHub {
    owner = "Heather";
    repo = "Idris.Yaml";
    rev = "5afa51ffc839844862b8316faba3bafa15656db4";
    sha256 = "1g4pi0swmg214kndj85hj50ccmckni7piprsxfdzdfhg87s0avw7";
  };

  meta = {
    description = "Idris YAML lib";
    homepage = https://github.com/Heather/Idris.Yaml;
    license = lib.licenses.mit;
    maintainers = [ lib.maintainers.brainrape ];
  };
}
</pre><p>
     Assuming this file is saved as <code class="literal">yaml.nix</code>, it’s
     buildable using
    </p><pre class="programlisting">
$ nix-build -E '(import &lt;nixpkgs&gt; {}).idrisPackages.callPackage ./yaml.nix {}'
</pre><p>
     Or it’s possible to use
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

{
  yaml = idrisPackages.callPackage ./yaml.nix {};
}
</pre><p>
     in another file (say <code class="literal">default.nix</code>) to be able to build
     it with
    </p><pre class="programlisting">
$ nix-build -A yaml
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ios"></a>9.8. iOS</h2></div></div></div><p>
    This component is basically a wrapper/workaround that makes it possible to
    expose an Xcode installation as a Nix package by means of symlinking to the
    relevant executables on the host system.
   </p><p>
    Since Xcode can’t be packaged with Nix, nor we can publish it as a
    Nix package (because of its license) this is basically the only integration
    strategy making it possible to do iOS application builds that integrate
    with other components of the Nix ecosystem
   </p><p>
    The primary objective of this project is to use the Nix expression language
    to specify how iOS apps can be built from source code, and to automatically
    spawn iOS simulator instances for testing.
   </p><p>
    This component also makes it possible to use
    <a class="link" href="http://nixos.org/hydra" target="_top">Hydra</a>, the Nix-based
    continuous integration server to regularly build iOS apps and to do
    wireless ad-hoc installations of enterprise IPAs on iOS devices through
    Hydra.
   </p><p>
    The Xcode build environment implements a number of features.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="deploying-a-proxy-component-wrapper-exposing-xcode"></a>9.8.1. Deploying a proxy component wrapper exposing Xcode</h3></div></div></div><p>
     The first use case is deploying a Nix package that provides symlinks to
     the Xcode installation on the host system. This package can be used as a
     build input to any build function implemented in the Nix expression
     language that requires Xcode.
    </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};

  xcodeenv = import ./xcodeenv {
    inherit (pkgs) stdenv;
  };
in
xcodeenv.composeXcodeWrapper {
  version = "9.2";
  xcodeBaseDir = "/Applications/Xcode.app";
}
</pre><p>
     By deploying the above expression with <code class="literal">nix-build</code> and
     inspecting its content you will notice that several Xcode-related
     executables are exposed as a Nix package:
    </p><pre class="programlisting">
$ ls result/bin
lrwxr-xr-x  1 sander  staff  94  1 jan  1970 Simulator -&gt; /Applications/Xcode.app/Contents/Developer/Applications/Simulator.app/Contents/MacOS/Simulator
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 codesign -&gt; /usr/bin/codesign
lrwxr-xr-x  1 sander  staff  17  1 jan  1970 security -&gt; /usr/bin/security
lrwxr-xr-x  1 sander  staff  21  1 jan  1970 xcode-select -&gt; /usr/bin/xcode-select
lrwxr-xr-x  1 sander  staff  61  1 jan  1970 xcodebuild -&gt; /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild
lrwxr-xr-x  1 sander  staff  14  1 jan  1970 xcrun -&gt; /usr/bin/xcrun
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="building-an-ios-application"></a>9.8.2. Building an iOS application</h3></div></div></div><p>
     We can build an iOS app executable for the simulator, or an IPA/xcarchive
     file for release purposes, e.g. ad-hoc, enterprise or store
     installations, by executing the <code class="literal">xcodeenv.buildApp {}</code>
     function:
    </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};

  xcodeenv = import ./xcodeenv {
    inherit (pkgs) stdenv;
  };
in
xcodeenv.buildApp {
  name = "MyApp";
  src = ./myappsources;
  sdkVersion = "11.2";

  target = null; # Corresponds to the name of the app by default
  configuration = null; # Release for release builds, Debug for debug builds
  scheme = null; # -scheme will correspond to the app name by default
  sdk = null; # null will set it to 'iphonesimulator` for simulator builds or `iphoneos` to real builds
  xcodeFlags = "";

  release = true;
  certificateFile = ./mycertificate.p12;
  certificatePassword = "secret";
  provisioningProfile = ./myprovisioning.profile;
  signMethod = "ad-hoc"; # 'enterprise' or 'store'
  generateIPA = true;
  generateXCArchive = false;

  enableWirelessDistribution = true;
  installURL = "/installipa.php";
  bundleId = "mycompany.myapp";
  appVersion = "1.0";

  # Supports all xcodewrapper parameters as well
  xcodeBaseDir = "/Applications/Xcode.app";
}
</pre><p>
     The above function takes a variety of parameters: * The
     <code class="literal">name</code> and <code class="literal">src</code> parameters are
     mandatory and specify the name of the app and the location where the
     source code resides * <code class="literal">sdkVersion</code> specifies which
     version of the iOS SDK to use.
    </p><p>
     It also possile to adjust the <code class="literal">xcodebuild</code> parameters.
     This is only needed in rare circumstances. In most cases the default
     values should suffice:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       Specifies which <code class="literal">xcodebuild</code> target to build. By
       default it takes the target that has the same name as the app.
      </p></li><li class="listitem"><p>
       The <code class="literal">configuration</code> parameter can be overridden if
       desired. By default, it will do a debug build for the simulator and a
       release build for real devices.
      </p></li><li class="listitem"><p>
       The <code class="literal">scheme</code> parameter specifies which
       <code class="literal">-scheme</code> parameter to propagate to
       <code class="literal">xcodebuild</code>. By default, it corresponds to the app
       name.
      </p></li><li class="listitem"><p>
       The <code class="literal">sdk</code> parameter specifies which SDK to use. By
       default, it picks <code class="literal">iphonesimulator</code> for simulator
       builds and <code class="literal">iphoneos</code> for release builds.
      </p></li><li class="listitem"><p>
       The <code class="literal">xcodeFlags</code> parameter specifies arbitrary command
       line parameters that should be propagated to
       <code class="literal">xcodebuild</code>.
      </p></li></ul></div><p>
     By default, builds are carried out for the iOS simulator. To do release
     builds (builds for real iOS devices), you must set the
     <code class="literal">release</code> parameter to <code class="literal">true</code>. In
     addition, you need to set the following parameters:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">certificateFile</code> refers to a P12 certificate file.
      </p></li><li class="listitem"><p>
       <code class="literal">certificatePassword</code> specifies the password of the P12
       certificate.
      </p></li><li class="listitem"><p>
       <code class="literal">provisioningProfile</code> refers to the provision profile
       needed to sign the app
      </p></li><li class="listitem"><p>
       <code class="literal">signMethod</code> should refer to <code class="literal">ad-hoc</code>
       for signing the app with an ad-hoc certificate,
       <code class="literal">enterprise</code> for enterprise certificates and
       <code class="literal">app-store</code> for App store certificates.
      </p></li><li class="listitem"><p>
       <code class="literal">generateIPA</code> specifies that we want to produce an IPA
       file (this is probably what you want)
      </p></li><li class="listitem"><p>
       <code class="literal">generateXCArchive</code> specifies thet we want to produce
       an xcarchive file.
      </p></li></ul></div><p>
     When building IPA files on Hydra and when it is desired to allow iOS
     devices to install IPAs by browsing to the Hydra build products page, you
     can enable the <code class="literal">enableWirelessDistribution</code> parameter.
    </p><p>
     When enabled, you need to configure the following options:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="literal">installURL</code> parameter refers to the URL of a PHP
       script that composes the <code class="literal">itms-services://</code> URL
       allowing iOS devices to install the IPA file.
      </p></li><li class="listitem"><p>
       <code class="literal">bundleId</code> refers to the bundle ID value of the app
      </p></li><li class="listitem"><p>
       <code class="literal">appVersion</code> refers to the app’s version number
      </p></li></ul></div><p>
     To use wireless adhoc distributions, you must also install the
     corresponding PHP script on a web server (see section: <span class="quote">“<span class="quote">Installing
     the PHP script for wireless ad hoc installations from Hydra</span>”</span> for
     more information).
    </p><p>
     In addition to the build parameters, you can also specify any parameters
     that the <code class="literal">xcodeenv.composeXcodeWrapper {}</code> function
     takes. For example, the <code class="literal">xcodeBaseDir</code> parameter can be
     overridden to refer to a different Xcode version.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="spawning-simulator-instances"></a>9.8.3. Spawning simulator instances</h3></div></div></div><p>
     In addition to building iOS apps, we can also automatically spawn
     simulator instances:
    </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};

  xcodeenv = import ./xcodeenv {
    inherit (pkgs) stdenv;
  };
in
xcode.simulateApp {
  name = "simulate";

  # Supports all xcodewrapper parameters as well
  xcodeBaseDir = "/Applications/Xcode.app";
}
</pre><p>
     The above expression produces a script that starts the simulator from the
     provided Xcode installation. The script can be started as follows:
    </p><pre class="programlisting">
./result/bin/run-test-simulator
</pre><p>
     By default, the script will show an overview of UDID for all available
     simulator instances and asks you to pick one. You can also provide a UDID
     as a command-line parameter to launch an instance automatically:
    </p><pre class="programlisting">
./result/bin/run-test-simulator 5C93129D-CF39-4B1A-955F-15180C3BD4B8
</pre><p>
     You can also extend the simulator script to automatically deploy and
     launch an app in the requested simulator instance:
    </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};

  xcodeenv = import ./xcodeenv {
    inherit (pkgs) stdenv;
  };
in
xcode.simulateApp {
  name = "simulate";
  bundleId = "mycompany.myapp";
  app = xcode.buildApp {
    # ...
  };

  # Supports all xcodewrapper parameters as well
  xcodeBaseDir = "/Applications/Xcode.app";
}
</pre><p>
     By providing the result of an <code class="literal">xcode.buildApp {}</code>
     function and configuring the app bundle id, the app gets deployed
     automatically and started.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-java"></a>9.9. Java</h2></div></div></div><p>
    Ant-based Java packages are typically built from source as follows:
</p><pre class="programlisting">
stdenv.mkDerivation {
  name = "...";
  src = fetchurl { ... };

  buildInputs = [ jdk ant ];

  buildPhase = "ant";
}
</pre><p>
    Note that <code class="varname">jdk</code> is an alias for the OpenJDK (self-built
    where available, or pre-built via Zulu). Platforms with OpenJDK not (yet)
    in Nixpkgs (<code class="literal">Aarch32</code>, <code class="literal">Aarch64</code>) point
    to the (unfree) <code class="literal">oraclejdk</code>.
   </p><p>
    JAR files that are intended to be used by other packages should be
    installed in <code class="filename">$out/share/java</code>. JDKs have a stdenv setup
    hook that add any JARs in the <code class="filename">share/java</code> directories
    of the build inputs to the <code class="envar">CLASSPATH</code> environment variable.
    For instance, if the package <code class="literal">libfoo</code> installs a JAR named
    <code class="filename">foo.jar</code> in its <code class="filename">share/java</code>
    directory, and another package declares the attribute
</p><pre class="programlisting">
buildInputs = [ jdk libfoo ];
</pre><p>
    then <code class="envar">CLASSPATH</code> will be set to
    <code class="filename">/nix/store/...-libfoo/share/java/foo.jar</code>.
   </p><p>
    Private JARs should be installed in a location like
    <code class="filename">$out/share/<em class="replaceable"><code>package-name</code></em></code>.
   </p><p>
    If your Java package provides a program, you need to generate a wrapper
    script to run it using the OpenJRE. You can use
    <code class="literal">makeWrapper</code> for this:
</p><pre class="programlisting">
buildInputs = [ makeWrapper ];

installPhase =
  ''
    mkdir -p $out/bin
    makeWrapper ${jre}/bin/java $out/bin/foo \
      --add-flags "-cp $out/share/java/foo.jar org.foo.Main"
  '';
</pre><p>
    Note the use of <code class="literal">jre</code>, which is the part of the OpenJDK
    package that contains the Java Runtime Environment. By using
    <code class="literal">${jre}/bin/java</code> instead of
    <code class="literal">${jdk}/bin/java</code>, you prevent your package from depending
    on the JDK at runtime.
   </p><p>
    Note all JDKs passthru <code class="literal">home</code>, so if your application
    requires environment variables like <code class="envar">JAVA_HOME</code> being set,
    that can be done in a generic fashion with the <code class="literal">--set</code>
    argument of <code class="literal">makeWrapper</code>:
</p><pre class="programlisting">
  --set JAVA_HOME ${jdk.home}
</pre><p>
   </p><p>
    It is possible to use a different Java compiler than
    <span class="command"><strong>javac</strong></span> from the OpenJDK. For instance, to use the GNU
    Java Compiler:
</p><pre class="programlisting">
buildInputs = [ gcj ant ];
</pre><p>
    Here, Ant will automatically use <span class="command"><strong>gij</strong></span> (the GNU Java
    Runtime) instead of the OpenJRE.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-lua"></a>9.10. Lua</h2></div></div></div><p>
    Lua packages are built by the <code class="varname">buildLuaPackage</code> function.
    This function is implemented in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/lua-modules/generic/default.nix" target="_top">
    <code class="filename">pkgs/development/lua-modules/generic/default.nix</code></a>
    and works similarly to <code class="varname">buildPerlPackage</code>. (See
    <a class="xref" href="#sec-language-perl" title="9.13. Perl">Section 9.13, “Perl”</a> for details.)
   </p><p>
    Lua packages are defined in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/lua-packages.nix" target="_top"><code class="filename">pkgs/top-level/lua-packages.nix</code></a>.
    Most of them are simple. For example:
</p><pre class="programlisting">
fileSystem = buildLuaPackage {
  name = "filesystem-1.6.2";
  src = fetchurl {
    url = "https://github.com/keplerproject/luafilesystem/archive/v1_6_2.tar.gz";
    sha256 = "1n8qdwa20ypbrny99vhkmx8q04zd2jjycdb5196xdhgvqzk10abz";
  };
  meta = {
    homepage = "https://github.com/keplerproject/luafilesystem";
    hydraPlatforms = stdenv.lib.platforms.linux;
    maintainers = with maintainers; [ flosse ];
  };
};
  </pre><p>
   </p><p>
    Though, more complicated package should be placed in a seperate file in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/lua-modules" target="_top"><code class="filename">pkgs/development/lua-modules</code></a>.
   </p><p>
    Lua packages accept additional parameter <code class="varname">disabled</code>, which
    defines the condition of disabling package from luaPackages. For example,
    if package has <code class="varname">disabled</code> assigned to
    <code class="literal">lua.luaversion != "5.1"</code>, it will not be included in any
    luaPackages except lua51Packages, making it only be built for lua 5.1.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="node.js-packages"></a>9.11. Node.js packages</h2></div></div></div><p>
    The <code class="literal">pkgs/development/node-packages</code> folder contains a
    generated collection of <a class="link" href="https://npmjs.com/" target="_top">NPM
    packages</a> that can be installed with the Nix package manager.
   </p><p>
    As a rule of thumb, the package set should only provide <span class="emphasis"><em>end
    user</em></span> software packages, such as command-line utilities.
    Libraries should only be added to the package set if there is a non-NPM
    package that requires it.
   </p><p>
    When it is desired to use NPM libraries in a development project, use the
    <code class="literal">node2nix</code> generator directly on the
    <code class="literal">package.json</code> configuration file of the project.
   </p><p>
    The package set also provides support for multiple Node.js versions. The
    policy is that a new package should be added to the collection for the
    latest stable LTS release (which is currently 10.x), unless there is an
    explicit reason to support a different release.
   </p><p>
    If your package uses native addons, you need to examine what kind of native
    build system it uses. Here are some examples:
   </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">node-gyp</code>
     </p></li><li class="listitem"><p>
      <code class="literal">node-gyp-builder</code>
     </p></li><li class="listitem"><p>
      <code class="literal">node-pre-gyp</code>
     </p></li></ul></div><p>
    After you have identified the correct system, you need to override your
    package expression while adding in build system as a build input. For
    example, <code class="literal">dat</code> requires <code class="literal">node-gyp-build</code>,
    so we override its expression in <code class="literal">default-v10.nix</code>:
   </p><pre class="programlisting">
dat = nodePackages.dat.override (oldAttrs: {
  buildInputs = oldAttrs.buildInputs ++ [ nodePackages.node-gyp-build ];
});
</pre><p>
    To add a package from NPM to nixpkgs:
   </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
      Modify
      <code class="literal">pkgs/development/node-packages/node-packages-v10.json</code>
      to add, update or remove package entries. (Or
      <code class="literal">pkgs/development/node-packages/node-packages-v8.json</code>
      for packages depending on Node.js 8.x)
     </p></li><li class="listitem"><p>
      Run the script: <code class="literal">(cd pkgs/development/node-packages &amp;&amp;
      ./generate.sh)</code>.
     </p></li><li class="listitem"><p>
      Build your new package to test your changes: <code class="literal">cd /path/to/nixpkgs
      &amp;&amp; nix-build -A
      nodePackages.&lt;new-or-updated-package&gt;</code>. To build against a
      specific Node.js version (e.g. 10.x): <code class="literal">nix-build -A
      nodePackages_10_x.&lt;new-or-updated-package&gt;</code>
     </p></li><li class="listitem"><p>
      Add and commit all modified and generated files.
     </p></li></ol></div><p>
    For more information about the generation process, consult the
    <a class="link" href="https://github.com/svanderburg/node2nix" target="_top">README.md</a>
    file of the <code class="literal">node2nix</code> tool.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-ocaml"></a>9.12. OCaml</h2></div></div></div><p>
    OCaml libraries should be installed in
    <code class="literal">$(out)/lib/ocaml/${ocaml.version}/site-lib/</code>. Such
    directories are automatically added to the <code class="literal">$OCAMLPATH</code>
    environment variable when building another package that depends on them or
    when opening a <code class="literal">nix-shell</code>.
   </p><p>
    Given that most of the OCaml ecosystem is now built with dune, nixpkgs
    includes a convenience build support function called
    <code class="literal">buildDunePackage</code> that will build an OCaml package using
    dune, OCaml and findlib and any additional dependencies provided as
    <code class="literal">buildInputs</code> or <code class="literal">propagatedBuildInputs</code>.
   </p><p>
    Here is a simple package example. It defines an (optional) attribute
    <code class="literal">minimumOCamlVersion</code> that will be used to throw a
    descriptive evaluation error if building with an older OCaml is attempted.
    It uses the <code class="literal">fetchFromGitHub</code> fetcher to get its source.
    It sets the <code class="literal">doCheck</code> (optional) attribute to
    <code class="literal">true</code> which means that tests will be run with
    <code class="literal">dune runtest -p angstrom</code> after the build (<code class="literal">dune
    build -p angstrom</code>) is complete. It uses
    <code class="literal">alcotest</code> as a build input (because it is needed to run
    the tests) and <code class="literal">bigstringaf</code> and <code class="literal">result</code>
    as propagated build inputs (thus they will also be available to libraries
    depending on this library). The library will be installed using the
    <code class="literal">angstrom.install</code> file that dune generates.
   </p><pre class="programlisting">
{ stdenv, fetchFromGitHub, buildDunePackage, alcotest, result, bigstringaf }:

buildDunePackage rec {
  pname = "angstrom";
  version = "0.10.0";

  minimumOCamlVersion = "4.03";

  src = fetchFromGitHub {
    owner  = "inhabitedtype";
    repo   = pname;
    rev    = version;
    sha256 = "0lh6024yf9ds0nh9i93r9m6p5psi8nvrqxl5x7jwl13zb0r9xfpw";
  };

  buildInputs = [ alcotest ];
  propagatedBuildInputs = [ bigstringaf result ];
  doCheck = true;

  meta = {
    homepage = https://github.com/inhabitedtype/angstrom;
    description = "OCaml parser combinators built for speed and memory efficiency";
    license = stdenv.lib.licenses.bsd3;
    maintainers = with stdenv.lib.maintainers; [ sternenseemann ];
  };
}
 </pre><p>
    Here is a second example, this time using a source archive generated with
    <code class="literal">dune-release</code>. It is a good idea to use this archive when
    it is available as it will usually contain substituted variables such as a
    <code class="literal">%%VERSION%%</code> field. This library does not depend on any
    other OCaml library and no tests are run after building it.
   </p><pre class="programlisting">
{ stdenv, fetchurl, buildDunePackage }:

buildDunePackage rec {
  pname = "wtf8";
  version = "1.0.1";

  minimumOCamlVersion = "4.01";

  src = fetchurl {
    url = "https://github.com/flowtype/ocaml-${pname}/releases/download/v${version}/${pname}-${version}.tbz";
    sha256 = "1msg3vycd3k8qqj61sc23qks541cxpb97vrnrvrhjnqxsqnh6ygq";
  };

  meta = with stdenv.lib; {
    homepage = https://github.com/flowtype/ocaml-wtf8;
    description = "WTF-8 is a superset of UTF-8 that allows unpaired surrogates.";
    license = licenses.mit;
    maintainers = [ maintainers.eqyiel ];
  };
}
 </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-perl"></a>9.13. Perl</h2></div></div></div><p>
    Nixpkgs provides a function <code class="varname">buildPerlPackage</code>, a generic
    package builder function for any Perl package that has a standard
    <code class="varname">Makefile.PL</code>. It’s implemented in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/perl-modules/generic" target="_top"><code class="filename">pkgs/development/perl-modules/generic</code></a>.
   </p><p>
    Perl packages from CPAN are defined in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/perl-packages.nix" target="_top"><code class="filename">pkgs/top-level/perl-packages.nix</code></a>,
    rather than <code class="filename">pkgs/all-packages.nix</code>. Most Perl packages
    are so straight-forward to build that they are defined here directly,
    rather than having a separate function for each package called from
    <code class="filename">perl-packages.nix</code>. However, more complicated packages
    should be put in a separate file, typically in
    <code class="filename">pkgs/development/perl-modules</code>. Here is an example of
    the former:
</p><pre class="programlisting">
ClassC3 = buildPerlPackage rec {
  name = "Class-C3-0.21";
  src = fetchurl {
    url = "mirror://cpan/authors/id/F/FL/FLORA/${name}.tar.gz";
    sha256 = "1bl8z095y4js66pwxnm7s853pi9czala4sqc743fdlnk27kq94gz";
  };
};
</pre><p>
    Note the use of <code class="literal">mirror://cpan/</code>, and the
    <code class="literal">${name}</code> in the URL definition to ensure that the name
    attribute is consistent with the source that we’re actually
    downloading. Perl packages are made available in
    <code class="filename">all-packages.nix</code> through the variable
    <code class="varname">perlPackages</code>. For instance, if you have a package that
    needs <code class="varname">ClassC3</code>, you would typically write
</p><pre class="programlisting">
foo = import ../path/to/foo.nix {
  inherit stdenv fetchurl ...;
  inherit (perlPackages) ClassC3;
};
</pre><p>
    in <code class="filename">all-packages.nix</code>. You can test building a Perl
    package as follows:
</p><pre class="screen">
$ nix-build -A perlPackages.ClassC3
</pre><p>
    <code class="varname">buildPerlPackage</code> adds <code class="literal">perl-</code> to the
    start of the name attribute, so the package above is actually called
    <code class="literal">perl-Class-C3-0.21</code>. So to install it, you can say:
</p><pre class="screen">
$ nix-env -i perl-Class-C3
</pre><p>
    (Of course you can also install using the attribute name: <code class="literal">nix-env
    -i -A perlPackages.ClassC3</code>.)
   </p><p>
    So what does <code class="varname">buildPerlPackage</code> do? It does the following:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       In the configure phase, it calls <code class="literal">perl Makefile.PL</code> to
       generate a Makefile. You can set the variable
       <code class="varname">makeMakerFlags</code> to pass flags to
       <code class="filename">Makefile.PL</code>
      </p></li><li class="listitem"><p>
       It adds the contents of the <code class="envar">PERL5LIB</code> environment variable
       to <code class="literal">#! .../bin/perl</code> line of Perl scripts as
       <code class="literal">-I<em class="replaceable"><code>dir</code></em></code> flags. This ensures
       that a script can find its dependencies.
      </p></li><li class="listitem"><p>
       In the fixup phase, it writes the propagated build inputs
       (<code class="varname">propagatedBuildInputs</code>) to the file
       <code class="filename">$out/nix-support/propagated-user-env-packages</code>.
       <span class="command"><strong>nix-env</strong></span> recursively installs all packages listed in
       this file when you install a package that has it. This ensures that a
       Perl package can find its dependencies.
      </p></li></ol></div><p>
   </p><p>
    <code class="varname">buildPerlPackage</code> is built on top of
    <code class="varname">stdenv</code>, so everything can be customised in the usual
    way. For instance, the <code class="literal">BerkeleyDB</code> module has a
    <code class="varname">preConfigure</code> hook to generate a configuration file used
    by <code class="filename">Makefile.PL</code>:
</p><pre class="programlisting">
{ buildPerlPackage, fetchurl, db }:

buildPerlPackage rec {
  name = "BerkeleyDB-0.36";

  src = fetchurl {
    url = "mirror://cpan/authors/id/P/PM/PMQS/${name}.tar.gz";
    sha256 = "07xf50riarb60l1h6m2dqmql8q5dij619712fsgw7ach04d8g3z1";
  };

  preConfigure = ''
    echo "LIB = ${db.out}/lib" &gt; config.in
    echo "INCLUDE = ${db.dev}/include" &gt;&gt; config.in
  '';
}
</pre><p>
   </p><p>
    Dependencies on other Perl packages can be specified in the
    <code class="varname">buildInputs</code> and <code class="varname">propagatedBuildInputs</code>
    attributes. If something is exclusively a build-time dependency, use
    <code class="varname">buildInputs</code>; if it’s (also) a runtime dependency,
    use <code class="varname">propagatedBuildInputs</code>. For instance, this builds a
    Perl module that has runtime dependencies on a bunch of other modules:
</p><pre class="programlisting">
ClassC3Componentised = buildPerlPackage rec {
  name = "Class-C3-Componentised-1.0004";
  src = fetchurl {
    url = "mirror://cpan/authors/id/A/AS/ASH/${name}.tar.gz";
    sha256 = "0xql73jkcdbq4q9m0b0rnca6nrlvf5hyzy8is0crdk65bynvs8q1";
  };
  propagatedBuildInputs = [
    ClassC3 ClassInspector TestException MROCompat
  ];
};
</pre><p>
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-generation-from-CPAN"></a>9.13.1. Generation from CPAN</h3></div></div></div><p>
     Nix expressions for Perl packages can be generated (almost) automatically
     from CPAN. This is done by the program
     <span class="command"><strong>nix-generate-from-cpan</strong></span>, which can be installed as
     follows:
    </p><pre class="screen">
$ nix-env -i nix-generate-from-cpan
</pre><p>
     This program takes a Perl module name, looks it up on CPAN, fetches and
     unpacks the corresponding package, and prints a Nix expression on standard
     output. For example:
</p><pre class="screen">
$ nix-generate-from-cpan XML::Simple
  XMLSimple = buildPerlPackage rec {
    name = "XML-Simple-2.22";
    src = fetchurl {
      url = "mirror://cpan/authors/id/G/GR/GRANTM/${name}.tar.gz";
      sha256 = "b9450ef22ea9644ae5d6ada086dc4300fa105be050a2030ebd4efd28c198eb49";
    };
    propagatedBuildInputs = [ XMLNamespaceSupport XMLSAX XMLSAXExpat ];
    meta = {
      description = "An API for simple XML files";
      license = with stdenv.lib.licenses; [ artistic1 gpl1Plus ];
    };
  };
</pre><p>
     The output can be pasted into
     <code class="filename">pkgs/top-level/perl-packages.nix</code> or wherever else you
     need it.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-perl-cross-compilation"></a>9.13.2. Cross-compiling modules</h3></div></div></div><p>
     Nixpkgs has experimental support for cross-compiling Perl modules. In many
     cases, it will just work out of the box, even for modules with native
     extensions. Sometimes, however, the Makefile.PL for a module may
     (indirectly) import a native module. In that case, you will need to make a
     stub for that module that will satisfy the Makefile.PL and install it into
     <code class="filename">lib/perl5/site_perl/cross_perl/${perl.version}</code>. See
     the <code class="varname">postInstall</code> for <code class="varname">DBI</code> for an
     example.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="python"></a>9.14. Python</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="user-guide"></a>9.14.1. User Guide</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="using-python"></a>9.14.1.1. Using Python</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="overview"></a>9.14.1.1.1. Overview</h5></div></div></div><p>
       Several versions of the Python interpreter are available on Nix, as well
       as a high amount of packages. The attribute <code class="literal">python</code>
       refers to the default interpreter, which is currently CPython 2.7. It is
       also possible to refer to specific versions,
       e.g. <code class="literal">python35</code> refers to CPython 3.5, and
       <code class="literal">pypy</code> refers to the default PyPy interpreter.
      </p><p>
       Python is used a lot, and in different ways. This affects also how it is
       packaged. In the case of Python on Nix, an important distinction is made
       between whether the package is considered primarily an application, or
       whether it should be used as a library, i.e., of primary interest are
       the modules in <code class="literal">site-packages</code> that should be
       importable.
      </p><p>
       In the Nixpkgs tree Python applications can be found throughout,
       depending on what they do, and are called from the main package set.
       Python libraries, however, are in separate sets, with one set per
       interpreter version.
      </p><p>
       The interpreters have several common attributes. One of these attributes
       is <code class="literal">pkgs</code>, which is a package set of Python libraries
       for this specific interpreter. E.g., the <code class="literal">toolz</code>
       package corresponding to the default interpreter is
       <code class="literal">python.pkgs.toolz</code>, and the CPython 3.5 version is
       <code class="literal">python35.pkgs.toolz</code>. The main package set contains
       aliases to these package sets, e.g. <code class="literal">pythonPackages</code>
       refers to <code class="literal">python.pkgs</code> and
       <code class="literal">python35Packages</code> to <code class="literal">python35.pkgs</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="installing-python-and-packages"></a>9.14.1.1.2. Installing Python and packages</h5></div></div></div><p>
       The Nix and NixOS manuals explain how packages are generally installed.
       In the case of Python and Nix, it is important to make a distinction
       between whether the package is considered an application or a library.
      </p><p>
       Applications on Nix are typically installed into your user profile
       imperatively using <code class="literal">nix-env -i</code>, and on NixOS
       declaratively by adding the package name to
       <code class="literal">environment.systemPackages</code> in
       <code class="literal">/etc/nixos/configuration.nix</code>. Dependencies such as
       libraries are automatically installed and should not be installed
       explicitly.
      </p><p>
       The same goes for Python applications and libraries. Python applications
       can be installed in your profile. But Python libraries you would like to
       use for development cannot be installed, at least not individually,
       because they won’t be able to find each other resulting in import
       errors. Instead, it is possible to create an environment with
       <code class="literal">python.buildEnv</code> or
       <code class="literal">python.withPackages</code> where the interpreter and other
       executables are able to find each other and all of the modules.
      </p><p>
       In the following examples we create an environment with Python 3.5,
       <code class="literal">numpy</code> and <code class="literal">toolz</code>. As you may
       imagine, there is one limitation here, and that’s that you can
       install only one environment at a time. You will notice the complaints
       about collisions when you try to install a second environment.
      </p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="environment-defined-in-separate-.nix-file"></a>9.14.1.1.2.1. Environment defined in separate <code class="literal">.nix</code> file</h6></div></div></div><p>
        Create a file, e.g. <code class="literal">build.nix</code>, with the
        following expression
       </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

python35.withPackages (ps: with ps; [ numpy toolz ])
</pre><p>
        and install it in your profile with
       </p><pre class="programlisting">
nix-env -if build.nix
</pre><p>
        Now you can use the Python interpreter, as well as the extra packages
        (<code class="literal">numpy</code>, <code class="literal">toolz</code>) that you added to
        the environment.
       </p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="environment-defined-in-.confignixpkgsconfig.nix"></a>9.14.1.1.2.2. Environment defined in <code class="literal">~/.config/nixpkgs/config.nix</code></h6></div></div></div><p>
        If you prefer to, you could also add the environment as a package
        override to the Nixpkgs set, e.g. using <code class="literal">config.nix</code>,
       </p><pre class="programlisting">
{ # ...

  packageOverrides = pkgs: with pkgs; {
    myEnv = python35.withPackages (ps: with ps; [ numpy toolz ]);
  };
}
</pre><p>
        and install it in your profile with
       </p><pre class="programlisting">
nix-env -iA nixpkgs.myEnv
</pre><p>
        The environment is is installed by referring to the attribute, and
        considering the <code class="literal">nixpkgs</code> channel was used.
       </p></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="environment-defined-in-etcnixosconfiguration.nix"></a>9.14.1.1.2.3. Environment defined in <code class="literal">/etc/nixos/configuration.nix</code></h6></div></div></div><p>
        For the sake of completeness, here’s another example how to
        install the environment system-wide.
       </p><pre class="programlisting">
{ # ...

  environment.systemPackages = with pkgs; [
    (python35.withPackages(ps: with ps; [ numpy toolz ]))
  ];
}
</pre></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="temporary-python-environment-with-nix-shell"></a>9.14.1.1.3. Temporary Python environment with <code class="literal">nix-shell</code></h5></div></div></div><p>
       The examples in the previous section showed how to install a Python
       environment into a profile. For development you may need to use multiple
       environments. <code class="literal">nix-shell</code> gives the possibility to
       temporarily load another environment, akin to
       <code class="literal">virtualenv</code>.
      </p><p>
       There are two methods for loading a shell with Python packages. The
       first and recommended method is to create an environment with
       <code class="literal">python.buildEnv</code> or
       <code class="literal">python.withPackages</code> and load that. E.g.
      </p><pre class="programlisting">
$ nix-shell -p 'python35.withPackages(ps: with ps; [ numpy toolz ])'
</pre><p>
       opens a shell from which you can launch the interpreter
      </p><pre class="programlisting">
[nix-shell:~] python3
</pre><p>
       The other method, which is not recommended, does not create an
       environment and requires you to list the packages directly,
      </p><pre class="programlisting">
$ nix-shell -p python35.pkgs.numpy python35.pkgs.toolz
</pre><p>
       Again, it is possible to launch the interpreter from the shell. The
       Python interpreter has the attribute <code class="literal">pkgs</code> which
       contains all Python libraries for that specific interpreter.
      </p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="load-environment-from-.nix-expression"></a>9.14.1.1.3.1. Load environment from <code class="literal">.nix</code> expression</h6></div></div></div><p>
        As explained in the Nix manual, <code class="literal">nix-shell</code> can also
        load an expression from a <code class="literal">.nix</code> file. Say we want to
        have Python 3.5, <code class="literal">numpy</code> and <code class="literal">toolz</code>,
        like before, in an environment. Consider a <code class="literal">shell.nix</code>
        file with
       </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

(python35.withPackages (ps: [ps.numpy ps.toolz])).env
</pre><p>
        Executing <code class="literal">nix-shell</code> gives you again a Nix shell from
        which you can run Python.
       </p><p>
        What’s happening here?
       </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
          We begin with importing the Nix Packages collections. <code class="literal">import
          &lt;nixpkgs&gt;</code> imports the
          <code class="literal">&lt;nixpkgs&gt;</code> function, <code class="literal">{}</code>
          calls it and the <code class="literal">with</code> statement brings all
          attributes of <code class="literal">nixpkgs</code> in the local scope. These
          attributes form the main package set.
         </p></li><li class="listitem"><p>
          Then we create a Python 3.5 environment with the
          <code class="literal">withPackages</code> function.
         </p></li><li class="listitem"><p>
          The <code class="literal">withPackages</code> function expects us to provide a
          function as an argument that takes the set of all python packages and
          returns a list of packages to include in the environment. Here, we
          select the packages <code class="literal">numpy</code> and
          <code class="literal">toolz</code> from the package set.
         </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="execute-command-with---run"></a>9.14.1.1.3.2. Execute command with <code class="literal">--run</code></h6></div></div></div><p>
        A convenient option with <code class="literal">nix-shell</code> is the
        <code class="literal">--run</code> option, with which you can execute a command
        in the <code class="literal">nix-shell</code>. We can e.g. directly open a
        Python shell
       </p><pre class="programlisting">
$ nix-shell -p python35Packages.numpy python35Packages.toolz --run "python3"
</pre><p>
        or run a script
       </p><pre class="programlisting">
$ nix-shell -p python35Packages.numpy python35Packages.toolz --run "python3 myscript.py"
</pre></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="nix-shell-as-shebang"></a>9.14.1.1.3.3. <code class="literal">nix-shell</code> as shebang</h6></div></div></div><p>
        In fact, for the second use case, there is a more convenient method.
        You can add a
        <a class="link" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_top">shebang</a>
        to your script specifying which dependencies
        <code class="literal">nix-shell</code> needs. With the following shebang, you can
        just execute <code class="literal">./myscript.py</code>, and it will make
        available all dependencies and run the script in the
        <code class="literal">python3</code> shell.
       </p><pre class="programlisting">
#! /usr/bin/env nix-shell
#! nix-shell -i python3 -p "python3.withPackages(ps: [ps.numpy])"

import numpy

print(numpy.__version__)
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="developing-with-python"></a>9.14.1.2. Developing with Python</h4></div></div></div><p>
      Now that you know how to get a working Python environment with Nix, it is
      time to go forward and start actually developing with Python. We will
      first have a look at how Python packages are packaged on Nix. Then, we
      will look at how you can use development mode with your code.
     </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="packaging-a-library"></a>9.14.1.2.1. Packaging a library</h5></div></div></div><p>
       With Nix all packages are built by functions. The main function in Nix
       for building Python libraries is <code class="literal">buildPythonPackage</code>.
       Let’s see how we can build the <code class="literal">toolz</code> package.
      </p><pre class="programlisting">
{ lib, buildPythonPackage, fetchPypi }:

  toolz = buildPythonPackage rec {
    pname = "toolz";
    version = "0.7.4";

    src = fetchPypi {
      inherit pname version;
      sha256 = "43c2c9e5e7a16b6c88ba3088a9bfc82f7db8e13378be7c78d6c14a5f8ed05afd";
    };

    doCheck = false;

    meta = with lib; {
      homepage = https://github.com/pytoolz/toolz;
      description = "List processing tools and functional utilities";
      license = licenses.bsd3;
      maintainers = with maintainers; [ fridh ];
    };
  };
}
</pre><p>
       What happens here? The function <code class="literal">buildPythonPackage</code> is
       called and as argument it accepts a set. In this case the set is a
       recursive set, <code class="literal">rec</code>. One of the arguments is the name
       of the package, which consists of a basename (generally following the
       name on PyPi) and a version. Another argument, <code class="literal">src</code>
       specifies the source, which in this case is fetched from PyPI using the
       helper function <code class="literal">fetchPypi</code>. The argument
       <code class="literal">doCheck</code> is used to set whether tests should be run
       when building the package. Furthermore, we specify some (optional) meta
       information. The output of the function is a derivation.
      </p><p>
       An expression for <code class="literal">toolz</code> can be found in the Nixpkgs
       repository. As explained in the introduction of this Python section, a
       derivation of <code class="literal">toolz</code> is available for each interpreter
       version, e.g. <code class="literal">python35.pkgs.toolz</code> refers to the
       <code class="literal">toolz</code> derivation corresponding to the CPython 3.5
       interpreter. The above example works when you’re directly working
       on <code class="literal">pkgs/top-level/python-packages.nix</code> in the Nixpkgs
       repository. Often though, you will want to test a Nix expression outside
       of the Nixpkgs tree.
      </p><p>
       The following expression creates a derivation for the
       <code class="literal">toolz</code> package, and adds it along with a
       <code class="literal">numpy</code> package to a Python environment.
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

( let
    my_toolz = python35.pkgs.buildPythonPackage rec {
      pname = "toolz";
      version = "0.7.4";

      src = python35.pkgs.fetchPypi {
        inherit pname version;
        sha256 = "43c2c9e5e7a16b6c88ba3088a9bfc82f7db8e13378be7c78d6c14a5f8ed05afd";
      };

      doCheck = false;

      meta = {
        homepage = "https://github.com/pytoolz/toolz/";
        description = "List processing tools and functional utilities";
      };
    };

  in python35.withPackages (ps: [ps.numpy my_toolz])
).env
</pre><p>
       Executing <code class="literal">nix-shell</code> will result in an environment in
       which you can use Python 3.5 and the <code class="literal">toolz</code> package.
       As you can see we had to explicitly mention for which Python version we
       want to build a package.
      </p><p>
       So, what did we do here? Well, we took the Nix expression that we used
       earlier to build a Python environment, and said that we wanted to
       include our own version of <code class="literal">toolz</code>, named
       <code class="literal">my_toolz</code>. To introduce our own package in the scope
       of <code class="literal">withPackages</code> we used a <code class="literal">let</code>
       expression. You can see that we used <code class="literal">ps.numpy</code> to
       select numpy from the nixpkgs package set (<code class="literal">ps</code>). We
       did not take <code class="literal">toolz</code> from the Nixpkgs package set this
       time, but instead took our own version that we introduced with the
       <code class="literal">let</code> expression.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="handling-dependencies"></a>9.14.1.2.2. Handling dependencies</h5></div></div></div><p>
       Our example, <code class="literal">toolz</code>, does not have any dependencies on
       other Python packages or system libraries. According to the manual,
       <code class="literal">buildPythonPackage</code> uses the arguments
       <code class="literal">buildInputs</code> and
       <code class="literal">propagatedBuildInputs</code> to specify dependencies. If
       something is exclusively a build-time dependency, then the dependency
       should be included as a <code class="literal">buildInput</code>, but if it is
       (also) a runtime dependency, then it should be added to
       <code class="literal">propagatedBuildInputs</code>. Test dependencies are
       considered build-time dependencies and passed to
       <code class="literal">checkInputs</code>.
      </p><p>
       The following example shows which arguments are given to
       <code class="literal">buildPythonPackage</code> in order to build
       <a class="link" href="https://github.com/blaze/datashape" target="_top"><code class="literal">datashape</code></a>.
      </p><pre class="programlisting">
{ # ...

  datashape = buildPythonPackage rec {
    pname = "datashape";
    version = "0.4.7";

    src = fetchPypi {
      inherit pname version;
      sha256 = "14b2ef766d4c9652ab813182e866f493475e65e558bed0822e38bf07bba1a278";
    };

    checkInputs = with self; [ pytest ];
    propagatedBuildInputs = with self; [ numpy multipledispatch dateutil ];

    meta = with lib; {
      homepage = https://github.com/ContinuumIO/datashape;
      description = "A data description language";
      license = licenses.bsd2;
      maintainers = with maintainers; [ fridh ];
    };
  };
}
</pre><p>
       We can see several runtime dependencies, <code class="literal">numpy</code>,
       <code class="literal">multipledispatch</code>, and <code class="literal">dateutil</code>.
       Furthermore, we have one <code class="literal">buildInput</code>,
       i.e. <code class="literal">pytest</code>. <code class="literal">pytest</code> is a test
       runner and is only used during the <code class="literal">checkPhase</code> and is
       therefore not added to <code class="literal">propagatedBuildInputs</code>.
      </p><p>
       In the previous case we had only dependencies on other Python packages
       to consider. Occasionally you have also system libraries to consider.
       E.g., <code class="literal">lxml</code> provides Python bindings to
       <code class="literal">libxml2</code> and <code class="literal">libxslt</code>. These
       libraries are only required when building the bindings and are therefore
       added as <code class="literal">buildInputs</code>.
      </p><pre class="programlisting">
{ # ...

  lxml = buildPythonPackage rec {
    pname = "lxml";
    version = "3.4.4";

    src = fetchPypi {
      inherit pname version;
      sha256 = "16a0fa97hym9ysdk3rmqz32xdjqmy4w34ld3rm3jf5viqjx65lxk";
    };

    buildInputs = with self; [ pkgs.libxml2 pkgs.libxslt ];

    meta = with lib; {
      description = "Pythonic binding for the libxml2 and libxslt libraries";
      homepage = https://lxml.de;
      license = licenses.bsd3;
      maintainers = with maintainers; [ sjourdois ];
    };
  };
}
</pre><p>
       In this example <code class="literal">lxml</code> and Nix are able to work out
       exactly where the relevant files of the dependencies are. This is not
       always the case.
      </p><p>
       The example below shows bindings to The Fastest Fourier Transform in the
       West, commonly known as FFTW. On Nix we have separate packages of FFTW
       for the different types of floats (<code class="literal">"single"</code>,
       <code class="literal">"double"</code>, <code class="literal">"long-double"</code>). The
       bindings need all three types, and therefore we add all three as
       <code class="literal">buildInputs</code>. The bindings don’t expect to find
       each of them in a different folder, and therefore we have to set
       <code class="literal">LDFLAGS</code> and <code class="literal">CFLAGS</code>.
      </p><pre class="programlisting">
{ # ...

  pyfftw = buildPythonPackage rec {
    pname = "pyFFTW";
    version = "0.9.2";

    src = fetchPypi {
      inherit pname version;
      sha256 = "f6bbb6afa93085409ab24885a1a3cdb8909f095a142f4d49e346f2bd1b789074";
    };

    buildInputs = [ pkgs.fftw pkgs.fftwFloat pkgs.fftwLongDouble];

    propagatedBuildInputs = with self; [ numpy scipy ];

    # Tests cannot import pyfftw. pyfftw works fine though.
    doCheck = false;

    preConfigure = ''
      export LDFLAGS="-L${pkgs.fftw.dev}/lib -L${pkgs.fftwFloat.out}/lib -L${pkgs.fftwLongDouble.out}/lib"
      export CFLAGS="-I${pkgs.fftw.dev}/include -I${pkgs.fftwFloat.dev}/include -I${pkgs.fftwLongDouble.dev}/include"
    '';

    meta = with lib; {
      description = "A pythonic wrapper around FFTW, the FFT library, presenting a unified interface for all the supported transforms";
      homepage = http://hgomersall.github.com/pyFFTW;
      license = with licenses; [ bsd2 bsd3 ];
      maintainers = with maintainers; [ fridh ];
    };
  };
}
</pre><p>
       Note also the line <code class="literal">doCheck = false;</code>, we explicitly
       disabled running the test-suite.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="develop-local-package"></a>9.14.1.2.3. Develop local package</h5></div></div></div><p>
       As a Python developer you’re likely aware of
       <a class="link" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode" target="_top">development
       mode</a> (<code class="literal">python setup.py develop</code>); instead of
       installing the package this command creates a special link to the
       project code. That way, you can run updated code without having to
       reinstall after each and every change you make. Development mode is also
       available. Let’s see how you can use it.
      </p><p>
       In the previous Nix expression the source was fetched from an url. We
       can also refer to a local source instead using <code class="literal">src =
       ./path/to/source/tree;</code>
      </p><p>
       If we create a <code class="literal">shell.nix</code> file which calls
       <code class="literal">buildPythonPackage</code>, and if <code class="literal">src</code> is
       a local source, and if the local source has a
       <code class="literal">setup.py</code>, then development mode is activated.
      </p><p>
       In the following example we create a simple environment that has a
       Python 3.5 version of our package in it, as well as its dependencies and
       other packages we like to have in the environment, all specified with
       <code class="literal">propagatedBuildInputs</code>. Indeed, we can just add any
       package we like to have in our environment to
       <code class="literal">propagatedBuildInputs</code>.
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};
with pkgs.python35Packages;

buildPythonPackage rec {
  name = "mypackage";
  src = ./path/to/package/source;
  propagatedBuildInputs = [ pytest numpy pkgs.libsndfile ];
}
</pre><p>
       It is important to note that due to how development mode is implemented
       on Nix it is not possible to have multiple packages simultaneously in
       development mode.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="organising-your-packages"></a>9.14.1.3. Organising your packages</h4></div></div></div><p>
      So far we discussed how you can use Python on Nix, and how you can
      develop with it. We’ve looked at how you write expressions to
      package Python packages, and we looked at how you can create environments
      in which specified packages are available.
     </p><p>
      At some point you’ll likely have multiple packages which you would
      like to be able to use in different projects. In order to minimise
      unnecessary duplication we now look at how you can maintain a repository
      with your own packages. The important functions here are
      <code class="literal">import</code> and <code class="literal">callPackage</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="including-a-derivation-using-callpackage"></a>9.14.1.4. Including a derivation using <code class="literal">callPackage</code></h4></div></div></div><p>
      Earlier we created a Python environment using
      <code class="literal">withPackages</code>, and included the
      <code class="literal">toolz</code> package via a <code class="literal">let</code> expression.
      Let’s split the package definition from the environment
      definition.
     </p><p>
      We first create a function that builds <code class="literal">toolz</code> in
      <code class="literal">~/path/to/toolz/release.nix</code>
     </p><pre class="programlisting">
{ lib, pkgs, buildPythonPackage }:

buildPythonPackage rec {
  pname = "toolz";
  version = "0.7.4";

  src = fetchPypi {
    inherit pname version;
    sha256 = "43c2c9e5e7a16b6c88ba3088a9bfc82f7db8e13378be7c78d6c14a5f8ed05afd";
  };

  meta = with lib; {
    homepage = "http://github.com/pytoolz/toolz/";
    description = "List processing tools and functional utilities";
    license = licenses.bsd3;
    maintainers = with maintainers; [ fridh ];
  };
}
</pre><p>
      It takes two arguments, <code class="literal">pkgs</code> and
      <code class="literal">buildPythonPackage</code>. We now call this function using
      <code class="literal">callPackage</code> in the definition of our environment
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

( let
    toolz = pkgs.callPackage /path/to/toolz/release.nix {
      pkgs = pkgs;
      buildPythonPackage = pkgs.python35Packages.buildPythonPackage;
    };
  in pkgs.python35.withPackages (ps: [ ps.numpy toolz ])
).env
</pre><p>
      Important to remember is that the Python version for which the package is
      made depends on the <code class="literal">python</code> derivation that is passed
      to <code class="literal">buildPythonPackage</code>. Nix tries to automatically pass
      arguments when possible, which is why generally you don’t
      explicitly define which <code class="literal">python</code> derivation should be
      used. In the above example we use <code class="literal">buildPythonPackage</code>
      that is part of the set <code class="literal">python35Packages</code>, and in this
      case the <code class="literal">python35</code> interpreter is automatically used.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="reference"></a>9.14.2. Reference</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="interpreters"></a>9.14.2.1. Interpreters</h4></div></div></div><p>
      Versions 2.7, 3.5, 3.6 and 3.7 of the CPython interpreter are available
      as respectively <code class="literal">python27</code>, <code class="literal">python35</code>,
      <code class="literal">python36</code> and <code class="literal">python37</code>. The aliases
      <code class="literal">python2</code> and <code class="literal">python3</code> correspond to
      respectively <code class="literal">python27</code> and <code class="literal">python37</code>.
      The default interpreter, <code class="literal">python</code>, maps to
      <code class="literal">python2</code>. The PyPy interpreters compatible with Python
      2.7 and 3 are available as <code class="literal">pypy27</code> and
      <code class="literal">pypy3</code>, with aliases <code class="literal">pypy2</code> mapping
      to <code class="literal">pypy27</code> and <code class="literal">pypy</code> mapping to
      <code class="literal">pypy2</code>. The Nix expressions for the interpreters can be
      found in <code class="literal">pkgs/development/interpreters/python</code>.
     </p><p>
      All packages depending on any Python interpreter get appended
      <code class="literal">out/{python.sitePackages}</code> to
      <code class="literal">$PYTHONPATH</code> if such directory exists.
     </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="missing-tkinter-module-standard-library"></a>9.14.2.1.1. Missing <code class="literal">tkinter</code> module standard library</h5></div></div></div><p>
       To reduce closure size the
       <code class="literal">Tkinter</code>/<code class="literal">tkinter</code> is available as a
       separate package, <code class="literal">pythonPackages.tkinter</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="attributes-on-interpreters-packages"></a>9.14.2.1.2. Attributes on interpreters packages</h5></div></div></div><p>
       Each interpreter has the following attributes:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">libPrefix</code>. Name of the folder in
         <code class="literal">${python}/lib/</code> for corresponding interpreter.
        </p></li><li class="listitem"><p>
         <code class="literal">interpreter</code>. Alias for
         <code class="literal">${python}/bin/${executable}</code>.
        </p></li><li class="listitem"><p>
         <code class="literal">buildEnv</code>. Function to build python interpreter
         environments with extra packages bundled together. See section
         <span class="emphasis"><em>python.buildEnv function</em></span> for usage and
         documentation.
        </p></li><li class="listitem"><p>
         <code class="literal">withPackages</code>. Simpler interface to
         <code class="literal">buildEnv</code>. See section <span class="emphasis"><em>python.withPackages
         function</em></span> for usage and documentation.
        </p></li><li class="listitem"><p>
         <code class="literal">sitePackages</code>. Alias for
         <code class="literal">lib/${libPrefix}/site-packages</code>.
        </p></li><li class="listitem"><p>
         <code class="literal">executable</code>. Name of the interpreter executable,
         e.g. <code class="literal">python3.7</code>.
        </p></li><li class="listitem"><p>
         <code class="literal">pkgs</code>. Set of Python packages for that specific
         interpreter. The package set can be modified by overriding the
         interpreter and passing <code class="literal">packageOverrides</code>.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="building-packages-and-applications"></a>9.14.2.2. Building packages and applications</h4></div></div></div><p>
      Python libraries and applications that use <code class="literal">setuptools</code>
      or <code class="literal">distutils</code> are typically build with respectively the
      <code class="literal">buildPythonPackage</code> and
      <code class="literal">buildPythonApplication</code> functions. These two functions
      also support installing a <code class="literal">wheel</code>.
     </p><p>
      All Python packages reside in
      <code class="literal">pkgs/top-level/python-packages.nix</code> and all
      applications elsewhere. In case a package is used as both a library and
      an application, then the package should be in
      <code class="literal">pkgs/top-level/python-packages.nix</code> since only those
      packages are made available for all interpreter versions. The preferred
      location for library expressions is in
      <code class="literal">pkgs/development/python-modules</code>. It is important that
      these packages are called from
      <code class="literal">pkgs/top-level/python-packages.nix</code> and not elsewhere,
      to guarantee the right version of the package is built.
     </p><p>
      Based on the packages defined in
      <code class="literal">pkgs/top-level/python-packages.nix</code> an attribute set is
      created for each available Python interpreter. The available sets are
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">pkgs.python27Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.python35Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.python36Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.python37Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.pypyPackages</code>
       </p></li></ul></div><p>
      and the aliases
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">pkgs.python2Packages</code> pointing to
        <code class="literal">pkgs.python27Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.python3Packages</code> pointing to
        <code class="literal">pkgs.python37Packages</code>
       </p></li><li class="listitem"><p>
        <code class="literal">pkgs.pythonPackages</code> pointing to
        <code class="literal">pkgs.python2Packages</code>
       </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildpythonpackage-function"></a>9.14.2.2.1. <code class="literal">buildPythonPackage</code> function</h5></div></div></div><p>
       The <code class="literal">buildPythonPackage</code> function is implemented in
       <code class="literal">pkgs/development/interpreters/python/build-python-package.nix</code>
      </p><p>
       The following is an example:
      </p><pre class="programlisting">
{ lib, buildPythonPackage, fetchPypi, hypothesis, setuptools_scm, attrs, py, setuptools, six, pluggy }:

buildPythonPackage rec {
  pname = "pytest";
  version = "3.3.1";

  src = fetchPypi {
    inherit pname version;
    sha256 = "cf8436dc59d8695346fcd3ab296de46425ecab00d64096cebe79fb51ecb2eb93";
  };

  postPatch = ''
    # don't test bash builtins
    rm testing/test_argcomplete.py
  '';

  checkInputs = [ hypothesis ];
  buildInputs = [ setuptools_scm ];
  propagatedBuildInputs = [ attrs py setuptools six pluggy ];

  meta = with lib; {
    maintainers = with maintainers; [ domenkozar lovek323 madjar lsix ];
    description = "Framework for writing tests";
  };
}
</pre><p>
       The <code class="literal">buildPythonPackage</code> mainly does four things:
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
         In the <code class="literal">buildPhase</code>, it calls
         <code class="literal">${python.interpreter} setup.py bdist_wheel</code> to build
         a wheel binary zipfile.
        </p></li><li class="listitem"><p>
         In the <code class="literal">installPhase</code>, it installs the wheel file
         using <code class="literal">pip install *.whl</code>.
        </p></li><li class="listitem"><p>
         In the <code class="literal">postFixup</code> phase, the
         <code class="literal">wrapPythonPrograms</code> bash function is called to wrap
         all programs in the <code class="literal">$out/bin/*</code> directory to include
         <code class="literal">$PATH</code> environment variable and add dependent
         libraries to script’s <code class="literal">sys.path</code>.
        </p></li><li class="listitem"><p>
         In the <code class="literal">installCheck</code> phase,
         <code class="literal">${python.interpreter} setup.py test</code> is ran.
        </p></li></ul></div><p>
       As in Perl, dependencies on other Python packages can be specified in
       the <code class="literal">buildInputs</code> and
       <code class="literal">propagatedBuildInputs</code> attributes. If something is
       exclusively a build-time dependency, use <code class="literal">buildInputs</code>;
       if it is (also) a runtime dependency, use
       <code class="literal">propagatedBuildInputs</code>.
      </p><p>
       By default tests are run because <code class="literal">doCheck = true</code>. Test
       dependencies, like e.g. the test runner, should be added to
       <code class="literal">checkInputs</code>.
      </p><p>
       By default <code class="literal">meta.platforms</code> is set to the same value as
       the interpreter unless overridden otherwise.
      </p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="buildpythonpackage-parameters"></a>9.14.2.2.1.1. <code class="literal">buildPythonPackage</code> parameters</h6></div></div></div><p>
        All parameters from <code class="literal">stdenv.mkDerivation</code> function are
        still supported. The following are specific to
        <code class="literal">buildPythonPackage</code>:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">catchConflicts ? true</code>: If <code class="literal">true</code>,
          abort package build if a package name appears more than once in
          dependency tree. Default is <code class="literal">true</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">disabled</code> ? false: If <code class="literal">true</code>,
          package is not build for the particular Python interpreter version.
         </p></li><li class="listitem"><p>
          <code class="literal">dontWrapPythonPrograms ? false</code>: Skip wrapping of
          python programs.
         </p></li><li class="listitem"><p>
          <code class="literal">installFlags ? []</code>: A list of strings. Arguments to
          be passed to <code class="literal">pip install</code>. To pass options to
          <code class="literal">python setup.py install</code>, use
          <code class="literal">--install-option</code>. E.g.,
          <code class="literal">installFlags=["--install-option='--cpp_implementation'"]</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">format ? "setuptools"</code>: Format of the source. Valid
          options are <code class="literal">"setuptools"</code>,
          <code class="literal">"pyproject"</code>, <code class="literal">"flit"</code>,
          <code class="literal">"wheel"</code>, and <code class="literal">"other"</code>.
          <code class="literal">"setuptools"</code> is for when the source has a
          <code class="literal">setup.py</code> and <code class="literal">setuptools</code> is used
          to build a wheel, <code class="literal">flit</code>, in case
          <code class="literal">flit</code> should be used to build a wheel, and
          <code class="literal">wheel</code> in case a wheel is provided. Use
          <code class="literal">other</code> when a custom <code class="literal">buildPhase</code>
          and/or <code class="literal">installPhase</code> is needed.
         </p></li><li class="listitem"><p>
          <code class="literal">makeWrapperArgs ? []</code>: A list of strings. Arguments
          to be passed to <code class="literal">makeWrapper</code>, which wraps generated
          binaries. By default, the arguments to <code class="literal">makeWrapper</code>
          set <code class="literal">PATH</code> and <code class="literal">PYTHONPATH</code>
          environment variables before calling the binary. Additional arguments
          here can allow a developer to set environment variables which will be
          available when the binary is run. For example,
          <code class="literal">makeWrapperArgs = ["--set FOO BAR" "--set BAZ
          QUX"]</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">namePrefix</code>: Prepends text to
          <code class="literal">${name}</code> parameter. In case of libraries, this
          defaults to <code class="literal">"python3.5-"</code> for Python 3.5, etc., and
          in case of applications to <code class="literal">""</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">pythonPath ? []</code>: List of packages to be added into
          <code class="literal">$PYTHONPATH</code>. Packages in
          <code class="literal">pythonPath</code> are not propagated (contrary to
          <code class="literal">propagatedBuildInputs</code>).
         </p></li><li class="listitem"><p>
          <code class="literal">preShellHook</code>: Hook to execute commands before
          <code class="literal">shellHook</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">postShellHook</code>: Hook to execute commands after
          <code class="literal">shellHook</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">removeBinByteCode ? true</code>: Remove bytecode from
          <code class="literal">/bin</code>. Bytecode is only created when the filenames
          end with <code class="literal">.py</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">setupPyBuildFlags ? []</code>: List of flags passed to
          <code class="literal">setup.py build_ext</code> command.
         </p></li></ul></div><p>
        The <code class="literal">stdenv.mkDerivation</code> function accepts various
        parameters for describing build inputs (see <span class="quote">“<span class="quote">Specifying
        dependencies</span>”</span>). The following are of special interest for Python
        packages, either because these are primarily used, or because their
        behaviour is different:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">nativeBuildInputs ? []</code>: Build-time only
          dependencies. Typically executables as well as the items listed in
          <code class="literal">setup_requires</code>.
         </p></li><li class="listitem"><p>
          <code class="literal">buildInputs ? []</code>: Build and/or run-time
          dependencies that need to be be compiled for the host machine.
          Typically non-Python libraries which are being linked.
         </p></li><li class="listitem"><p>
          <code class="literal">checkInputs ? []</code>: Dependencies needed for running
          the <code class="literal">checkPhase</code>. These are added to
          <code class="literal">nativeBuildInputs</code> when <code class="literal">doCheck =
          true</code>. Items listed in <code class="literal">tests_require</code> go
          here.
         </p></li><li class="listitem"><p>
          <code class="literal">propagatedBuildInputs ? []</code>: Aside from propagating
          dependencies, <code class="literal">buildPythonPackage</code> also injects code
          into and wraps executables with the paths included in this list.
          Items listed in <code class="literal">install_requires</code> go here.
         </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="overriding-python-packages"></a>9.14.2.2.1.2. Overriding Python packages</h6></div></div></div><p>
        The <code class="literal">buildPythonPackage</code> function has a
        <code class="literal">overridePythonAttrs</code> method that can be used to
        override the package. In the following example we create an environment
        where we have the <code class="literal">blaze</code> package using an older
        version of <code class="literal">pandas</code>. We override first the Python
        interpreter and pass <code class="literal">packageOverrides</code> which contains
        the overrides for packages in the package set.
       </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

(let
  python = let
    packageOverrides = self: super: {
      pandas = super.pandas.overridePythonAttrs(old: rec {
        version = "0.19.1";
        src =  super.fetchPypi {
          pname = "pandas";
          inherit version;
          sha256 = "08blshqj9zj1wyjhhw3kl2vas75vhhicvv72flvf1z3jvapgw295";
        };
      });
    };
  in pkgs.python3.override {inherit packageOverrides;};

in python.withPackages(ps: [ps.blaze])).env
</pre></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="buildpythonapplication-function"></a>9.14.2.2.2. <code class="literal">buildPythonApplication</code> function</h5></div></div></div><p>
       The <code class="literal">buildPythonApplication</code> function is practically
       the same as <code class="literal">buildPythonPackage</code>. The main purpose of
       this function is to build a Python package where one is interested only
       in the executables, and not importable modules. For that reason, when
       adding this package to a <code class="literal">python.buildEnv</code>, the modules
       won’t be made available.
      </p><p>
       Another difference is that <code class="literal">buildPythonPackage</code> by
       default prefixes the names of the packages with the version of the
       interpreter. Because this is irrelevant for applications, the prefix is
       omitted.
      </p><p>
       When packaging a python application with
       <code class="literal">buildPythonApplication</code>, it should be called with
       <code class="literal">callPackage</code> and passed <code class="literal">python</code> or
       <code class="literal">pythonPackages</code> (possibly specifying an interpreter
       version), like this:
      </p><pre class="programlisting">
{ lib, python3Packages }:

python3Packages.buildPythonApplication rec {
  pname = "luigi";
  version = "2.7.9";

  src = python3Packages.fetchPypi {
    inherit pname version;
    sha256 = "035w8gqql36zlan0xjrzz9j4lh9hs0qrsgnbyw07qs7lnkvbdv9x";
  };

  propagatedBuildInputs = with python3Packages; [ tornado_4 python-daemon ];

  meta = with lib; {
    ...
  };
}
</pre><p>
       This is then added to <code class="literal">all-packages.nix</code> just as any
       other application would be.
      </p><pre class="programlisting">
luigi = callPackage ../applications/networking/cluster/luigi { };
</pre><p>
       Since the package is an application, a consumer doesn’t need to
       care about python versions or modules, which is why they don’t go
       in <code class="literal">pythonPackages</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="topythonapplication-function"></a>9.14.2.2.3. <code class="literal">toPythonApplication</code> function</h5></div></div></div><p>
       A distinction is made between applications and libraries, however,
       sometimes a package is used as both. In this case the package is added
       as a library to <code class="literal">python-packages.nix</code> and as an
       application to <code class="literal">all-packages.nix</code>. To reduce
       duplication the <code class="literal">toPythonApplication</code> can be used to
       convert a library to an application.
      </p><p>
       The Nix expression shall use <code class="literal">buildPythonPackage</code> and
       be called from <code class="literal">python-packages.nix</code>. A reference shall
       be created from <code class="literal">all-packages.nix</code> to the attribute in
       <code class="literal">python-packages.nix</code>, and the
       <code class="literal">toPythonApplication</code> shall be applied to the
       reference:
      </p><pre class="programlisting">
youtube-dl = with pythonPackages; toPythonApplication youtube-dl;
</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="topythonmodule-function"></a>9.14.2.2.4. <code class="literal">toPythonModule</code> function</h5></div></div></div><p>
       In some cases, such as bindings, a package is created using
       <code class="literal">stdenv.mkDerivation</code> and added as attribute in
       <code class="literal">all-packages.nix</code>. The Python bindings should be made
       available from <code class="literal">python-packages.nix</code>. The
       <code class="literal">toPythonModule</code> function takes a derivation and makes
       certain Python-specific modifications.
      </p><pre class="programlisting">
opencv = toPythonModule (pkgs.opencv.override {
  enablePython = true;
  pythonPackages = self;
});
</pre><p>
       Do pay attention to passing in the right Python version!
      </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="python.buildenv-function"></a>9.14.2.2.5. <code class="literal">python.buildEnv</code> function</h5></div></div></div><p>
       Python environments can be created using the low-level
       <code class="literal">pkgs.buildEnv</code> function. This example shows how to
       create an environment that has the Pyramid Web Framework. Saving the
       following as <code class="literal">default.nix</code>
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

python.buildEnv.override {
  extraLibs = [ pkgs.pythonPackages.pyramid ];
  ignoreCollisions = true;
}
</pre><p>
       and running <code class="literal">nix-build</code> will create
      </p><pre class="programlisting">
/nix/store/cf1xhjwzmdki7fasgr4kz6di72ykicl5-python-2.7.8-env
</pre><p>
       with wrapped binaries in <code class="literal">bin/</code>.
      </p><p>
       You can also use the <code class="literal">env</code> attribute to create local
       environments with needed packages installed. This is somewhat comparable
       to <code class="literal">virtualenv</code>. For example, running
       <code class="literal">nix-shell</code> with the following
       <code class="literal">shell.nix</code>
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

(python3.buildEnv.override {
  extraLibs = with python3Packages; [ numpy requests ];
}).env
</pre><p>
       will drop you into a shell where Python will have the specified packages
       in its path.
      </p><div class="section"><div class="titlepage"><div><div><h6 class="title"><a id="python.buildenv-arguments"></a>9.14.2.2.5.1. <code class="literal">python.buildEnv</code> arguments</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">extraLibs</code>: List of packages installed inside the
          environment.
         </p></li><li class="listitem"><p>
          <code class="literal">postBuild</code>: Shell command executed after the build
          of environment.
         </p></li><li class="listitem"><p>
          <code class="literal">ignoreCollisions</code>: Ignore file collisions inside
          the environment (default is <code class="literal">false</code>).
         </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="python.withpackages-function"></a>9.14.2.2.6. <code class="literal">python.withPackages</code> function</h5></div></div></div><p>
       The <code class="literal">python.withPackages</code> function provides a simpler
       interface to the <code class="literal">python.buildEnv</code> functionality. It
       takes a function as an argument that is passed the set of python
       packages and returns the list of the packages to be included in the
       environment. Using the <code class="literal">withPackages</code> function, the
       previous example for the Pyramid Web Framework environment can be
       written like this:
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

python.withPackages (ps: [ps.pyramid])
</pre><p>
       <code class="literal">withPackages</code> passes the correct package set for the
       specific interpreter version as an argument to the function. In the
       above example, <code class="literal">ps</code> equals
       <code class="literal">pythonPackages</code>. But you can also easily switch to
       using python3:
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

python3.withPackages (ps: [ps.pyramid])
</pre><p>
       Now, <code class="literal">ps</code> is set to <code class="literal">python3Packages</code>,
       matching the version of the interpreter.
      </p><p>
       As <code class="literal">python.withPackages</code> simply uses
       <code class="literal">python.buildEnv</code> under the hood, it also supports the
       <code class="literal">env</code> attribute. The <code class="literal">shell.nix</code> file
       from the previous section can thus be also written like this:
      </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

(python36.withPackages (ps: [ps.numpy ps.requests])).env
</pre><p>
       In contrast to <code class="literal">python.buildEnv</code>,
       <code class="literal">python.withPackages</code> does not support the more
       advanced options such as <code class="literal">ignoreCollisions = true</code> or
       <code class="literal">postBuild</code>. If you need them, you have to use
       <code class="literal">python.buildEnv</code>.
      </p><p>
       Python 2 namespace packages may provide <code class="literal">__init__.py</code>
       that collide. In that case <code class="literal">python.buildEnv</code> should be
       used with <code class="literal">ignoreCollisions = true</code>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="development-mode"></a>9.14.2.3. Development mode</h4></div></div></div><p>
      Development or editable mode is supported. To develop Python packages
      <code class="literal">buildPythonPackage</code> has additional logic inside
      <code class="literal">shellPhase</code> to run <code class="literal">pip install -e . --prefix
      $TMPDIR/</code>for the package.
     </p><p>
      Warning: <code class="literal">shellPhase</code> is executed only if
      <code class="literal">setup.py</code> exists.
     </p><p>
      Given a <code class="literal">default.nix</code>:
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

buildPythonPackage { name = "myproject";

buildInputs = with pkgs.pythonPackages; [ pyramid ];

src = ./.; }
</pre><p>
      Running <code class="literal">nix-shell</code> with no arguments should give you
      the environment in which the package would be built with
      <code class="literal">nix-build</code>.
     </p><p>
      Shortcut to setup environments with C headers/libraries and python
      packages:
     </p><pre class="programlisting">
nix-shell -p pythonPackages.pyramid zlib libjpeg git
</pre><p>
      Note: There is a boolean value <code class="literal">lib.inNixShell</code> set to
      <code class="literal">true</code> if nix-shell is invoked.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="tools"></a>9.14.2.4. Tools</h4></div></div></div><p>
      Packages inside nixpkgs are written by hand. However many tools exist in
      community to help save time. No tool is preferred at the moment.
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="https://github.com/proger/python2nix" target="_top">python2nix</a>
        by Vladimir Kirillov
       </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/garbas/pypi2nix" target="_top">pypi2nix</a>
        by Rok Garbas
       </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/offlinehacker/pypi2nix" target="_top">pypi2nix</a>
        by Jaka Hudoklin
       </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="deterministic-builds"></a>9.14.2.5. Deterministic builds</h4></div></div></div><p>
      The Python interpreters are now built deterministically. Minor
      modifications had to be made to the interpreters in order to generate
      deterministic bytecode. This has security implications and is relevant
      for those using Python in a <code class="literal">nix-shell</code>.
     </p><p>
      When the environment variable <code class="literal">DETERMINISTIC_BUILD</code> is
      set, all bytecode will have timestamp 1. The
      <code class="literal">buildPythonPackage</code> function sets
      <code class="literal">DETERMINISTIC_BUILD=1</code> and
      <a class="link" href="https://docs.python.org/3.5/using/cmdline.html#envvar-PYTHONHASHSEED" target="_top">PYTHONHASHSEED=0</a>.
      Both are also exported in <code class="literal">nix-shell</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="automatic-tests"></a>9.14.2.6. Automatic tests</h4></div></div></div><p>
      It is recommended to test packages as part of the build process. Source
      distributions (<code class="literal">sdist</code>) often include test files, but
      not always.
     </p><p>
      By default the command <code class="literal">python setup.py test</code> is run as
      part of the <code class="literal">checkPhase</code>, but often it is necessary to
      pass a custom <code class="literal">checkPhase</code>. An example of such a
      situation is when <code class="literal">py.test</code> is used.
     </p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="common-issues"></a>9.14.2.6.1. Common issues</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Non-working tests can often be deselected. By default
         <code class="literal">buildPythonPackage</code> runs <code class="literal">python setup.py
         test</code>. Most python modules follows the standard test protocol
         where the pytest runner can be used instead.
         <code class="literal">py.test</code> supports a <code class="literal">-k</code> parameter
         to ignore test methods or classes:
        </p><pre class="programlisting">
buildPythonPackage {
  # ...
  # assumes the tests are located in tests
  checkInputs = [ pytest ];
  checkPhase = ''
    py.test -k 'not function_name and not other_function' tests
  '';
}
</pre></li><li class="listitem"><p>
         Tests that attempt to access <code class="literal">$HOME</code> can be fixed by
         using the following work-around before running tests
         (e.g. <code class="literal">preCheck</code>): <code class="literal">export HOME=$(mktemp
         -d)</code>
        </p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="faq"></a>9.14.3. FAQ</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-solve-circular-dependencies"></a>9.14.3.1. How to solve circular dependencies?</h4></div></div></div><p>
      Consider the packages <code class="literal">A</code> and <code class="literal">B</code> that
      depend on each other. When packaging <code class="literal">B</code>, a solution is
      to override package <code class="literal">A</code> not to depend on
      <code class="literal">B</code> as an input. The same should also be done when
      packaging <code class="literal">A</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package"></a>9.14.3.2. How to override a Python package?</h4></div></div></div><p>
      We can override the interpreter and pass
      <code class="literal">packageOverrides</code>. In the following example we rename
      the <code class="literal">pandas</code> package and build it.
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

(let
  python = let
    packageOverrides = self: super: {
      pandas = super.pandas.overridePythonAttrs(old: {name="foo";});
    };
  in pkgs.python35.override {inherit packageOverrides;};

in python.withPackages(ps: [ps.pandas])).env
</pre><p>
      Using <code class="literal">nix-build</code> on this expression will build an
      environment that contains the package <code class="literal">pandas</code> but with
      the new name <code class="literal">foo</code>.
     </p><p>
      All packages in the package set will use the renamed package. A typical
      use case is to switch to another version of a certain package. For
      example, in the Nixpkgs repository we have multiple versions of
      <code class="literal">django</code> and <code class="literal">scipy</code>. In the following
      example we use a different version of <code class="literal">scipy</code> and create
      an environment that uses it. All packages in the Python package set will
      now use the updated <code class="literal">scipy</code> version.
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

( let
    packageOverrides = self: super: {
      scipy = super.scipy_0_17;
    };
  in (pkgs.python35.override {inherit packageOverrides;}).withPackages (ps: [ps.blaze])
).env
</pre><p>
      The requested package <code class="literal">blaze</code> depends on
      <code class="literal">pandas</code> which itself depends on
      <code class="literal">scipy</code>.
     </p><p>
      If you want the whole of Nixpkgs to use your modifications, then you can
      use <code class="literal">overlays</code> as explained in this manual. In the
      following example we build a <code class="literal">inkscape</code> using a
      different version of <code class="literal">numpy</code>.
     </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};
  newpkgs = import pkgs.path { overlays = [ (pkgsself: pkgssuper: {
    python27 = let
      packageOverrides = self: super: {
        numpy = super.numpy_1_10;
      };
    in pkgssuper.python27.override {inherit packageOverrides;};
  } ) ]; };
in newpkgs.inkscape
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="python-setup.py-bdist_wheel-cannot-create-.whl"></a>9.14.3.3. <code class="literal">python setup.py bdist_wheel</code> cannot create .whl</h4></div></div></div><p>
      Executing <code class="literal">python setup.py bdist_wheel</code> in a
      <code class="literal">nix-shell</code>fails with
     </p><pre class="programlisting">
ValueError: ZIP does not support timestamps before 1980
</pre><p>
      This is because files from the Nix store (which have a timestamp of the
      UNIX epoch of January 1, 1970) are included in the .ZIP, but .ZIP
      archives follow the DOS convention of counting timestamps from 1980.
     </p><p>
      The command <code class="literal">bdist_wheel</code> reads the
      <code class="literal">SOURCE_DATE_EPOCH</code> environment variable, which
      <code class="literal">nix-shell</code> sets to 1. Unsetting this variable or giving
      it a value corresponding to 1980 or later enables building wheels.
     </p><p>
      Use 1980 as timestamp:
     </p><pre class="programlisting">
nix-shell --run "SOURCE_DATE_EPOCH=315532800 python3 setup.py bdist_wheel"
</pre><p>
      or the current time:
     </p><pre class="programlisting">
nix-shell --run "SOURCE_DATE_EPOCH=$(date +%s) python3 setup.py bdist_wheel"
</pre><p>
      or unset <code class="literal">SOURCE_DATE_EPOCH</code>:
     </p><pre class="programlisting">
nix-shell --run "unset SOURCE_DATE_EPOCH; python3 setup.py bdist_wheel"
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="install_data-data_files-problems"></a>9.14.3.4. <code class="literal">install_data</code> / <code class="literal">data_files</code> problems</h4></div></div></div><p>
      If you get the following error:
     </p><pre class="programlisting">
could not create '/nix/store/6l1bvljpy8gazlsw2aw9skwwp4pmvyxw-python-2.7.8/etc':
Permission denied
</pre><p>
      This is a
      <a class="link" href="https://github.com/pypa/setuptools/issues/130" target="_top">known
      bug</a> in <code class="literal">setuptools</code>. Setuptools
      <code class="literal">install_data</code> does not respect
      <code class="literal">--prefix</code>. An example of such package using the feature
      is <code class="literal">pkgs/tools/X11/xpra/default.nix</code>. As workaround
      install it as an extra <code class="literal">preInstall</code> step:
     </p><pre class="programlisting">
${python.interpreter} setup.py install_data --install-dir=$out --root=$out
sed -i '/ = data\_files/d' setup.py
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="rationale-of-non-existent-global-site-packages"></a>9.14.3.5. Rationale of non-existent global site-packages</h4></div></div></div><p>
      On most operating systems a global <code class="literal">site-packages</code> is
      maintained. This however becomes problematic if you want to run multiple
      Python versions or have multiple versions of certain libraries for your
      projects. Generally, you would solve such issues by creating virtual
      environments using <code class="literal">virtualenv</code>.
     </p><p>
      On Nix each package has an isolated dependency tree which, in the case of
      Python, guarantees the right versions of the interpreter and libraries or
      packages are available. There is therefore no need to maintain a global
      <code class="literal">site-packages</code>.
     </p><p>
      If you want to create a Python environment for development, then the
      recommended method is to use <code class="literal">nix-shell</code>, either with or
      without the <code class="literal">python.buildEnv</code> function.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-consume-python-modules-using-pip-in-a-virtualenv-like-i-am-used-to-on-other-operating-systems"></a>9.14.3.6. How to consume python modules using pip in a virtualenv like I am used to on other Operating Systems ?</h4></div></div></div><p>
      This is an example of a <code class="literal">default.nix</code> for a
      <code class="literal">nix-shell</code>, which allows to consume a
      <code class="literal">virtualenv</code> environment, and install python modules
      through <code class="literal">pip</code> the traditional way.
     </p><p>
      Create this <code class="literal">default.nix</code> file, together with a
      <code class="literal">requirements.txt</code> and simply execute
      <code class="literal">nix-shell</code>.
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};
with pkgs.python27Packages;

stdenv.mkDerivation {
  name = "impurePythonEnv";
  buildInputs = [
    # these packages are required for virtualenv and pip to work:
    #
    python27Full
    python27Packages.virtualenv
    python27Packages.pip
    # the following packages are related to the dependencies of your python
    # project.
    # In this particular example the python modules listed in the
    # requirements.txt require the following packages to be installed locally
    # in order to compile any binary extensions they may require.
    #
    taglib
    openssl
    git
    libxml2
    libxslt
    libzip
    stdenv
    zlib ];
  src = null;
  shellHook = ''
  # set SOURCE_DATE_EPOCH so that we can use python wheels
  SOURCE_DATE_EPOCH=$(date +%s)
  virtualenv --no-setuptools venv
  export PATH=$PWD/venv/bin:$PATH
  pip install -r requirements.txt
  '';
}
</pre><p>
      Note that the <code class="literal">pip install</code> is an imperative action. So
      every time <code class="literal">nix-shell</code> is executed it will attempt to
      download the python modules listed in requirements.txt. However these
      will be cached locally within the <code class="literal">virtualenv</code> folder
      and not downloaded again.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package-from-configuration.nix"></a>9.14.3.7. How to override a Python package from <code class="literal">configuration.nix</code>?</h4></div></div></div><p>
      If you need to change a package’s attribute(s) from
      <code class="literal">configuration.nix</code> you could do:
     </p><pre class="programlisting">
  nixpkgs.config.packageOverrides = super: {
    python = super.python.override {
      packageOverrides = python-self: python-super: {
        zerobin = python-super.zerobin.overrideAttrs (oldAttrs: {
          src = super.fetchgit {
            url = "https://github.com/sametmax/0bin";
            rev = "a344dbb18fe7a855d0742b9a1cede7ce423b34ec";
            sha256 = "16d769kmnrpbdr0ph0whyf4yff5df6zi4kmwx7sz1d3r6c8p6xji";
          };
        });
      };
    };
  };
</pre><p>
      <code class="literal">pythonPackages.zerobin</code> is now globally overridden. All
      packages and also the <code class="literal">zerobin</code> NixOS service use the
      new definition. Note that <code class="literal">python-super</code> refers to the
      old package set and <code class="literal">python-self</code> to the new, overridden
      version.
     </p><p>
      To modify only a Python package set instead of a whole Python derivation,
      use this snippet:
     </p><pre class="programlisting">
  myPythonPackages = pythonPackages.override {
    overrides = self: super: {
      zerobin = ...;
    };
  }
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-override-a-python-package-using-overlays"></a>9.14.3.8. How to override a Python package using overlays?</h4></div></div></div><p>
      Use the following overlay template:
     </p><pre class="programlisting">
self: super: {
  python = super.python.override {
    packageOverrides = python-self: python-super: {
      zerobin = python-super.zerobin.overrideAttrs (oldAttrs: {
        src = super.fetchgit {
          url = "https://github.com/sametmax/0bin";
          rev = "a344dbb18fe7a855d0742b9a1cede7ce423b34ec";
          sha256 = "16d769kmnrpbdr0ph0whyf4yff5df6zi4kmwx7sz1d3r6c8p6xji";
        };
      });
    };
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="how-to-use-intels-mkl-with-numpy-and-scipy"></a>9.14.3.9. How to use Intel’s MKL with numpy and scipy?</h4></div></div></div><p>
      A <code class="literal">site.cfg</code> is created that configures BLAS based on
      the <code class="literal">blas</code> parameter of the <code class="literal">numpy</code>
      derivation. By passing in <code class="literal">mkl</code>,
      <code class="literal">numpy</code> and packages depending on
      <code class="literal">numpy</code> will be built with <code class="literal">mkl</code>.
     </p><p>
      The following is an overlay that configures <code class="literal">numpy</code> to
      use <code class="literal">mkl</code>:
     </p><pre class="programlisting">
self: super: {
  python37 = super.python37.override {
    packageOverrides = python-self: python-super: {
      numpy = python-super.numpy.override {
        blas = super.pkgs.mkl;
      };
    };
  };
}
</pre><p>
      <code class="literal">mkl</code> requires an <code class="literal">openmp</code>
      implementation when running with multiple processors. By default,
      <code class="literal">mkl</code> will use Intel’s <code class="literal">iomp</code>
      implementation if no other is specified, but this is a runtime-only
      dependency and binary compatible with the LLVM implementation. To use
      that one instead, Intel recommends users set it with
      <code class="literal">LD_PRELOAD</code>.
     </p><p>
      Note that <code class="literal">mkl</code> is only available on
      <code class="literal">x86_64-{linux,darwin}</code> platforms; moreover, Hydra is
      not building and distributing pre-compiled binaries using it.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="what-inputs-do-setup_requires-install_requires-and-tests_require-map-to"></a>9.14.3.10. What inputs do <code class="literal">setup_requires</code>, <code class="literal">install_requires</code> and <code class="literal">tests_require</code> map to?</h4></div></div></div><p>
      In a <code class="literal">setup.py</code> or <code class="literal">setup.cfg</code> it is
      common to declare dependencies:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">setup_requires</code> corresponds to
        <code class="literal">nativeBuildInputs</code>
       </p></li><li class="listitem"><p>
        <code class="literal">install_requires</code> corresponds to
        <code class="literal">propagatedBuildInputs</code>
       </p></li><li class="listitem"><p>
        <code class="literal">tests_require</code> corresponds to
        <code class="literal">checkInputs</code>
       </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="contributing"></a>9.14.4. Contributing</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="contributing-guidelines"></a>9.14.4.1. Contributing guidelines</h4></div></div></div><p>
      Following rules are desired to be respected:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Python libraries are called from <code class="literal">python-packages.nix</code>
        and packaged with <code class="literal">buildPythonPackage</code>. The expression
        of a library should be in
        <code class="literal">pkgs/development/python-modules/&lt;name&gt;/default.nix</code>.
        Libraries in <code class="literal">pkgs/top-level/python-packages.nix</code> are
        sorted quasi-alphabetically to avoid merge conflicts.
       </p></li><li class="listitem"><p>
        Python applications live outside of
        <code class="literal">python-packages.nix</code> and are packaged with
        <code class="literal">buildPythonApplication</code>.
       </p></li><li class="listitem"><p>
        Make sure libraries build for all Python interpreters.
       </p></li><li class="listitem"><p>
        By default we enable tests. Make sure the tests are found and, in the
        case of libraries, are passing for all interpreters. If certain tests
        fail they can be disabled individually. Try to avoid disabling the
        tests altogether. In any case, when you disable tests, leave a comment
        explaining why.
       </p></li><li class="listitem"><p>
        Commit names of Python libraries should reflect that they are Python
        libraries, so write for example <code class="literal">pythonPackages.numpy: 1.11
        -&gt; 1.12</code>.
       </p></li><li class="listitem"><p>
        Attribute names in <code class="literal">python-packages.nix</code> should be
        normalized according to
        <a class="link" href="https://www.python.org/dev/peps/pep-0503/#normalized-names" target="_top">PEP
        0503</a>. This means that characters should be converted to
        lowercase and <code class="literal">.</code> and <code class="literal">_</code> should be
        replaced by a single <code class="literal">-</code> (foo-bar-baz instead of
        Foo__Bar.baz )
       </p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-qt"></a>9.15. Qt</h2></div></div></div><p>
    Qt is a comprehensive desktop and mobile application development toolkit
    for C++. Legacy support is available for Qt 3 and Qt 4, but all current
    development uses Qt 5. The Qt 5 packages in Nixpkgs are updated frequently
    to take advantage of new features, but older versions are typically
    retained until their support window ends. The most important consideration
    in packaging Qt-based software is ensuring that each package and all its
    dependencies use the same version of Qt 5; this consideration motivates
    most of the tools described below.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-qt-libraries"></a>9.15.1. Packaging Libraries for Nixpkgs</h3></div></div></div><p>
     Whenever possible, libraries that use Qt 5 should be built with each
     available version. Packages providing libraries should be added to the
     top-level function <code class="varname">mkLibsForQt5</code>, which is used to build
     a set of libraries for every Qt 5 version. A special
     <code class="varname">callPackage</code> function is used in this scope to ensure
     that the entire dependency tree uses the same Qt 5 version. Import
     dependencies unqualified, i.e., <code class="literal">qtbase</code> not
     <code class="literal">qt5.qtbase</code>. <span class="emphasis"><em>Do not</em></span> import a
     package set such as <code class="literal">qt5</code> or
     <code class="literal">libsForQt5</code>.
    </p><p>
     If a library does not support a particular version of Qt 5, it is best to
     mark it as broken by setting its <code class="literal">meta.broken</code> attribute.
     A package may be marked broken for certain versions by testing the
     <code class="literal">qtbase.version</code> attribute, which will always give the
     current Qt 5 version.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ssec-qt-applications"></a>9.15.2. Packaging Applications for Nixpkgs</h3></div></div></div><p>
     Call your application expression using
     <code class="literal">libsForQt5.callPackage</code> instead of
     <code class="literal">callPackage</code>. Import dependencies unqualified, i.e.,
     <code class="literal">qtbase</code> not <code class="literal">qt5.qtbase</code>. <span class="emphasis"><em>Do
     not</em></span> import a package set such as <code class="literal">qt5</code> or
     <code class="literal">libsForQt5</code>.
    </p><p>
     Qt 5 maintains strict backward compatibility, so it is generally best to
     build an application package against the latest version using the
     <code class="varname">libsForQt5</code> library set. In case a package does not
     build with the latest Qt version, it is possible to pick a set pinned to a
     particular version, e.g. <code class="varname">libsForQt55</code> for Qt 5.5, if
     that is the latest version the package supports. If a package must be
     pinned to an older Qt version, be sure to file a bug upstream; because Qt
     is strictly backwards-compatible, any incompatibility is by definition a
     bug in the application.
    </p><p>
     When testing applications in Nixpkgs, it is a common practice to build the
     package with <code class="literal">nix-build</code> and run it using the created
     symbolic link. This will not work with Qt applications, however, because
     they have many hard runtime requirements that can only be guaranteed if
     the package is actually installed. To test a Qt application, install it
     with <code class="literal">nix-env</code> or run it inside
     <code class="literal">nix-shell</code>.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="r-packages"></a>9.16. R packages</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="installation"></a>9.16.1. Installation</h3></div></div></div><p>
     Define an environment for R that contains all the libraries that
     you’d like to use by adding the following snippet to your
     $HOME/.config/nixpkgs/config.nix file:
    </p><pre class="programlisting">
{
    packageOverrides = super: let self = super.pkgs; in
    {

        rEnv = super.rWrapper.override {
            packages = with self.rPackages; [
                devtools
                ggplot2
                reshape2
                yaml
                optparse
                ];
        };
    };
}
</pre><p>
     Then you can use <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA rEnv</code>
     to install it into your user profile. The set of available libraries can
     be discovered by running the command <code class="literal">nix-env -f "&lt;nixpkgs&gt;"
     -qaP -A rPackages</code>. The first column from that output is the name
     that has to be passed to rWrapper in the code snipped above.
    </p><p>
     However, if you’d like to add a file to your project source to make
     the environment available for other contributors, you can create a
     <code class="literal">default.nix</code> file like so:
    </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};
  stdenv = pkgs.stdenv;
in with pkgs; {
  myProject = stdenv.mkDerivation {
    name = "myProject";
    version = "1";
    src = if pkgs.lib.inNixShell then null else nix;

    buildInputs = with rPackages; [
      R
      ggplot2
      knitr
    ];
  };
}
</pre><p>
     and then run <code class="literal">nix-shell .</code> to be dropped into a shell
     with those packages available.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rstudio"></a>9.16.2. RStudio</h3></div></div></div><p>
     RStudio uses a standard set of packages and ignores any custom R
     environments or installed packages you may have. To create a custom
     environment, see <code class="literal">rstudioWrapper</code>, which functions
     similarly to <code class="literal">rWrapper</code>:
    </p><pre class="programlisting">
{
    packageOverrides = super: let self = super.pkgs; in
    {

        rstudioEnv = super.rstudioWrapper.override {
            packages = with self.rPackages; [
                dplyr
                ggplot2
                reshape2
                ];
        };
    };
}
</pre><p>
     Then like above, <code class="literal">nix-env -f "&lt;nixpkgs&gt;" -iA
     rstudioEnv</code> will install this into your user profile.
    </p><p>
     Alternatively, you can create a self-contained
     <code class="literal">shell.nix</code> without the need to modify any configuration
     files:
    </p><pre class="programlisting">
{ pkgs ? import &lt;nixpkgs&gt; {}
}:

pkgs.rstudioWrapper.override {
  packages = with pkgs.rPackages; [ dplyr ggplot2 reshape2 ];
}
</pre><p>
     Executing <code class="literal">nix-shell</code> will then drop you into an
     environment equivalent to the one above. If you need additional packages
     just add them to the list and re-enter the shell.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="updating-the-package-set"></a>9.16.3. Updating the package set</h3></div></div></div><pre class="programlisting">
nix-shell generate-shell.nix

Rscript generate-r-packages.R cran  &gt; cran-packages.nix.new
mv cran-packages.nix.new cran-packages.nix

Rscript generate-r-packages.R bioc  &gt; bioc-packages.nix.new
mv bioc-packages.nix.new bioc-packages.nix
</pre><p>
     <code class="literal">generate-r-packages.R &lt;repo&gt;</code> reads
     <code class="literal">&lt;repo&gt;-packages.nix</code>, therefor the renaming.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="testing-if-the-nix-expression-could-be-evaluated"></a>9.16.4. Testing if the Nix-expression could be evaluated</h3></div></div></div><pre class="programlisting">
nix-build test-evaluation.nix --dry-run
</pre><p>
     If this exits fine, the expression is ok. If not, you have to edit
     <code class="literal">default.nix</code>
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-ruby"></a>9.17. Ruby</h2></div></div></div><p>
    There currently is support to bundle applications that are packaged as Ruby
    gems. The utility "bundix" allows you to write a
    <code class="filename">Gemfile</code>, let bundler create a
    <code class="filename">Gemfile.lock</code>, and then convert this into a nix
    expression that contains all Gem dependencies automatically.
   </p><p>
    For example, to package sensu, we did:
   </p><pre class="screen">
$ cd pkgs/servers/monitoring
$ mkdir sensu
$ cd sensu
$ cat &gt; Gemfile
source 'https://rubygems.org'
gem 'sensu'
$ $(nix-build '&lt;nixpkgs&gt;' -A bundix --no-out-link)/bin/bundix --magic
$ cat &gt; default.nix
{ lib, bundlerEnv, ruby }:

bundlerEnv rec {
  name = "sensu-${version}";

  version = (import gemset).sensu.version;
  inherit ruby;
  # expects Gemfile, Gemfile.lock and gemset.nix in the same directory
  gemdir = ./.;

  meta = with lib; {
    description = "A monitoring framework that aims to be simple, malleable, and scalable";
    homepage    = http://sensuapp.org/;
    license     = with licenses; mit;
    maintainers = with maintainers; [ theuni ];
    platforms   = platforms.unix;
  };
}
</pre><p>
    Please check in the <code class="filename">Gemfile</code>,
    <code class="filename">Gemfile.lock</code> and the <code class="filename">gemset.nix</code>
    so future updates can be run easily.
   </p><p>
    Updating Ruby packages can then be done like this:
   </p><pre class="screen">
$ cd pkgs/servers/monitoring/sensu
$ nix-shell -p bundler --run 'bundle lock --update'
$ nix-shell -p bundix --run 'bundix'

</pre><p>
    For tools written in Ruby - i.e. where the desire is to install a package
    and then execute e.g. <span class="command"><strong>rake</strong></span> at the command line, there is
    an alternative builder called <code class="literal">bundlerApp</code>. Set up the
    <code class="filename">gemset.nix</code> the same way, and then, for example:
   </p><pre class="screen">
{ lib, bundlerApp }:

bundlerApp {
  pname = "corundum";
  gemdir = ./.;
  exes = [ "corundum-skel" ];

  meta = with lib; {
    description = "Tool and libraries for maintaining Ruby gems.";
    homepage    = https://github.com/nyarly/corundum;
    license     = licenses.mit;
    maintainers = [ maintainers.nyarly ];
    platforms   = platforms.unix;
  };
}
</pre><p>
    The chief advantage of <code class="literal">bundlerApp</code> over
    <code class="literal">bundlerEnv</code> is the executables introduced in the
    environment are precisely those selected in the <code class="literal">exes</code>
    list, as opposed to <code class="literal">bundlerEnv</code> which adds all the
    executables made available by gems in the gemset, which can mean e.g.
    <span class="command"><strong>rspec</strong></span> or <span class="command"><strong>rake</strong></span> in unpredictable
    versions available from various packages.
   </p><p>
    Resulting derivations for both builders also have two helpful attributes,
    <code class="literal">env</code> and <code class="literal">wrappedRuby</code>. The first one
    allows one to quickly drop into <span class="command"><strong>nix-shell</strong></span> with the
    specified environment present. E.g. <span class="command"><strong>nix-shell -A
    sensu.env</strong></span> would give you an environment with Ruby preset so it
    has all the libraries necessary for <code class="literal">sensu</code> in its paths.
    The second one can be used to make derivations from custom Ruby scripts
    which have <code class="filename">Gemfile</code>s with their dependencies specified.
    It is a derivation with <span class="command"><strong>ruby</strong></span> wrapped so it can find all
    the needed dependencies. For example, to make a derivation
    <code class="literal">my-script</code> for a <code class="filename">my-script.rb</code> (which
    should be placed in <code class="filename">bin</code>) you should run
    <span class="command"><strong>bundix</strong></span> as specified above and then use
    <code class="literal">bundlerEnv</code> like this:
   </p><pre class="programlisting">
let env = bundlerEnv {
  name = "my-script-env";

  inherit ruby;
  gemfile = ./Gemfile;
  lockfile = ./Gemfile.lock;
  gemset = ./gemset.nix;
};

in stdenv.mkDerivation {
  name = "my-script";
  buildInputs = [ env.wrappedRuby ];
  script = ./my-script.rb;
  buildCommand = ''
    install -D -m755 $script $out/bin/my-script
    patchShebangs $out/bin/my-script
  '';
}
</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="users-guide-to-the-rust-infrastructure"></a>9.18. User’s Guide to the Rust Infrastructure</h2></div></div></div><p>
    To install the rust compiler and cargo put
   </p><pre class="programlisting">
rustc
cargo
</pre><p>
    into the <code class="literal">environment.systemPackages</code> or bring them into
    scope with <code class="literal">nix-shell -p rustc cargo</code>.
   </p><div class="blockquote"><blockquote class="blockquote"><p>
     If you are using NixOS and you want to use rust without a nix expression
     you probably want to add the following in your
     <code class="literal">configuration.nix</code> to build crates with C dependencies.
    </p><pre class="programlisting">
environment.systemPackages = [binutils gcc gnumake openssl pkgconfig]
</pre></blockquote></div><p>
    For daily builds (beta and nightly) use either rustup from nixpkgs or use
    the <a class="link" href="#using-the-rust-nightlies-overlay" title="9.18.4. Using the Rust nightlies overlay">Rust nightlies
    overlay</a>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="compiling-rust-applications-with-cargo"></a>9.18.1. Compiling Rust applications with Cargo</h3></div></div></div><p>
     Rust applications are packaged by using the
     <code class="literal">buildRustPackage</code> helper from
     <code class="literal">rustPlatform</code>:
    </p><pre class="programlisting">
rustPlatform.buildRustPackage rec {
  name = "ripgrep-${version}";
  version = "0.4.0";

  src = fetchFromGitHub {
    owner = "BurntSushi";
    repo = "ripgrep";
    rev = "${version}";
    sha256 = "0y5d1n6hkw85jb3rblcxqas2fp82h3nghssa4xqrhqnz25l799pj";
  };

  cargoSha256 = "0q68qyl2h6i0qsz82z840myxlnjay8p1w5z7hfyr8fqp7wgwa9cx";

  meta = with stdenv.lib; {
    description = "A fast line-oriented regex search tool, similar to ag and ack";
    homepage = https://github.com/BurntSushi/ripgrep;
    license = licenses.unlicense;
    maintainers = [ maintainers.tailhook ];
    platforms = platforms.all;
  };
}
</pre><p>
     <code class="literal">buildRustPackage</code> requires a
     <code class="literal">cargoSha256</code> attribute which is computed over all crate
     sources of this package. Currently it is obtained by inserting a fake
     checksum into the expression and building the package once. The correct
     checksum can be then take from the failed build.
    </p><p>
     When the <code class="literal">Cargo.lock</code>, provided by upstream, is not in
     sync with the <code class="literal">Cargo.toml</code>, it is possible to use
     <code class="literal">cargoPatches</code> to update it. All patches added in
     <code class="literal">cargoPatches</code> will also be prepended to the patches in
     <code class="literal">patches</code> at build-time.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="compiling-rust-crates-using-nix-instead-of-cargo"></a>9.18.2. Compiling Rust crates using Nix instead of Cargo</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="simple-operation"></a>9.18.2.1. Simple operation</h4></div></div></div><p>
      When run, <code class="literal">cargo build</code> produces a file called
      <code class="literal">Cargo.lock</code>, containing pinned versions of all
      dependencies. Nixpkgs contains a tool called <code class="literal">carnix</code>
      (<code class="literal">nix-env -iA nixos.carnix</code>), which can be used to turn
      a <code class="literal">Cargo.lock</code> into a Nix expression.
     </p><p>
      That Nix expression calls <code class="literal">rustc</code> directly (hence
      bypassing Cargo), and can be used to compile a crate and all its
      dependencies. Here is an example for a minimal <code class="literal">hello</code>
      crate:
     </p><pre class="programlisting">
$ cargo new hello
$ cd hello
$ cargo build
 Compiling hello v0.1.0 (file:///tmp/hello)
  Finished dev [unoptimized + debuginfo] target(s) in 0.20 secs
$ carnix -o hello.nix --src ./. Cargo.lock --standalone
$ nix-build hello.nix -A hello_0_1_0
</pre><p>
      Now, the file produced by the call to <code class="literal">carnix</code>, called
      <code class="literal">hello.nix</code>, looks like:
     </p><pre class="programlisting">
# Generated by carnix 0.6.5: carnix -o hello.nix --src ./. Cargo.lock --standalone
{ lib, stdenv, buildRustCrate, fetchgit }:
let kernel = stdenv.buildPlatform.parsed.kernel.name;
    # ... (content skipped)
in
rec {
  hello = f: hello_0_1_0 { features = hello_0_1_0_features { hello_0_1_0 = f; }; };
  hello_0_1_0_ = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    crateName = "hello";
    version = "0.1.0";
    authors = [ "pe@pijul.org &lt;pe@pijul.org&gt;" ];
    src = ./.;
    inherit dependencies buildDependencies features;
  };
  hello_0_1_0 = { features?(hello_0_1_0_features {}) }: hello_0_1_0_ {};
  hello_0_1_0_features = f: updateFeatures f (rec {
        hello_0_1_0.default = (f.hello_0_1_0.default or true);
    }) [ ];
}
</pre><p>
      In particular, note that the argument given as <code class="literal">--src</code>
      is copied verbatim to the source. If we look at a more complicated
      dependencies, for instance by adding a single line
      <code class="literal">libc="*"</code> to our <code class="literal">Cargo.toml</code>, we
      first need to run <code class="literal">cargo build</code> to update the
      <code class="literal">Cargo.lock</code>. Then, <code class="literal">carnix</code> needs to
      be run again, and produces the following nix file:
     </p><pre class="programlisting">
# Generated by carnix 0.6.5: carnix -o hello.nix --src ./. Cargo.lock --standalone
{ lib, stdenv, buildRustCrate, fetchgit }:
let kernel = stdenv.buildPlatform.parsed.kernel.name;
    # ... (content skipped)
in
rec {
  hello = f: hello_0_1_0 { features = hello_0_1_0_features { hello_0_1_0 = f; }; };
  hello_0_1_0_ = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    crateName = "hello";
    version = "0.1.0";
    authors = [ "pe@pijul.org &lt;pe@pijul.org&gt;" ];
    src = ./.;
    inherit dependencies buildDependencies features;
  };
  libc_0_2_36_ = { dependencies?[], buildDependencies?[], features?[] }: buildRustCrate {
    crateName = "libc";
    version = "0.2.36";
    authors = [ "The Rust Project Developers" ];
    sha256 = "01633h4yfqm0s302fm0dlba469bx8y6cs4nqc8bqrmjqxfxn515l";
    inherit dependencies buildDependencies features;
  };
  hello_0_1_0 = { features?(hello_0_1_0_features {}) }: hello_0_1_0_ {
    dependencies = mapFeatures features ([ libc_0_2_36 ]);
  };
  hello_0_1_0_features = f: updateFeatures f (rec {
    hello_0_1_0.default = (f.hello_0_1_0.default or true);
    libc_0_2_36.default = true;
  }) [ libc_0_2_36_features ];
  libc_0_2_36 = { features?(libc_0_2_36_features {}) }: libc_0_2_36_ {
    features = mkFeatures (features.libc_0_2_36 or {});
  };
  libc_0_2_36_features = f: updateFeatures f (rec {
    libc_0_2_36.default = (f.libc_0_2_36.default or true);
    libc_0_2_36.use_std =
      (f.libc_0_2_36.use_std or false) ||
      (f.libc_0_2_36.default or false) ||
      (libc_0_2_36.default or false);
  }) [];
}
</pre><p>
      Here, the <code class="literal">libc</code> crate has no <code class="literal">src</code>
      attribute, so <code class="literal">buildRustCrate</code> will fetch it from
      <a class="link" href="https://crates.io" target="_top">crates.io</a>. A
      <code class="literal">sha256</code> attribute is still needed for Nix purity.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="handling-external-dependencies"></a>9.18.2.2. Handling external dependencies</h4></div></div></div><p>
      Some crates require external libraries. For crates from
      <a class="link" href="https://crates.io" target="_top">crates.io</a>, such libraries can
      be specified in <code class="literal">defaultCrateOverrides</code> package in
      nixpkgs itself.
     </p><p>
      Starting from that file, one can add more overrides, to add features or
      build inputs by overriding the hello crate in a seperate file.
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};
((import ./hello.nix).hello {}).override {
  crateOverrides = defaultCrateOverrides // {
    hello = attrs: { buildInputs = [ openssl ]; };
  };
}
</pre><p>
      Here, <code class="literal">crateOverrides</code> is expected to be a attribute
      set, where the key is the crate name without version number and the value
      a function. The function gets all attributes passed to
      <code class="literal">buildRustCrate</code> as first argument and returns a set
      that contains all attribute that should be overwritten.
     </p><p>
      For more complicated cases, such as when parts of the crate’s
      derivation depend on the the crate’s version, the
      <code class="literal">attrs</code> argument of the override above can be read, as
      in the following example, which patches the derivation:
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};
((import ./hello.nix).hello {}).override {
  crateOverrides = defaultCrateOverrides // {
    hello = attrs: lib.optionalAttrs (lib.versionAtLeast attrs.version "1.0")  {
      postPatch = ''
        substituteInPlace lib/zoneinfo.rs \
          --replace "/usr/share/zoneinfo" "${tzdata}/share/zoneinfo"
      '';
    };
  };
}
</pre><p>
      Another situation is when we want to override a nested dependency. This
      actually works in the exact same way, since the
      <code class="literal">crateOverrides</code> parameter is forwarded to the
      crate’s dependencies. For instance, to override the build inputs
      for crate <code class="literal">libc</code> in the example above, where
      <code class="literal">libc</code> is a dependency of the main crate, we could do:
     </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};
((import hello.nix).hello {}).override {
  crateOverrides = defaultCrateOverrides // {
    libc = attrs: { buildInputs = []; };
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="options-and-phases-configuration"></a>9.18.2.3. Options and phases configuration</h4></div></div></div><p>
      Actually, the overrides introduced in the previous section are more
      general. A number of other parameters can be overridden:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The version of rustc used to compile the crate:
       </p><pre class="programlisting">
(hello {}).override { rust = pkgs.rust; };
</pre></li><li class="listitem"><p>
        Whether to build in release mode or debug mode (release mode by
        default):
       </p><pre class="programlisting">
(hello {}).override { release = false; };
</pre></li><li class="listitem"><p>
        Whether to print the commands sent to rustc when building (equivalent
        to <code class="literal">--verbose</code> in cargo:
       </p><pre class="programlisting">
(hello {}).override { verbose = false; };
</pre></li><li class="listitem"><p>
        Extra arguments to be passed to <code class="literal">rustc</code>:
       </p><pre class="programlisting">
(hello {}).override { extraRustcOpts = "-Z debuginfo=2"; };
</pre></li><li class="listitem"><p>
        Phases, just like in any other derivation, can be specified using the
        following attributes: <code class="literal">preUnpack</code>,
        <code class="literal">postUnpack</code>, <code class="literal">prePatch</code>,
        <code class="literal">patches</code>, <code class="literal">postPatch</code>,
        <code class="literal">preConfigure</code> (in the case of a Rust crate, this is
        run before calling the <span class="quote">“<span class="quote">build</span>”</span> script),
        <code class="literal">postConfigure</code> (after the <span class="quote">“<span class="quote">build</span>”</span>
        script),<code class="literal">preBuild</code>, <code class="literal">postBuild</code>,
        <code class="literal">preInstall</code> and <code class="literal">postInstall</code>. As an
        example, here is how to create a new module before running the build
        script:
       </p><pre class="programlisting">
(hello {}).override {
  preConfigure = ''
     echo "pub const PATH=\"${hi.out}\";" &gt;&gt; src/path.rs"
  '';
};
</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="features"></a>9.18.2.4. Features</h4></div></div></div><p>
      One can also supply features switches. For example, if we want to compile
      <code class="literal">diesel_cli</code> only with the <code class="literal">postgres</code>
      feature, and no default features, we would write:
     </p><pre class="programlisting">
(callPackage ./diesel.nix {}).diesel {
  default = false;
  postgres = true;
}
</pre><p>
      Where <code class="literal">diesel.nix</code> is the file generated by Carnix, as
      explained above.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="setting-up-nix-shell"></a>9.18.3. Setting Up <code class="literal">nix-shell</code></h3></div></div></div><p>
     Oftentimes you want to develop code from within
     <code class="literal">nix-shell</code>. Unfortunately
     <code class="literal">buildRustCrate</code> does not support common
     <code class="literal">nix-shell</code> operations directly (see
     <a class="link" href="https://github.com/NixOS/nixpkgs/issues/37945" target="_top">this
     issue</a>) so we will use <code class="literal">stdenv.mkDerivation</code>
     instead.
    </p><p>
     Using the example <code class="literal">hello</code> project above, we want to do
     the following: - Have access to <code class="literal">cargo</code> and
     <code class="literal">rustc</code> - Have the <code class="literal">openssl</code> library
     available to a crate through it’s <span class="emphasis"><em>normal</em></span>
     compilation mechanism (<code class="literal">pkg-config</code>).
    </p><p>
     A typical <code class="literal">shell.nix</code> might look like:
    </p><pre class="programlisting">
with import &lt;nixpkgs&gt; {};

stdenv.mkDerivation {
  name = "rust-env";
  nativeBuildInputs = [
    rustc cargo

    # Example Build-time Additional Dependencies
    pkgconfig
  ];
  buildInputs = [
    # Example Run-time Additional Dependencies
    openssl
  ];

  # Set Environment Variables
  RUST_BACKTRACE = 1;
}
</pre><p>
     You should now be able to run the following:
    </p><pre class="programlisting">
$ nix-shell --pure
$ cargo build
$ cargo test
</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="controlling-rust-version-inside-nix-shell"></a>9.18.3.1. Controlling Rust Version Inside <code class="literal">nix-shell</code></h4></div></div></div><p>
      To control your rust version (i.e. use nightly) from within
      <code class="literal">shell.nix</code> (or other nix expressions) you can use the
      following <code class="literal">shell.nix</code>
     </p><pre class="programlisting">
# Latest Nightly
with import &lt;nixpkgs&gt; {};
let src = fetchFromGitHub {
      owner = "mozilla";
      repo = "nixpkgs-mozilla";
      # commit from: 2018-03-27
      rev = "2945b0b6b2fd19e7d23bac695afd65e320efcebe";
      sha256 = "034m1dryrzh2lmjvk3c0krgip652dql46w5yfwpvh7gavd3iypyw";
   };
in
with import "${src.out}/rust-overlay.nix" pkgs pkgs;
stdenv.mkDerivation {
  name = "rust-env";
  buildInputs = [
    # Note: to use use stable, just replace `nightly` with `stable`
    latest.rustChannels.nightly.rust

    # Add some extra dependencies from `pkgs`
    pkgconfig openssl
  ];

  # Set Environment Variables
  RUST_BACKTRACE = 1;
}
</pre><p>
      Now run:
     </p><pre class="programlisting">
$ rustc --version
rustc 1.26.0-nightly (188e693b3 2018-03-26)
</pre><p>
      To see that you are using nightly.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="using-the-rust-nightlies-overlay"></a>9.18.4. Using the Rust nightlies overlay</h3></div></div></div><p>
     Mozilla provides an overlay for nixpkgs to bring a nightly version of Rust
     into scope. This overlay can <span class="emphasis"><em>also</em></span> be used to install
     recent unstable or stable versions of Rust, if desired.
    </p><p>
     To use this overlay, clone
     <a class="link" href="https://github.com/mozilla/nixpkgs-mozilla" target="_top">nixpkgs-mozilla</a>,
     and create a symbolic link to the file
     <a class="link" href="https://github.com/mozilla/nixpkgs-mozilla/blob/master/rust-overlay.nix" target="_top">rust-overlay.nix</a>
     in the <code class="literal">~/.config/nixpkgs/overlays</code> directory.
    </p><pre class="programlisting">
$ git clone https://github.com/mozilla/nixpkgs-mozilla.git
$ mkdir -p ~/.config/nixpkgs/overlays
$ ln -s $(pwd)/nixpkgs-mozilla/rust-overlay.nix ~/.config/nixpkgs/overlays/rust-overlay.nix
</pre><p>
     The latest version can be installed with the following command:
    </p><pre class="programlisting">
$ nix-env -Ai nixos.latest.rustChannels.stable.rust
</pre><p>
     Or using the attribute with nix-shell:
    </p><pre class="programlisting">
$ nix-shell -p nixos.latest.rustChannels.stable.rust
</pre><p>
     To install the beta or nightly channel, <span class="quote">“<span class="quote">stable</span>”</span> should be
     substituted by <span class="quote">“<span class="quote">nightly</span>”</span> or <span class="quote">“<span class="quote">beta</span>”</span>, or use the
     function provided by this overlay to pull a version based on a build date.
    </p><p>
     The overlay automatically updates itself as it uses the same source as
     <a class="link" href="https://www.rustup.rs/" target="_top">rustup</a>.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-language-texlive"></a>9.19. TeX Live</h2></div></div></div><p>
    Since release 15.09 there is a new TeX Live packaging that lives entirely
    under attribute <code class="varname">texlive</code>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-language-texlive-users-guide"></a>9.19.1. User's guide</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       For basic usage just pull
       <code class="varname">texlive.combined.scheme-basic</code> for an environment with
       basic LaTeX support.
      </p></li><li class="listitem"><p>
       It typically won't work to use separately installed packages together.
       Instead, you can build a custom set of packages like this:
</p><pre class="programlisting">
texlive.combine {
  inherit (texlive) scheme-small collection-langkorean algorithms cm-super;
}
      </pre><p>
       There are all the schemes, collections and a few thousand packages, as
       defined upstream (perhaps with tiny differences).
      </p></li><li class="listitem"><p>
       By default you only get executables and files needed during runtime, and
       a little documentation for the core packages. To change that, you need
       to add <code class="varname">pkgFilter</code> function to
       <code class="varname">combine</code>.
</p><pre class="programlisting">
texlive.combine {
  # inherit (texlive) whatever-you-want;
  pkgFilter = pkg:
    pkg.tlType == "run" || pkg.tlType == "bin" || pkg.pname == "cm-super";
  # elem tlType [ "run" "bin" "doc" "source" ]
  # there are also other attributes: version, name
}
      </pre><p>
      </p></li><li class="listitem"><p>
       You can list packages e.g. by <span class="command"><strong>nix repl</strong></span>.
</p><pre class="programlisting">
$ nix repl
nix-repl&gt; :l &lt;nixpkgs&gt;
nix-repl&gt; texlive.collection-&lt;TAB&gt;
</pre><p>
      </p></li><li class="listitem"><p>
       Note that the wrapper assumes that the result has a chance to be useful.
       For example, the core executables should be present, as well as some
       core data files. The supported way of ensuring this is by including some
       scheme, for example <code class="varname">scheme-basic</code>, into the
       combination.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-language-texlive-known-problems"></a>9.19.2. Known problems</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Some tools are still missing, e.g. luajittex;
      </p></li><li class="listitem"><p>
       some apps aren't packaged/tested yet (asymptote, biber, etc.);
      </p></li><li class="listitem"><p>
       feature/bug: when a package is rejected by <code class="varname">pkgFilter</code>,
       its dependencies are still propagated;
      </p></li><li class="listitem"><p>
       in case of any bugs or feature requests, file a github issue or better a
       pull request and /cc @vcunat.
      </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="titanium"></a>9.20. Titanium</h2></div></div></div><p>
    The Nixpkgs repository contains facilities to deploy a variety of versions
    of the <a class="link" href="https://www.appcelerator.com" target="_top">Titanium SDK</a>
    versions, a cross-platform mobile app development framework using
    JavaScript as an implementation language, and includes a function
    abstraction making it possible to build Titanium applications for Android
    and iOS devices from source code.
   </p><p>
    Not all Titanium features supported – currently, it can only be used
    to build Android and iOS apps.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="building-a-titanium-app"></a>9.20.1. Building a Titanium app</h3></div></div></div><p>
     We can build a Titanium app from source for Android or iOS and for
     debugging or release purposes by invoking the
     <code class="literal">titaniumenv.buildApp {}</code> function:
    </p><pre class="programlisting">
titaniumenv.buildApp {
  name = "myapp";
  src = ./myappsource;

  preBuild = "";
  target = "android"; # or 'iphone'
  tiVersion = "7.1.0.GA";
  release = true;

  androidsdkArgs = {
    platformVersions = [ "25" "26" ];
  };
  androidKeyStore = ./keystore;
  androidKeyAlias = "myfirstapp";
  androidKeyStorePassword = "secret";

  xcodeBaseDir = "/Applications/Xcode.app";
  xcodewrapperArgs = {
    version = "9.3";
  };
  iosMobileProvisioningProfile = ./myprovisioning.profile;
  iosCertificateName = "My Company";
  iosCertificate = ./mycertificate.p12;
  iosCertificatePassword = "secret";
  iosVersion = "11.3";
  iosBuildStore = false;

  enableWirelessDistribution = true;
  installURL = "/installipa.php";
}
</pre><p>
     The <code class="literal">titaniumenv.buildApp {}</code> function takes the
     following parameters:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="literal">name</code> parameter refers to the name in the Nix
       store.
      </p></li><li class="listitem"><p>
       The <code class="literal">src</code> parameter refers to the source code location
       of the app that needs to be built.
      </p></li><li class="listitem"><p>
       <code class="literal">preRebuild</code> contains optional build instructions that
       are carried out before the build starts.
      </p></li><li class="listitem"><p>
       <code class="literal">target</code> indicates for which device the app must be
       built. Currently only <span class="quote">“<span class="quote">android</span>”</span> and <span class="quote">“<span class="quote">iphone</span>”</span>
       (for iOS) are supported.
      </p></li><li class="listitem"><p>
       <code class="literal">tiVersion</code> can be used to optionally override the
       requested Titanium version in <code class="literal">tiapp.xml</code>. If not
       specified, it will use the version in <code class="literal">tiapp.xml</code>.
      </p></li><li class="listitem"><p>
       <code class="literal">release</code> should be set to true when building an app
       for submission to the Google Playstore or Apple Appstore. Otherwise, it
       should be false.
      </p></li></ul></div><p>
     When the <code class="literal">target</code> has been set to
     <code class="literal">android</code>, we can configure the following parameters:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="literal">androidSdkArgs</code> parameter refers to an attribute
       set that propagates all parameters to the
       <code class="literal">androidenv.composeAndroidPackages {}</code> function. This
       can be used to install all relevant Android plugins that may be needed
       to perform the Android build. If no parameters are given, it will deploy
       the platform SDKs for API-levels 25 and 26 by default.
      </p></li></ul></div><p>
     When the <code class="literal">release</code> parameter has been set to true, you
     need to provide parameters to sign the app:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">androidKeyStore</code> is the path to the keystore file
      </p></li><li class="listitem"><p>
       <code class="literal">androidKeyAlias</code> is the key alias
      </p></li><li class="listitem"><p>
       <code class="literal">androidKeyStorePassword</code> refers to the password to
       open the keystore file.
      </p></li></ul></div><p>
     When the <code class="literal">target</code> has been set to
     <code class="literal">iphone</code>, we can configure the following parameters:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="literal">xcodeBaseDir</code> parameter refers to the location
       where Xcode has been installed. When none value is given, the above
       value is the default.
      </p></li><li class="listitem"><p>
       The <code class="literal">xcodewrapperArgs</code> parameter passes arbitrary
       parameters to the <code class="literal">xcodeenv.composeXcodeWrapper {}</code>
       function. This can, for example, be used to adjust the default version
       of Xcode.
      </p></li></ul></div><p>
     When <code class="literal">release</code> has been set to true, you also need to
     provide the following parameters:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">iosMobileProvisioningProfile</code> refers to a mobile
       provisioning profile needed for signing.
      </p></li><li class="listitem"><p>
       <code class="literal">iosCertificateName</code> refers to the company name in the
       P12 certificate.
      </p></li><li class="listitem"><p>
       <code class="literal">iosCertificate</code> refers to the path to the P12 file.
      </p></li><li class="listitem"><p>
       <code class="literal">iosCertificatePassword</code> contains the password to open
       the P12 file.
      </p></li><li class="listitem"><p>
       <code class="literal">iosVersion</code> refers to the iOS SDK version to use. It
       defaults to the latest version.
      </p></li><li class="listitem"><p>
       <code class="literal">iosBuildStore</code> should be set to
       <code class="literal">true</code> when building for the Apple Appstore submission.
       For enterprise or ad-hoc builds it should be set to
       <code class="literal">false</code>.
      </p></li></ul></div><p>
     When <code class="literal">enableWirelessDistribution</code> has been enabled, you
     must also provide the path of the PHP script
     (<code class="literal">installURL</code>) (that is included with the iOS build
     environment) to enable wireless ad-hoc installations.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="emulating-or-simulating-the-app"></a>9.20.2. Emulating or simulating the app</h3></div></div></div><p>
     It is also possible to simulate the correspond iOS simulator build by
     using <code class="literal">xcodeenv.simulateApp {}</code> and emulate an Android
     APK by using <code class="literal">androidenv.emulateApp {}</code>.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="users-guide-to-vim-pluginsaddonsbundlesscripts-in-nixpkgs"></a>9.21. User’s Guide to Vim Plugins/Addons/Bundles/Scripts in Nixpkgs</h2></div></div></div><p>
    Both Neovim and Vim can be configured to include your favorite plugins and
    additional libraries.
   </p><p>
    Loading can be deferred; see examples.
   </p><p>
    At the moment we support three different methods for managing plugins:
   </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
      Vim packages (<span class="emphasis"><em>recommend</em></span>)
     </p></li><li class="listitem"><p>
      VAM (=vim-addon-manager)
     </p></li><li class="listitem"><p>
      Pathogen
     </p></li><li class="listitem"><p>
      vim-plug
     </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="custom-configuration"></a>9.21.1. Custom configuration</h3></div></div></div><p>
     Adding custom .vimrc lines can be done using the following code:
    </p><pre class="programlisting">
vim_configurable.customize {
  # `name` specifies the name of the executable and package
  name = "vim-with-plugins";

  vimrcConfig.customRC = ''
    set hidden
  '';
}
</pre><p>
     This configuration is used when vim is invoked with the command specified
     as name, in this case <code class="literal">vim-with-plugins</code>.
    </p><p>
     For Neovim the <code class="literal">configure</code> argument can be overridden to
     achieve the same:
    </p><pre class="programlisting">
neovim.override {
  configure = {
    customRC = ''
      # here your custom configuration goes!
    '';
  };
}
</pre><p>
     If you want to use <code class="literal">neovim-qt</code> as a graphical editor, you
     can configure it by overriding neovim in an overlay or passing it an
     overridden neovimn:
    </p><pre class="programlisting">
neovim-qt.override {
  neovim = neovim.override {
    configure = {
      customRC = ''
        # your custom configuration
      '';
    };
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="managing-plugins-with-vim-packages"></a>9.21.2. Managing plugins with Vim packages</h3></div></div></div><p>
     To store you plugins in Vim packages (the native vim plugin manager, see
     <code class="literal">:help packages</code>) the following example can be used:
    </p><pre class="programlisting">
vim_configurable.customize {
  vimrcConfig.packages.myVimPackage = with pkgs.vimPlugins; {
    # loaded on launch
    start = [ youcompleteme fugitive ];
    # manually loadable by calling `:packadd $plugin-name`
    # however, if a vim plugin has a dependency that is not explicitly listed in
    # opt that dependency will always be added to start to avoid confusion.
    opt = [ phpCompletion elm-vim ];
    # To automatically load a plugin when opening a filetype, add vimrc lines like:
    # autocmd FileType php :packadd phpCompletion
  };
}
</pre><p>
     <code class="literal">myVimPackage</code> is an arbitrary name for the generated
     package. You can choose any name you like. For Neovim the syntax is:
    </p><pre class="programlisting">
neovim.override {
  configure = {
    customRC = ''
      # here your custom configuration goes!
    '';
    packages.myVimPackage = with pkgs.vimPlugins; {
      # see examples below how to use custom packages
      start = [ ];
      # If a vim plugin has a dependency that is not explicitly listed in
      # opt that dependency will always be added to start to avoid confusion.
      opt = [ ];
    };
  };
}
</pre><p>
     The resulting package can be added to <code class="literal">packageOverrides</code>
     in <code class="literal">~/.nixpkgs/config.nix</code> to make it installable:
    </p><pre class="programlisting">
{
  packageOverrides = pkgs: with pkgs; {
    myVim = vim_configurable.customize {
      # `name` specifies the name of the executable and package
      name = "vim-with-plugins";
      # add here code from the example section
    };
    myNeovim = neovim.override {
      configure = {
      # add here code from the example section
      };
    };
  };
}
</pre><p>
     After that you can install your special grafted <code class="literal">myVim</code>
     or <code class="literal">myNeovim</code> packages.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="managing-plugins-with-vim-plug"></a>9.21.3. Managing plugins with vim-plug</h3></div></div></div><p>
     To use
     <a class="link" href="https://github.com/junegunn/vim-plug" target="_top">vim-plug</a> to
     manage your Vim plugins the following example can be used:
    </p><pre class="programlisting">
vim_configurable.customize {
  vimrcConfig.packages.myVimPackage = with pkgs.vimPlugins; {
    # loaded on launch
    plug.plugins = [ youcompleteme fugitive phpCompletion elm-vim ];
  };
}
</pre><p>
     For Neovim the syntax is:
    </p><pre class="programlisting">
neovim.override {
  configure = {
    customRC = ''
      # here your custom configuration goes!
    '';
    plug.plugins = with pkgs.vimPlugins; [
      vim-go
    ];
  };
}
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="managing-plugins-with-vam"></a>9.21.4. Managing plugins with VAM</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="handling-dependencies-of-vim-plugins"></a>9.21.4.1. Handling dependencies of Vim plugins</h4></div></div></div><p>
      VAM introduced .json files supporting dependencies without versioning
      assuming that <span class="quote">“<span class="quote">using latest version</span>”</span> is ok most of the time.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="example"></a>9.21.4.2. Example</h4></div></div></div><p>
      First create a vim-scripts file having one plugin name per line. Example:
     </p><pre class="programlisting">
"tlib"
{'name': 'vim-addon-sql'}
{'filetype_regex': '\%(vim)$', 'names': ['reload', 'vim-dev-plugin']}
</pre><p>
      Such vim-scripts file can be read by VAM as well like this:
     </p><pre class="programlisting">
call vam#Scripts(expand('~/.vim-scripts'), {})
</pre><p>
      Create a default.nix file:
     </p><pre class="programlisting">
{ nixpkgs ? import &lt;nixpkgs&gt; {}, compiler ? "ghc7102" }:
nixpkgs.vim_configurable.customize { name = "vim"; vimrcConfig.vam.pluginDictionaries = [ "vim-addon-vim2nix" ]; }
</pre><p>
      Create a generate.vim file:
     </p><pre class="programlisting">
ActivateAddons vim-addon-vim2nix
let vim_scripts = "vim-scripts"
call nix#ExportPluginsForNix({
\  'path_to_nixpkgs': eval('{"'.substitute(substitute(substitute($NIX_PATH, ':', ',', 'g'), '=',':', 'g'), '\([:,]\)', '"\1"',"g").'"}')["nixpkgs"],
\  'cache_file': '/tmp/vim2nix-cache',
\  'try_catch': 0,
\  'plugin_dictionaries': ["vim-addon-manager"]+map(readfile(vim_scripts), 'eval(v:val)')
\ })
</pre><p>
      Then run
     </p><pre class="programlisting">
nix-shell -p vimUtils.vim_with_vim2nix --command "vim -c 'source generate.vim'"
</pre><p>
      You should get a Vim buffer with the nix derivations (output1) and
      vam.pluginDictionaries (output2). You can add your vim to your
      system’s configuration file like this and start it by
      <span class="quote">“<span class="quote">vim-my</span>”</span>:
     </p><pre class="programlisting">
my-vim =
 let plugins = let inherit (vimUtils) buildVimPluginFrom2Nix; in {
      copy paste output1 here
 }; in vim_configurable.customize {
   name = "vim-my";

   vimrcConfig.vam.knownPlugins = plugins; # optional
   vimrcConfig.vam.pluginDictionaries = [
      copy paste output2 here
   ];

   # Pathogen would be
   # vimrcConfig.pathogen.knownPlugins = plugins; # plugins
   # vimrcConfig.pathogen.pluginNames = ["tlib"];
 };
</pre><p>
      Sample output1:
     </p><pre class="programlisting">
"reload" = buildVimPluginFrom2Nix { # created by nix#NixDerivation
  name = "reload";
  src = fetchgit {
    url = "git://github.com/xolox/vim-reload";
    rev = "0a601a668727f5b675cb1ddc19f6861f3f7ab9e1";
    sha256 = "0vb832l9yxj919f5hfg6qj6bn9ni57gnjd3bj7zpq7d4iv2s4wdh";
  };
  dependencies = ["nim-misc"];

};
[...]
</pre><p>
      Sample output2:
     </p><pre class="programlisting">
[
  ''vim-addon-manager''
  ''tlib''
  { "name" = ''vim-addon-sql''; }
  { "filetype_regex" = ''\%(vim)$$''; "names" = [ ''reload'' ''vim-dev-plugin'' ]; }
]
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="adding-new-plugins-to-nixpkgs"></a>9.21.5. Adding new plugins to nixpkgs</h3></div></div></div><p>
     In <code class="literal">pkgs/misc/vim-plugins/vim-plugin-names</code> we store the
     plugin names for all vim plugins we automatically generate plugins for.
     The format of this file <code class="literal">github username/github
     repository</code>: For example https://github.com/scrooloose/nerdtree
     becomes <code class="literal">scrooloose/nerdtree</code>. After adding your plugin
     to this file run the <code class="literal">./update.py</code> in the same folder.
     This will updated a file called <code class="literal">generated.nix</code> and make
     your plugin accessible in the <code class="literal">vimPlugins</code> attribute set
     (<code class="literal">vimPlugins.nerdtree</code> in our example). If additional
     steps to the build process of the plugin are required, add an override to
     the <code class="literal">pkgs/misc/vim-plugins/default.nix</code> in the same
     directory.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="important-repositories"></a>9.21.6. Important repositories</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <a class="link" href="https://bitbucket.org/vimcommunity/vim-pi" target="_top">vim-pi</a>
       is a plugin repository from VAM plugin manager meant to be used by
       others as well used by
      </p></li><li class="listitem"><p>
       <a class="link" href="http://github.com/MarcWeber/vim-addon-vim2nix" target="_top">vim2nix</a>
       which generates the .nix code
      </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="users-guide-to-emscripten-in-nixpkgs"></a>9.22. User’s Guide to Emscripten in Nixpkgs</h2></div></div></div><p>
    <a class="link" href="https://github.com/kripken/emscripten" target="_top">Emscripten</a>:
    An LLVM-to-JavaScript Compiler
   </p><p>
    This section of the manual covers how to use <code class="literal">emscripten</code>
    in nixpkgs.
   </p><p>
    Minimal requirements:
   </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
      nix
     </p></li><li class="listitem"><p>
      nixpkgs
     </p></li></ul></div><p>
    Modes of use of <code class="literal">emscripten</code>:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <span class="strong"><strong>Imperative usage</strong></span> (on the command
      line):
     </p><p>
      If you want to work with <code class="literal">emcc</code>,
      <code class="literal">emconfigure</code> and <code class="literal">emmake</code> as you are
      used to from Ubuntu and similar distributions you can use these commands:
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">nix-env -i emscripten</code>
       </p></li><li class="listitem"><p>
        <code class="literal">nix-shell -p emscripten</code>
       </p></li></ul></div></li><li class="listitem"><p>
      <span class="strong"><strong>Declarative usage</strong></span>:
     </p><p>
      This mode is far more power full since this makes use of
      <code class="literal">nix</code> for dependency management of emscripten libraries
      and targets by using the <code class="literal">mkDerivation</code> which is
      implemented by <code class="literal">pkgs.emscriptenStdenv</code> and
      <code class="literal">pkgs.buildEmscriptenPackage</code>. The source for the
      packages is in <code class="literal">pkgs/top-level/emscripten-packages.nix</code>
      and the abstraction behind it in
      <code class="literal">pkgs/development/em-modules/generic/default.nix</code>.
     </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
        build and install all packages:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
          <code class="literal">nix-env -iA emscriptenPackages</code>
         </p></li></ul></div></li><li class="listitem"><p>
        dev-shell for zlib implementation hacking:
       </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
          <code class="literal">nix-shell -A emscriptenPackages.zlib</code>
         </p></li></ul></div></li></ul></div></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="imperative-usage"></a>9.22.1. Imperative usage</h3></div></div></div><p>
     A few things to note:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">export EMCC_DEBUG=2</code> is nice for debugging
      </p></li><li class="listitem"><p>
       <code class="literal">~/.emscripten</code>, the build artifact cache sometimes
       creates issues and needs to be removed from time to time
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="declarative-usage"></a>9.22.2. Declarative usage</h3></div></div></div><p>
     Let’s see two different examples from
     <code class="literal">pkgs/top-level/emscripten-packages.nix</code>:
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">pkgs.zlib.override</code>
      </p></li><li class="listitem"><p>
       <code class="literal">pkgs.buildEmscriptenPackage</code>
      </p></li></ul></div><p>
     Both are interesting concepts.
    </p><p>
     A special requirement of the
     <code class="literal">pkgs.buildEmscriptenPackage</code> is the <code class="literal">doCheck =
     true</code> is a default meaning that each emscriptenPackage requires a
     <code class="literal">checkPhase</code> implemented.
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
       Use <code class="literal">export EMCC_DEBUG=2</code> from within a
       emscriptenPackage’s <code class="literal">phase</code> to get more detailed
       debug output what is going wrong.
      </p></li><li class="listitem"><p>
       ~/.emscripten cache is requiring us to set
       <code class="literal">HOME=$TMPDIR</code> in individual phases. This makes
       compilation slower but also makes it more deterministic.
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-1-pkgs.zlib.override"></a>9.22.2.1. Usage 1: pkgs.zlib.override</h4></div></div></div><p>
      This example uses <code class="literal">zlib</code> from nixpkgs but instead of
      compiling <span class="strong"><strong>C</strong></span> to
      <span class="strong"><strong>ELF</strong></span> it compiles
      <span class="strong"><strong>C</strong></span> to
      <span class="strong"><strong>JS</strong></span> since we were using
      <code class="literal">pkgs.zlib.override</code> and changed stdenv to
      <code class="literal">pkgs.emscriptenStdenv</code>. A few adaptions and hacks were
      set in place to make it working. One advantage is that when
      <code class="literal">pkgs.zlib</code> is updated, it will automatically update
      this package as well. However, this can also be the downside…
     </p><p>
      See the <code class="literal">zlib</code> example:
     </p><pre class="programlisting">
zlib = (pkgs.zlib.override {
  stdenv = pkgs.emscriptenStdenv;
}).overrideDerivation
(old: rec {
  buildInputs = old.buildInputs ++ [ pkgconfig ];
  # we need to reset this setting!
  NIX_CFLAGS_COMPILE="";
  configurePhase = ''
    # FIXME: Some tests require writing at $HOME
    HOME=$TMPDIR
    runHook preConfigure

    #export EMCC_DEBUG=2
    emconfigure ./configure --prefix=$out --shared

    runHook postConfigure
  '';
  dontStrip = true;
  outputs = [ "out" ];
  buildPhase = ''
    emmake make
  '';
  installPhase = ''
    emmake make install
  '';
  checkPhase = ''
    echo "================= testing zlib using node ================="

    echo "Compiling a custom test"
    set -x
    emcc -O2 -s EMULATE_FUNCTION_POINTER_CASTS=1 test/example.c -DZ_SOLO \
    libz.so.${old.version} -I . -o example.js

    echo "Using node to execute the test"
    ${pkgs.nodejs}/bin/node ./example.js 

    set +x
    if [ $? -ne 0 ]; then
      echo "test failed for some reason"
      exit 1;
    else
      echo "it seems to work! very good."
    fi
    echo "================= /testing zlib using node ================="
  '';

  postPatch = pkgs.stdenv.lib.optionalString pkgs.stdenv.isDarwin ''
    substituteInPlace configure \
      --replace '/usr/bin/libtool' 'ar' \
      --replace 'AR="libtool"' 'AR="ar"' \
      --replace 'ARFLAGS="-o"' 'ARFLAGS="-r"'
  '';
});
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="usage-2-pkgs.buildemscriptenpackage"></a>9.22.2.2. Usage 2: pkgs.buildEmscriptenPackage</h4></div></div></div><p>
      This <code class="literal">xmlmirror</code> example features a emscriptenPackage
      which is defined completely from this context and no
      <code class="literal">pkgs.zlib.override</code> is used.
     </p><pre class="programlisting">
xmlmirror = pkgs.buildEmscriptenPackage rec {
  name = "xmlmirror";

  buildInputs = [ pkgconfig autoconf automake libtool gnumake libxml2 nodejs openjdk json_c ];
  nativeBuildInputs = [ pkgconfig zlib ];

  src = pkgs.fetchgit {
    url = "https://gitlab.com/odfplugfest/xmlmirror.git";
    rev = "4fd7e86f7c9526b8f4c1733e5c8b45175860a8fd";
    sha256 = "1jasdqnbdnb83wbcnyrp32f36w3xwhwp0wq8lwwmhqagxrij1r4b";
  };

  configurePhase = ''
    rm -f fastXmlLint.js*
    # a fix for ERROR:root:For asm.js, TOTAL_MEMORY must be a multiple of 16MB, was 234217728
    # https://gitlab.com/odfplugfest/xmlmirror/issues/8
    sed -e "s/TOTAL_MEMORY=234217728/TOTAL_MEMORY=268435456/g" -i Makefile.emEnv
    # https://github.com/kripken/emscripten/issues/6344
    # https://gitlab.com/odfplugfest/xmlmirror/issues/9
    sed -e "s/\$(JSONC_LDFLAGS) \$(ZLIB_LDFLAGS) \$(LIBXML20_LDFLAGS)/\$(JSONC_LDFLAGS) \$(LIBXML20_LDFLAGS) \$(ZLIB_LDFLAGS) /g" -i Makefile.emEnv
    # https://gitlab.com/odfplugfest/xmlmirror/issues/11
    sed -e "s/-o fastXmlLint.js/-s EXTRA_EXPORTED_RUNTIME_METHODS='[\"ccall\", \"cwrap\"]' -o fastXmlLint.js/g" -i Makefile.emEnv
  '';

  buildPhase = ''
    HOME=$TMPDIR
    make -f Makefile.emEnv
  '';

  outputs = [ "out" "doc" ];

  installPhase = ''
    mkdir -p $out/share
    mkdir -p $doc/share/${name}

    cp Demo* $out/share
    cp -R codemirror-5.12 $out/share
    cp fastXmlLint.js* $out/share
    cp *.xsd $out/share
    cp *.js $out/share
    cp *.xhtml $out/share
    cp *.html $out/share
    cp *.json $out/share
    cp *.rng $out/share
    cp README.md $doc/share/${name}
  '';
  checkPhase = ''

  '';
}; 
</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="declarative-debugging"></a>9.22.2.3. Declarative debugging</h4></div></div></div><p>
      Use <code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A
      emscriptenPackages.libz</code> and from there you can go trough the
      individual steps. This makes it easy to build a good <code class="literal">unit
      test</code> or list the files of the project.
     </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>
        <code class="literal">nix-shell -I nixpkgs=/some/dir/nixpkgs -A
        emscriptenPackages.libz</code>
       </p></li><li class="listitem"><p>
        <code class="literal">cd /tmp/</code>
       </p></li><li class="listitem"><p>
        <code class="literal">unpackPhase</code>
       </p></li><li class="listitem"><p>
        cd libz-1.2.3
       </p></li><li class="listitem"><p>
        <code class="literal">configurePhase</code>
       </p></li><li class="listitem"><p>
        <code class="literal">buildPhase</code>
       </p></li><li class="listitem"><p>
        … happy hacking…
       </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="summary"></a>9.22.3. Summary</h3></div></div></div><p>
     Using this toolchain makes it easy to leverage <code class="literal">nix</code> from
     NixOS, MacOSX or even Windows (WSL+ubuntu+nix). This toolchain is
     reproducible, behaves like the rest of the packages from nixpkgs and
     contains a set of well working examples to learn and adapt from.
    </p><p>
     If in trouble, ask the maintainers.
    </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-platform-nodes"></a>Chapter 10. Platform Notes</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-darwin">10.1. Darwin (macOS)</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-darwin"></a>10.1. Darwin (macOS)</h2></div></div></div><p>
    Some common issues when packaging software for Darwin:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The Darwin <code class="literal">stdenv</code> uses clang instead of gcc. When
      referring to the compiler <code class="varname">$CC</code> or <span class="command"><strong>cc</strong></span>
      will work in both cases. Some builds hardcode gcc/g++ in their build
      scripts, that can usually be fixed with using something like
      <code class="literal">makeFlags = [ "CC=cc" ];</code> or by patching the build
      scripts.
     </p><pre class="programlisting">
      stdenv.mkDerivation {
        name = "libfoo-1.2.3";
        # ...
        buildPhase = ''
          $CC -o hello hello.c
        '';
      }
    </pre></li><li class="listitem"><p>
      On Darwin, libraries are linked using absolute paths, libraries are
      resolved by their <code class="literal">install_name</code> at link time. Sometimes
      packages won't set this correctly causing the library lookups to fail at
      runtime. This can be fixed by adding extra linker flags or by running
      <span class="command"><strong>install_name_tool -id</strong></span> during the
      <code class="function">fixupPhase</code>.
     </p><pre class="programlisting">
      stdenv.mkDerivation {
        name = "libfoo-1.2.3";
        # ...
        makeFlags = stdenv.lib.optional stdenv.isDarwin "LDFLAGS=-Wl,-install_name,$(out)/lib/libfoo.dylib";
      }
    </pre></li><li class="listitem"><p>
      Even if the libraries are linked using absolute paths and resolved via
      their <code class="literal">install_name</code> correctly, tests can sometimes fail
      to run binaries. This happens because the <code class="varname">checkPhase</code>
      runs before the libraries are installed.
     </p><p>
      This can usually be solved by running the tests after the
      <code class="varname">installPhase</code> or alternatively by using
      <code class="varname">DYLD_LIBRARY_PATH</code>. More information about this
      variable can be found in the <span class="citerefentry"><span class="refentrytitle">dyld</span>(1)</span> manpage.
     </p><pre class="programlisting">
      dyld: Library not loaded: /nix/store/7hnmbscpayxzxrixrgxvvlifzlxdsdir-jq-1.5-lib/lib/libjq.1.dylib
      Referenced from: /private/tmp/nix-build-jq-1.5.drv-0/jq-1.5/tests/../jq
      Reason: image not found
      ./tests/jqtest: line 5: 75779 Abort trap: 6
    </pre><pre class="programlisting">
      stdenv.mkDerivation {
        name = "libfoo-1.2.3";
        # ...
        doInstallCheck = true;
        installCheckTarget = "check";
      }
    </pre></li><li class="listitem"><p>
      Some packages assume xcode is available and use <span class="command"><strong>xcrun</strong></span>
      to resolve build tools like <span class="command"><strong>clang</strong></span>, etc. This causes
      errors like <code class="code">xcode-select: error: no developer tools were found at
      '/Applications/Xcode.app'</code> while the build doesn't actually depend
      on xcode.
     </p><pre class="programlisting">
      stdenv.mkDerivation {
        name = "libfoo-1.2.3";
        # ...
        prePatch = ''
          substituteInPlace Makefile \
              --replace '/usr/bin/xcrun clang' clang
        '';
      }
    </pre><p>
      The package <code class="literal">xcbuild</code> can be used to build projects that
      really depend on Xcode. However, this replacement is not 100% compatible
      with Xcode and can occasionally cause issues.
     </p></li></ul></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-package-notes"></a>Chapter 11. Package Notes</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-linux-kernel">11.1. Linux kernel</a></span></dt><dt><span class="section"><a href="#sec-xorg">11.2. X.org</a></span></dt><dt><span class="section"><a href="#sec-eclipse">11.3. Eclipse</a></span></dt><dt><span class="section"><a href="#sec-elm">11.4. Elm</a></span></dt><dt><span class="section"><a href="#sec-shell-helpers">11.5. Interactive shell helpers</a></span></dt><dt><span class="section"><a href="#sec-steam">11.6. Steam</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-steam-nix">11.6.1. Steam in Nix</a></span></dt><dt><span class="section"><a href="#sec-steam-play">11.6.2. How to play</a></span></dt><dt><span class="section"><a href="#sec-steam-troub">11.6.3. Troubleshooting</a></span></dt><dt><span class="section"><a href="#sec-steam-run">11.6.4. steam-run</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-emacs">11.7. Emacs</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-emacs-config">11.7.1. Configuring Emacs</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-weechat">11.8. Weechat</a></span></dt><dt><span class="section"><a href="#sec-citrix">11.9. Citrix Receiver</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-citrix-base">11.9.1. Basic usage</a></span></dt><dt><span class="section"><a href="#sec-citrix-custom-certs">11.9.2. Custom certificates</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-ibus-typing-booster">11.10. ibus-engines.typing-booster</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-ibus-typing-booster-activate">11.10.1. Activating the engine</a></span></dt><dt><span class="section"><a href="#sec-ibus-typing-booster-customize-hunspell">11.10.2. Using custom hunspell dictionaries</a></span></dt><dt><span class="section"><a href="#sec-ibus-typing-booster-emoji-picker">11.10.3. Built-in emoji picker</a></span></dt></dl></dd></dl></div><p>
   This chapter contains information about how to use and maintain the Nix
   expressions for a number of specific packages, such as the Linux kernel or
   X.org.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-linux-kernel"></a>11.1. Linux kernel</h2></div></div></div><p>
    The Nix expressions to build the Linux kernel are in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/os-specific/linux/kernel" target="_top"><code class="filename">pkgs/os-specific/linux/kernel</code></a>.
   </p><p>
    The function that builds the kernel has an argument
    <code class="varname">kernelPatches</code> which should be a list of <code class="literal">{name,
    patch, extraConfig}</code> attribute sets, where <code class="varname">name</code>
    is the name of the patch (which is included in the kernel’s
    <code class="varname">meta.description</code> attribute), <code class="varname">patch</code> is
    the patch itself (possibly compressed), and <code class="varname">extraConfig</code>
    (optional) is a string specifying extra options to be concatenated to the
    kernel configuration file (<code class="filename">.config</code>).
   </p><p>
    The kernel derivation exports an attribute <code class="varname">features</code>
    specifying whether optional functionality is or isn’t enabled. This
    is used in NixOS to implement kernel-specific behaviour. For instance, if
    the kernel has the <code class="varname">iwlwifi</code> feature (i.e. has built-in
    support for Intel wireless chipsets), then NixOS doesn’t have to
    build the external <code class="varname">iwlwifi</code> package:
</p><pre class="programlisting">
modulesTree = [kernel]
  ++ pkgs.lib.optional (!kernel.features ? iwlwifi) kernelPackages.iwlwifi
  ++ ...;
</pre><p>
   </p><p>
    How to add a new (major) version of the Linux kernel to Nixpkgs:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Copy the old Nix expression (e.g. <code class="filename">linux-2.6.21.nix</code>)
       to the new one (e.g. <code class="filename">linux-2.6.22.nix</code>) and update
       it.
      </p></li><li class="listitem"><p>
       Add the new kernel to <code class="filename">all-packages.nix</code> (e.g.,
       create an attribute <code class="varname">kernel_2_6_22</code>).
      </p></li><li class="listitem"><p>
       Now we’re going to update the kernel configuration. First unpack
       the kernel. Then for each supported platform (<code class="literal">i686</code>,
       <code class="literal">x86_64</code>, <code class="literal">uml</code>) do the following:
       </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
          Make an copy from the old config (e.g.
          <code class="filename">config-2.6.21-i686-smp</code>) to the new one (e.g.
          <code class="filename">config-2.6.22-i686-smp</code>).
         </p></li><li class="listitem"><p>
          Copy the config file for this platform (e.g.
          <code class="filename">config-2.6.22-i686-smp</code>) to
          <code class="filename">.config</code> in the kernel source tree.
         </p></li><li class="listitem"><p>
          Run <code class="literal">make oldconfig
          ARCH=<em class="replaceable"><code>{i386,x86_64,um}</code></em></code> and answer
          all questions. (For the uml configuration, also add
          <code class="literal">SHELL=bash</code>.) Make sure to keep the configuration
          consistent between platforms (i.e. don’t enable some feature
          on <code class="literal">i686</code> and disable it on
          <code class="literal">x86_64</code>).
         </p></li><li class="listitem"><p>
          If needed you can also run <code class="literal">make menuconfig</code>:
</p><pre class="screen">
$ nix-env -i ncurses
$ export NIX_CFLAGS_LINK=-lncurses
$ make menuconfig ARCH=<em class="replaceable"><code>arch</code></em></pre><p>
         </p></li><li class="listitem"><p>
          Copy <code class="filename">.config</code> over the new config file (e.g.
          <code class="filename">config-2.6.22-i686-smp</code>).
         </p></li></ol></div><p>
      </p></li><li class="listitem"><p>
       Test building the kernel: <code class="literal">nix-build -A kernel_2_6_22</code>.
       If it compiles, ship it! For extra credit, try booting NixOS with it.
      </p></li><li class="listitem"><p>
       It may be that the new kernel requires updating the external kernel
       modules and kernel-dependent packages listed in the
       <code class="varname">linuxPackagesFor</code> function in
       <code class="filename">all-packages.nix</code> (such as the NVIDIA drivers, AUFS,
       etc.). If the updated packages aren’t backwards compatible with
       older kernels, you may need to keep the older versions around.
      </p></li></ol></div><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-xorg"></a>11.2. X.org</h2></div></div></div><p>
    The Nix expressions for the X.org packages reside in
    <code class="filename">pkgs/servers/x11/xorg/default.nix</code>. This file is
    automatically generated from lists of tarballs in an X.org release. As such
    it should not be modified directly; rather, you should modify the lists,
    the generator script or the file
    <code class="filename">pkgs/servers/x11/xorg/overrides.nix</code>, in which you can
    override or add to the derivations produced by the generator.
   </p><p>
    The generator is invoked as follows:
</p><pre class="screen">
$ cd pkgs/servers/x11/xorg
$ cat tarballs-7.5.list extra.list old.list \
  | perl ./generate-expr-from-tarballs.pl
</pre><p>
    For each of the tarballs in the <code class="filename">.list</code> files, the
    script downloads it, unpacks it, and searches its
    <code class="filename">configure.ac</code> and <code class="filename">*.pc.in</code> files
    for dependencies. This information is used to generate
    <code class="filename">default.nix</code>. The generator caches downloaded tarballs
    between runs. Pay close attention to the <code class="literal">NOT FOUND:
    <em class="replaceable"><code>name</code></em></code> messages at the end of the run,
    since they may indicate missing dependencies. (Some might be optional
    dependencies, however.)
   </p><p>
    A file like <code class="filename">tarballs-7.5.list</code> contains all tarballs in
    a X.org release. It can be generated like this:
</p><pre class="screen">
$ export i="mirror://xorg/X11R7.4/src/everything/"
$ cat $(PRINT_PATH=1 nix-prefetch-url $i | tail -n 1) \
  | perl -e 'while (&lt;&gt;) { if (/(href|HREF)="([^"]*.bz2)"/) { print "$ENV{'i'}$2\n"; }; }' \
  | sort &gt; tarballs-7.4.list
</pre><p>
    <code class="filename">extra.list</code> contains libraries that aren’t part
    of X.org proper, but are closely related to it, such as
    <code class="literal">libxcb</code>. <code class="filename">old.list</code> contains some
    packages that were removed from X.org, but are still needed by some people
    or by other packages (such as <code class="varname">imake</code>).
   </p><p>
    If the expression for a package requires derivation attributes that the
    generator cannot figure out automatically (say, <code class="varname">patches</code>
    or a <code class="varname">postInstall</code> hook), you should modify
    <code class="filename">pkgs/servers/x11/xorg/overrides.nix</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-eclipse"></a>11.3. Eclipse</h2></div></div></div><p>
    The Nix expressions related to the Eclipse platform and IDE are in
    <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/editors/eclipse" target="_top"><code class="filename">pkgs/applications/editors/eclipse</code></a>.
   </p><p>
    Nixpkgs provides a number of packages that will install Eclipse in its
    various forms. These range from the bare-bones Eclipse Platform to the more
    fully featured Eclipse SDK or Scala-IDE packages and multiple version are
    often available. It is possible to list available Eclipse packages by
    issuing the command:
</p><pre class="screen">
$ nix-env -f '&lt;nixpkgs&gt;' -qaP -A eclipses --description
</pre><p>
    Once an Eclipse variant is installed it can be run using the
    <span class="command"><strong>eclipse</strong></span> command, as expected. From within Eclipse it is
    then possible to install plugins in the usual manner by either manually
    specifying an Eclipse update site or by installing the Marketplace Client
    plugin and using it to discover and install other plugins. This
    installation method provides an Eclipse installation that closely resemble
    a manually installed Eclipse.
   </p><p>
    If you prefer to install plugins in a more declarative manner then Nixpkgs
    also offer a number of Eclipse plugins that can be installed in an
    <span class="emphasis"><em>Eclipse environment</em></span>. This type of environment is
    created using the function <code class="varname">eclipseWithPlugins</code> found
    inside the <code class="varname">nixpkgs.eclipses</code> attribute set. This function
    takes as argument <code class="literal">{ eclipse, plugins ? [], jvmArgs ? []
    }</code> where <code class="varname">eclipse</code> is a one of the Eclipse
    packages described above, <code class="varname">plugins</code> is a list of plugin
    derivations, and <code class="varname">jvmArgs</code> is a list of arguments given to
    the JVM running the Eclipse. For example, say you wish to install the
    latest Eclipse Platform with the popular Eclipse Color Theme plugin and
    also allow Eclipse to use more RAM. You could then add
</p><pre class="screen">
packageOverrides = pkgs: {
  myEclipse = with pkgs.eclipses; eclipseWithPlugins {
    eclipse = eclipse-platform;
    jvmArgs = [ "-Xmx2048m" ];
    plugins = [ plugins.color-theme ];
  };
}
</pre><p>
    to your Nixpkgs configuration
    (<code class="filename">~/.config/nixpkgs/config.nix</code>) and install it by
    running <span class="command"><strong>nix-env -f '&lt;nixpkgs&gt;' -iA myEclipse</strong></span> and
    afterward run Eclipse as usual. It is possible to find out which plugins
    are available for installation using <code class="varname">eclipseWithPlugins</code>
    by running
</p><pre class="screen">
$ nix-env -f '&lt;nixpkgs&gt;' -qaP -A eclipses.plugins --description
</pre><p>
   </p><p>
    If there is a need to install plugins that are not available in Nixpkgs
    then it may be possible to define these plugins outside Nixpkgs using the
    <code class="varname">buildEclipseUpdateSite</code> and
    <code class="varname">buildEclipsePlugin</code> functions found in the
    <code class="varname">nixpkgs.eclipses.plugins</code> attribute set. Use the
    <code class="varname">buildEclipseUpdateSite</code> function to install a plugin
    distributed as an Eclipse update site. This function takes <code class="literal">{ name,
    src }</code> as argument where <code class="literal">src</code> indicates the
    Eclipse update site archive. All Eclipse features and plugins within the
    downloaded update site will be installed. When an update site archive is
    not available then the <code class="varname">buildEclipsePlugin</code> function can
    be used to install a plugin that consists of a pair of feature and plugin
    JARs. This function takes an argument <code class="literal">{ name, srcFeature,
    srcPlugin }</code> where <code class="literal">srcFeature</code> and
    <code class="literal">srcPlugin</code> are the feature and plugin JARs, respectively.
   </p><p>
    Expanding the previous example with two plugins using the above functions
    we have
</p><pre class="screen">
packageOverrides = pkgs: {
  myEclipse = with pkgs.eclipses; eclipseWithPlugins {
    eclipse = eclipse-platform;
    jvmArgs = [ "-Xmx2048m" ];
    plugins = [
      plugins.color-theme
      (plugins.buildEclipsePlugin {
        name = "myplugin1-1.0";
        srcFeature = fetchurl {
          url = "http://…/features/myplugin1.jar";
          sha256 = "123…";
        };
        srcPlugin = fetchurl {
          url = "http://…/plugins/myplugin1.jar";
          sha256 = "123…";
        };
      });
      (plugins.buildEclipseUpdateSite {
        name = "myplugin2-1.0";
        src = fetchurl {
          stripRoot = false;
          url = "http://…/myplugin2.zip";
          sha256 = "123…";
        };
      });
    ];
  };
}
</pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-elm"></a>11.4. Elm</h2></div></div></div><p>
    To update Elm compiler, see
    <code class="filename">nixpkgs/pkgs/development/compilers/elm/README.md</code>.
   </p><p>
    To package Elm applications,
    <a class="link" href="https://github.com/hercules-ci/elm2nix#elm2nix" target="_top">read
    about elm2nix</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-shell-helpers"></a>11.5. Interactive shell helpers</h2></div></div></div><p>
    Some packages provide the shell integration to be more useful. But unlike
    other systems, nix doesn't have a standard share directory location. This
    is why a bunch <span class="command"><strong>PACKAGE-share</strong></span> scripts are shipped that
    print the location of the corresponding shared folder. Current list of such
    packages is as following:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">autojump</code>: <span class="command"><strong>autojump-share</strong></span>
      </p></li><li class="listitem"><p>
       <code class="literal">fzf</code>: <span class="command"><strong>fzf-share</strong></span>
      </p></li></ul></div><p>
    E.g. <code class="literal">autojump</code> can then used in the .bashrc like this:
</p><pre class="screen">
  source "$(autojump-share)/autojump.bash"
</pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-steam"></a>11.6. Steam</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-steam-nix"></a>11.6.1. Steam in Nix</h3></div></div></div><p>
     Steam is distributed as a <code class="filename">.deb</code> file, for now only as
     an i686 package (the amd64 package only has documentation). When unpacked,
     it has a script called <code class="filename">steam</code> that in ubuntu (their
     target distro) would go to <code class="filename">/usr/bin </code>. When run for
     the first time, this script copies some files to the user's home, which
     include another script that is the ultimate responsible for launching the
     steam binary, which is also in $HOME.
    </p><p>
     Nix problems and constraints:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        We don't have <code class="filename">/bin/bash</code> and many scripts point
        there. Similarly for <code class="filename">/usr/bin/python</code> .
       </p></li><li class="listitem"><p>
        We don't have the dynamic loader in <code class="filename">/lib </code>.
       </p></li><li class="listitem"><p>
        The <code class="filename">steam.sh</code> script in $HOME can not be patched,
        as it is checked and rewritten by steam.
       </p></li><li class="listitem"><p>
        The steam binary cannot be patched, it's also checked.
       </p></li></ul></div><p>
    </p><p>
     The current approach to deploy Steam in NixOS is composing a
     FHS-compatible chroot environment, as documented
     <a class="link" href="http://sandervanderburg.blogspot.nl/2013/09/composing-fhs-compatible-chroot.html" target="_top">here</a>.
     This allows us to have binaries in the expected paths without disrupting
     the system, and to avoid patching them to work in a non FHS environment.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-steam-play"></a>11.6.2. How to play</h3></div></div></div><p>
     For 64-bit systems it's important to have
</p><pre class="programlisting">hardware.opengl.driSupport32Bit = true;</pre><p>
     in your <code class="filename">/etc/nixos/configuration.nix</code>. You'll also
     need
</p><pre class="programlisting">hardware.pulseaudio.support32Bit = true;</pre><p>
     if you are using PulseAudio - this will enable 32bit ALSA apps
     integration. To use the Steam controller or other Steam supported
     controllers such as the DualShock 4 or Nintendo Switch Pro, you need to
     add
</p><pre class="programlisting">hardware.steam-hardware.enable = true;</pre><p>
     to your configuration.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-steam-troub"></a>11.6.3. Troubleshooting</h3></div></div></div><p>
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
        Steam fails to start. What do I do?
       </span></dt><dd><p>
         Try to run
</p><pre class="programlisting">strace steam</pre><p>
         to see what is causing steam to fail.
        </p></dd><dt><span class="term">
        Using the FOSS Radeon or nouveau (nvidia) drivers
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
           The <code class="literal">newStdcpp</code> parameter was removed since NixOS
           17.09 and should not be needed anymore.
          </p></li><li class="listitem"><p>
           Steam ships statically linked with a version of libcrypto that
           conflics with the one dynamically loaded by radeonsi_dri.so. If you
           get the error
</p><pre class="programlisting">steam.sh: line 713: 7842 Segmentation fault (core dumped)</pre><p>
           have a look at
           <a class="link" href="https://github.com/NixOS/nixpkgs/pull/20269" target="_top">this
           pull request</a>.
          </p></li></ul></div></dd><dt><span class="term">
        Java
       </span></dt><dd><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
           There is no java in steam chrootenv by default. If you get a message
           like
</p><pre class="programlisting">/home/foo/.local/share/Steam/SteamApps/common/towns/towns.sh: line 1: java: command not found</pre><p>
           You need to add
</p><pre class="programlisting"> steam.override { withJava = true; };</pre><p>
           to your configuration.
          </p></li></ol></div></dd></dl></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-steam-run"></a>11.6.4. steam-run</h3></div></div></div><p>
     The FHS-compatible chroot used for steam can also be used to run other
     linux games that expect a FHS environment. To do it, add
</p><pre class="programlisting">pkgs.(steam.override {
          nativeOnly = true;
          newStdcpp = true;
        }).run</pre><p>
     to your configuration, rebuild, and run the game with
</p><pre class="programlisting">steam-run ./foo</pre><p>
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-emacs"></a>11.7. Emacs</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-emacs-config"></a>11.7.1. Configuring Emacs</h3></div></div></div><p>
     The Emacs package comes with some extra helpers to make it easier to
     configure. <code class="varname">emacsWithPackages</code> allows you to manage
     packages from ELPA. This means that you will not have to install that
     packages from within Emacs. For instance, if you wanted to use
     <code class="literal">company</code>, <code class="literal">counsel</code>,
     <code class="literal">flycheck</code>, <code class="literal">ivy</code>,
     <code class="literal">magit</code>, <code class="literal">projectile</code>, and
     <code class="literal">use-package</code> you could use this as a
     <code class="filename">~/.config/nixpkgs/config.nix</code> override:
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; {
    myEmacs = emacsWithPackages (epkgs: (with epkgs.melpaStablePackages; [
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  }
}
</pre><p>
     You can install it like any other packages via <span class="command"><strong>nix-env -iA
     myEmacs</strong></span>. However, this will only install those packages. It will
     not <code class="literal">configure</code> them for us. To do this, we need to
     provide a configuration file. Luckily, it is possible to do this from
     within Nix! By modifying the above example, we can make Emacs load a
     custom config file. The key is to create a package that provide a
     <code class="filename">default.el</code> file in
     <code class="filename">/share/emacs/site-start/</code>. Emacs knows to load this
     file automatically when it starts.
    </p><pre class="screen">
{
  packageOverrides = pkgs: with pkgs; rec {
    myEmacsConfig = writeText "default.el" ''
;; initialize package

(require 'package)
(package-initialize 'noactivate)
(eval-when-compile
  (require 'use-package))

;; load some packages

(use-package company
  :bind ("&lt;C-tab&gt;" . company-complete)
  :diminish company-mode
  :commands (company-mode global-company-mode)
  :defer 1
  :config
  (global-company-mode))

(use-package counsel
  :commands (counsel-descbinds)
  :bind (([remap execute-extended-command] . counsel-M-x)
         ("C-x C-f" . counsel-find-file)
         ("C-c g" . counsel-git)
         ("C-c j" . counsel-git-grep)
         ("C-c k" . counsel-ag)
         ("C-x l" . counsel-locate)
         ("M-y" . counsel-yank-pop)))

(use-package flycheck
  :defer 2
  :config (global-flycheck-mode))

(use-package ivy
  :defer 1
  :bind (("C-c C-r" . ivy-resume)
         ("C-x C-b" . ivy-switch-buffer)
         :map ivy-minibuffer-map
         ("C-j" . ivy-call))
  :diminish ivy-mode
  :commands ivy-mode
  :config
  (ivy-mode 1))

(use-package magit
  :defer
  :if (executable-find "git")
  :bind (("C-x g" . magit-status)
         ("C-x G" . magit-dispatch-popup))
  :init
  (setq magit-completing-read-function 'ivy-completing-read))

(use-package projectile
  :commands projectile-mode
  :bind-keymap ("C-c p" . projectile-command-map)
  :defer 5
  :config
  (projectile-global-mode))
    '';
    myEmacs = emacsWithPackages (epkgs: (with epkgs.melpaStablePackages; [
      (runCommand "default.el" {} ''
mkdir -p $out/share/emacs/site-lisp
cp ${myEmacsConfig} $out/share/emacs/site-lisp/default.el
'')
      company
      counsel
      flycheck
      ivy
      magit
      projectile
      use-package
    ]));
  };
}
</pre><p>
     This provides a fairly full Emacs start file. It will load in addition to
     the user's presonal config. You can always disable it by passing
     <span class="command"><strong>-q</strong></span> to the Emacs command.
    </p><p>
     Sometimes <code class="varname">emacsWithPackages</code> is not enough, as this
     package set has some priorities imposed on packages (with the lowest
     priority assigned to Melpa Unstable, and the highest for packages manually
     defined in <code class="filename">pkgs/top-level/emacs-packages.nix</code>). But
     you can't control this priorities when some package is installed as a
     dependency. You can override it on per-package-basis, providing all the
     required dependencies manually - but it's tedious and there is always a
     possibility that an unwanted dependency will sneak in through some other
     package. To completely override such a package you can use
     <code class="varname">overrideScope'</code>.
    </p><pre class="screen">
overrides = self: super: rec {
  haskell-mode = self.melpaPackages.haskell-mode;
  ...
};
((emacsPackagesNgGen emacs).overrideScope' overrides).emacsWithPackages (p: with p; [
  # here both these package will use haskell-mode of our own choice
  ghc-mod
  dante
])
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-weechat"></a>11.8. Weechat</h2></div></div></div><p>
    Weechat can be configured to include your choice of plugins, reducing its
    closure size from the default configuration which includes all available
    plugins. To make use of this functionality, install an expression that
    overrides its configuration such as
</p><pre class="programlisting">weechat.override {configure = {availablePlugins, ...}: {
    plugins = with availablePlugins; [ python perl ];
  }
}</pre><p>
    If the <code class="literal">configure</code> function returns an attrset without the
    <code class="literal">plugins</code> attribute, <code class="literal">availablePlugins</code>
    will be used automatically.
   </p><p>
    The plugins currently available are <code class="literal">python</code>,
    <code class="literal">perl</code>, <code class="literal">ruby</code>, <code class="literal">guile</code>,
    <code class="literal">tcl</code> and <code class="literal">lua</code>.
   </p><p>
    The python and perl plugins allows the addition of extra libraries. For
    instance, the <code class="literal">inotify.py</code> script in weechat-scripts
    requires D-Bus or libnotify, and the <code class="literal">fish.py</code> script
    requires pycrypto. To use these scripts, use the plugin's
    <code class="literal">withPackages</code> attribute:
</p><pre class="programlisting">weechat.override { configure = {availablePlugins, ...}: {
    plugins = with availablePlugins; [
            (python.withPackages (ps: with ps; [ pycrypto python-dbus ]))
        ];
    };
}
</pre><p>
   </p><p>
    In order to also keep all default plugins installed, it is possible to use
    the following method:
</p><pre class="programlisting">weechat.override { configure = { availablePlugins, ... }: {
  plugins = builtins.attrValues (availablePlugins // {
    python = availablePlugins.python.withPackages (ps: with ps; [ pycrypto python-dbus ]);
  });
}; }
</pre><p>
   </p><p>
    WeeChat allows to set defaults on startup using the
    <code class="literal">--run-command</code>. The <code class="literal">configure</code> method
    can be used to pass commands to the program:
</p><pre class="programlisting">weechat.override {
  configure = { availablePlugins, ... }: {
    init = ''
      /set foo bar
      /server add freenode chat.freenode.org
    '';
  };
}</pre><p>
    Further values can be added to the list of commands when running
    <code class="literal">weechat --run-command "your-commands"</code>.
   </p><p>
    Additionally it's possible to specify scripts to be loaded when starting
    <code class="literal">weechat</code>. These will be loaded before the commands from
    <code class="literal">init</code>:
</p><pre class="programlisting">weechat.override {
  configure = { availablePlugins, ... }: {
    scripts = with pkgs.weechatScripts; [
      weechat-xmpp weechat-matrix-bridge wee-slack
    ];
    init = ''
      /set plugins.var.python.jabber.key "val"
    '':
  };
}</pre><p>
   </p><p>
    In <code class="literal">nixpkgs</code> there's a subpackage which contains
    derivations for WeeChat scripts. Such derivations expect a
    <code class="literal">passthru.scripts</code> attribute which contains a list of all
    scripts inside the store path. Furthermore all scripts have to live in
    <code class="literal">$out/share</code>. An exemplary derivation looks like this:
</p><pre class="programlisting">{ stdenv, fetchurl }:

stdenv.mkDerivation {
  name = "exemplary-weechat-script";
  src = fetchurl {
    url = "https://scripts.tld/your-scripts.tar.gz";
    sha256 = "...";
  };
  passthru.scripts = [ "foo.py" "bar.lua" ];
  installPhase = ''
    mkdir $out/share
    cp foo.py $out/share
    cp bar.lua $out/share
  '';
}</pre><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-citrix"></a>11.9. Citrix Receiver</h2></div></div></div><p>
    The <a class="link" href="https://www.citrix.com/products/receiver/" target="_top">Citrix
    Receiver</a> is a remote desktop viewer which provides access to
    <a class="link" href="https://www.citrix.com/products/xenapp-xendesktop/" target="_top">XenDesktop</a>
    installations.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-citrix-base"></a>11.9.1. Basic usage</h3></div></div></div><p>
     The tarball archive needs to be downloaded manually as the licenses
     agreements of the vendor need to be accepted first. This is available at
     the
     <a class="link" href="https://www.citrix.com/downloads/citrix-receiver/" target="_top">download
     page at citrix.com</a>. Then run <code class="literal">nix-prefetch-url
     file://$PWD/linuxx64-$version.tar.gz</code>. With the archive available
     in the store the package can be built and installed with Nix.
    </p><p>
     <span class="emphasis"><em>Note: it's recommended to install <code class="literal">Citrix
     Receiver</code> using <code class="literal">nix-env -i</code> or globally to
     ensure that the <code class="literal">.desktop</code> files are installed properly
     into <code class="literal">$XDG_CONFIG_DIRS</code>. Otherwise it won't be possible
     to open <code class="literal">.ica</code> files automatically from the browser to
     start a Citrix connection.</em></span>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-citrix-custom-certs"></a>11.9.2. Custom certificates</h3></div></div></div><p>
     The <code class="literal">Citrix Receiver</code> in <code class="literal">nixpkgs</code>
     trusts several certificates
     <a class="link" href="https://curl.haxx.se/docs/caextract.html" target="_top">from the
     Mozilla database</a> by default. However several companies using Citrix
     might require their own corporate certificate. On distros with imperative
     packaging these certs can be stored easily in
     <a class="link" href="https://developer-docs.citrix.com/projects/receiver-for-linux-command-reference/en/13.7/" target="_top"><code class="literal">$ICAROOT</code></a>,
     however this directory is a store path in <code class="literal">nixpkgs</code>. In
     order to work around this issue the package provides a simple mechanism to
     add custom certificates without rebuilding the entire package using
     <code class="literal">symlinkJoin</code>:
</p><pre class="programlisting">
with import &lt;nixpkgs&gt; { config.allowUnfree = true; };
let extraCerts = [ ./custom-cert-1.pem ./custom-cert-2.pem /* ... */ ]; in
citrix_receiver.override {
  inherit extraCerts;
}
</pre><p>
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-ibus-typing-booster"></a>11.10. ibus-engines.typing-booster</h2></div></div></div><p>
    This package is an ibus-based completion method to speed up typing.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-ibus-typing-booster-activate"></a>11.10.1. Activating the engine</h3></div></div></div><p>
     IBus needs to be configured accordingly to activate
     <code class="literal">typing-booster</code>. The configuration depends on the
     desktop manager in use. For detailed instructions, please refer to the
     <a class="link" href="https://mike-fabian.github.io/ibus-typing-booster/documentation.html" target="_top">upstream
     docs</a>.
    </p><p>
     On NixOS you need to explicitly enable <code class="literal">ibus</code> with given
     engines before customizing your desktop to use
     <code class="literal">typing-booster</code>. This can be achieved using the
     <code class="literal">ibus</code> module:
</p><pre class="programlisting">{ pkgs, ... }: {
  i18n.inputMethod = {
    enabled = "ibus";
    ibus.engines = with pkgs.ibus-engines; [ typing-booster ];
  };
}</pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-ibus-typing-booster-customize-hunspell"></a>11.10.2. Using custom hunspell dictionaries</h3></div></div></div><p>
     The IBus engine is based on <code class="literal">hunspell</code> to support
     completion in many languages. By default the dictionaries
     <code class="literal">de-de</code>, <code class="literal">en-us</code>,
     <code class="literal">es-es</code>, <code class="literal">it-it</code>,
     <code class="literal">sv-se</code> and <code class="literal">sv-fi</code> are in use. To add
     another dictionary, the package can be overridden like this:
</p><pre class="programlisting">ibus-engines.typing-booster.override {
  langs = [ "de-at" "en-gb" ];
}</pre><p>
    </p><p>
     <span class="emphasis"><em>Note: each language passed to <code class="literal">langs</code> must be
     an attribute name in <code class="literal">pkgs.hunspellDicts</code>.</em></span>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-ibus-typing-booster-emoji-picker"></a>11.10.3. Built-in emoji picker</h3></div></div></div><p>
     The <code class="literal">ibus-engines.typing-booster</code> package contains a
     program named <code class="literal">emoji-picker</code>. To display all emojis
     correctly, a special font such as <code class="literal">noto-fonts-emoji</code> is
     needed:
    </p><p>
     On NixOS it can be installed using the following expression:
</p><pre class="programlisting">{ pkgs, ... }: {
  fonts.fonts = with pkgs; [ noto-fonts-emoji ];
}</pre><p>
    </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-overlays"></a>Chapter 12. Overlays</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-overlays-install">12.1. Installing overlays</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-overlays-argument">12.1.1. Set overlays in NixOS or Nix expressions</a></span></dt><dt><span class="section"><a href="#sec-overlays-lookup">12.1.2. Install overlays via configuration lookup</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-overlays-definition">12.2. Defining overlays</a></span></dt></dl></div><p>
   This chapter describes how to extend and change Nixpkgs using overlays.
   Overlays are used to add layers in the fixed-point used by Nixpkgs to
   compose the set of all packages.
  </p><p>
   Nixpkgs can be configured with a list of overlays, which are applied in
   order. This means that the order of the overlays can be significant if
   multiple layers override the same package.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-overlays-install"></a>12.1. Installing overlays</h2></div></div></div><p>
    The list of overlays can be set either explicitly in a Nix expression, or
    through <code class="literal">&lt;nixpkgs-overlays&gt;</code> or user configuration
    files.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-overlays-argument"></a>12.1.1. Set overlays in NixOS or Nix expressions</h3></div></div></div><p>
     On a NixOS system the value of the <code class="literal">nixpkgs.overlays</code>
     option, if present, is passed to the system Nixpkgs directly as an
     argument. Note that this does not affect the overlays for non-NixOS
     operations (e.g. <code class="literal">nix-env</code>), which are
     <a class="link" href="#sec-overlays-lookup" title="12.1.2. Install overlays via configuration lookup">looked</a> up independently.
    </p><p>
     The list of overlays can be passed explicitly when importing nixpkgs, for
     example <code class="literal">import &lt;nixpkgs&gt; { overlays = [ overlay1 overlay2
     ]; }</code>.
    </p><p>
     Further overlays can be added by calling the
     <code class="literal">pkgs.extend</code> or <code class="literal">pkgs.appendOverlays</code>,
     although it is often preferable to avoid these functions, because they
     recompute the Nixpkgs fixpoint, which is somewhat expensive to do.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-overlays-lookup"></a>12.1.2. Install overlays via configuration lookup</h3></div></div></div><p>
     The list of overlays is determined as follows.
    </p><p>
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        First, if an
        <a class="link" href="#sec-overlays-argument" title="12.1.1. Set overlays in NixOS or Nix expressions"><code class="varname">overlays</code>
        argument</a> to the Nixpkgs function itself is given, then that is
        used and no path lookup will be performed.
       </p></li><li class="listitem"><p>
        Otherwise, if the Nix path entry
        <code class="literal">&lt;nixpkgs-overlays&gt;</code> exists, we look for
        overlays at that path, as described below.
       </p><p>
        See the section on <code class="literal">NIX_PATH</code> in the Nix manual for
        more details on how to set a value for
        <code class="literal">&lt;nixpkgs-overlays&gt;.</code>
       </p></li><li class="listitem"><p>
        If one of <code class="filename">~/.config/nixpkgs/overlays.nix</code> and
        <code class="filename">~/.config/nixpkgs/overlays/</code> exists, then we look
        for overlays at that path, as described below. It is an error if both
        exist.
       </p></li></ol></div><p>
    </p><p>
     If we are looking for overlays at a path, then there are two cases:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If the path is a file, then the file is imported as a Nix expression
        and used as the list of overlays.
       </p></li><li class="listitem"><p>
        If the path is a directory, then we take the content of the directory,
        order it lexicographically, and attempt to interpret each as an overlay
        by:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
           Importing the file, if it is a <code class="literal">.nix</code> file.
          </p></li><li class="listitem"><p>
           Importing a top-level <code class="filename">default.nix</code> file, if it
           is a directory.
          </p></li></ul></div><p>
       </p></li></ul></div><p>
    </p><p>
     Because overlays that are set in NixOS configuration do not affect
     non-NixOS operations such as <code class="literal">nix-env</code>, the
     <code class="filename">overlays.nix</code> option provides a convenient way to use
     the same overlays for a NixOS system configuration and user configuration:
     the same file can be used as <code class="filename">overlays.nix</code> and
     imported as the value of <code class="literal">nixpkgs.overlays</code>.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-overlays-definition"></a>12.2. Defining overlays</h2></div></div></div><p>
    Overlays are Nix functions which accept two arguments, conventionally
    called <code class="varname">self</code> and <code class="varname">super</code>, and return a
    set of packages. For example, the following is a valid overlay.
   </p><pre class="programlisting">
self: super:

{
  boost = super.boost.override {
    python = self.python3;
  };
  rr = super.callPackage ./pkgs/rr {
    stdenv = self.stdenv_32bit;
  };
}
</pre><p>
    The first argument (<code class="varname">self</code>) corresponds to the final
    package set. You should use this set for the dependencies of all packages
    specified in your overlay. For example, all the dependencies of
    <code class="varname">rr</code> in the example above come from
    <code class="varname">self</code>, as well as the overridden dependencies used in the
    <code class="varname">boost</code> override.
   </p><p>
    The second argument (<code class="varname">super</code>) corresponds to the result of
    the evaluation of the previous stages of Nixpkgs. It does not contain any
    of the packages added by the current overlay, nor any of the following
    overlays. This set should be used either to refer to packages you wish to
    override, or to access functions defined in Nixpkgs. For example, the
    original recipe of <code class="varname">boost</code> in the above example, comes
    from <code class="varname">super</code>, as well as the
    <code class="varname">callPackage</code> function.
   </p><p>
    The value returned by this function should be a set similar to
    <code class="filename">pkgs/top-level/all-packages.nix</code>, containing overridden
    and/or new packages.
   </p><p>
    Overlays are similar to other methods for customizing Nixpkgs, in
    particular the <code class="literal">packageOverrides</code> attribute described in
    <a class="xref" href="#sec-modify-via-packageOverrides" title="6.5. Modify packages via packageOverrides">Section 6.5, “Modify packages via <code class="literal">packageOverrides</code>”</a>. Indeed,
    <code class="literal">packageOverrides</code> acts as an overlay with only the
    <code class="varname">super</code> argument. It is therefore appropriate for basic
    use, but overlays are more powerful and easier to distribute.
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-conventions"></a>Chapter 13. Coding conventions</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#sec-syntax">13.1. Syntax</a></span></dt><dt><span class="section"><a href="#sec-package-naming">13.2. Package naming</a></span></dt><dt><span class="section"><a href="#sec-organisation">13.3. File naming and organisation</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-hierarchy">13.3.1. Hierarchy</a></span></dt><dt><span class="section"><a href="#sec-versioning">13.3.2. Versioning</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-sources">13.4. Fetching Sources</a></span></dt><dt><span class="section"><a href="#sec-source-hashes">13.5. Obtaining source hash</a></span></dt><dd><dl><dt><span class="section"><a href="#sec-source-hashes-security">13.5.1. Obtaining hashes securely</a></span></dt></dl></dd><dt><span class="section"><a href="#sec-patches">13.6. Patches</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-syntax"></a>13.1. Syntax</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Use 2 spaces of indentation per indentation level in Nix expressions, 4
      spaces in shell scripts.
     </p></li><li class="listitem"><p>
      Do not use tab characters, i.e. configure your editor to use soft tabs.
      For instance, use <code class="literal">(setq-default indent-tabs-mode nil)</code>
      in Emacs. Everybody has different tab settings so it’s asking for
      trouble.
     </p></li><li class="listitem"><p>
      Use <code class="literal">lowerCamelCase</code> for variable names, not
      <code class="literal">UpperCamelCase</code>. Note, this rule does not apply to
      package attribute names, which instead follow the rules in
      <a class="xref" href="#sec-package-naming" title="13.2. Package naming">Section 13.2, “Package naming”</a>.
     </p></li><li class="listitem"><p>
      Function calls with attribute set arguments are written as
</p><pre class="programlisting">
foo {
  arg = ...;
}
</pre><p>
      not
</p><pre class="programlisting">
foo
{
  arg = ...;
}
</pre><p>
      Also fine is
</p><pre class="programlisting">
foo { arg = ...; }
</pre><p>
      if it's a short call.
     </p></li><li class="listitem"><p>
      In attribute sets or lists that span multiple lines, the attribute names
      or list elements should be aligned:
</p><pre class="programlisting">
# A long list.
list = [
  elem1
  elem2
  elem3
];

# A long attribute set.
attrs = {
  attr1 = short_expr;
  attr2 =
    if true then big_expr else big_expr;
};

# Combined
listOfAttrs = [
  {
    attr1 = 3;
    attr2 = "fff";
  }
  {
    attr1 = 5;
    attr2 = "ggg";
  }
];
</pre><p>
     </p></li><li class="listitem"><p>
      Short lists or attribute sets can be written on one line:
</p><pre class="programlisting">
# A short list.
list = [ elem1 elem2 elem3 ];

# A short set.
attrs = { x = 1280; y = 1024; };
</pre><p>
     </p></li><li class="listitem"><p>
      Breaking in the middle of a function argument can give hard-to-read code,
      like
</p><pre class="programlisting">
someFunction { x = 1280;
  y = 1024; } otherArg
  yetAnotherArg
</pre><p>
      (especially if the argument is very large, spanning multiple lines).
     </p><p>
      Better:
</p><pre class="programlisting">
someFunction
  { x = 1280; y = 1024; }
  otherArg
  yetAnotherArg
</pre><p>
      or
</p><pre class="programlisting">
let res = { x = 1280; y = 1024; };
in someFunction res otherArg yetAnotherArg
</pre><p>
     </p></li><li class="listitem"><p>
      The bodies of functions, asserts, and withs are not indented to prevent a
      lot of superfluous indentation levels, i.e.
</p><pre class="programlisting">
{ arg1, arg2 }:
assert system == "i686-linux";
stdenv.mkDerivation { ...
</pre><p>
      not
</p><pre class="programlisting">
{ arg1, arg2 }:
  assert system == "i686-linux";
    stdenv.mkDerivation { ...
</pre><p>
     </p></li><li class="listitem"><p>
      Function formal arguments are written as:
</p><pre class="programlisting">
{ arg1, arg2, arg3 }:
</pre><p>
      but if they don't fit on one line they're written as:
</p><pre class="programlisting">
{ arg1, arg2, arg3
, arg4, ...
, # Some comment...
  argN
}:
</pre><p>
     </p></li><li class="listitem"><p>
      Functions should list their expected arguments as precisely as possible.
      That is, write
</p><pre class="programlisting">
{ stdenv, fetchurl, perl }: <em class="replaceable"><code>...</code></em>
</pre><p>
      instead of
</p><pre class="programlisting">
args: with args; <em class="replaceable"><code>...</code></em>
</pre><p>
      or
</p><pre class="programlisting">
{ stdenv, fetchurl, perl, ... }: <em class="replaceable"><code>...</code></em>
</pre><p>
     </p><p>
      For functions that are truly generic in the number of arguments (such as
      wrappers around <code class="varname">mkDerivation</code>) that have some required
      arguments, you should write them using an <code class="literal">@</code>-pattern:
</p><pre class="programlisting">
{ stdenv, doCoverageAnalysis ? false, ... } @ args:

stdenv.mkDerivation (args // {
  <em class="replaceable"><code>...</code></em> if doCoverageAnalysis then "bla" else "" <em class="replaceable"><code>...</code></em>
})
</pre><p>
      instead of
</p><pre class="programlisting">
args:

args.stdenv.mkDerivation (args // {
  <em class="replaceable"><code>...</code></em> if args ? doCoverageAnalysis &amp;&amp; args.doCoverageAnalysis then "bla" else "" <em class="replaceable"><code>...</code></em>
})
</pre><p>
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-package-naming"></a>13.2. Package naming</h2></div></div></div><p>
    The key words <span class="emphasis"><em>must</em></span>, <span class="emphasis"><em>must not</em></span>,
    <span class="emphasis"><em>required</em></span>, <span class="emphasis"><em>shall</em></span>, <span class="emphasis"><em>shall
    not</em></span>, <span class="emphasis"><em>should</em></span>, <span class="emphasis"><em>should
    not</em></span>, <span class="emphasis"><em>recommended</em></span>, <span class="emphasis"><em>may</em></span>,
    and <span class="emphasis"><em>optional</em></span> in this section are to be interpreted as
    described in <a class="link" href="https://tools.ietf.org/html/rfc2119" target="_top">RFC
    2119</a>. Only <span class="emphasis"><em>emphasized</em></span> words are to be
    interpreted in this way.
   </p><p>
    In Nixpkgs, there are generally three different names associated with a
    package:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="varname">name</code> attribute of the derivation (excluding the
       version part). This is what most users see, in particular when using
       <span class="command"><strong>nix-env</strong></span>.
      </p></li><li class="listitem"><p>
       The variable name used for the instantiated package in
       <code class="filename">all-packages.nix</code>, and when passing it as a
       dependency to other functions. Typically this is called the
       <span class="emphasis"><em>package attribute name</em></span>. This is what Nix expression
       authors see. It can also be used when installing using <span class="command"><strong>nix-env
       -iA</strong></span>.
      </p></li><li class="listitem"><p>
       The filename for (the directory containing) the Nix expression.
      </p></li></ul></div><p>
    Most of the time, these are the same. For instance, the package
    <code class="literal">e2fsprogs</code> has a <code class="varname">name</code> attribute
    <code class="literal">"e2fsprogs-<em class="replaceable"><code>version</code></em>"</code>, is bound
    to the variable name <code class="varname">e2fsprogs</code> in
    <code class="filename">all-packages.nix</code>, and the Nix expression is in
    <code class="filename">pkgs/os-specific/linux/e2fsprogs/default.nix</code>.
   </p><p>
    There are a few naming guidelines:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       The <code class="literal">name</code> attribute <span class="emphasis"><em>should</em></span> be
       identical to the upstream package name.
      </p></li><li class="listitem"><p>
       The <code class="literal">name</code> attribute <span class="emphasis"><em>must not</em></span>
       contain uppercase letters — e.g.,
       <code class="literal">"mplayer-1.0rc2"</code> instead of
       <code class="literal">"MPlayer-1.0rc2"</code>.
      </p></li><li class="listitem"><p>
       The version part of the <code class="literal">name</code> attribute
       <span class="emphasis"><em>must</em></span> start with a digit (following a dash) —
       e.g., <code class="literal">"hello-0.3.1rc2"</code>.
      </p></li><li class="listitem"><p>
       If a package is not a release but a commit from a repository, then the
       version part of the name <span class="emphasis"><em>must</em></span> be the date of that
       (fetched) commit. The date <span class="emphasis"><em>must</em></span> be in
       <code class="literal">"YYYY-MM-DD"</code> format. Also append
       <code class="literal">"unstable"</code> to the name - e.g.,
       <code class="literal">"pkgname-unstable-2014-09-23"</code>.
      </p></li><li class="listitem"><p>
       Dashes in the package name <span class="emphasis"><em>should</em></span> be preserved in
       new variable names, rather than converted to underscores or camel cased
       — e.g., <code class="varname">http-parser</code> instead of
       <code class="varname">http_parser</code> or <code class="varname">httpParser</code>. The
       hyphenated style is preferred in all three package names.
      </p></li><li class="listitem"><p>
       If there are multiple versions of a package, this
       <span class="emphasis"><em>should</em></span> be reflected in the variable names in
       <code class="filename">all-packages.nix</code>, e.g.
       <code class="varname">json-c-0-9</code> and <code class="varname">json-c-0-11</code>. If
       there is an obvious “default” version, make an attribute
       like <code class="literal">json-c = json-c-0-9;</code>. See also
       <a class="xref" href="#sec-versioning" title="13.3.2. Versioning">Section 13.3.2, “Versioning”</a>
      </p></li></ul></div><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-organisation"></a>13.3. File naming and organisation</h2></div></div></div><p>
    Names of files and directories should be in lowercase, with dashes between
    words — not in camel case. For instance, it should be
    <code class="filename">all-packages.nix</code>, not
    <code class="filename">allPackages.nix</code> or
    <code class="filename">AllPackages.nix</code>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-hierarchy"></a>13.3.1. Hierarchy</h3></div></div></div><p>
     Each package should be stored in its own directory somewhere in the
     <code class="filename">pkgs/</code> tree, i.e. in
     <code class="filename">pkgs/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>subcategory</code></em>/<em class="replaceable"><code>...</code></em>/<em class="replaceable"><code>pkgname</code></em></code>.
     Below are some rules for picking the right category for a package. Many
     packages fall under several categories; what matters is the
     <span class="emphasis"><em>primary</em></span> purpose of a package. For example, the
     <code class="literal">libxml2</code> package builds both a library and some tools;
     but it’s a library foremost, so it goes under
     <code class="filename">pkgs/development/libraries</code>.
    </p><p>
     When in doubt, consider refactoring the <code class="filename">pkgs/</code> tree,
     e.g. creating new categories or splitting up an existing category.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
       If it’s used to support <span class="emphasis"><em>software development</em></span>:
      </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          If it’s a <span class="emphasis"><em>library</em></span> used by other packages:
         </span></dt><dd><p>
           <code class="filename">development/libraries</code> (e.g.
           <code class="filename">libxml2</code>)
          </p></dd><dt><span class="term">
          If it’s a <span class="emphasis"><em>compiler</em></span>:
         </span></dt><dd><p>
           <code class="filename">development/compilers</code> (e.g.
           <code class="filename">gcc</code>)
          </p></dd><dt><span class="term">
          If it’s an <span class="emphasis"><em>interpreter</em></span>:
         </span></dt><dd><p>
           <code class="filename">development/interpreters</code> (e.g.
           <code class="filename">guile</code>)
          </p></dd><dt><span class="term">
          If it’s a (set of) development <span class="emphasis"><em>tool(s)</em></span>:
         </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
             If it’s a <span class="emphasis"><em>parser generator</em></span> (including lexers):
            </span></dt><dd><p>
              <code class="filename">development/tools/parsing</code> (e.g.
              <code class="filename">bison</code>, <code class="filename">flex</code>)
             </p></dd><dt><span class="term">
             If it’s a <span class="emphasis"><em>build manager</em></span>:
            </span></dt><dd><p>
              <code class="filename">development/tools/build-managers</code> (e.g.
              <code class="filename">gnumake</code>)
             </p></dd><dt><span class="term">
             Else:
            </span></dt><dd><p>
              <code class="filename">development/tools/misc</code> (e.g.
              <code class="filename">binutils</code>)
             </p></dd></dl></div></dd><dt><span class="term">
          Else:
         </span></dt><dd><p>
           <code class="filename">development/misc</code>
          </p></dd></dl></div></dd><dt><span class="term">
       If it’s a (set of) <span class="emphasis"><em>tool(s)</em></span>:
      </span></dt><dd><p>
        (A tool is a relatively small program, especially one intended to be
        used non-interactively.)
       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          If it’s for <span class="emphasis"><em>networking</em></span>:
         </span></dt><dd><p>
           <code class="filename">tools/networking</code> (e.g.
           <code class="filename">wget</code>)
          </p></dd><dt><span class="term">
          If it’s for <span class="emphasis"><em>text processing</em></span>:
         </span></dt><dd><p>
           <code class="filename">tools/text</code> (e.g.
           <code class="filename">diffutils</code>)
          </p></dd><dt><span class="term">
          If it’s a <span class="emphasis"><em>system utility</em></span>, i.e., something related or essential to the operation of a system:
         </span></dt><dd><p>
           <code class="filename">tools/system</code> (e.g. <code class="filename">cron</code>)
          </p></dd><dt><span class="term">
          If it’s an <span class="emphasis"><em>archiver</em></span> (which may include a compression function):
         </span></dt><dd><p>
           <code class="filename">tools/archivers</code> (e.g. <code class="filename">zip</code>,
           <code class="filename">tar</code>)
          </p></dd><dt><span class="term">
          If it’s a <span class="emphasis"><em>compression</em></span> program:
         </span></dt><dd><p>
           <code class="filename">tools/compression</code> (e.g.
           <code class="filename">gzip</code>, <code class="filename">bzip2</code>)
          </p></dd><dt><span class="term">
          If it’s a <span class="emphasis"><em>security</em></span>-related program:
         </span></dt><dd><p>
           <code class="filename">tools/security</code> (e.g. <code class="filename">nmap</code>,
           <code class="filename">gnupg</code>)
          </p></dd><dt><span class="term">
          Else:
         </span></dt><dd><p>
           <code class="filename">tools/misc</code>
          </p></dd></dl></div></dd><dt><span class="term">
       If it’s a <span class="emphasis"><em>shell</em></span>:
      </span></dt><dd><p>
        <code class="filename">shells</code> (e.g. <code class="filename">bash</code>)
       </p></dd><dt><span class="term">
       If it’s a <span class="emphasis"><em>server</em></span>:
      </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          If it’s a web server:
         </span></dt><dd><p>
           <code class="filename">servers/http</code> (e.g.
           <code class="filename">apache-httpd</code>)
          </p></dd><dt><span class="term">
          If it’s an implementation of the X Windowing System:
         </span></dt><dd><p>
           <code class="filename">servers/x11</code> (e.g. <code class="filename">xorg</code>
           — this includes the client libraries and programs)
          </p></dd><dt><span class="term">
          Else:
         </span></dt><dd><p>
           <code class="filename">servers/misc</code>
          </p></dd></dl></div></dd><dt><span class="term">
       If it’s a <span class="emphasis"><em>desktop environment</em></span>:
      </span></dt><dd><p>
        <code class="filename">desktops</code> (e.g. <code class="filename">kde</code>,
        <code class="filename">gnome</code>, <code class="filename">enlightenment</code>)
       </p></dd><dt><span class="term">
       If it’s a <span class="emphasis"><em>window manager</em></span>:
      </span></dt><dd><p>
        <code class="filename">applications/window-managers</code> (e.g.
        <code class="filename">awesome</code>, <code class="filename">stumpwm</code>)
       </p></dd><dt><span class="term">
       If it’s an <span class="emphasis"><em>application</em></span>:
      </span></dt><dd><p>
        A (typically large) program with a distinct user interface, primarily
        used interactively.
       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          If it’s a <span class="emphasis"><em>version management system</em></span>:
         </span></dt><dd><p>
           <code class="filename">applications/version-management</code> (e.g.
           <code class="filename">subversion</code>)
          </p></dd><dt><span class="term">
          If it’s for <span class="emphasis"><em>video playback / editing</em></span>:
         </span></dt><dd><p>
           <code class="filename">applications/video</code> (e.g.
           <code class="filename">vlc</code>)
          </p></dd><dt><span class="term">
          If it’s for <span class="emphasis"><em>graphics viewing / editing</em></span>:
         </span></dt><dd><p>
           <code class="filename">applications/graphics</code> (e.g.
           <code class="filename">gimp</code>)
          </p></dd><dt><span class="term">
          If it’s for <span class="emphasis"><em>networking</em></span>:
         </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
             If it’s a <span class="emphasis"><em>mailreader</em></span>:
            </span></dt><dd><p>
              <code class="filename">applications/networking/mailreaders</code> (e.g.
              <code class="filename">thunderbird</code>)
             </p></dd><dt><span class="term">
             If it’s a <span class="emphasis"><em>newsreader</em></span>:
            </span></dt><dd><p>
              <code class="filename">applications/networking/newsreaders</code> (e.g.
              <code class="filename">pan</code>)
             </p></dd><dt><span class="term">
             If it’s a <span class="emphasis"><em>web browser</em></span>:
            </span></dt><dd><p>
              <code class="filename">applications/networking/browsers</code> (e.g.
              <code class="filename">firefox</code>)
             </p></dd><dt><span class="term">
             Else:
            </span></dt><dd><p>
              <code class="filename">applications/networking/misc</code>
             </p></dd></dl></div></dd><dt><span class="term">
          Else:
         </span></dt><dd><p>
           <code class="filename">applications/misc</code>
          </p></dd></dl></div></dd><dt><span class="term">
       If it’s <span class="emphasis"><em>data</em></span> (i.e., does not have a straight-forward executable semantics):
      </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
          If it’s a <span class="emphasis"><em>font</em></span>:
         </span></dt><dd><p>
           <code class="filename">data/fonts</code>
          </p></dd><dt><span class="term">
          If it’s related to <span class="emphasis"><em>SGML/XML processing</em></span>:
         </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">
             If it’s an <span class="emphasis"><em>XML DTD</em></span>:
            </span></dt><dd><p>
              <code class="filename">data/sgml+xml/schemas/xml-dtd</code> (e.g.
              <code class="filename">docbook</code>)
             </p></dd><dt><span class="term">
             If it’s an <span class="emphasis"><em>XSLT stylesheet</em></span>:
            </span></dt><dd><p>
              (Okay, these are executable...)
             </p><p>
              <code class="filename">data/sgml+xml/stylesheets/xslt</code> (e.g.
              <code class="filename">docbook-xsl</code>)
             </p></dd></dl></div></dd></dl></div></dd><dt><span class="term">
       If it’s a <span class="emphasis"><em>game</em></span>:
      </span></dt><dd><p>
        <code class="filename">games</code>
       </p></dd><dt><span class="term">
       Else:
      </span></dt><dd><p>
        <code class="filename">misc</code>
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-versioning"></a>13.3.2. Versioning</h3></div></div></div><p>
     Because every version of a package in Nixpkgs creates a potential
     maintenance burden, old versions of a package should not be kept unless
     there is a good reason to do so. For instance, Nixpkgs contains several
     versions of GCC because other packages don’t build with the latest
     version of GCC. Other examples are having both the latest stable and
     latest pre-release version of a package, or to keep several major releases
     of an application that differ significantly in functionality.
    </p><p>
     If there is only one version of a package, its Nix expression should be
     named <code class="filename">e2fsprogs/default.nix</code>. If there are multiple
     versions, this should be reflected in the filename, e.g.
     <code class="filename">e2fsprogs/1.41.8.nix</code> and
     <code class="filename">e2fsprogs/1.41.9.nix</code>. The version in the filename
     should leave out unnecessary detail. For instance, if we keep the latest
     Firefox 2.0.x and 3.5.x versions in Nixpkgs, they should be named
     <code class="filename">firefox/2.0.nix</code> and
     <code class="filename">firefox/3.5.nix</code>, respectively (which, at a given
     point, might contain versions <code class="literal">2.0.0.20</code> and
     <code class="literal">3.5.4</code>). If a version requires many auxiliary files, you
     can use a subdirectory for each version, e.g.
     <code class="filename">firefox/2.0/default.nix</code> and
     <code class="filename">firefox/3.5/default.nix</code>.
    </p><p>
     All versions of a package <span class="emphasis"><em>must</em></span> be included in
     <code class="filename">all-packages.nix</code> to make sure that they evaluate
     correctly.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-sources"></a>13.4. Fetching Sources</h2></div></div></div><p>
    There are multiple ways to fetch a package source in nixpkgs. The general
    guideline is that you should package reproducible sources with a high
    degree of availability. Right now there is only one fetcher which has
    mirroring support and that is <code class="literal">fetchurl</code>. Note that you
    should also prefer protocols which have a corresponding proxy environment
    variable.
   </p><p>
    You can find many source fetch helpers in
    <code class="literal">pkgs/build-support/fetch*</code>.
   </p><p>
    In the file <code class="literal">pkgs/top-level/all-packages.nix</code> you can find
    fetch helpers, these have names on the form <code class="literal">fetchFrom*</code>.
    The intention of these are to provide snapshot fetches but using the same
    api as some of the version controlled fetchers from
    <code class="literal">pkgs/build-support/</code>. As an example going from bad to
    good:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Bad: Uses <code class="literal">git://</code> which won't be proxied.
</p><pre class="programlisting">
src = fetchgit {
  url = "git://github.com/NixOS/nix.git";
  rev = "1f795f9f44607cc5bec70d1300150bfefcef2aae";
  sha256 = "1cw5fszffl5pkpa6s6wjnkiv6lm5k618s32sp60kvmvpy7a2v9kg";
}
</pre><p>
      </p></li><li class="listitem"><p>
       Better: This is ok, but an archive fetch will still be faster.
</p><pre class="programlisting">
src = fetchgit {
  url = "https://github.com/NixOS/nix.git";
  rev = "1f795f9f44607cc5bec70d1300150bfefcef2aae";
  sha256 = "1cw5fszffl5pkpa6s6wjnkiv6lm5k618s32sp60kvmvpy7a2v9kg";
}
</pre><p>
      </p></li><li class="listitem"><p>
       Best: Fetches a snapshot archive and you get the rev you want.
</p><pre class="programlisting">
src = fetchFromGitHub {
  owner = "NixOS";
  repo = "nix";
  rev = "1f795f9f44607cc5bec70d1300150bfefcef2aae";
  sha256 = "1i2yxndxb6yc9l6c99pypbd92lfq5aac4klq7y2v93c9qvx2cgpc";
}
</pre><p>
       Find the value to put as <code class="literal">sha256</code> by running
       <code class="literal">nix run -f '&lt;nixpkgs&gt;' nix-prefetch-github -c
       nix-prefetch-github --rev 1f795f9f44607cc5bec70d1300150bfefcef2aae NixOS
       nix</code> or <code class="literal">nix-prefetch-url --unpack
       https://github.com/NixOS/nix/archive/1f795f9f44607cc5bec70d1300150bfefcef2aae.tar.gz</code>.
      </p></li></ul></div><p>
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-source-hashes"></a>13.5. Obtaining source hash</h2></div></div></div><p>
    Preferred source hash type is sha256. There are several ways to get it.
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      Prefetch URL (with <code class="literal">nix-prefetch-<em class="replaceable"><code>XXX</code></em>
      <em class="replaceable"><code>URL</code></em></code>, where
      <em class="replaceable"><code>XXX</code></em> is one of <code class="literal">url</code>,
      <code class="literal">git</code>, <code class="literal">hg</code>, <code class="literal">cvs</code>,
      <code class="literal">bzr</code>, <code class="literal">svn</code>). Hash is printed to
      stdout.
     </p></li><li class="listitem"><p>
      Prefetch by package source (with <code class="literal">nix-prefetch-url
      '&lt;nixpkgs&gt;' -A <em class="replaceable"><code>PACKAGE</code></em>.src</code>,
      where <em class="replaceable"><code>PACKAGE</code></em> is package attribute name). Hash
      is printed to stdout.
     </p><p>
      This works well when you've upgraded existing package version and want to
      find out new hash, but is useless if package can't be accessed by
      attribute or package has multiple sources (<code class="literal">.srcs</code>,
      architecture-dependent sources, etc).
     </p></li><li class="listitem"><p>
      Upstream provided hash: use it when upstream provides
      <code class="literal">sha256</code> or <code class="literal">sha512</code> (when upstream
      provides <code class="literal">md5</code>, don't use it, compute
      <code class="literal">sha256</code> instead).
     </p><p>
      A little nuance is that <code class="literal">nix-prefetch-*</code> tools produce
      hash encoded with <code class="literal">base32</code>, but upstream usually
      provides hexadecimal (<code class="literal">base16</code>) encoding. Fetchers
      understand both formats. Nixpkgs does not standardize on any one format.
     </p><p>
      You can convert between formats with nix-hash, for example:
</p><pre class="screen">
$ nix-hash --type sha256 --to-base32 <em class="replaceable"><code>HASH</code></em>
</pre><p>
     </p></li><li class="listitem"><p>
      Extracting hash from local source tarball can be done with
      <code class="literal">sha256sum</code>. Use <code class="literal">nix-prefetch-url
      file:///path/to/tarball </code> if you want base32 hash.
     </p></li><li class="listitem"><p>
      Fake hash: set fake hash in package expression, perform build and extract
      correct hash from error Nix prints.
     </p><p>
      For package updates it is enough to change one symbol to make hash fake.
      For new packages, you can use <code class="literal">lib.fakeSha256</code>,
      <code class="literal">lib.fakeSha512</code> or any other fake hash.
     </p><p>
      This is last resort method when reconstructing source URL is non-trivial
      and <code class="literal">nix-prefetch-url -A</code> isn't applicable (for example,
      <a class="link" href="https://github.com/NixOS/nixpkgs/blob/d2ab091dd308b99e4912b805a5eb088dd536adb9/pkgs/applications/video/kodi/default.nix#L73" target="_top">
      one of <code class="literal">kodi</code> dependencies</a>). The easiest way then
      would be replace hash with a fake one and rebuild. Nix build will fail
      and error message will contain desired hash.
     </p><div class="warning"><h3 class="title">Warning</h3><p>
       This method has security problems. Check below for details.
      </p></div></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-source-hashes-security"></a>13.5.1. Obtaining hashes securely</h3></div></div></div><p>
     Let's say Man-in-the-Middle (MITM) sits close to your network. Then
     instead of fetching source you can fetch malware, and instead of source
     hash you get hash of malware. Here are security considerations for this
     scenario:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">http://</code> URLs are not secure to prefetch hash from;
      </p></li><li class="listitem"><p>
       hashes from upstream (in method 3) should be obtained via secure
       protocol;
      </p></li><li class="listitem"><p>
       <code class="literal">https://</code> URLs are secure in methods 1, 2, 3;
      </p></li><li class="listitem"><p>
       <code class="literal">https://</code> URLs are not secure in method 5. When
       obtaining hashes with fake hash method, TLS checks are disabled. So
       refetch source hash from several different networks to exclude MITM
       scenario. Alternatively, use fake hash method to make Nix error, but
       instead of extracting hash from error, extract
       <code class="literal">https://</code> URL and prefetch it with method 1.
      </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-patches"></a>13.6. Patches</h2></div></div></div><p>
    Patches available online should be retrieved using
    <code class="literal">fetchpatch</code>.
   </p><p>
</p><pre class="programlisting">
patches = [
  (fetchpatch {
    name = "fix-check-for-using-shared-freetype-lib.patch";
    url = "http://git.ghostscript.com/?p=ghostpdl.git;a=patch;h=8f5d285";
    sha256 = "1f0k043rng7f0rfl9hhb89qzvvksqmkrikmm38p61yfx51l325xr";
  })
];
</pre><p>
   </p><p>
    Otherwise, you can add a <code class="literal">.patch</code> file to the
    <code class="literal">nixpkgs</code> repository. In the interest of keeping our
    maintenance burden to a minimum, only patches that are unique to
    <code class="literal">nixpkgs</code> should be added in this way.
   </p><p>
</p><pre class="programlisting">
patches = [ ./0001-changes.patch ];
</pre><p>
   </p><p>
    If you do need to do create this sort of patch file, one way to do so is
    with git:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Move to the root directory of the source code you're patching.
</p><pre class="screen">
$ cd the/program/source</pre><p>
      </p></li><li class="listitem"><p>
       If a git repository is not already present, create one and stage all of
       the source files.
</p><pre class="screen">
$ git init
$ git add .</pre><p>
      </p></li><li class="listitem"><p>
       Edit some files to make whatever changes need to be included in the
       patch.
      </p></li><li class="listitem"><p>
       Use git to create a diff, and pipe the output to a patch file:
</p><pre class="screen">
$ git diff &gt; nixpkgs/pkgs/the/package/0001-changes.patch</pre><p>
      </p></li></ol></div><p>
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-submitting-changes"></a>Chapter 14. Submitting changes</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#submitting-changes-making-patches">14.1. Making patches</a></span></dt><dt><span class="section"><a href="#submitting-changes-submitting-changes">14.2. Submitting changes</a></span></dt><dt><span class="section"><a href="#submitting-changes-pull-request-template">14.3. Pull Request Template</a></span></dt><dd><dl><dt><span class="section"><a href="#submitting-changes-tested-with-sandbox">14.3.1. Tested using sandboxing</a></span></dt><dt><span class="section"><a href="#submitting-changes-platform-diversity">14.3.2. Built on platform(s)</a></span></dt><dt><span class="section"><a href="#submitting-changes-nixos-tests">14.3.3. Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)</a></span></dt><dt><span class="section"><a href="#submitting-changes-tested-compilation">14.3.4. Tested compilation of all pkgs that depend on this change using <span class="command"><strong>nox-review</strong></span></a></span></dt><dt><span class="section"><a href="#submitting-changes-tested-execution">14.3.5. Tested execution of all binary files (usually in <code class="filename">./result/bin/</code>)</a></span></dt><dt><span class="section"><a href="#submitting-changes-contribution-standards">14.3.6. Meets Nixpkgs contribution standards</a></span></dt></dl></dd><dt><span class="section"><a href="#submitting-changes-hotfixing-pull-requests">14.4. Hotfixing pull requests</a></span></dt><dt><span class="section"><a href="#submitting-changes-commit-policy">14.5. Commit policy</a></span></dt><dd><dl><dt><span class="section"><a href="#submitting-changes-master-branch">14.5.1. Master branch</a></span></dt><dt><span class="section"><a href="#submitting-changes-staging-branch">14.5.2. Staging branch</a></span></dt><dt><span class="section"><a href="#submitting-changes-stable-release-branches">14.5.3. Stable release branches</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="submitting-changes-making-patches"></a>14.1. Making patches</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Read <a class="link" href="https://nixos.org/nixpkgs/manual/" target="_top">Manual (How to
      write packages for Nix)</a>.
     </p></li><li class="listitem"><p>
      Fork the repository on GitHub.
     </p></li><li class="listitem"><p>
      Create a branch for your future fix.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         You can make branch from a commit of your local
         <span class="command"><strong>nixos-version</strong></span>. That will help you to avoid
         additional local compilations. Because you will receive packages from
         binary cache.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
            For example: <span class="command"><strong>nixos-version</strong></span> returns
            <span class="command"><strong>15.05.git.0998212 (Dingo)</strong></span>. So you can do:
           </p></li></ul></div><p>
</p><pre class="screen">
$ git checkout 0998212
$ git checkout -b 'fix/pkg-name-update'
</pre><p>
        </p></li><li class="listitem"><p>
         Please avoid working directly on the <span class="command"><strong>master</strong></span> branch.
        </p></li></ul></div><p>
     </p></li><li class="listitem"><p>
      Make commits of logical units.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         If you removed pkgs, made some major NixOS changes etc., write about
         them in
         <span class="command"><strong>nixos/doc/manual/release-notes/rl-unstable.xml</strong></span>.
        </p></li></ul></div><p>
     </p></li><li class="listitem"><p>
      Check for unnecessary whitespace with <span class="command"><strong>git diff --check</strong></span>
      before committing.
     </p></li><li class="listitem"><p>
      Format the commit in a following way:
     </p><pre class="programlisting">
(pkg-name | nixos/&lt;module&gt;): (from -&gt; to | init at version | refactor | etc)
Additional information.
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        Examples:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
           <span class="command"><strong>nginx: init at 2.0.1</strong></span>
          </p></li><li class="listitem"><p>
           <span class="command"><strong>firefox: 54.0.1 -&gt; 55.0</strong></span>
          </p></li><li class="listitem"><p>
           <span class="command"><strong>nixos/hydra: add bazBaz option</strong></span>
          </p></li><li class="listitem"><p>
           <span class="command"><strong>nixos/nginx: refactor config generation</strong></span>
          </p></li></ul></div><p>
       </p></li></ul></div></li><li class="listitem"><p>
      Test your changes. If you work with
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         nixpkgs:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
            update pkg -&gt;
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               <span class="command"><strong>nix-env -i pkg-name -f &lt;path to your local nixpkgs
               folder&gt;</strong></span>
              </p></li></ul></div><p>
           </p></li><li class="listitem"><p>
            add pkg -&gt;
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               Make sure it's in
               <span class="command"><strong>pkgs/top-level/all-packages.nix</strong></span>
              </p></li><li class="listitem"><p>
               <span class="command"><strong>nix-env -i pkg-name -f &lt;path to your local nixpkgs
               folder&gt;</strong></span>
              </p></li></ul></div><p>
           </p></li><li class="listitem"><p>
            <span class="emphasis"><em>If you don't want to install pkg in you
            profile</em></span>.
            </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
               <span class="command"><strong>nix-build -A pkg-attribute-name &lt;path to your local
               nixpkgs folder&gt;/default.nix</strong></span> and check results in
               the folder <span class="command"><strong>result</strong></span>. It will appear in the same
               directory where you did <span class="command"><strong>nix-build</strong></span>.
              </p></li></ul></div><p>
           </p></li><li class="listitem"><p>
            If you did <span class="command"><strong>nix-env -i pkg-name</strong></span> you can do
            <span class="command"><strong>nix-env -e pkg-name</strong></span> to uninstall it from your
            system.
           </p></li></ul></div><p>
        </p></li><li class="listitem"><p>
         NixOS and its modules:
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
            You can add new module to your NixOS configuration file (usually
            it's <span class="command"><strong>/etc/nixos/configuration.nix</strong></span>). And do
            <span class="command"><strong>sudo nixos-rebuild test -I nixpkgs=&lt;path to your local
            nixpkgs folder&gt; --fast</strong></span>.
           </p></li></ul></div><p>
        </p></li></ul></div><p>
     </p></li><li class="listitem"><p>
      If you have commits <span class="command"><strong>pkg-name: oh, forgot to insert
      whitespace</strong></span>: squash commits in this case. Use <span class="command"><strong>git
      rebase -i</strong></span>.
     </p></li><li class="listitem"><p>
      Rebase you branch against current <span class="command"><strong>master</strong></span>.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="submitting-changes-submitting-changes"></a>14.2. Submitting changes</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Push your changes to your fork of nixpkgs.
     </p></li><li class="listitem"><p>
      Create pull request:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         Write the title in format <span class="command"><strong>(pkg-name | nixos/&lt;module&gt;):
         improvement</strong></span>.
         </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>
            If you update the pkg, write versions <span class="command"><strong>from -&gt;
            to</strong></span>.
           </p></li></ul></div><p>
        </p></li><li class="listitem"><p>
         Write in comment if you have tested your patch. Do not rely much on
         <span class="command"><strong>TravisCI</strong></span>.
        </p></li><li class="listitem"><p>
         If you make an improvement, write about your motivation.
        </p></li><li class="listitem"><p>
         Notify maintainers of the package. For example add to the message:
         <span class="command"><strong>cc @jagajaga @domenkozar</strong></span>.
        </p></li></ul></div><p>
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="submitting-changes-pull-request-template"></a>14.3. Pull Request Template</h2></div></div></div><p>
    The pull request template helps determine what steps have been made for a
    contribution so far, and will help guide maintainers on the status of a
    change. The motivation section of the PR should include any extra details
    the title does not address and link any existing issues related to the pull
    request.
   </p><p>
    When a PR is created, it will be pre-populated with some checkboxes
    detailed below:
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-tested-with-sandbox"></a>14.3.1. Tested using sandboxing</h3></div></div></div><p>
     When sandbox builds are enabled, Nix will setup an isolated environment
     for each build process. It is used to remove further hidden dependencies
     set by the build environment to improve reproducibility. This includes
     access to the network during the build outside of
     <code class="function">fetch*</code> functions and files outside the Nix store.
     Depending on the operating system access to other resources are blocked as
     well (ex. inter process communication is isolated on Linux); see
     <a class="link" href="https://nixos.org/nix/manual/#description-45" target="_top">build-use-sandbox</a>
     in Nix manual for details.
    </p><p>
     Sandboxing is not enabled by default in Nix due to a small performance hit
     on each build. In pull requests for
     <a class="link" href="https://github.com/NixOS/nixpkgs/" target="_top">nixpkgs</a> people
     are asked to test builds with sandboxing enabled (see <code class="literal">Tested
     using sandboxing</code> in the pull request template) because
     in<a class="link" href="https://nixos.org/hydra/" target="_top">https://nixos.org/hydra/</a>
     sandboxing is also used.
    </p><p>
     Depending if you use NixOS or other platforms you can use one of the
     following methods to enable sandboxing
     <span class="bold"><strong>before</strong></span> building the package:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <span class="bold"><strong>Globally enable sandboxing on NixOS</strong></span>:
        add the following to <code class="filename">configuration.nix</code>
</p><pre class="screen">nix.useSandbox = true;</pre><p>
       </p></li><li class="listitem"><p>
        <span class="bold"><strong>Globally enable sandboxing on non-NixOS
        platforms</strong></span>: add the following to:
        <code class="filename">/etc/nix/nix.conf</code>
</p><pre class="screen">build-use-sandbox = true</pre><p>
       </p></li></ul></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-platform-diversity"></a>14.3.2. Built on platform(s)</h3></div></div></div><p>
     Many Nix packages are designed to run on multiple platforms. As such, it's
     important to let the maintainer know which platforms your changes have
     been tested on. It's not always practical to test a change on all
     platforms, and is not required for a pull request to be merged. Only check
     the systems you tested the build on in this section.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-nixos-tests"></a>14.3.3. Tested via one or more NixOS test(s) if existing and applicable for the change (look inside nixos/tests)</h3></div></div></div><p>
     Packages with automated tests are much more likely to be merged in a
     timely fashion because it doesn't require as much manual testing by the
     maintainer to verify the functionality of the package. If there are
     existing tests for the package, they should be run to verify your changes
     do not break the tests. Tests only apply to packages with NixOS modules
     defined and can only be run on Linux. For more details on writing and
     running tests, see the
     <a class="link" href="https://nixos.org/nixos/manual/index.html#sec-nixos-tests" target="_top">section
     in the NixOS manual</a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-tested-compilation"></a>14.3.4. Tested compilation of all pkgs that depend on this change using <span class="command"><strong>nox-review</strong></span></h3></div></div></div><p>
     If you are updating a package's version, you can use nox to make sure all
     packages that depend on the updated package still compile correctly. This
     can be done using the nox utility. The <span class="command"><strong>nox-review</strong></span>
     utility can look for and build all dependencies either based on uncommited
     changes with the <code class="literal">wip</code> option or specifying a github pull
     request number.
    </p><p>
     review uncommitted changes:
</p><pre class="screen">nix-shell -p nox --run "nox-review wip"</pre><p>
    </p><p>
     review changes from pull request number 12345:
</p><pre class="screen">nix-shell -p nox --run "nox-review pr 12345"</pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-tested-execution"></a>14.3.5. Tested execution of all binary files (usually in <code class="filename">./result/bin/</code>)</h3></div></div></div><p>
     It's important to test any executables generated by a build when you
     change or create a package in nixpkgs. This can be done by looking in
     <code class="filename">./result/bin</code> and running any files in there, or at a
     minimum, the main executable for the package. For example, if you make a
     change to <span class="package">texlive</span>, you probably would only check the
     binaries associated with the change you made rather than testing all of
     them.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-contribution-standards"></a>14.3.6. Meets Nixpkgs contribution standards</h3></div></div></div><p>
     The last checkbox is fits
     <a class="link" href="https://github.com/NixOS/nixpkgs/blob/master/.github/CONTRIBUTING.md" target="_top">CONTRIBUTING.md</a>.
     The contributing document has detailed information on standards the Nix
     community has for commit messages, reviews, licensing of contributions you
     make to the project, etc... Everyone should read and understand the
     standards the community has for contributing before submitting a pull
     request.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="submitting-changes-hotfixing-pull-requests"></a>14.4. Hotfixing pull requests</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Make the appropriate changes in you branch.
     </p></li><li class="listitem"><p>
      Don't create additional commits, do
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
         <span class="command"><strong>git rebase -i</strong></span>
        </p></li><li class="listitem"><p>
         <span class="command"><strong>git push --force</strong></span> to your branch.
        </p></li></ul></div><p>
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="submitting-changes-commit-policy"></a>14.5. Commit policy</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Commits must be sufficiently tested before being merged, both for the
      master and staging branches.
     </p></li><li class="listitem"><p>
      Hydra builds for master and staging should not be used as testing
      platform, it's a build farm for changes that have been already tested.
     </p></li><li class="listitem"><p>
      When changing the bootloader installation process, extra care must be
      taken. Grub installations cannot be rolled back, hence changes may break
      people's installations forever. For any non-trivial change to the
      bootloader please file a PR asking for review, especially from @edolstra.
     </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-master-branch"></a>14.5.1. Master branch</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       It should only see non-breaking commits that do not cause mass rebuilds.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-staging-branch"></a>14.5.2. Staging branch</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       It's only for non-breaking mass-rebuild commits. That means it's not to
       be used for testing, and changes must have been well tested already.
       <a class="link" href="https://web.archive.org/web/20160528180406/http://comments.gmane.org/gmane.linux.distributions.nixos/13447" target="_top">Read
       policy here</a>.
      </p></li><li class="listitem"><p>
       If the branch is already in a broken state, please refrain from adding
       extra new breakages. Stabilize it for a few days, merge into master,
       then resume development on staging.
       <a class="link" href="http://hydra.nixos.org/jobset/nixpkgs/staging#tabs-evaluations" target="_top">Keep
       an eye on the staging evaluations here</a>. If any fixes for staging
       happen to be already in master, then master can be merged into staging.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="submitting-changes-stable-release-branches"></a>14.5.3. Stable release branches</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       If you're cherry-picking a commit to a stable release branch, always use
       <span class="command"><strong>git cherry-pick -xe</strong></span> and ensure the message contains a
       clear description about why this needs to be included in the stable
       branch.
      </p><p>
       An example of a cherry-picked commit would look like this:
      </p><pre class="screen">
nixos: Refactor the world.

The original commit message describing the reason why the world was torn apart.

(cherry picked from commit abcdef)
Reason: I just had a gut feeling that this would also be wanted by people from
the stone age.
      </pre></li></ul></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="sec-reviewing-contributions"></a>Chapter 15. Reviewing contributions</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#reviewing-contributions-package-updates">15.1. Package updates</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-new-packages">15.2. New packages</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-module-updates">15.3. Module updates</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-new-modules">15.4. New modules</a></span></dt><dt><span class="section"><a href="#reviewing-contributions-other-submissions">15.5. Other submissions</a></span></dt><dt><span class="section"><a href="#reviewing-contributions--merging-pull-requests">15.6. Merging pull requests</a></span></dt></dl></div><div class="warning"><h3 class="title">Warning</h3><p>
    The following section is a draft, and the policy for reviewing is still
    being discussed in issues such as
    <a class="link" href="https://github.com/NixOS/nixpkgs/issues/11166" target="_top">#11166
    </a> and
    <a class="link" href="https://github.com/NixOS/nixpkgs/issues/20836" target="_top">#20836
    </a>.
   </p></div><p>
   The Nixpkgs project receives a fairly high number of contributions via
   GitHub pull requests. Reviewing and approving these is an important task and
   a way to contribute to the project.
  </p><p>
   The high change rate of Nixpkgs makes any pull request that remains open for
   too long subject to conflicts that will require extra work from the
   submitter or the merger. Reviewing pull requests in a timely manner and
   being responsive to the comments is the key to avoid this issue. GitHub
   provides sort filters that can be used to see the
   <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-desc" target="_top">most
   recently</a> and the
   <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-asc" target="_top">least
   recently</a> updated pull requests. We highly encourage looking at
   <a class="link" href="https://github.com/NixOS/nixpkgs/pulls?q=is%3Apr+is%3Aopen+review%3Anone+status%3Asuccess+-label%3A%222.status%3A+work-in-progress%22+no%3Aproject+no%3Aassignee+no%3Amilestone" target="_top">
   this list of ready to merge, unreviewed pull requests</a>.
  </p><p>
   When reviewing a pull request, please always be nice and polite.
   Controversial changes can lead to controversial opinions, but it is
   important to respect every community member and their work.
  </p><p>
   GitHub provides reactions as a simple and quick way to provide feedback to
   pull requests or any comments. The thumb-down reaction should be used with
   care and if possible accompanied with some explanation so the submitter has
   directions to improve their contribution.
  </p><p>
   pull request reviews should include a list of what has been reviewed in a
   comment, so other reviewers and mergers can know the state of the review.
  </p><p>
   All the review template samples provided in this section are generic and
   meant as examples. Their usage is optional and the reviewer is free to adapt
   them to their liking.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions-package-updates"></a>15.1. Package updates</h2></div></div></div><p>
    A package update is the most trivial and common type of pull request. These
    pull requests mainly consist of updating the version part of the package
    name and the source hash.
   </p><p>
    It can happen that non-trivial updates include patches or more complex
    changes.
   </p><p>
    Reviewing process:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Add labels to the pull request. (Requires commit rights)
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">8.has: package (update)</code> and any topic label that fit
        the updated package.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the package versioning fits the guidelines.
     </p></li><li class="listitem"><p>
      Ensure that the commit text fits the guidelines.
     </p></li><li class="listitem"><p>
      Ensure that the package maintainers are notified.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <a class="link" href="https://help.github.com/articles/about-codeowners/" target="_top">CODEOWNERS</a>
        will make GitHub notify users based on the submitted changes, but it
        can happen that it misses some of the package maintainers.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the meta field information is correct.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        License can change with version updates, so it should be checked to
        match the upstream license.
       </p></li><li class="listitem"><p>
        If the package has no maintainer, a maintainer must be set. This can be
        the update submitter or a community member that accepts to take
        maintainership of the package.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the code contains no typos.
     </p></li><li class="listitem"><p>
      Building the package locally.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        pull requests are often targeted to the master or staging branch, and
        building the pull request locally when it is submitted can trigger many
        source builds.
       </p><p>
        It is possible to rebase the changes on nixos-unstable or
        nixpkgs-unstable for easier review by running the following commands
        from a nixpkgs clone.
</p><pre class="screen">
$ git remote add channels https://github.com/NixOS/nixpkgs-channels.git <a id="reviewing-rebase-1"></a><span><img src="images/callouts/1.svg" alt="1" border="0" /></span>
$ git fetch channels nixos-unstable <a id="reviewing-rebase-2"></a><span><img src="images/callouts/2.svg" alt="2" border="0" /></span>
$ git fetch origin pull/PRNUMBER/head <a id="reviewing-rebase-3"></a><span><img src="images/callouts/3.svg" alt="3" border="0" /></span>
$ git rebase --onto nixos-unstable BASEBRANCH FETCH_HEAD <a id="reviewing-rebase-4"></a><span><img src="images/callouts/4.svg" alt="4" border="0" /></span>
</pre><p>
        </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#reviewing-rebase-1"><span><img src="images/callouts/1.svg" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
           This should be done only once to be able to fetch channel branches
           from the nixpkgs-channels repository.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#reviewing-rebase-2"><span><img src="images/callouts/2.svg" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
           Fetching the nixos-unstable branch.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#reviewing-rebase-3"><span><img src="images/callouts/3.svg" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
           Fetching the pull request changes, <code class="varname">PRNUMBER</code> is
           the number at the end of the pull request title and
           <code class="varname">BASEBRANCH</code> the base branch of the pull request.
          </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#reviewing-rebase-4"><span><img src="images/callouts/4.svg" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
           Rebasing the pull request changes to the nixos-unstable branch.
          </p></td></tr></table></div><p>
       </p></li><li class="listitem"><p>
        The <a class="link" href="https://github.com/madjar/nox" target="_top">nox</a> tool
        can be used to review a pull request content in a single command. It
        doesn't rebase on a channel branch so it might trigger multiple source
        builds. <code class="varname">PRNUMBER</code> should be replaced by the number at
        the end of the pull request title.
       </p><pre class="screen">
$ nix-shell -p nox --run "nox-review -k pr PRNUMBER"
</pre></li></ul></div></li><li class="listitem"><p>
      Running every binary.
     </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-package-update"></a><p class="title"><strong>Example 15.1. Sample template for a package update review</strong></p><div class="example-contents"><pre class="screen">
##### Reviewed points

- [ ] package name fits guidelines
- [ ] package version fits guidelines
- [ ] package build on ARCHITECTURE
- [ ] executables tested on ARCHITECTURE
- [ ] all depending packages build

##### Possible improvements

##### Comments

</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions-new-packages"></a>15.2. New packages</h2></div></div></div><p>
    New packages are a common type of pull requests. These pull requests
    consists in adding a new nix-expression for a package.
   </p><p>
    Reviewing process:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Add labels to the pull request. (Requires commit rights)
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">8.has: package (new)</code> and any topic label that fit
        the new package.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the package versioning is fitting the guidelines.
     </p></li><li class="listitem"><p>
      Ensure that the commit name is fitting the guidelines.
     </p></li><li class="listitem"><p>
      Ensure that the meta field contains correct information.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        License must be checked to be fitting upstream license.
       </p></li><li class="listitem"><p>
        Platforms should be set or the package will not get binary substitutes.
       </p></li><li class="listitem"><p>
        A maintainer must be set. This can be the package submitter or a
        community member that accepts to take maintainership of the package.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the code contains no typos.
     </p></li><li class="listitem"><p>
      Ensure the package source.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        Mirrors urls should be used when available.
       </p></li><li class="listitem"><p>
        The most appropriate function should be used (e.g. packages from GitHub
        should use <code class="literal">fetchFromGitHub</code>).
       </p></li></ul></div></li><li class="listitem"><p>
      Building the package locally.
     </p></li><li class="listitem"><p>
      Running every binary.
     </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-new-package"></a><p class="title"><strong>Example 15.2. Sample template for a new package review</strong></p><div class="example-contents"><pre class="screen">
##### Reviewed points

- [ ] package path fits guidelines
- [ ] package name fits guidelines
- [ ] package version fits guidelines
- [ ] package build on ARCHITECTURE
- [ ] executables tested on ARCHITECTURE
- [ ] `meta.description` is set and fits guidelines
- [ ] `meta.license` fits upstream license
- [ ] `meta.platforms` is set
- [ ] `meta.maintainers` is set
- [ ] build time only dependencies are declared in `nativeBuildInputs`
- [ ] source is fetched using the appropriate function
- [ ] phases are respected
- [ ] patches that are remotely available are fetched with `fetchpatch`

##### Possible improvements

##### Comments

</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions-module-updates"></a>15.3. Module updates</h2></div></div></div><p>
    Module updates are submissions changing modules in some ways. These often
    contains changes to the options or introduce new options.
   </p><p>
    Reviewing process
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Add labels to the pull request. (Requires commit rights)
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">8.has: module (update)</code> and any topic label that fit
        the module.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the module maintainers are notified.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <a class="link" href="https://help.github.com/articles/about-codeowners/" target="_top">CODEOWNERS</a>
        will make GitHub notify users based on the submitted changes, but it
        can happen that it misses some of the package maintainers.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the module tests, if any, are succeeding.
     </p></li><li class="listitem"><p>
      Ensure that the introduced options are correct.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        Type should be appropriate (string related types differs in their
        merging capabilities, <code class="literal">optionSet</code> and
        <code class="literal">string</code> types are deprecated).
       </p></li><li class="listitem"><p>
        Description, default and example should be provided.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that option changes are backward compatible.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">mkRenamedOptionModule</code> and
        <code class="literal">mkAliasOptionModule</code> functions provide way to make
        option changes backward compatible.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that removed options are declared with
      <code class="literal">mkRemovedOptionModule</code>
     </p></li><li class="listitem"><p>
      Ensure that changes that are not backward compatible are mentioned in
      release notes.
     </p></li><li class="listitem"><p>
      Ensure that documentations affected by the change is updated.
     </p></li></ul></div><div class="example"><a id="reviewing-contributions-sample-module-update"></a><p class="title"><strong>Example 15.3. Sample template for a module update review</strong></p><div class="example-contents"><pre class="screen">
##### Reviewed points

- [ ] changes are backward compatible
- [ ] removed options are declared with `mkRemovedOptionModule`
- [ ] changes that are not backward compatible are documented in release notes
- [ ] module tests succeed on ARCHITECTURE
- [ ] options types are appropriate
- [ ] options description is set
- [ ] options example is provided
- [ ] documentation affected by the changes is updated

##### Possible improvements

##### Comments

</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions-new-modules"></a>15.4. New modules</h2></div></div></div><p>
    New modules submissions introduce a new module to NixOS.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Add labels to the pull request. (Requires commit rights)
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">8.has: module (new)</code> and any topic label that fit the
        module.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the module tests, if any, are succeeding.
     </p></li><li class="listitem"><p>
      Ensure that the introduced options are correct.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        Type should be appropriate (string related types differs in their
        merging capabilities, <code class="literal">optionSet</code> and
        <code class="literal">string</code> types are deprecated).
       </p></li><li class="listitem"><p>
        Description, default and example should be provided.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that module <code class="literal">meta</code> field is present
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        Maintainers should be declared in <code class="literal">meta.maintainers</code>.
       </p></li><li class="listitem"><p>
        Module documentation should be declared with
        <code class="literal">meta.doc</code>.
       </p></li></ul></div></li><li class="listitem"><p>
      Ensure that the module respect other modules functionality.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        For example, enabling a module should not open firewall ports by
        default.
       </p></li></ul></div></li></ul></div><div class="example"><a id="reviewing-contributions-sample-new-module"></a><p class="title"><strong>Example 15.4. Sample template for a new module review</strong></p><div class="example-contents"><pre class="screen">
##### Reviewed points

- [ ] module path fits the guidelines
- [ ] module tests succeed on ARCHITECTURE
- [ ] options have appropriate types
- [ ] options have default
- [ ] options have example
- [ ] options have descriptions
- [ ] No unneeded package is added to environment.systemPackages
- [ ] meta.maintainers is set
- [ ] module documentation is declared in meta.doc

##### Possible improvements

##### Comments

</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions-other-submissions"></a>15.5. Other submissions</h2></div></div></div><p>
    Other type of submissions requires different reviewing steps.
   </p><p>
    If you consider having enough knowledge and experience in a topic and would
    like to be a long-term reviewer for related submissions, please contact the
    current reviewers for that topic. They will give you information about the
    reviewing process. The main reviewers for a topic can be hard to find as
    there is no list, but checking past pull requests to see who reviewed or
    git-blaming the code to see who committed to that topic can give some
    hints.
   </p><p>
    Container system, boot system and library changes are some examples of the
    pull requests fitting this category.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="reviewing-contributions--merging-pull-requests"></a>15.6. Merging pull requests</h2></div></div></div><p>
    It is possible for community members that have enough knowledge and
    experience on a special topic to contribute by merging pull requests.
   </p><p>
    TODO: add the procedure to request merging rights.
   </p><p>
    In a case a contributor definitively leaves the Nix community, they should
    create an issue or post on
    <a class="link" href="https://discourse.nixos.org" target="_top">Discourse</a> with
    references of packages and modules they maintain so the maintainership can
    be taken over by other contributors.
   </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chap-contributing"></a>Chapter 16. Contributing to this documentation</h1></div></div></div><p>
   The DocBook sources of the Nixpkgs manual are in the
   <code class="filename"><a class="filename" href="https://github.com/NixOS/nixpkgs/tree/master/doc" target="_top">doc</a></code>
   subdirectory of the Nixpkgs repository.
  </p><p>
   You can quickly check your edits with <span class="command"><strong>make</strong></span>:
  </p><pre class="screen">
  $ cd /path/to/nixpkgs/doc
  $ nix-shell
  [nix-shell]$ make
</pre><p>
   If you experience problems, run <span class="command"><strong>make debug</strong></span> to help
   understand the docbook errors.
  </p><p>
   After making modifications to the manual, it's important to build it before
   committing. You can do that as follows:
</p><pre class="screen">
  $ cd /path/to/nixpkgs/doc
  $ nix-shell
  [nix-shell]$ make clean
  [nix-shell]$ nix-build .
</pre><p>
   If the build succeeds, the manual will be in
   <code class="filename">./result/share/doc/nixpkgs/manual.html</code>.
  </p></div></div></body></html>